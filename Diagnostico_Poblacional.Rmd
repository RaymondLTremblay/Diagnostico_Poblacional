---
title: "Dinamica Poblacional"
#output:
#  bookdown::gitbook:
#    highlight: tango
    #code_folding: hide
author: 
 - name: Raymond L. Tremblay 
   affiliation: Universidad de Puerto Rico, Recinto de Río Piedras y Humacao, Departamento de Biología, San Juan, Puerto Rico
 - name: Aucencia Emeterio Lara
   affiliation: Colegio de la Frontera Sur, ECOSUR, México
 - name: Elaine González
   affiliation: Orquídeario Soroa, Universidad de Pinar del Río, Apdo. postal No. 5 Candelaria, Pinar del Río, Cuba
 - name: Mariana Hernández-Apolinar
   affiliation: Universidad Nacional Autónoma de México, Facultad de Ciencias, México
 - name: Fabiola Hernández
   affiliation: Colegio de la Frontera Sur, ECOSUR, México
 - name: Diana C. Molina Ozuma
   affiliation: Colegio de la Frontera Sur, ECOSUR, México
 - name: Demetria Mondragón
   affiliation: Centro Interdisciplinario para la Investigación Integral Regional, CIIDIR-Oaxaca, México
 - name: Ernesto Mujíca Benitez
   affiliation: Orquídeario Soroa, Universidad de Pinar del Río, Apdo. postal No. 5 Candelaria, Pinar del Río, Cuba
 - name: Paola Portillo Tzompa
   affiliation: Universidad Nacional Autónoma de México, Facultad de Ciencias, México
 - name: Roberto Salguero Gómez
   affiliation: Laboratory of Evolutionary Biodemography Laboratory, Max Planck Institute for Demographic Research, Konrad-Zuse-Straße 1, Rostock DE-18057, Germany; ARC Centre of Excellence for Environmental Decisions, School of Biological Sciences, The University of Queensland, Goddard building 8, St. Lucia, Qld 4072, Australia;
 - name: Adriana Ramírez Martínez
   affiliation: Centro Interdisciplinario para la Investigación Integral Regional, CIIDIR-Oaxaca, México
 - name: Tamara Ticktin
   affiliation: Department of Botany, University of Hawaii at Manoa, 3190 Maile Way, Honolulu, HI 96822, USA.
   
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]
# biblio-style: apalike. # only applies to pdf format

description: |
  Este libro digital es una introdución al estudio de la Dinámica Poblacional con ejemplos de orquídeas. Los capítulos estan organizado de lo más básico a más complejo en la recolección de datos, análisis y interpretación de los resultados. Incluyendo acercamientos que fueron desarrollados más reciente para el análisis de datos de dinámica poblacional. Los capitulos de **Métodos Bayesiano de calcular las transiciones y fecundidad** y **Un protocolo para informar sobre modelos discreto de estructura de población** son especialmente importante para reducir los errores de cálculos de los parámetros y divulgación de los trabajos. El capitulo de **Impacto de datos sin sentidos** es *PRIMORDIAL* para los investigadores que trabajan con datos de dinámica poblacional y debería ser un capitulo donde uno regrese continuamente para evaluar sus análisis y interpretaciones. En otra palabra si los datos no tiene sentido biológico y matemático los resultados no sirven.  En adición se presenta múltiples ejemplos de datos sin sentido y como estos datos pueden impactar los resultados de los análisis de forma negativa.
  
Fecha de actualización: 2024-09-30

link-citations: yes

editor_options: 
  markdown: 
    wrap: 72 
---









*******



# Dinámica Poblacional

El estudio de la Dinámica Poblacional tiene como objetivo desarrollar conocimiento sobre los patrones y procesos intra-específica y variables inter-específicos que impacta el crecimiento de una especies en particular.  Tradicionalmente muchos de los trabajos de dinámica poblacional se enfocan en los estudios intra-específica, fomentando una perspectiva que las especies no inter-actúan con su ambiente abiótico o las especies en su entorno ecológico. Como toda las áreas de la ecología el desarrollo de los conceptos tienden a ser simplista al principio y con el tiempo se van complicando de forma conceptual y metodológicos. Para entender los procesos dinámicos de cualquier especie cuando se comienza a estudiar uno debería comenzar por modelos simples y con el tiempo ir complicando los modelos para entender los procesos más complejos y evaluar si realmente complicando los modelos se puede explicar mejor los procesos y patrones.  Este libro comienza por explicar las herramientas, conceptos y métodos más básicos en la dinámica poblacional enfatizando los supuestos y la limitaciones en el uso de cada indices y sus acercamientos. Al final del libro se enfatiza múltiples puntos que el investigador debería considerar al momento de hacer un análisis de dinámica poblacional y para reducir los sesgos y errores en los análisis. 

## Objetivo del libro: 

Este libro es orientado a dos grupos de personas: Para los estudiantes de pre-grado y posgrado que están interesados en aprender sobre la dinámica poblacional y para los investigadores que desean tener una guía de los conceptos y métodos tradicionales y más recientes en la dinámica poblacional. Pero nota que este libro no es un libro de texto tradicional, es una guía práctica de los conceptos y métodos en la dinámica poblacional. En cada capítulo se presentará una introducción a los conceptos y métodos y ejemplos prácticos de como aplicar estos conceptos y métodos usando la matemática más básica y como se interpreta de forma biológica.  En cada caso se ampliará con métodos y funciones disponible en varios paquetes de **R** para facilitar el análisis. La gran mayoría de los ejemplos matemáticos básicos se presentarán en **R**, y algunos en **MS Excel**.  Al final se debería tener una apreciación de la diversidad de metodologías y conceptos en la dinámica poblacional y como se puede aplicar a su estudio para contestar varios tipos de preguntas ecología, de conservación y evolución.Un esfuerzo de recopilar referencias de la literatura de la dinámica poblacional de las orquídeas y otros organismos (tanto animales como otro grupos de plantas) se ha hecho para que el lector pueda tener una idea de los estudios que se han hecho. Se espera que la diversidad de ejemplos puede dar una apreciación holística de la diversidad de acercamiento, fortalezas y retos.


## Estructura del libro

El libro se divide en **xx** capítulos. Estos capítulos están organizados para que el lector pueda seguir el proceso de recolección de datos, análisis y interpretación de los resultados. Incluyendo acercamientos que fueron desarrollados más reciente para el análisis de datos de dinámica poblacional. Los capítulos de **Métodos Bayesiano de calcular las transiciones y fecundidad** y **Un protocolo para informar sobre modelos discreto de estructura de población** son especialmente importante para reducir los errores de cálculos de los parámetros y divulgación de los trabajos. 

1. **Ciclo de vida de una especie**:

El primer capitulo presenta un concepto fundamental en la dinámica poblacional, el ciclo de vida. Cada especie tiene un ciclo de vida **REAL**, donde el investigador siempre debería tratar de replicar en la recolección de datos incluyendo información para cada etapa/edad de la vida de la especie. El ciclo de vida **REAL** es la base para entender los procesos de la dinámica poblacional. Noto aquí que entre el ciclo de vida **REAL** de una especie y la capacidad de recolección de datos sobre el mismo hay una brecha que el investigador debería tratar de cerrar. Un ejemplo extremo, recientemente acaban de descubrir un cadáver de una especies de ballena en Nueva Zelanda, que se llama "Spade tooth whale" donde se ha encontrado desde su descripción (1874) solamente 6 individuos. Sin duda hacer un estudio considerando el ciclo de vida de esta especie sería un reto. Cualquier especie que se estudie con tan pocos datos es un reto, y múltiples supuestos del ciclo de vida de la especie tendrían que ser incluidos.  Lo más importante es reconocer lo que es un supuesto (y por consecuencia una hipótesis) y lo que es un hecho o sea la realidad. 

En las orquídeas, hay multiples etapas del ciclo de vida, las etapas de semillas, germinación (colonización de semillas por un hongo apropiado para su germinación en el campo) y plántulas son etapas críticas en el ciclo de vida de la especie, pero son etapas que son difíciles de recolectar datos en el campo. Estas etapas son primordial para entender la dinámica poblacional de las orquídeas, pero desafortunado estamos todavía muy ignorante de estas etapas en el campo, y la variación en los procesos y patrones. Enfatizo el hecho que son procesos en el hábitat natural, mucho de lo que conocemos es de estudios en laboratorio, que pudiese ser procesos y patrones sesgados. 

Lo importante de este capitulo es reconocer varios aspectos del ciclo de vida de una especie y como se puede categorizar de forma practica para la recolección de datos para entender los procesos de la dinámica poblacional y reconocer los supuestos y limitaciones en la interpretaciones de lo que es el ciclo de vida de las orquídeas recolectado versus lo ciclos de vida real de una especie.

2. **Recolección de datos**:

Ese capitulo se enfoca en la recolección de datos en el campo, métodos de muestreo, marcar, identificar y seguir los individuos a través de múltiples periodos de tiempo. Enfatizamos tres tipos de recolección de datos basado en su ciclo de vida, epifitas, terrestres, y terrestres con latencia. Para ayudar en la compresión de los métodos de muestreo se presentará ejemplos de la literatura o experiencia de los autores. En adición se presenta múltiples métodos para hacer estudios de marca y recaptura en orquídeas y se sugiere múltiples sistema de marca para reducir los errores de confusión en identificar individuos entre poblaciones y periodo de muestreo.

3. **Transiciones de etapa/edad**:

El tercer capitulo se enfoca en como calcular las transiciones de una etapa/edad de un muestreo a otro. Se comienza con análisis que se puede hacer a mano, y después se presentará como hacerlo en R.  En este capitulo se presenta los métodos de calcular de forma simple y se discute algunos los supuestos y limitaciones. Estos métodos tradicional son especialmente practico para poblaciones grandes con tamaño de muestra grande para cada una de las etapas o grupo de edad. Cuando los tamaños de muestra son pequeñas o la probabilidad de una transición es rara vea el capitulo de métodos Bayesianos para calcular las transiciones.

4. **Calcular la fecundidad**:

Este capitulo se enfoca en como calcular la fecundidad de una especie. El capítulo se enfoca en tratar de que los investigadores reconozcan que los indices de fecundidad tienen que estar relacionados con las etapas de vida de la especie que se esta modelando. En otra palabra si la primera etapa del ciclo de vida son plántulas, la fecundidad debería ser relacionada con la producción de semillas que se convierte en plántulas. En este capitulo se presentará los métodos de calcular de forma simple y se discute algunos los supuestos y limitaciones. En adición se asume en estos calculo tradicional que las probabilidad de fecundidad tienen una distribución normal, y suficiente grandes.  Si las probabilidades de fecundidades son raras y los parámetros son cerca de cero vea el capitulo de métodos Bayesianos para calcular la fecundidad. En adición si la distribución de fecundidad no cumple con una distribución normal vea el capitulo de métodos Bayesianos para calcular la fecundidad. Es posible que una distribución gamma sea una mejor acercamiento a la distribución de fecundidad de una especie.


5. **Relación entre las matriz de transiciones, fecundidad y clonaje**:

Este capítulo se enfoca en como relacionar las diferentes matrices de transiciones, fecundidad y clonaje.  La suma de los tres tipo de matriz refleje el ciclo de vida de la especie estudiado. Separar las matriz en una de transición, fecundidad y clonaje ayuda a aclarar los procesos y patrones de la dinámica poblacional en adición que ciertos indices depende que la matriz sea separada. Por ejemplo para calcular el largo de vida de una especies (life span) se usa solamente la matriz de transición y o clonaje [@orive1993effective].

6. **Métodos Bayesiano de calcular las transiciones y fecundidad**:

Este nuevo procedimiento incluido en un paquete de R, llamado **raretrans** tiene como objetivo resolver múltiples asuntos en la estimación de los parámetros de transiciones y fecundidad. Específicamente en la falta de datos de transiciones raras y datos con parámetros sin sentido biológicos (ejemplo: supervivencia perfecta, ninguna mortandad). Aunque este paquete es nuevo y no ha sido implementado en múltiples estudios todavía, se espera que las funciones en este paquete sean herramientas útiles para los investigadores que trabajan con datos de dinámica poblacional especialmente cuando se trata de especies raras donde la recolección de datos es limitada a tamaño de muestras pequeñas [@tremblay2021population; @ospina2023effect].


7. **Crecimiento poblacional**:

El crecimiento poblacional se refiere a si la población es estable, creciendo o reduciendo. Se presentará los métodos de calcular de forma simple y se discute algunos los supuestos y limitaciones. Se discute los diferentes tipos de indices de crecimiento poblacional y como se puede interpreta.

8. **Análisis de sensibilidad y elasticidad**:

Los análisis de sensibilidad y elasticidad son herramientas para evaluar la importancia relativa de los cambios en los parámetros de la matriz de transición sobre el crecimiento poblacional. En este capitulo se presentará los métodos de calcular de forma simple y se discute algunos los supuestos y limitaciones. Se discute cual es la diferencias entre matriz de sensibilidad y elasticidad y como se puede interpretar los resultados como herramienta para el manejo de las especies para su conservación. Un ejemplo de la importancia de estos análisis se encuentra en los trabajos sobre la tortuga boba, *Caretta caretta* [@crouse1987stage; @crowder1994predicting] donde se ha encontrado que la supervivencia de las hembras adultas es el parámetro más importante para el crecimiento poblacional de la especie, mucho más que la supervivencia de los huevos (eso no quiere decir que uno no debería proteger los huevos). Lo que identifica es que para cada adulto que se protege tiene un potencial de aumento poblacional muchos más grande que salvar un huevo. 


9. **Indices de historia de vida**:

10. **Dinámica de transiciones**:

La dinámica de transciones evalúa los cambios en parámetros (tamaño poblacional, supervivencia, fecundidad) a lo largo del tiempo o a tiempo corto o largo. Ejemplos, incluye como la distribuciones de etapas al comienzo del estudio impacta el crecimiento poblacional, o como la supervivencia de una etapa impacta el crecimiento poblacional. En este capitulo se presentará los métodos de calcular de forma simple y se discute algunos los supuestos y limitaciones. Gran parte de estos acercamiento fuero desarollados por Stott y collegas [@stott2010boom; @mcdonald2016transients] y otros [@heggerud2023transient] han usado en múltiples estudios de dinámica poblacional evaluando como los cambios de transiciones son dinámicos.  La ventaja de esta acercamiento es que se puede evaluar los cambios en los parámetros de la matriz de transición y como impacta el crecimiento poblacional y no asumir que los cambios necesariamente lleguen a una población de son estables.

11. **Funciones de transferencias**:

12. **Experimento de Respuesta de Tabla de Vida**:

13. **Variación Espacial y Temporal: simulaciones**:

14. **Impacto de datos sin sentidos**:

Este capitulo es *PRIMORDIAL* para los investigadores que trabajan con datos de dinámica poblacional y debería ser capitulo donde uno regrese continuamente para evaluar sus análisis y interpretaciones. Hay un dicho en Ingles que dice, *Garbage in Garbage out*. En otra palabra si los datos no tiene sentido biológico y matemático los resultados no sirven, .  En este capitulo se presentará múltiples ejemplos de datos sin sentido y como estos datos pueden impactar los resultados de los análisis de forma negativa. 

15. **Un protocolo para informar sobre modelos discreto de estructura de población**:

En este capitulo se presenta un protocolo para informar sobre modelos discreto de estructura de población. Este protocolo es una guía para los investigadores para asegurar que toda la información necesaria es presente para evaluar críticamente sus manuscritos. Este capitulo es una traducción de **A standard protocol to report discrete stage-structured demographic information** [@gascoigne2023standard]. *Antes de publicar un estudio usando matrices de proyección se debería asegurar que cumple con la mayoría de las recomendaciones presentadas en este protocolo.*

16. **Estudios evolutivos de la dinámica poblacional: Ejemplos con Orquídeas**:

17. **Sinopsis Históricos de Estudios de Dinámica Poblacional en Orquidea**:

18. **COMPADRE: Una base de datos de matrices de vida de plantas**:

Todos las publicaciones (revido por pares, tesis, informes técnicos) que tienen matrices de vida de plantas están incluido en COMPADRE (por lo menos es el objetivo). En este capitulo se presenta la base de datos con un sub-grupo de especies (las Orquídeas) y se evalúa como utilizar la base datos. La funciones (scripts) para extraer las matrices y analizar los datos están disponible en el paquete de R **RCompadre**. En adición se evalúa múltiples hipótesis sobre la dinámica poblacional de las orquídeas y determinar si hay patrones generales en la dinámica poblacional de las orquídeas entre grupos (por ejemplo terrestres vs. epífitas, distribución mundial, tiempo de estudios, etc). Este un capitulo para dar ideas a investigadores que trabajan con datos de dinámica poblacional y como se puede hacer análisis de datos a gran escala. 

19. **Conclusiones**:

En este capitulo se presentará las conclusiones generales del libro y se presentará las recomendaciones para futuras investigaciones en la dinámica poblacional. En adición se hace referencias a nuevos métodos y conceptos que no se han presentado en el libro.

Apéndice 1: **Lista de especies de Orquídeas estudiadas usando PPM**:

Lista de las especies de orquídeas que se han estudiado en la dinámica poblacional y la referencia de los estudios. EL tema principal de cada manuscrito/estudio esta presentado en una tabla para que el lector pueda buscar los estudios que le interesa.




## Paquetes de R principales usado en el libro

Los paquetes principales para el análisis de dinámica poblacional al incluye

 - *popbio*: un paquete para analizar datos de dinámica poblacional basado en funciones que se encuentran en el libro de Caswell [@caswell2001matrix] y en el libro de Morris y Doak [@morris2002quantitative] por edades o etapas [@popbio2007].
 
 - *popdemo*: un paquete que incluye Herramientas para modelar poblaciones y demografía utilizando modelos de proyección matricial, con implementaciones de modelos deterministas y estocásticos. Incluye proyección de población, índices de tamaño y crecimiento de la población a corto y largo plazo, análisis de perturbaciones, convergencia hacia la estabilidad o estacionaria [@popdemo2021].
 
 - *raretrans*: Funciones para crear modelos matriciales de población a partir de una combinación de datos sobre transiciones de etapa/edad con información previa bayesiana. Esto compensa los problemas estructurales causados por la falta de observaciones de transiciones raras y datos sin sentido biológicos [@raretrans2024] (vea capitulo XX).
 
 - *Rage*: Funciones para calcular métricas de historia de vida utilizando modelos matriciales de población ("MPM"). Descrito en Jones [@Rage2022]. 
 
 - *RCompadre*: Un paquete para analizar datos recopilado en la base de datos de COM(P)ADRE: ese es un base de datos de matrices de vida de plantas y animales usando matrices [@jones2022rcompadre].
 

Otros paquetes que se usan para analizar datos, mayormente para manipular datos, hacer modelos estadísticos y visualización incluye:

 - *ggplot2*: # para hacer gráficos 
 - *dplyr*: # para manipular datos
 - *tidyr* # para manipular datos
 - *lubridate* # para trabajar con fechas

 


## Libro digital y archivos de datos
 
El libro se encuentra en el siguiente enlace, donde el acceso a todas las funciones y datos están disponibles para reproducir los ejemplos utilizado en el libro. 

https://raymondltremblay.github.io/Diagnostico_Poblacional/
 
 
 

 Revisión: Sept 14, 2024

<!--chapter:end:index.Rmd-->

---
output:
  html_document:
    code_folding: show
  pdf_document: default
  word_document: default
---


```{css, eval=FALSE, echo=FALSE}
body {
  counter-reset: counter-rchunks;
}

div.main-container {
  padding-left: 5em;
}

pre.r {
  counter-increment: counter-rchunks;
  position: relative;
  overflow: visible;
}

pre.r::before {
  content: 'In [' counter(counter-rchunks) ']: ';
  display: inline-block;
  position: absolute;
  left: -5em;
  color: rgb(48, 63, 159);
}
```




# ¿Qué es el analisis de dinamica poblacional?

Por: Por RLT, Nhora Ospina, Demetria y Anne .....

***

El objetivo de la conservación biológica es asegurar que las especies pueden sobrevivir, reproducirse y dejar progenie viable de una generación a otra. Por consecuencia se necesita que las variables intrínsicas y extrínsicas, bióticas y abióticas de cada especies estén considerado con todas sus interacciones. Naturalmente aunque el concepto es sencillo, tomar en cuanta **TODAS** las posibles interacciones biológicas y abióticas es imposible. Por consecuencia, uno tiene que simplificar el problema y descubrir y considerar las interacciones más importantes.

El primer paso a la conservación es considerar el ambiente adecuado para cada especie. Sin duda en los últimos 50 años en muchos países ha habido un cambio grande en el apreciación hacia la conservaciones de bosque, pradera, desierto y todos los biomas en general. Por ejemplo el cambio de cobertura de bosque en Puerto Rico ha aumentado de circa de 2-5% en los años 1910 a más 40-55% en el 2000 [@pares2008agricultural; @gould2017land]. En general en Latino América ha habido en los últimos años más reforestación que deforestación [@aide2013deforestation], aunque varia mucho entre países y periodo de tiempo. Para la conservación biológica el primer paso era reconocer que los hábitat necesitan ser protegido.  Pero, ¿es suficiente proteger los hábitat para asegurar la supervivencia de las especies?

Muchos de estos nuevos hábitat son bosque secundarios, fragmentados y dominado por especies introducidas. Estos hábitat por consecuencia son mayormente diferentes al ambiente antes del impacto de la deforestación o antes los cambios antropogénicos recientes. Aunque como ecólogos sabemos que los cambios antropogenicos sobre el ambiente no es reciente, la evidencia del impacto de los humanos y sus ancestros han tenido un impacto hasta la extirpación de especies en cierto lugares desde más de 2000 años. El resultado, en muchas ocasiones, es que la especies de interés están reducida en números de individuos o fragmentados. Considerando esos remanentes de individuos en el hábitat, ¿es el hábitat remanente suficiente para mantener una población viable? ¿Como que uno decide que una población es viable y tenga una alta probabilidad de sobrevivir en 5, 100 o 500 años?

En general, el conceptos de conservación es que si uno protege los hábitat las especies estarán conservadas. Pero lo que no es asegurado que la presencia de individuos en un sitio que este protegido o que haya muchos individuos no es suficiente para asegurar la supervivencia de una especies a largo plazo. Un ejemplo bien conocida es la extinción del Dodo un ave de la isla de Mauritius y la estrecha relación biótica y casi extinción de una especies de árbol en la familia Sapotaceae, *Calvaria major*. Aun que el ultimo Dodo vivo fue en 1681, todavía sobrevive *Calvaria major*.  Stanley Temple desmostó que el reclutamiento de esa especie dependía del Dodo [@temple1977plant]. Para que la semillas sean viable necesitan pasar por el tracto digestivo de un pájaro para remover el exocarpo persistente de la semilla que causa latencia/"dormancy" en las semillas [@temple1977plant]. Por consecuencia nunca se puede asumir que la presencia de una especies sin tomar en cuenta las interacciones bióticas y abióticas es suficiente para sugerir que no hay riesgo de extinción. En este caso más de 300 años después de la extinción del Dodo, la especies de árbol todavía sobrevive, pero en un estado muy vulnerable.

## Un recuento histórico breve de la ecología de poblaciones

Los primeros estudios poblacionales se enfocan en contar cuantos individuos de varias especies hay en un sitio y el impacto de varios tipo de efecto antropogénico o de especies invasivas [@crawley1990population]. Crawley [@crawley1990population] indica que los primeros estudios publicados de conteo de números individuos en plantas son de Carr (1848) y Burdon (1856) ambos fueron presidente de la "Tyneside Natural History Society" en Inglaterra.  En la publicación de Burdon se menciona individuos de *Cypripedium calceolus* en el Castle Eden Dene en el County de Durham hasta la perdida completa de todos los individuos de *C. calceolus* en el sitio en 1850 (extraido de la publicación de Michael J. Crawley [@crawley1990population]). Evaluando la publicación original desafortunadamente no se menciona la cantidad de individuos en el sitio [@baker1867northumberland]. 

Un otro de los estudios pionero en la dinámica de población fue establecido por V. M. Spalding en 1906 en el Carnegie Institute Desert Laboratory para contabilizar la cantidad de individuos del cactus de Saguaro, *Carnegiea gigantea*, para evaluar el efecto en la reducción del cactus y el aumento con la especie invasiva *Prosopis glandulosa* y la correlación con aumento en la ganadería en el área.  

En la revisión de literatura de Crawley [@crawley1990population] sobre la dinámica de poblaciones de plantas el menciona siete componentes de la biología de plantas que parecen ser consistente. 

 - El tamaño de las plantas son plástica, por consecuencia el tamaño de las plantas no es un buen indicador de la edad de la planta y la correlaciones tamaño y edad varia entre especies [@gatsuk1980age; @le2004use; @vanderklein2007plant; @baden2021effects] .
 - Debido que las plantas son sedentarias la interacciones con sus vecinos más inmediato es importante y que la cantidad de individuos que rodea una planta impacta su crecimiento, reproducción y supervivencia [@mitchell1987analysis; @pantone1992path; postma2021dividing]. En la revisión de literatura de Postma [@postma2021dividing] donde se evalúa 334 experimentos en un meta-análisis de como la biomasa de la plantas y las característica fenotípicas cambian. Se observa que al aumentar la densidad el tamaño de la plantas se reduce con el números de talos y ramas, pero la altura de las plantas no es afectada. 
 - Los cambios succesionales en estructura poblacional (en tiempo) es la regla y no la excepción [@young1987seed; @de2013early]. Por consecuencia el reclutamiento o supervivencia en una parcela específica puede ser muy variable en el tiempo y espacio [@acacio2007multiple] incluyendo variables biótica y abióticas [@luzuriaga2008determines].
 - El reclutamiento puede ser infrecuente, impredecible y variable en el tiempo. En adición como muchas especies produce bancos de semillas, el reclutamiento pudiese ser de semillas que han estado en el banco de semillas por muchos años [@saatkamp201411; @fenner2017ecology; @tomowski2023recruitment] y el reclutamiento pudiese ser de un conjunto de semillas de diferentes años o cohortes.
 - La competencia entre individuos de la misma especies de plantas o especies distintas es importante y asimétrica.  Típicamente las plantas grandes pueden afectar las plantas pequeñas en su entorno, y raramente al revés.  La competencia a nivel intra especifica [@weiner1986size; @connolly1996asymmetric; @weiner2001effects] o inter-especifica [@freckleton2001asymmetric ] son comunes.
 - La mortandad es altamente relacionado al tamaño de la planta y mayormente observado en las etapas/tamaños más pequeños comparando diferentes especies [@moles2006seed] y también intra-especifica [@fricke2019linking].
 - La mortandad de individuos grandes, viejos, por accidentes, herbivoría o enfermedades puede abrir una oportunidad de reclutamiento [wright2003gap].  



## ¿Qué es el estudio de la dinámica poblacional?

La dinámica poblacional tiene como meta tomar en cuenta todas las etapas/edades de una especies y interacciones y evaluar cuales de estas etapas/edades tiene relativamente más impacto sobre la supervivencia de la especies para conocer cuales de estas etapas/edades se pudiese modificar para cambiar el crecimiento de la poblaciones estudiadas. Se debería considerar las interacciones con sus ambiente biótico y abiótico. La dinámica de población es fundamental en todas las áreas de la ecología y evolución. Comprender la dinámica poblacional es la clave para entender la importancia relativa que tiene el acceso a los recursos y el efecto de competencia, herbivoría y depredaciones sobre la viabilidad de especies y la persistencia de la población. Tradicionalmente los estudios estaban enfocado a evaluar la tabla de vida para el manejo, la fenología y conservaciones de especies particulares [@harper1977population]. Sin duda John L. Harper fue uno de los pioneros de la ecología de plantas y ha dejado una diversidad de publicaciones y temas amplios [@sagar1985profile].  En años más recientes los estudios se han diversificado para evaluar la interacciones entre especies y su ambiente [@caswell2001matrix; @bacaer2011short] .

## Definición

Una definición más específica de los estudios de dinámica poblacional es que son definidos como los análisis de los factores que afecten el crecimiento, estabilidad y reducción en el tamaño de la población en una serie de tiempo.

Por ejemplo, la dinámica poblacional de especies invasivas incluye un periodo de crecimiento muy lento al comienzo de la colonización de un nuevo sitio y frecuentemente seguido de un crecimiento logarítmico y posteriormente de una reducción en crecimiento poblacional. La figura \@ref(fig:Pop-fig_1) demuestra el cambio de número de individuos en el tiempo de una especie invasiva hipotética. Lo importante es que la dinámica poblacional es una herramienta para evaluar el impacto de diferentes factores sobre el crecimiento de la poblacional y la viabilidad de la población.



```{r chap1_1 ggplot2, echo=FALSE}
library(ggplot2)
        rlt_theme <- theme_bw()+
          theme(axis.title.y = element_text(colour="grey20",size=15,face="bold"),
                   axis.text.x = element_text(colour="grey20",size=15, face="bold"),
                   axis.text.y = element_text(colour="grey20",size=20,face="bold"),  
                   axis.title.x = element_text(colour="grey20",size=15,face="bold"))
                    
```

```{r Pop-fig_1, fig.cap='Cambio poblacional en tiempo'}
ggplot(pressure, aes(temperature, pressure))+
  geom_point()+
  rlt_theme+
  xlab("Tiempo")+
  ylab("Tamaño poblacional, N")

```

## El analisis de Dinámica Poblacional y su uso

Determinar el tamaño poblacional en el futuro tiene muchos usos. Se puede dividir sus usos en tres grupos grandes, entender las **1)** interacciones ecológicas, **2)** manejo y conservaciones o **3)** los procesos evolutivos. Los estudios enfocado a la conservación se engloba dentro de un acercamiento de la viabilidad de poblaciones. En este libro estaremos dando una introducción a cada uno de estas vertientes, pero nuestros ejemplos son una introducción al tema y no una profundización extensa de cada uno. En la table \@ref(USO) vemos algunos de los usos específicos que se ha dado con la metodología de MPP. La lista de como se ha usado los análisis de PPM proviene en parte de las ideas de Morris and Doak [@morris2002quantitative] y expandido. 



### Tabla: El uso potencial de la diferentes acercamiento de PPM. {#USO}

NOTA IMPORTANTE: *Evaluar las referencias y añadir referencias tradicionales y recientes*

| Categoría de Uso  | Uso especifico | Referencias generales  | Referencias con Orquídeas |
|:----------------|:-------------------|:----------------|-------------------:|
| Manejo          | Identificar las etapas o procesos demográficos claves   | [@crouse1987stage] |  [@shefferson2003life; @kery2004demographic; @zotz2006population; @zhongjian2008correlation; @tremblay2009dormancy; @tremblay2009population] |
|                                | Determinar cuantos individuos en una población es necesario para reducir la extinción                            | [@shaffer1981minimum; @armbruster1993population] |                      ?   |
|                                | Determinar cuantos individuos se necesita introducir en una sitio para establecer una población viable           | [@bustamante1996population]                      |                        ? |
|                                | Determinar cuantos individuos se puede extraer sin tener un impacto negativo sobre la viabilidad de una población | [@nantel1996population]                  |                        [@emeterio2021does] |
|                                | En especies invasivas determinar cuantos y cual etapas se necesita remover para controlar la población           | [@arroyo2022prescriptions]                                   |                        ? |
|                                | Determinar cuantas poblaciones se necesita para la viabilidad de una especie al nivel local o global             | [@lindenmayer1996ranking]      |                      [@tremblay2006epiphytic; @lind2007metapopulation; @winkler2009population; @garcia2010living; @kindlmann2014disobedient]    |
| Evaluación de riesgos          | Evaluar el riesgo de una población                                                                               | [@gotelli2006forecasting]                          |                   [@nicole2005population; @iriondo2009peligro; @hutchings2010population; @thorpe2011trends; @raventos2015transient; @hens2017low; @ackerman2020small; @berry2021population; @timsina2021six]|
|                                | Comparando el riesgo relativo de dos o más poblaciones o especies                                                          | [@earl2019evaluating]               |                        [@raventos2018comparison; @schodelbauerova2010prediction; @crain2019sheltered] |
| Interacciones ecológicas       | Evaluar interacciones ecológicas abiótica y biótica para entender las variables importantes para la supervivencia de una población  | [@halpern2006approaches]                                   |     [@coates2006effects; @sletvold2010long; @sletvold2013climate; @ospina2023effect] |
| Procesos y patrones evolutivos | Cual de los procesos, interacciones y patrones evolutivos del ciclo de vida de especies impacta su crecimiento                 | [@coste2020analysis]                                 |                        [@calvo1993evolutionary; @jakalaniemi2011orchids; @shefferson2012linking; @falcon2017quantifying] |
| Metodología                   |  Identificación de metodología adecuada por diferentes tipos de muestreos o historia de vida                     |              ?  | [@gregg2006comparison; @kery2004demographic; @tremblay2009dormancy; @shefferson2014life; @tremblay2014bayesian; @tremblay2021population]|


### USO 1: Identificar las etapas or procesos demográficos claves

Identificar y conocer cuales son las etapas de vida más susceptibles y relacionados a cambios abióticos y bióticos. Aclarar cuales de las etapas/edades son más susceptibles y que resulta en cambios demográficos y su impacto sobre la persistencia de una población es necesario para el manejo.  El ejemplo clásico en la literatura usando PPM son los trabajos sobre la dinámica poblacional de la tortuga "boba" o "cabezona" *Caretta caretta* [@crouse1987stage], [@crowder1994predicting].  Crouse y Crowder demostraron que aun salvando TODOS los huevos de depredación, esa estrategia de manejo antropogénico iba a tener muy poco impacto en el crecimiento de la población. Lo que encontraron es que el impacto más grande sobre el crecimiento poblacional provendría de proteger los adultos y reducir la mortandad de los adultos específicamente a causa de la mortandad de los adultos en las redes de pesca.  Modificando estas redes para que las tortugas se pueden escapar y no ahogarse en las redes tendría un impacto más grande que salvar un huevos. Los trabajos de Crouse y Crowder [@crouse1987stage], [@crowder1994predicting] fueron pioneros en demostrar que uno podía simular diferentes escenarios basado en la historia de vida y evaluar su impacto. Naturalmente, eso no quiso decir que no se debería proteger los huevos, pero que el impacto de proteger los huevos era menor que proteger los adultos. 

Ejemplo de orquidea AQUI

### USO 2: Determinar cuantos individuos en una población es necesario para reducir la extinción

El efecto de tamaño poblacional sobre la biología y la probabilidad de extinción es bien conocido [@shaffer1985population; @nunney1993assessing; @harris2022abundance]. ¿Cual es la probabilidad de extinción de una población considerando la cantidad de individuos en cada etapa? En general lo que se observa es que menor el tamaño poblacional, *N*, mayor es el riesgo de extinción. Esa correlación de extinción con el tamaño de muestra puede variar si algunas etapas del ciclo de vida es muy reducido o su probabilidad de sobrevivir es baja o la probabilidad de crecer a la próxima etapa varia. En orquídeas es probable que una de las etapas más vulnerable es la etapa de semilla. Consideramos por ejemplo cual es la probabilidad de que las semillas se establece, germina y crezca hasta ser un juvenil en el medio ambiente.  Cada una de esas probabilidades de transiciones son muy pequeñas.  Por consecuencia establecer una nueva población de orquídea necesita considerar la cantidad de individuos que este presente pero también la probabilidad de tener semillas y que estás pueden crecer a ser adultos que se pueden reproducir. Sin duda la orquídeas tienen un potencial enorme de crecer. Darwin [@darwin1877various] estimó que un fruto de *Orchis maculata* produce 6,200 semillas y una planta pudiese tener 30 capsula produciendo 186,300 semillas y en un acre la suma de las plantas produce más de 32,400,000,000 semillas!!!!  Sin duda la probabilidad de que una semilla germina y produce una planta es muy pequeña sino estaríamos cubierto de orquídea en dos generaciones.   


### USO 3: Determinar cuantos individuos se necesita introducir en una sitio para establecer una población viable 

Naturalmente, más cantidad de individuos re-introducido en un sitio mayor sera la probabilidad que la población sea viable, asumiendo que los individuos fueron establecidos en un area donde todas las etapas pueden sobrevivir, crecer y reproducirse. Pero, como todo, hay un limite de tiempo y esfuerzo disponible. Por consecuencia la pregunta debería ser orientado a determinar cual es el mínimo de individuos que se debería introducir para garantizar un **x** porciento de suceso en el establecimiento de una nueva población. 

En los últimos años, muchas organizaciones y científicos han comenzado a hacer re-introducción de especies en su hábitat nativo y no. (ref) incluyendo algunos programa introduce especies en áreas urbanas.  

En Corea dos trabajos demuestra que la re-introducción de orquídeas en un sitio puede ser parcialmente exitoso. Los autores translocarón la orquídea *Thrixspermum japonicum* en la isla de Jeju donde la cantidad de individuos pre-localización era cerca de 50 y solamente un individuo produjo frutos, de allí propagaron plántulas y fueron translocado en la isla. de los 216 individuos 73% sobrevivieron el primer año y 63% el segundo año.  De estos individuos el porcentaje de individuos que produjeron frutos fue de 16% a 35% en los dos años [@kim2016restoration].  En otro estudio en Corea, En un trabajo masivo de re-introducción de la orquídea *Dendrobium moniliforme* en la isla de Bogildo, Corea, más de 13,000 individuos artificialmente propagado fueron en su ambiente natural y seguido por múltiples años.  Demostraron que el sitio de localización es una variable importante para el crecimientos de los individuos. Las áreas abiertas con luz solar directa tuvieron un crecimiento más rápido que las áreas con sombra y que la especie de árbol tiene una impacto significativo en el crecimiento [@kim2016restoration].   

Lawrence Zettler

AQUI poner ejemplos de trabajos usando PPM para establecer N para la re-nintroduccion

  - Caladenia 

  - one million orchids project: Escribi a Fairchild para ver si tienen datos.
  - ????
  
  Desafortunadamente ninguno de los trabajos mencionado arriba de Orquídeas toma ventaja de los métodos de PPM para evaluar el tamaño de re-introducción sobre el impacto de la supervivencia de orquídeas en un sitio y cuantos individuos se debería relocalizar en su ambiente natural para establecer una población viable.  En general, la re-introducción de orquídeas es un tema que necesita más investigaciones y evaluaciones.

### USO 4: Determinar cuantos individuos se puede extraer sin tener un impacto negativo sobre la viabilidad de una población

Hay tres razones principales para la extracción de individuos de su ambiente natural. 

 1. Obtener individuos para la conservación *Ex Situ*.
 2. Usar un grupo de individuos para su propagación.
 3. Extracción para la venta sin objetivo de conservación.  

El supuesto de colectores de orquídea de su hábitat naturales, tanto para la conservación de *Ex situ* y el uso para la propagación es que el impacto es mínimo, y no tendrá impacto a largo plazo para la supervivencia. Regresaremos sobre este punto más tarde. La historia de fanatismo de recolección de orquídeas para la venta es bien conocida ref(). Aun que uno quisiera pensar que estas extracciones son del pasado y no ocurren hoy en día, hay todavía escrúpulos que extraen los plantas sin pensar al impacto que tendrá sobre la población o especie.  

Pero la pregunta se tiene que hacer. Cuantos individuos y de que etapas se puede extraer de la población sin tener impacto en el crecimiento poblacional?     

### USO 5:  En especies invasivas determinar cuantos y cual etapas se necesita remover para controlar la población.  

Ahora es común reconocer el impacto negativo que puede tener organismos invasivos sobre la flora y la fauna local. Cual son las características que hace que una especie puede ser invasiva y cual características si fuese manejada pudiese reducir su impacto.  En general, las especies invasivas tienen una tasa de crecimiento alta, una tasa de reproducción alta, una tasa de supervivencia alta y una tasa de dispersión alta.  Por consecuencia, una estrategia de manejo debería considerar cual de estas etapas es más susceptible a ser manejado.  En general, la etapa de semilla es la más susceptible a ser manejado. Algunos de los impacto de especies invasivas son de Australia y son bien conocidos y discutidos en clases de ecología, tal como la introducción del conejo, *Oryctolagus cuniculus* [@alves2022single], del cactus *Opuntia* [@novoa2015introduced] entre muchos otros.  En general, la introducción de especies invasivas es un tema que necesita más investigaciones y evaluaciones. 

Algunos ejemplos de estudios usando PPM para evaluar la demografía de especies invasivas incluye [@koop2005projection; @mcmahon2008transient; @li2015demographic]. 

Falta ejemplos de orquídeas FALCON et al. 


### USO 6: Evaluar el riesgo de una población 

La gran mayoría de los estudios realizados usando PPM es para evaluar el riesgo de reducción poblacional o el riesgo de extinción. Un trabajo ejemplar es el de Forsman [@forsman1996demography] donde evaluó 11 poblaciones del "spotted owl" donde demostró que 10 de estas poblaciones estaban en declive y que la población de California estaba en riesgo de extinción.  Análisis usando PPM como herramienta para evaluar el riesgo de extinción incluye estimados distintos, como el riesgo de extinción, el cuasi-extinción y la probabilidad de cuasi-extinción y naturalmente son utilizado para especies donde se quiere hacer un manejo de la demografía de esta para reducir el riesgo de extinción [@crone2011plant; @semmens2016quasi]. El uso de este acercamiento aun que es común en la literatura de conservación pudiese ser problemático si no se considera la confiabilidad de los parámetros estimados y la incertidumbre de los datos [@ludwig1999meaningful].  

Falta ejemplos de orquídeas

### USO 7:  Determinar cuantas poblaciones se necesita para la viabilidad de una especie al nivel local o global

La gran mayoría de las especies son dividido en múltiples poblaciones, donde el concepto de poblaciones puede tener muchas definiciones.  Típicamente los científicos ni mencionan la definición del termino y lo usan para identificar una agrupación de individuos. El uso frecuentemente es usado de forma practica en que son individuos suficiente cercano uno del otro donde se puede recolectar la información fácilmente. Ese acercamiento puede que no tengo ninguna validez ecológica o evolutiva.  En ecología una población debería ser un grupo de individuos que tenga una interacciones entre los individuos por lo menos con una cierta probabilidades. Por consecuencia si hablamos de una población de *Catasetum* los individuos de una misma población debería considerar la posibilidad que las abejas que la polinizan (i.e. *Euglossina* sp.) pueden mover el polen y dependiendo de la especies de abeja el área de movimiento de ellas puede ser bastante grande.  Otra definición de población una evolutiva, donde los individuos tienen movimiento de genes considerando el largo de vida de los individuos o sea en una generación. El largo de vida de especies de orquídea pueden variar mucho, por ejemplo en las especies de ramitas (twig epiphytes) el periodo de generación pudiese ser 3-4 años, al contrario especies como *Cypripedium calceolus* pudiese ser de meas de 50 años.   

Irrelevante de las dos definiciones de una población, tipicamente en el área de conservación es de interés hacer predicción sobre la probabilidad de extinción/supervivencia de las poblaciones y determinar cuantas poblaciones son necesaria para que la especie en una área determinada es necesario para su persistencia.
  
Un otro método de evaluar el riesgo de múltiples poblaciones es aplicar los análisis de supervivencia usando el concepto *la dinámica de metapoblaciones* (se define como poblaciones de poblaciones) y es un acercamiento más sencillo para evaluar la dinámica de poblaciones, pero en la mayoría de los casos no se recolecta información sobre la estructura de edades o etapas de los individuos, pero el cambio en número de individuos, la colonización y extinción de sitios previamente ocupado para evaluar la persistencia del conjunto de las poblaciones. Ese acercamiento es muy útil para evaluar la viabilidad de una especie en un conjunto de sitios. Pero la lista de estudios de metapoblaciones es limitada a unos pocos artículos [@tremblay2006epiphytic; @lind2007metapopulation; @winkler2009population;  @kindlmann2014disobedient;  @acevedo2015spatial; @acevedo2020local; @vsvecova2023difficulties]. Para una introducción a los conceptos y métodos de análisis vea el libro de Hanski [@hanski1999metapopulation]. 



### USO 8: Comparando el riesgo relativo de dos o más poblaciones 



### USO 9: Evaluar interacciones ecológicas para entender las variables importantes para la supervivencia de una población 


### USO 10: Cual de los procesos y patrones evolutivos del ciclo de vida de especies impacta su crecimiento o grupos taxonómicos




## Visualización de la dinámica poblacional

Visualizar el proceso de cambio poblacional en un diagrama y las posibles causes puede ayudar a englobar los diferentes componentes abióticos y bióticos que están presente y que influencia la dinámica de una especies. Hay que aclarar que un modelo es una caricatura y no incluye TODOS los componentes que pueden influenciar la dinámica de una especies.  El objetivo de un modelo es de tratar de simplificar la biología a los procesos más importante. Al complicar de forma exagerada los modelos resulta en que los patrones y dinamica no se pueden asignar a efectos proporcionalmente más relevante. En la siguiente figura \@ref(fig:Pop-fig_2) se muestra los factores principales sobre el crecimiento de la poblacional con respecto a las variables más relevante para evaluar el riesgo de extinción de **UNA** población. 

Todos los trabajos de dinámica poblacional comienzan con el tamaño de la población, **N**. El tamaño poblacional y su densidad impacta directamente los otros factores de los parámetros de la población. En la figura notará, que hay linea entrecortada, y signo de interrogación y lineas rellana con grosor diferentes.  Las lineas entrecortada con signo de interrogación representa factores donde no hay (o muy poca) evidencia de que estos factores influencia la dinámica poblacional de orquídea. Las lineas rellenada son factores donde hay más evidencia basado en los estudios de dinámica poblacional en orquídea  
 
Los efectos denso-dependientes pueden influenciar la cantidad de individuos en el próximo tiempo ademas que la diferencias genéticas entre individuos, hay evidencia de esto en otros organismos, pero en orquídea todavía no hay estudios o muy pocos estudios, o estos asumen que por la diferencias genéticas tienen más impacto en la dinámica de la población. Al contrario los efectos de estocásticos en demográfica y ambiental son bien conocidos en orquídea. Esto lleva a influenciar los parámetros de crecimiento y la variación en estos parámetros.  Por ultimo la variación en tiempo es el parámetro que más impacta el riesgo de extinción.  El tamaño de la variación en tiempo es un factor importante para evaluar el riesgo de extinción de una población.  Cuando la variación en tiempo es muy grande en pequeñas poblaciones, la probabilidad de extinción es más alta.  En general, la variación en tiempo es un factor que se debería considerar en todos los estudios de dinámica poblacional. 

 

 









```{r intro1, out.width="500px", include=TRUE, fig.align="center", fig.cap=c("Factores que influencia la dinamica de una población"), echo=FALSE}

knitr::include_graphics("Figures/Demografia_de_una_poblacion.pdf")
```



Revision: Sept 14, 2024

<!--chapter:end:02-Intro.Rmd-->

# Qué es un diagrama de Ciclo de Vida

Por: 


```{r CV_1}
library(Rage)
library(DiagrammeR)
```

## Introducción

Todas las especies biológicas tienen una historia de vida, del comienzo de la vida hasta su fallecimiento. La supervivencia de la mayoría de las especies de plantas en su hábitat natural requiere que todas las etapas de vida, desde la semilla, las plántulas, los juveniles, los adultos y el esfuerzo reproductivo, sean continuas dentro de la vida natural del organismo de interés. Aunque esos son las etapas más común incluidos en análisis algunas especies pudiese que ya no tenga por ejemplo semillas y se reproduce por clonaje (e.i. guineo **Otros ejemplos**). Nuestra perspectiva para análisis de conservación y ecológica es evaluar toda la información del ciclo de vida de una especies, comprender las características del ciclo de vida que limitan la supervivencia y la reproducción de una especie en su hábitat natural y identificar cual son las etapas más relevante para impactar el crecimiento poblacional. 

La supervivencia de las especies depende de los procesos viables del ciclo de vida que resultan en una población estable o en un aumento en el tamaño de la población.  El proceso más apropiado para determinar la persistencia de una población es evaluar todas las etapas críticas de la historia de vida de una especie y utilizar matrices de proyección de población para determinar el potencial del cambio poblacional, si aumenta, disminuya o es estable.  

Siempre uno debería comenzar por crear modelos de diagramas de ciclo de vida antes de cualquier estudio.  Esto se debería hacer antes de la recolección de datos para visualizar el ciclo de vida hipotético de la especie de interés. La visualización del ciclo de vida es una herramienta muy útil para identificar las etapas críticas de la historia de vida de una especie y para determinar qué factores pudiese influir en el crecimiento y la supervivencia de la población y determinar cual son los datos a recolectar en el campo.  Estos diagramas son muy útiles para entender la biología de un organismo y para identificar los posibles factores que influyen en su desarrollo. 

Enfatizando lo hipotético versus lo que se puede recolectar en el campo.  Un diagrama de ciclo de vida es una representación gráfica de los diferentes estadios que atraviesa un organismo a lo largo de su vida. En este capítulo, veremos cómo se pueden crear diagramas de ciclo de vida en R utilizando la librería `Rage`.

## Ejemplo de ciclos de vida sencillo

El primer ejemplo comenzamos con un ejemplo de un ciclo de vida sencillo con tres estadios: semillas, plántulas y adultos. Vamos a sumir que es una planta que se reproduce sexualmente, y que las semillas no tienen banco de semilla (latencia de germinación entre periodos).  En este caso, las semillas germinan y se convierten en plántulas o se mueren. Las plántulas crecen y se convierten en adultos o se mueren. Los adultos se reproducen y mueren. Por consecuencia el ciclo de vida dura 3 años. El primer año es el año de la semilla, el segundo año es el año de la plántula y el tercer año es el año del adulto y reproducción.  Nota que este es un ciclo de vida hipotético y que no todos los organismos tienen un ciclo de vida de 3 años y raramente tan sencillo. 

El la matriz de transición de este ciclo de vida es la siguiente: 50% de la semillas germinan y se convierten en plántulas, 40% de las plántulas se convierten en adultos y cada adultos en promedio deja 3.2 semillas. Las lineas verde representan crecimiento y la linea amarilla representan reproducción. 





```{r CV_2}
# hidden code to produce figures
matA <- rbind(
  c(0.0, 0.0, 3.2),
  c(0.5, 0.0, 0.0),
  c(0.0, 0.4, 0.0)
)


etapas <- c("semillas", "plantulas", "adultos")
title <- NULL
graph <- expand.grid(to = etapas, from = etapas)
graph$trans <- round(c(matA), 3)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", etapas, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 3
graph$col <- c(
  "PaleGreen4", "PaleGreen4", "Goldenrod1"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 

```

## Ejemplo de una orquídea hipotética

En el siguiente gráfico se muestra un ciclo de vida hipotética de una orquídea epifita. La orquídea comienza como una semilla que germina sobre un árbol. La plántula crece y se convierte en un juvenil y subsiguientemente en un adulto que florece y produce semillas. En cada uno de las etapas menos de la semilla se puede quedar en la misma etapa de un año a otro (nota la flecha roja).  En este caso, la orquídea tiene un ciclo de vida de múltiples años. El primer año es el año de la semilla, el segundo año es el año de la plántula pero esta etapa los individuos pueden quedarse en esta etapa de un año al otro, igual como las etapas de juveniles y adulto. Cuando los individuos se pueden quedar en la misma etapa hay valores mayor de cero en la diagonal. Solamente los adultos pueden reproducir semillas. 

Las lineas en verde representa crecimiento, las lineas en rojas representan quedarse en la misma etapa y las lineas en amarillo representan reproducción.

Nota aquí es que si este diagrama representa la recolección de datos en el campo uno debería de recolectar datos de la etapa de semilla, plántula, juvenil y adulto. En nuestra búsqueda de literatura no encontramos ni una publicación que recolectara datos de todas las etapas de vida de una orquídea. En parte por la dificultad de encontrar semillas y plántulas en el campo. Especialmente por la dificultad de encontrar semillas en un árbol por ser tan diminutas y seguir su desarrollo de un año a otro.


```{r CV_3}
# hidden code to produce figures
library(DiagrammeR)
matA <- rbind(
  c(0.0, 0.0, 0.0, 3.2),
  c(0.5, 0.3, 0.0, 0.0),
  c(0.0, 0.4, 0.20, 0.0),
  c(0.0, 0.0, 0.40, 0.80)
)


etapas <- c("semillas", "plantulas", "juvenil", "adultos")
title <- NULL
graph <- expand.grid(to = etapas, from = etapas)
graph$trans <- round(c(matA), 3)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", etapas, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 3
graph$col <- c(
  "PaleGreen4", 
  "red", "PaleGreen4", 
  "red", "PaleGreen4", 
  "Goldenrod1", "red"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 



```



## Ciclo de vida de orquídea en publicaciones

En la siguiente veremos diferentes ciclos de vida utilizados en varias publicaciones. Demostramos que no hay un ciclo de vida estándar y que cada investigador seleccionó ciclo de vida es único basado en su entendimiento del ciclo de vida de la especies, la capacidad de seguir los individuos de un año a otro y la pregunta de investigación. Los ejemplos representan tanto especies terrestre como epifitas, y la complejidad entre los ciclos de vida hipotéticas y lo que se puede recolectar el el campo.   


### Especies Epífitas

#### *Laelia speciosa*

La siguiente información proviene de la tesina de Mariana Hernández-Apolinar [@hernandez1992dinamica], yuno de los primeros trabajos de dinamica poblacional en orquídeas epifitas. El tema principal de la tesis fue evaluar el impacto de la recolección de orquídeas en la dinámica poblacional de *Laelia speciosa*.

El ciclo de vida es representada por 5 etapas. Los datos provienen de la figura 25a de la tesina.

- Semillas
- Plántulas
- 3 etapas de tamaño de planta donde 2 de las etapas son adultos y pueden producir semillas

Nota aquí que se hizo un estimado de la cantidad de semillas producidas y la proporciones de semillas que germinan y se convierten en plántulas el siguiente año. 


```{r CV_5}
# hidden code to produce figures
library(DiagrammeR)
matA <- rbind(
  c(0.0,     0.0,  0.00, 52686, 127324),
  c(0.00022, 0.0,  0.00, 0.0,   0.0),
  c(0.0,     0.71, 0.93, 0.0,   0.0),
  c(0.0,     0.0,  0.07, 0.76,   0.0),
  c(0.0,     0.0,  0.00, 0.24,   0.75)
)


etapas <- c("semillas", "plántulas", "adulto 1", "adulto 2", "adulto 3")
title <- NULL
graph <- expand.grid(to = etapas, from = etapas)
graph$trans <- round(c(matA), 5)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", etapas, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 3
graph$col <- c(
  "PaleGreen4", 
  "PaleGreen4", 
  "red", "PaleGreen4", 
  "Goldenrod1", "red", "PaleGreen4",
  "Goldenrod1", "red"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 



```



#### *Telipogon helleri*

En el trabajo de [@raventos2018comparison] se recolectaron datos de la etapa de inmaduros, reproductivo pequeños y reproductivo grandes.  El ciclo de vida es representada por 3 etapas. Los datos provienen de la figura 1 de la publicación de [@raventos2018comparison]. En este caso, los autores le interesa el efecto de perturbaciones sobre el crecimiento poblacional evaluando el efecto de perturbaciones con análisis de dinámica transitoria.  

Los autores observaron tres tipos de transiciones en la historia de vida de la orquídea *Telipogon helleri*.  Las etapas que pasen una tamaño/etapa pequeña a más grande el próximo año son de color verde, los que se quedan en la misma etapa son de color roja, los individuos que se ponen más pequeños son de color violeta y amarillo es la reproducción de las etapas adultas. Nota que los individuos grandes tienen una mayor contribución (0.5359) a la producción que los individuos adultos pequeños (0.1573). 



```{r CV_3Telipogon_helleri}


matA_Th=matrix(c(                  
 0.1548, 0.1573, 0.5309,
 0.2738, 0.4425, 0.1606,
 0.0238, 0.4060, 0.7368), byrow=TRUE,ncol=3)

matA_Th

etapas <- c("inmaduros", "reproductivo_pequeños", "reproductivo_grandes")
title <- NULL
graph <- expand.grid(to = etapas, from = etapas)
graph$trans <- round(c(matA_Th), 3)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", etapas, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 3
graph$col <- c(
  "red", "PaleGreen4", "PaleGreen4", 
  "Goldenrod1", "red", "PaleGreen4", 
  "Goldenrod1", "MediumOrchid4", "red" 
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 

```




### Especies Terrestres

#### *Prasophyllum correctum*

Es este trabajo se recolectaron datos de la etapa de plántula, juvenil, adulto y latencia de los individuos.  La historia de vida es representada por 4 etapas. Los datos provienen de la figura 4 de la publicación de [@coates2006effects], donde hay un periodo de 3 o más años entre los periodos de régimen de fuegos. Una de la etapas distintivas de esta especie es la latencia, en otra palabra plantas que no emergen de un año a otro. Muchas especies de orquídeas terrestres tienen latencia en las etapas de plántulas, juvenil y adultos . En estas especies la única etapa que podemos estimar la mortandad es después de la latencia.  Esto típicamente es un problema de muestreo y no la biología de la especie, ya que frecuentemente las especies muestreadas son en peligro de extinción y no se pueden recolectar datos de todas las etapas de vida para determinar cuando no se ven la planta es viva (debajo el suelo) o muerta. Como son en peligro de extinción no permite y realmente no es ético modificar el hábitat para determinar si la planta esta viva o muerta.  En este caso, se hace unos análisis para determinar cual es la probabilidad que un individuo con latencia de múltiples años este vivo.

Las etapas que pasen a latente el próximo año son de color azul, los que se quedan en la misma etapa son de color roja (incluyendo de latente a latente), verde es crecimiento y amarillo es reproducción. 




```{r CV4Prasophyllum_correctum}
# hidden code to produce figures
library(DiagrammeR)
matA <- rbind(
  c(0.0, 0.0,     0.0125, 0.0),
  c(0.0, 0.2874,  0.375,  0.1364),
  c(0.0, 0.0230,  0.15,   0.0303),
  c(1.000, 0.6897,  0.475,  0.7475)
)


etapas <- c("plántulas", "adultos vegetativos", "adultos reproductivos", "latencia")
title <- NULL
graph <- expand.grid(to = etapas, from = etapas)
graph$trans <- round(c(matA), 4)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", etapas, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 2
graph$col <- c(
  "blue", 
  "red", "PaleGreen4", "blue",
  "Goldenrod1", "PaleGreen4", "red", "blue",
  "PaleGreen4", "PaleGreen4", "red"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 



```



#### *Ophrys sphegodes*  

En el trabajo de Waite y Hutchings 1991, se recolectaron datos de la etapas vegetativa, plantas con flores y latencia de un año y dos años, por consecuencia la historia de vida es representada por 4 etapas. Los datos provienen de la figura 1 y la tabla 3b (periodo de herbivoría por oveja) de la publicación de [@waite1991effects]. En este caso, se hace análisis para determinar cual es la probabilidad que un individuo con latencia de múltiples de un o dos años este vivo comparando periodos de herbivoría por ganados versus ovejas.

El objetivo de la publicación era determinar la probabilidad de que un individuo con latencia de múltiples años (uno o dos) este vivo.  Por consecuencia no incluye reproducción (nota que no hay linea amarilla). Las etapas que pasen a latente el próximo año son de color azul, los que se quedan en la misma etapa son de color roja, verde es de una etapa no latente.

            
            
```{r CV5Ophrys}
# hidden code to produce figures
library(DiagrammeR)
G1=matrix(c(0.0080, 0.0184,   0.0149, 0.0148,
            0.0180,  0.4249,  0.1214, 0.1214,
            0.1853,  0.2770,  0,      0,
            0,       0,       0.3050, 0), byrow=TRUE,ncol=4)


etapas <- c("Vegetativa", "Ind. con Flores", "Latencia año 1", "Latencia año 2")
title <- NULL
graph <- expand.grid(to = etapas, from = etapas)
graph$trans <- round(c(G1), 4)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", etapas, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 2
graph$col <- c(
  "red", "PaleGreen4", "blue",
  "PaleGreen4", "red", "blue",
  "PaleGreen4", "PaleGreen4",  "blue",
  "PaleGreen4", "PaleGreen4"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 



```


#### *Cypripedium parviflorum*, *Epipactus atrorubens* y *Orchis purpurea*

La dimensiones de la matriz y la cantidad de etapas/años incluido en un análisis depende de múltiples factores.  Sin duda si son datos del campo el acceso a individuos de las etapas de vida es un factor importante.  Revisión de las publicaciones de orquídea se observa análisis con dimensiones de matrices que van de 29 a 3, con un promedio de 5.6 etapas (desv. estandard de 3.2).  El trabajo que incluyo el máximo de etapas fue el trabajo de [@shefferson2014life] con 29 etapas en *Cypripedium parviflorum* var. *parviflorum*.  En la especies *Epipactus atrorubens* se evaluó el costo de estar latente después de diferentes etapas. En este análisis usaron 11 etapas, donde hubiese una probabilidad de latencia después de todas las etapas emergente [@jakalaniemi2011orchids].  En *Orchis purpurea* los autores modelaron la especie usando 6 etapas de vida, protocormos, turberculos, plántulas, juveniles (más de un año y menos de 3 hojas), plantas sin flores (más de 3 hojas) y plantas con flores [@jacquemyn2010seed].  

Aquí se visualiza la matriz de *Orchis purpurea* de la publicación de [@jacquemyn2010seed]. La transiciones a una etapa subsiguiente son en verde, las transiciones a una etapa más pequeña son en violeta y la reproducción en amarillo.   En este ciclo de vida las etapas de protocormos, tuberculos, plántulas son de un año cada una. Si estos individuos no crecen a la próxima etapa se asume que fallecieron.


##### 

```{r CV6}
matA_Os=matrix(c(
0.000, 0.000, 0, 0.00, 0.000, 84.88725,
0.012, 0.000, 0, 0.00, 0.000,  0.00000,
0.000, 0.041, 0, 0.00, 0.000,  0.00000,
0.000, 0.000, 1, 0.75, 0.000,  0.00000,
0.000, 0.000, 0, 0.25, 0.615,  0.62500,
0.000, 0.000, 0, 0.00, 0.385,  0.37500), byrow=TRUE,ncol=6)

matA_Os  



etapas <- c("Protocormos", "tuberculos", "Plantulas", "Juveniles", "Sin Flores", "Con Flores")
title <- NULL
graph <- expand.grid(to = etapas, from = etapas)
graph$trans <- round(c(matA_Os), 3)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", etapas, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 2
graph$col <- c(
   "PaleGreen4",
  "PaleGreen4",
  "PaleGreen4",
  "red", "PaleGreen4",  
  "red", "PaleGreen4", 
  "Goldenrod1","MediumOrchid4", "red"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 
```


### Ejemplo de un ciclo de vida incompleto (y biologicamente erroneos)

La importancia de este capitulo es reconocer la diferencia entre la historia de vida real de un organismo biológico versus lo que uno puede recolectar en el campo.  En las orquídeas en general, dos áreas de investigación y muestreo son un reto (entre otros), la capacidad de seguir las semillas en el campo, y la capacidad de determinar si un sitio es adecuado germina o no. En el segundo paso incluye la presencia de las micorrhizas para germinación.  Estas etapas del ciclo de vida de la orquídea resulta ser un componente de mucha incertidumbre y por consecuencia limite los análisis y interpretaciones evolutivas y de conservaciones. 

Pero eso no son los únicos problemas.  La recolección de datos en el campo puede ser irreal dentro de un contexto de historia de vida general y la matemática que le corresponde. Aquí vemos un ejemplo de lo siguiente. Para mucho más detalles ver el capitulo "Impacto de datos sin sentidos". 
En la siguiente figura aparece tres errores comunes cuando se recolectan datos de la historia de vida de una especie.  El primero es que no hay mortandad en una de las etapas (los juveniles), y el otro es que todos los individuos se mueren (las plántulas) o se quedan en la misma etapa (los adultos), resultando en un ciclo de vida donde no es posible pasar de una etapa a otra. Estos errores ocurren típicamente cuando el tamaño de muestra es pequeña o la probabilidad de transiciones es rara (por ejemplos los arboles grandes no fallecen). Nota que no hay flecha que va de plántulas a otros estados. Esos son tres errores típicos que se enfrenta cuando se usa análisis de dinámica poblacional en especies con transiciones poco comunes.

 
 
 

```{r CV7, echo=FALSE}
# hidden code to produce figures
library(DiagrammeR)
matA <- rbind(
  c(0.0, 0.0, 3.2),
  c(0.0, 1.0, 0.1),
  c(0.0, 0.0, 0.9)
)


etapas <- c("plántula", "juvenil", "adulto")
title <- NULL
graph <- expand.grid(to = etapas, from = etapas)
graph$trans <- round(c(matA), 3)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", etapas, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 3
graph$col <- c(
  "red", 
  "Goldenrod1", 
  "MediumOrchid4",  "red"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 



```


## Ejemplo de un diagrama de un ciclo de vida usando el paquete ggplot

Nota aquí podemos usar otro paquete de R (Rage). La diferencia es que no se puede cambiar los colores de las lineas y los nodos.  Es una opción más sencilla para crear diagramas de ciclo de vida. Y practico para publicaciones donde no se necesita cambiar los colores de las lineas y los nodos. 

 

```{r CV8}
library(Rage)
plot_life_cycle(matA, stages=etapas, fontsize = 0)

```



## Code for color coding figure

http://rich-iannone.github.io/DiagrammeR/


Revision: Sept 14, 2024

<!--chapter:end:03-Ciclos_de_Vida.Rmd-->

---
editor_options:
  markdown:
    wrap: sentence
output: word_document
---

# Como recopilar datos en el campo

## Consideraciones en la colecta de datos en el campo

Por: Aucencia Emeterio-Lara, Mariana Hernández-Apolinar y Raymond L. Tremblay

## Tipo de crecimiento en las orquídeas

Conocer el tipo de crecimiento y la apariencia general de la especie de interés es el primer paso en la toma de datos en el campo, ya que a partir de esto sabremos dónde ubicarlas y cómo identificarlas las etapas con facilidad en su medio natural. Es así que hay que identificar el sustrato en el que se establecen las orquídeas (i.e. tipo de crecimiento), mismo que puede ser terrestre, epífito o rupícola, éste último también llamado litófito [@tellez2007orquideas]. Como es evidente, en el primer caso las plantas se desarrollan en suelo, en el segundo sobre ramas y troncos los árboles, mientras que en el tercero grupo sobre rocas. Es importante reconocer que algunas especies no son estrictamente limitado a un tipo de ambiente, por ejemplo hay algunas especies de *Lepanthes* que son epífita y rupícula. Hay también especies que son epifitas y terrestres (*Dipodium*)

De acuerdo con sus rasgos morfológicos o apariencia se pueden identificar al menos tres grupos de orquídeas epífitas: plantas con tallos engrosados y modificados conocidos como pseudobulbos (e.g *Laelia*, *Oncidium*, *Encyclia*, *Stanhopea*, *Maxilaria*, *Rhynchostelle*, etc), plantas con tallos simples o delgados (e.g *Epidendrum*, *Dichea*) y un tercer grupo con hojas engrosadas y tallos compactos o pseudobulbos poco visibles (e. g. *Trichocentrum*).

En el caso de las orquídeas terrestres se pueden identificar seis grupos: plantas con tallos y hojas alternas o en espiral (v. g. *Cypripedium*, *Dichromanthus*, *Habenaria*, *Triphora*), plantas con hojas solitarias o en pares (v.g. *Bletia*, *Schiedeella*, *Malaxis*, *Govenia*), plantas con hojas en roseta (*Brachystele*, *Deiregyne*, *Sarcoglottis*), plantas con hojas en abanico (*Paphiopedilum*, *Phragmipedium*), plantas sin hojas (*Rhizanthella*, *Triphora*) y plantas con pseudobulbos (*Oeceoclades*, *Cymbidium*).
Por su parte, en las plantas rupícolas se identifica un dos grupos: plantas con pseudobulbos (*Cattleya*, *Hoffmannsegella*, *Laelia*, *Paphiopedillum*) o sin pseudobulbo (*Lepanthes*).

Cabe señalar que, si bien esta clasificación es de utilidad y brinda una idea de la diversidad en la morfología vegetativa de las orquídeas, hay que considerar que solo se basa en su apariencia, por lo que es muy cualitativa y poco rigurosa desde el punto de vista botánico.

## Métodos y técnicas de muestreo

El método y técnica de muestreo depende en gran medida del tipo de crecimiento (i.e. epífito, rupícola o terrestre) que presente la especie de interés.
No solo eso, también de esta condición depende el grado de dificultad y el tiempo que se invertirá en la toma de datos. Para facilitar esta colecta de información se han implementado distintas técnicas de muestreo según su tipo de crecimiento, las cuales se describen a continuación.

### *Orquídeas epífitas y rupícolas*.

Las orquídeas epífitas y rupícolas viven a distintas alturas en árboles y acantilados. En la colecta de información de estas poblaciones se utilizan desde una simple escalera hasta equipo de alpinismo para ascenso. El uso de escaleras es una técnica muy práctica si la especie de estudio se desarrolla en las zonas bajas de los acantilados o en forofítos como arbustos y árboles de porte bajo a medio [@hernandez1992dinamica] ; sin embargo, se tiene la desventaja de transportar este instrumento de trabajo hasta el sitio de muestreo.

Cuando las orquídeas se distribuyen a una altura considerable del acantilado, la técnica de rapel resulta muy útil y segura e implica el descenso mediante cuerdas hasta llegar a las orquídeas a muestrear (ref). Por su parte, la técnica de ascenso de una sola cuerda es muy segura [@jepson2000tree] cuando se trata de orquídeas epífitas habitando hospederos de porte medio y alto con troncos y ramas gruesas. Pero tiene algunas limitaciones como es la dificultad de acceder a ramas delgadas en los estratos muy altos. En importante señalar que, si se carece de experiencia en el ascenso de árboles y acantilados es importante recibir apoyo de gente experta.

En el muestreo de los árboles se señala la ubicación preferente de las orquídeas de estudio, debido a que éstas presentan condiciones microclimáticas variables.
Dicha ubicación, generalmente toma en cuenta la clasificación hecha por Johansson [@johansson1974ecology; @catling1986epiphytic], quien señala que en un árbol hospedero existen cinco zonas o estratos, dividiéndolos de la siguiente manera: la parte basal del tronco (Zona I), tronco principal (Zona II), la copa interna (Zona III), la copa media (Zona IV) y la copa externa (Zona V). La mayor concentración de orquídeas epífitas se registra en los estratos medios II, III, IV [@mondragon2007life].

**AQUI un dibujo del concepto sugerido por Johansson (1974) y Cattling (Quien puede hacer un dibujo que se acerca al concepto sugerido por el y Cattling? NO deberiamos usar una foto de otro papers, habria que pedir permiso.**

### *Orquídeas terrestres*.

En el muestreo de poblaciones de orquídeas terrestres se han implementado varias técnicas de muestreo, en esta sección nos referiremos a dos: El método de triangulación y el método sin área. El primero permite estimar el área en que se establece la población, mientras que el segundo no permite establecer esta variable y se centra en el marcaje de individuos.
A continuación se detalla en qué consisten ambos.

a)  *Método de triangulación*. El método de triangulación es una técnica no invasiva y comúnmente es utilizada para monitorear las poblaciones de las orquideas terrestres en Australia [@tremblay2009population]. El método consiste en clavar dos estacas o clavijas permanentes en el suelo. La distancia entre la primera estaca y segunda estaca generalmente es de un metro. Sobre las estacas se puede: 1) sobreponer un cuadro de madera o tubos de PVC, cuyos lados están divididos en centímetros o 2) colocar cintas métricas sobre cada uno de los lados del cuadrado hecho. Estas dos variantes del método se utilizan para ubicar a los individuos dentro del cuadro al indicarse la distancia de la planta respecto a dos de los lados (un sistema **x** e **y**). Esta técnica es muy buena cuando los individuos están separados uno del otro, pero hay que tener cuidado cuando están muy cercanos (menos de 1 cm de distancia). Además, es fácil de implementarse, es muy precisa y deja muy poca evidencia en el campo.

![Métodos de triangulación para muestreo: los P_x representa la posición de cada planta. Dos distancia son medidas, cada una de la estaca. Nota que este método no se añade un identificador individual a las plantas.](Figures/Triangulation_Method.pdf){width="100%" height="400"}

<br>

b)  *Método de sin área*. En campo, las orquídeas terrestres forman pequeñas colonias, algunas de menos de 20 individuos e incluso hay especies con individuos aislados (Ej. *Govenia lagenophora*, *Dichromanthus cinnabarinus* y *D. aurantiacus* [@tellez2007orquideas], por lo que su dinámica poblacional generalmente es descrita a partir de la información obtenida en varias colonias o subpoblaciones. El método sin área ha sido ampliamente usado en este tipo de orquídeas, no es invasivo y consiste en la selección de una colonia o subpoblación en la que se marcan todas las plantas observadas en el lugar [@martinez2024estimation]. Asimismo, la ubicación del sitio y los individuos puede geo-referirse y/o hacer mapas de localización.

## Marcaje y monitoreo de los individuos en el tiempo

La dinámica o cambio en una población se evalúa marcando y siguiendo a todos los individuos que se encuentran en un sitio (i.e. censo) o de solo una parte de éstos (i.e. muestreo) a lo largo de sus distintas etapas del ciclo de vida. Sin importar si censamos o muestreamos, tenemos que asegurar dos aspectos durante el marcaje o etiquetado de una población:

1)  que se incluyan individuos de todas las categorías de etapas/estados que conforman una población y

2)  que el número de individuos de cada etapas/estados sea suficiente para poder llevar a cabo un análisis demográfico robusto que refleje, con cierta precisión, la dinámica de la población seleccionada.

3)  además de esto, también debemos lograr que el registro de la información en campo sea fácil, consistente y sin error o sea minimizar los errores de recolección de datos.

### Etapas de las orquídeas de estudio a identificar en campo

Identificar las etapas/estados de desarrollo de una especie es esencial para evaluar los cambios que ocurren en los individuos de una población a lo largo de su ciclo de vida.
Para cambios en las etapas de los individuos en el tiempo se debe identificar las características biológicas y morfológicas que definen cada una de las etapas/estados de desarrollo de los individuos de la población. Esta serie de características permitirá reconocer y diferenciar las semillas, plántulas, juveniles, adultos y etapas latentes (cuando las haya); asimismo a partir de su monitoreo o seguimiento se reconocerá su cambio de etapa/estado en el tiempo.

Existen características que son distintivas de una etapa/estado en particular, tal es el caso de estructuras reproductivas (flores, frutos y escapos frescos o secos), las cuales son distintivas de los individuos adultos y permiten diferenciar estados de desarrollo en las plantas. No obstante, cuando se trata de especies de un mismo género que comparten un mismo hábitat, es posible confundir a los individuos de diferente etapas, plántulas, juveniles y adultos de distintas especies debido a que pueden presentar características vegetativas o florales muy similares (eso es muy común en las *Lepanthes* cuando están en etapas de plántulas). A pesar de esto, y con la ayuda de un botánico experimentado, es posible resolver la mayoría de estos dilemas. Por su parte, los individuos juveniles o no reproductivos serán aquellos que no presenta flores ni frutos, y son distintos a las plántulas, que son los individuos recién establecidos.

Dos de las etapas de desarrollo más difíciles de seguir en campo son las semillas y plántulas, por lo que para su caracterización y muestreo en campo hay que considerar lo siguiente:

#### *Semillas*.

La fase de semillas es uno de los mayores retos en el estudio de las orquídeas, ya que sus tamaño tan pequeño (i.e. son conocidas como semillas polvo o “dust-seeds”) dificulta el seguimiento de su dispersión, germinación y establecimiento en campo [@ackerman1996seedling; @ticktin2020synthesis] ; los parámetros que corresponde a la supervivencia y crecimiento de semillas son de gran utilidad al momento de estimar los valores de fecundidad o de transición en el primer estadio del ciclo de vida. La relación entre la producción de semillas y la transición a plántulas y juveniles raramente se ha estudiando raramente en las orquídeas. Actualmente en el medio natural, el método más usado para evaluar la germinación es la introducción de bolsas pequeñas de malla de plancton (mesh plankton, 50 μm) con semillas, las cuales se colocan en el suelo o en la corteza de árboles donde se añadió semillas y se recogen en uno o distintos periodos del año para evaluar la germinación [@rasmussen1993seed; @rasmussen2011methods; @anghelescu2023asymbiotic]. 

La dispersión de las semillas en el espacio ha sido estudiado muy poco [@ackerman1996seedling] debido a sus tamaños tan pequeños y dificultad de seguir en el espacio.
Los métodos de seguir las semillas en su ambiente natural incluye típicamente ponerlos en una malla y ponerlos en el suelo o la corteza de un árbol y recogerlos más tarde para ver si estas germinaron [@rasmussen1993seed], [@whigham2006seed]. Un patrón que parecer ser consistente en las plantas es que el crecimiento poblacional tienden a ser limitado por las semillas [@turnbull2000plant].

#### *Plántulas*.

Identificar las plántulas en orquídeas también tiende a ser complicado debido a que se desconoce su morfología en la gran mayoría de las especies.
Por ejemplo, en el caso de *Cypripedium irapeanum*, una orquídea terrestre, las plántulas presentan tallos muy delgados y su apariencia es semejante al pasto (gramas) y varias de éstas se encuentran escondidas entre la vegetación (Hernández-Apolinar, comunicación personal). En el caso de orquídeas epífitas, se trata de los individuos más pequeños en la población, algunos se pueden reconocer si no están cubiertas de musgo, liquen u otra tipo de planta. Tremblay (com. pers.) ha encontrado a estas pequeñas plantas en alrededor de las plantas adultas, por lo que recomienda esta estrategia para marcar correctamente esta fase de desarrollo en orquídeas terrestres o epífitas; sin embargo, un problema potencial es lograr diferenciar correctamente las plántulas de distinta especie.

En *Lepanthes*, por ejemplo, las plántulas se establecen entremezclas de diferentes especies en el mismo forofito y carecen de caracteres distintivos por lo que es imposible distinguirlas por especie (Tremblay com. pers.); esto se logra solamente cuando se marcan y siguen cuidadosamente a etapas posteriores (juvenil o adulto). De esta manera, el investigador ha logrado distinguir entre plántulas de *Lepanthes eltoroensis* y *L. woodburyana*, las cuales se diferencian únicamente en la forma de crecimiento del tallo.
Al continuar el desarrollo, *Lepanthes eltoroensis* tendrá un crecimiento postrado, mientras que éste será erecto en *L. woodburyana*. Si bien este método es bueno, es importante considerar que puede representar un periodo de tiempo largo y que se corre el riesgo de no saber la especie cuando las plántulas no sobreviven a la siguiente etapa o el largo del estudio no es suficiente para determinar a cual especies pertenece las plántulas o juveniles.

## Identificar la características de la especie de estudio

Para cualquier estudio usando el acercamiento de dinámica poblacional es necesario conocer lo básico de la especie de interés y las etapas/edades que corresponde al ciclo de vida de esa misma y que sea representativo de la historia de vida de esa especie. Poder reconocer las diferentes etapas del ciclo de vida con exactitud es esencial, por ejemplo separar entre las semillas, plántulas, juveniles y adultos y si hay etapas latentes. Cuando se define una etapa de vida se debería tener características morfológicas que se puede identificar en el campo con facilidad para reducir los errores de asignaciones a otras etapas. Por ejemplo en *Lepanthes* [@tremblay2003population] definió un juvenil como individuo que tiene tallos con vaine Lepanthiforme *lepanthiform sheath* en por lo menos una de los peciolos y que no tiene evidencia de presente o anterior de inflorescencias. Nota que aquí la diferencia entre una plántula y un juvenil es que tenga una vaina lepanthiforme y se diferencia de los adultos con la ausencia de evidencia de inflorescencias seca y activa.

Por ejemplo en la foto que sigue tenemos un individuos que tiene dos hojas, una con inflorescencia activa y la otra hoja con inflorescencia secas, por consecuencia ese individuos es un adulto ya que tiene por los menor una inflorescencia activa (produciendo flores o el potencial de producir flores). Nota no es que la inflorescencia tenga flores es que la inflorescencia es verde (el potencial de producir flores).

![*Lepanthes rupestris* con inflorescencias seca y activa. Foto: Tremblay](Figures/lepanthes_rupestris.jpeg){width="90%"}



### Identificación y etiquetado de individuos.

Debido a la naturaleza sésil de las plantas, una vez delimitada la población resulta relativamente sencillo contar e identificar a todos los individuos seleccionados.
Sin embargo, el monitoreo y secuenciación de todos y cada uno de los procesos o eventos de desarrollo por los que transita cada uno de los individuos de año a otro año. No todos los estudios son de un periodo anuales. En *Lepanthes* el periodo de tiempo entre muestreo fue mensual [@tremblay2003population].  **MIRAMOS SI HAY MáS ejemplos NO ANUAL**

Para llevar a cabo un monitoreo exitoso de los individuos de una población es necesario que

 - contamos con material de marcaje de calidad 
 - si tenemos un sistema de identificación sencillo y claro. 


Estos dos sencillos pasos evitarán mezclar la información entre individuos de una misma población o confundir la información con plantas de otras poblaciones o periodos de tiempo.
Es decir, la calidad de nuestros datos dependerá, en parte, de cómo marquemos y de qué calidad sea el material que usemos para el marcaje.

a)  *Qué material usar al marcar o etiquetar un individuo o sitio de muestro*.

La calidad y sobre todo la durabilidad del material de marcaje es importante cuando hacemos un estudio poblacional, más aún cuando se trata de uno de largo plazo (múltiples años). Si las marcas se desintegran de un año a otro, se perderá la identidad de cada planta y si no nos damos cuenta podríamos suponer dos cosas en nuestro siguiente monitoreo: 1) que el individuo murió (ya que el marcador no se encuentra) o 2) que hay un nuevo reclutamiento en la población (aparece un nuevo individuo sin marca pero es un error por la perdida del identificador). Esto sesgaría nuestros resultados al suponer un aumento en la mortalidad o, en su defecto, un aumento en el reclutamiento.
Naturalmente, cuan grande es el sesgos dependerán del número de individuos que marquemos (i.e. tamaño de la muestra). Por regla general a menor tamaño de muestra, mayor es el impacto de estos sobre los estimados de los parámetros y por consecuencia mayor es el sesgo.

Las etiquetas de aluminio resultan ser un buen material al marcar los individuos de las orquídeas de cualquier ambiente (i.e. epífito, terrestre o rupícola). El aluminio laminado es un material relativamente barato, muy duradero y se puede escribir sobre éste; por lo que, se garantiza la permanencia de la marca o etiqueta y la de las inscripciones que hayamos hechos sobre ésta, hay también marcadores previamente numerado. Además, este tipo de etiquetas puede sujetarse a la planta o colocarse cerca de ésta con diferentes materiales; por ejemplo, hilo de pescador, cinchos de plástico, alambre galvanizado o plastificado, clavos, chinchetas (drawing pin) y grapas, entre aquellos más usados.

Un aspecto que hay que cuidar al marcar individuos es que las etiquetas se enmascaren con el ambiente; es decir, que no sean muy grandes, estén protegidas y que no sean evidentes en áreas donde transitan personas no asociada a la investigación, a fin de evitar su pérdida o, incluso, el robo de plantas por gente ajena a la investigación es algo que siempre debemos tratar de minimizar.

La durabilidad del material usado es muy importante cuando existen eventos en el ciclo de vida de una especie que pueden prolongarse por varios años. Este es el caso de algunas orquídeas terrestres que pueden no rebrotar y mantenerse en latencia vegetativa por más de un ciclo anual de forma consecutiva. Por ejemplo, en *Liparis lilifolia* puede no emerger por tres o más años continuos [@hutchings1987population; @wells1991demographic], mientras que en *Epipactis helleborine* por cinco e, incluso, siete años [@light2006appearance ; @coates2006effects] o más años en *Prasophyllum correctum* [coates2006effects].
El poder tener un muestreo confiable de la secuenciación de estos eventos en un individuo en el mediano y largo plazo depende de la calidad del material usado al marcar las plantas o sea el método de marca y recaptura, lo cual a su vez permitirá tener estimaciones confiable o segadas del tamaño poblacional y de la supervivencia y crecimiento de los individuos.

<br>

![*Cypripedium acaule* marcado en una población cerca de North Bay, Canada; Foto: Tremblay](Figures/Cypripedium_acaule.jpg){width="60%"}

<br>

b)  *Como marcar los individuos*

*Marcar los sitios de muestreos*.

Al igual que los individuos, los sitios de muestreo también se marcan a fin de facilitar su ubicación en el medio natural.
Estos pueden ser marcados, usando banderines, etiquetas grandes de aluminio o plástico, cinta de señalización (flagging tape) o pintura permanente; asimismo, también se pueden georeferir y hacer mapas de localización.
Cuando se trata de marcas de colores, se deben preferir colores poco llamativos que puedan disimularse con la vegetación circundante.
Si el sitio está bien protegido se puede optar por colores fuertes y llamativos; sin embargo, hay que considerar que los animales (mamíferos, aves, herbívoros) se pueden ver atraídos por éstas e ingerirlas o destruirlas; de ahí que se sugiere utilizar etiquetas discretas que favorezcan su permanencia en el mediano y largo plazo.

*Qué información debo plasmar en una etiqueta*.

La marca o etiqueta de cada uno de los individuos de una población debe compactar la mayor cantidad de información posible, no solo número consecutivos. Es decir, generalmente escribimos números consecutivos (1, 2, 3, 4, etc.) en las etiquetas que colocamos a cada individuo en campo. Sin embargo si no hay notas guía (metadata), esta información es limitada cuando se quieren analizar nuevamente; ya que es difícil determinar cuándo se reclutaron los nuevos individuos a la población o cuándo se fragmentó una planta para dar origen a un individuo de una categoría distinta a una plántula. Asimismo, si se seleccionan distintas poblaciones o colonias y los números consecutivos son los mismos, podemos confundir la información y llegar a conclusiones erróneas asignando individuos a poblaciones equivocadas.

Cuando se estudia una sola población, una forma sencilla de evitar errores y anexar más información es escribir en la etiqueta el año de estudio y el número consecutivo de la planta. Por ejemplo, si el estudio comenzó en 2023 y la población está formada por 152 individuos, éstos se podrían codificar así: 23001, 23002, 23003, ... 23152 (i.e. captura). En el siguiente año (2024) se revisarán o censarán los 152 individuos (i.e. recaptura) marcados y se etiquetarán los nuevos individuos que ingresan a la población (v.g. plántulas, juveniles), cuya marca iniciará con 24 y el número consecutivo (153 en adelante, 24153, 24154....). De esta forma se identificará el año en que inició la toma de datos del individuo, el año de ingresaron de los nuevos individuos, lo cual evitará la redundancia en el código, ayudando a reducir los errores de asignaciones de información a individuos incorrectos.
Otro aspecto que reduce los errores de codificación es mantener una secuencia lógica en las distintas zonas de muestreo.
Debido a que las orquídeas no tienen una distribución regular y varias de éstas tienen una distribución aparchonada (plantas concentrada en un área), se apremia a mantener números consecutivos (23001, 23002, 23003, etc.) por zona en un sitio de estudio y evitar la mezcla de número es áreas distintas (23001, 23012, 23043, etc.).

Siguiendo con el mismo concepto del inciso anterior, pero aplicado a múltiples poblaciones, en la numeración de la población se puede utilizar una codificación alfanumérica, donde la letra del alfabeto representa a la población y el número a los individuos marcados para su monitoreo. De esta manera, las marcas individuales se verían de la siguiente forma: A23001, A23002, ..., 23xxx para la primera población y B23001, B23002, ..., B23xxx para la segunda población y así sucesivamente, en caso de estudiar más de dos poblaciones.

Otra forma de codificar las múltiples poblaciones o subpoblaciones es asignando un número a cada una y añadiendo el número consecutivo correspondiente. En este caso la etiquetas de las plantas número 10 en dos sitios se verían de la siguiente manera: 1.10 y 2.10.
Si queremos añadir el año del estudio, éste también puede ser al final y sería de la siguiente forma: 1.10.23 y 2.10.23.
Para los nuevos ingresos se sigue la misma lógica del inciso anterior, por lo que la nueva planta 155 que ingresa en 2024 a la población 1 le corresponderá la etiqueta 1.155.24.

c)  *Cómo colocar la etiqueta*.

Existen distintas formas de colocar las etiquetas o marcas en los individuos seleccionados para el estudio y su colocación no debe afectar el desempeño de la planta marcada y si asegurar su permanencia en el mediano y largo plazo. Por ejemplo en las orquídeas epífitas de tamaño grande, la etiqueta de identidad se puede colocar abrazando a la planta, incluyendo la rama o tronco donde se desarrolla, o bien, colocarse abrazando a uno solo de los módulos. En el caso de *Laelia autumnalis* [@emeterio2021does], además de la etiqueta de identificación, se marcó **¿con qué?** el último módulo (el más joven o reciente) de cada uno de los frentes de crecimiento.
Este tipo de marcaje permitió determinar la biomasa nueva que se agrega cada año a cada planta y, al mismo tiempo, permitió identificar la permanencia, crecimiento o retrogresión entre fases de crecimiento. En las orquídeas terrestres *Cypripedium irapeanum* **(ref)** y *Govenia lagenophora* **(ref)** funcionó bien usar etiquetas aluminio o cinta dymo amarradas palos de clavos o clavadas en segmentos de alambre delgado, semejando banderitas, los cuales a su vez fueron clavados en el suelo junto a los tallos.

Las plántulas (pequeños individuos) son muy frágiles por lo que el marcaje es necesario definir un material suave que evite dañar sus estructuras. Tremblay [@tremblay2000plant; @tremblay2003population ; @tremblay1997lepanthes] utilizo un método que reduce el impacto sobre de marcaje sobre plantas pequeñas, el cual consiste en colocar la etiqueta **dymo** plástico al lado de los individuos. En este tipo de individuos **NO** se debe amarrar la etiqueta a la planta, ya que el peso de la etiqueta puede causarle daño además de que las hojas no son persistentes, por lo que la marca podría perderse. En *Lepanthes eltoroensis* se usaron al principio pequeños clavos para fijar las etiqueta de los individuos, posteriormente se usaron grapas, con lo cual se provocó menos daño al árbol y más fácil el proceso de marcar. Después de más de 15 años todavía se encontraba individuos marcado con estas etiquetas de *dymo*.  

<br>

![Los individuo de *Lepanthes eltoroensis* fueron identificados con una etiqueta de plástico clavada a la rama del árbol, posteriormente las nuevas etiquetas fueron engrapadas a la corteza del árbol. Foto: Tremblay](Figures/Lep_eltoroensis.png){width="60%"}

<br>

## Variables a registrar en campo

Captar los cambios en crecimiento, reproducción, supervivencia o muerte en los individuos es vital para describir la dinámica de una población en el tiempo. Dichos cambios se registran en todas y cada una de las distintas etapas por las que transita un individuo a lo largo de su ciclo de vida. A través de los distintos trabajos publicados es evidente que las categorías o etapas no siempre son las mismas entre las especies, ya que depende de aspectos biológicos de la plantas (características morfológicas, fenológicas y de crecimiento), de la información disponible, del número de individuos marcado y de las preguntas de interés en la investigación [@hernandez1992dinamica; @mondragon2013population] y Hernández-Apolinar y Gutiérrez-Paredes, en revisión. En esta sección se presentan ejemplos en los que se utilizan distintas variables vegetativas y reproductivas para la clasificación de los individuos.

Sin importar las variables que usemos en la clasificación de las plantas, es necesario ser riguroso al colectar los datos, a fin de determinar las diferencias de un periodo a otro (i.e. año, temporada, etc.) asociados a los parámetros definidos, ya que estas diferencias permitirán determinar qué cambios ocurren en los individuos, en primer instancia, y en cada una de las categorías en promedio. A fin de establecer las diferencias de un muestreo a otro, por convención se ha establecido que el registro de datos en la población al inicio del estudio sea definido como el tiempo cero o inicial ($t_{0}$), mientras que el siguiente sea denominado como $t_{+1}$. Cuando el estudio se prolonga por más de dos periodos, los subsecuentes muestreos se nombran como $t_{+n}$. Con base en las diferencias estimadas se podrá establecer cuál o cuáles de éstas categorías son muy dinámicas o, por el contrario, constantes en el ciclo de vida de la especie de interés.

Dos aspectos que facilitarán establecer las categorías y los cambios en los individuos en el tiempo son, por un lado, capturar información relevante que es común para todas las especies (Tabla X), y, por otro, entender cómo crecen o reiteran las plantas.
Las primeras se refieren a las características básicas más simples que permiten diferenciar un estadio de otro.

```{r DC1, echo=FALSE, message=FALSE}
library(tidyverse)
library(gt)
Variable_Censo=tribble(
  ~"Tiempo inicial t_0",                       ~"Muestreo posterior t+1",
  "Etapa del individuo",                     "Etapa del individuo",
  "Presencia/ausencia de flores y/o frutos", "Presencia/ausencia del individuo",
  "Número de flores",                         "Presencia/ausencia de flores y/o frutos",
  "Número de frutos",                          "Cantidad de flores",
  "",                                          "Cantidad de frutos",
  "",                                           "Cantidad de individuos en la población"  
)
```

```{r DC2, echo=FALSE, message=FALSE}
gt(Variable_Censo)|>
  tab_header(
    title = md("**Variables esenciales en un censo demográfico**"),
    subtitle = ""
  ) |> 
tab_footnote(
    footnote = md("Especificar si se trata de individuos procedentes de semilla o si su origen es por clonación (v.g. keikis, pseudobulbos separados, activación de yemas de reserva en pseudobulbos y rizomas, etc.)."),
    locations = cells_body(
      columns = "Muestreo posterior t+1",
      rows = 6
    )
  )
```

<br>

### *Crecimiento o reiteración vegetativa*.

El crecimiento en las orquídeas es a partir de las yemas de reiteración, las cuales se encuentran en la base de pseudobulbos de plantas epífitas y justo por debajo del suelo en los cormos, rizomas, tubérculos y pseudobulbos de plantas terrestres. Con la activación de estas yemas, en cada temporada de crecimiento se desarrollan estructuras que dan continuidad al crecimiento individual, las cuales en conjunto son conocidas como módulo de iteración o unidad de crecimiento básico. El módulo es característico de todas las plantas [@harper1977population] y varía en forma según la especie que se trate. En algunas orquídeas terrestres, por ejemplo, este módulo está representado por un cormo, yemas de regeneración, hojas , flores y frutos; éstos dos últimos cuando se trata de plantas adultas. Las mismas estructuras se desarrollan en otras orquídeas, aunque en lugar del cormo se genera un pseudobulbo, un rizoma o un tubérculo(s), según la orquídea en cuestión.

Las yemas de regeneración se pueden clasificar por su actividad en dos tipos: renuevo y reserva [@rasmussen1995terrestrial]. Las primeras son aquellas que se activan y dan continuidad al crecimiento de una planta en cada temporada, mientras que las segundas se activan eventualmente. En orquideas epífitas como *Laelia autumnalis* y *L. speciosa* [@emeterio2016usos; @hernandez1992dinamica], así como en orquídeas terrestres *Cypripedium irapeanum* y *Govenia lagenophora* [@hernandez2012ecological; @martinez2024estimation], se ha observado que las yemas de renuevo se activan (i.e. generalmente una) y dan origen al nuevo módulo al inicio de una temporada de crecimiento; que se suma a la secuencia de módulos formados en periodos previos. En el caso de *Govenia lagenophora* el nuevo cormo que se produce, reemplaza al módulo del año previo al morir. Asimismo, estos autores también han reconocido que las yemas de reserva pueden activarse cuando las condiciones ambientales son favorables para sostener el desarrollo de más de un módulo, dando origen a nuevas líneas o frentes de crecimiento que amplían su tamaño (**Figuras 1 y 2, cual son estas figuras?**).

Si bien las orquídeas epífitas y terrestres son perennes, lo que significa que viven por más de dos años consecutivos. Es importante hacer notar que, el crecimiento es estacional en un gran número de estas plantas; es decir, que la gran mayoría de especies solo producen módulo de crecimiento en una época del año (v.g. lluvias o primavera) caracterizada por presentar las condiciones ambientales (i.e. luz, agua, etc.) adecuadas que permiten su reiteración. Después de este periodo, las orquídeas no tienen actividad y, por lo tanto, no producen nuevas estructuras, y solo captan y/o usan los recursos necesarios para sobrevivir. Este comportamiento es muy evidente en las orquídeas epífitas, pero lo es más aún en muchas de las orquídeas terrestres, ya que éstas emergen del suelo y son evidentes y emergente del suelo sólo en un periodo de año especifico (generalmente lluvias o primavera/verano) para después marchitarse y desaparecer en la época menos favorable (v.g. época seca o fría, con nieve). Sin embargo, el hecho de que no estén visibles no implica que hayan muerto, como sería el caso de las plantas anuales (v.g. cosmos). Por el contrario, como parte de su ciclo de vida, las orquídeas terrestres viven bajo el suelo una parte del año; fase conocida como subterránea o latencia vegetativa [@shefferson2020demography]. Esta condición es equivalente a la hibernación en los animales, ya que las plantas sobreviven reduciendo sus actividades fisiológicas y consumiendo los recursos que almacenaron en los cormos, pseudobulbos, tubérculos o rizomas, que también son órganos de almacenamiento (**referencia**). Aunque a diferencia de los animales, la latencia vegetativa puede prolongarse por más de un año en forma consecutiva en muchas especies, cuando la planta no almacenó suficientes recursos o no existen las condiciones ambientales propicias para su desarrollo (Schefferson et al. 2020). Por ejemplo, los tubérculos de *Liparis liliifolia* [@hutchings1987population; @wells1991demographic] y *Orchis simia* [@willems1991population] pueden sobrevivir de forma subterránea por tres años, mientras que *Epipactis helleborine* por 5 a 7 años [@light2006appearance]. En los estudios poblacionales esta situación dificulta la estimación de la mortalidad en las orquídeas terrestres y, en consecuencia, se desconoce la supervivencia real de las distintas fases de desarrollo de la especie y el tamaño real de una población de interés. Múltiples acercamiento han sido desarrollado para considerar el periodo de no avistamiento en la dinámica de orquídeas [@shefferson2003life; @kery2004demographic; @shefferson2005adult]. Nuevos métodos bayesiano para estimar los parámetros de supervivencia condicional basado en si la plantas eran vista el año anterior o no y la cantidad de años sin ser vista han ayudado a estimar parámetros del ciclo de vida más consonó al los patrones naturales de las especies [@tremblay2009dormancy; @tremblay2009population].

<br>

### Ejemplos de categorización en especies de estudio

#### Etapas o estadios de desarrollo

 

    <br/>

a)  *Govenia lagenophora*.

Martínez-Villegas y colaboradores [@martinez2024estimation] definieron cuatro categorías de estado (i.e. Reproductivo, No reproductivo, Cormo y Ausente) para la orquídea terrestre *Govenia lagenophora*, cuya dinámica poblacional fue analizada en la Reserva del Pedregal de San Ángel, Ciudad de México, México.
    La estimación de las variables poblacionales fue estimada a partir de cuatro años de monitoreo.

-   **Reproductivo**: Individuos con hojas y con inflorescencia.

-   **No reproductivo**: Individuos con hojas y sin evidencia de ser reproductivos

-   **Cormo**: Individuos latentes, sin producción de hojas o inflorescencias.

-   **Ausente**: Individuos no detectados.

    <br/>

b)  *Caladenia*.

Tremblay y colaboradores [@tremblay2009dormancy; @tremblay2009population], estudiaron nueve especies del género *Caladenia* en distintas localidades de Australia, cuya demografía fue analizada a partir de tres categorías de estado: individuos vegetativos, individuos en floración e individuos latentes.

-   **Individuos vegetativos**: Individuos con hojas y sin evidencia de ser reproductivos.
-   **Reproductivo**: Individuos con hojas y en flor.
-   **Latente**. Individuos sin actividad aérea.

<br/>

c)  *Laelia speciosa*.

Hernández-Apolinar [@hernandez1992dinamica] por su parte trabajó con la especie epífita *Laelia speciosa*, en la cual se identificaron cuatro fases: plántulas, juveniles y dos estadios de adultos.
Las fases de adultos y juveniles se determinaron a partir del conteo de módulos, que en este caso se trató del número de pseudobulbos por planta.
A continuación, se define cada categoría considerada.

-   **Plántula**: Individuo con un pseudobulbo pequeño (3mm de alto) o sin pseudobulbos y presentado 2 hojas pequeñas (hasta 5 mm de alto) y 1-2 raíces
-   **Juvenil**: Individuo no reproductivo, con 2 a 10 pseudobulbos y que presentan las puntas de los pseudobulbos redondeadas sin evidencia del escapo floral, que es persistente.
-   **Adulto 1**: Individuo con y sin flores, con escapos florales previos y de 11 a 20 pseudobulbos
-   **Adulto 2**: Individuo con y sin flores, con escapos florales previos y con 21 o más pseudobulbos

<br/>

d)  *Ophrys sphegodes*

Hutchings [@hutchings2010population] analizó la dinámica poblacional de *Ophrys sphegodes* por 30 años.
Esta orquídea terrestre se monitoreó durante su fase aérea, considerando la presencia o ausencia de plantas.
A las plantas que emergieron del suelo se les trató como *ramets* (i.e. plantas independientes con la misma información genética), debido a que de los tubérculos (i.e. órganos de perennación subterráneos) de *Ophrys sphegodes* se da origen a más de una planta.
Por convención los ramets (i.e. fragmentos de una planta con vida independiente y con la misma información genética) se analizan como si fueran genéticamente independientes.
En el estudio utilizaron tres categorías para su análisis:

-   **Vegetativos**: Individuos no reproductivos caracterizados por la presencia de hojas en roseta.
-   **En floración**: Individuos con hojas en roseta que presentan inflorescencia.
-   **Latentes**: Individuos que no emergen en la época de crecimiento.

<br/>

e)  *Brassavola cucullata*.

Ackerman y colaboradores [@ackerman2020small] trabajaron con tres poblaciones de *Brassavola cucullata* en las Islas de San Eustaquio y Saba, Antillas de Barlovento del Mar Caribe, donde esta especie puede ser epífita o vivir sobre rocas.

Usando el número de hojas se establecieron cuatro categorías de estado:

-   **Juveniles 1**: Plantas con 1 ó 2 hojas.
-   **Juveniles 2**: Plantas con 3 a 6 hojas.
-   **Adultos 1**: Plantas con 7 a 20 hojas.
-   **Adultos 2**: Plantas con más de 20 hojas.

<br/>

f)  *Aspasia principissa*.
    (AVERGIAR ESTA CODIFICACION!!!)

Zotz y Schmidt [@zotz2006population] analizaron el comportamiento poblacional de *Aspasia principissa* en la Isla de Barro Colorado, Panamá. A partir del tamaño del pseudobulbo más reciente, los investigadores determinaron siete categorías de tamaño en la población. Además, se evaluó la presencia de flores y frutos en las plantas con un pseudobulbo reciente mayor a 7 cm de altura.
    **SC1**.

    -   Individuos con tamaño del pseudobulbo más reciente menor a 1.5 cm **SC2**.
    -   Individuos con tamaño del pseudobulbo más reciente de 1.6 a 2.5 cm **SC3**.
    -   Individuos con tamaño del pseudobulbo más reciente de 2.6–4.0 cm **SC4**.
    -   Individuos con tamaño del pseudobulbo más reciente de 4.1–6.0 cm **SC5**.
    -   Individuos con tamaño del pseudobulbo más reciente de 6.1–8.0 cm **SC6**.
    -   Individuos con tamaño del pseudobulbo más reciente de 8.1–11.0 cm **SC7**.
    -   Individuos con tamaño del pseudobulbo más reciente mayor a 11.0 cm

<br/>

g)  *Laelia autumnalis*.

Emeterio-Lara y colaboradores (en preparación) estudiaron poblaciones de la orquídea epífita *Laelia autumnalis*.
Las plantas de *Laelia autumnalis* fueron clasificadas en cinco categorías con base a su biomasa.

-   **Plántulas**: Un primer pseudobulbo pequeño
-   **Juveniles 1**: \< 9.5 gramos de biomasa, sin estructuras reproductivas
-   **Juveniles 2**: de \> 9.5 - 23.5 gramos de biomasa, ocasionalmente primeros eventos reproductivos
-   **Adulto 1**: de \> 23.5 - 49.5 gramos con restos y estructuras reproductivas en desarrollo
-   **Adulto 2**: \> 49.5 gramos de biomasa con restos de estructuras reproductivas y escasos eventos reproductivos posteriores

<br/>

![Cypripedium acaule marcado; Foto: Tremblay](Figures/Cypripedium_acaule.jpg){width="50%"}

![Cypripedium acaule identificado con bandera numerada; Foto: Tremblay](Figures/Cyp_acaule_flag.jpg){width="50%"}


h) *Lepanthes*.

Tremblay [@tremblay1997lepanthes] en su estudio con el género *Lepanthes*, una orquídea miniatura epífita, considero las etapas o estadios de desarrollo para definir cuatro categorías del ciclo de vida: plántulas, juveniles, adultos no reproductivos y adultos reproductivos.
Cabe señalar que, cada una de estas etapas está definida específicamente para cada especie de estudio; es decir, no son fijas por lo que pueden incluir más categorías de estado aún dentro del mismo género *Lepanthes*.
Por ejemplo, Tremblay usó en *L. caritensis* [@tremblay2003population] cuatro categorías y otras especies cinco etapas (*L. rubripetala* y *L. eltoroensis*) o seis etapas (*L. rupestris*) al incluir una segunda etapa de adulto reproductivo y un estado no reproductivo [@tremblay2001gene].
Además de definir las categorías de estado, en cada estudio es importante tener claro cuáles son las características tomadas en cuenta para su clasificación.
A continuación, se describen las categorías generales usadas en el género *Lepanthes* [@tremblay2003population]

-   **Plántula**: individuo con hojas y sin peciolo visible.

-   **Juvenil**: individuo con hojas y peciolo, pero sin evidencia de haber sido reproductivo en el pasado (la base de las inflorescencias es persistentes)

-   **Adulto no-reproductivo**: individuos con inflorescencias secas (ninguna verde)

-   **Adulto reproductivo**: individuo con inflorescencia verdes con o sin flores o frutos.


Otras variables que pudiese recoger incluye

-   el tamaño de las hojas o la hoja más grande o la cantidad de hojas

    -   *Brasavola cucculata* []: las plantas necesitan un tamaño mínimo de largo de hoja antes de florecer

-   el número de pseudobulbo

    -   ....

-   la altura de la inflorescencia

    -   *Caladenia valida* []: la altura de la inflorescencia impacta la probabilidad de producir frutos (de ser polinizada)

-   la altura en el árbol de las epífitas

    -   *Brasavola cucculata* []: la localización de la planta sobre el forofito. Las plantas muy bajo, menos de 1.5m son depredadas por la cabras

-   el número de "ramet", un indice del tamaño del genotipo en plantas con crecimiento horizontal

    -   *Cypripedium calceolus var. parviflorum* [Tremblay]: Los estudios evolutivos tienen que reconocer la diferencia entre un "ramet" y un "genet".

-   indicadores de herbivoria sobre la planta

-   indicadores de la cantidad plagas sobre la planta como "rust"


Revision: Sept 14, 2024

<!--chapter:end:04-Recopilacion_datos_en_el_campo.Rmd-->

# Como calcular transiciones para la matriz de Lefkovitch

Por: RLT, Ernesto Mujica y Elaine Gonzalez y Aucencia

```{r Trans1, message=FALSE}
library(tidyverse)
```

## Introducción

En el siguiente capitulo estaremos viendo como calcular las transiciones para la matriz de Lefkovitch. En la primera parte veremos como calcular las transiciones de manera tradicional y a mano y en la segunda parte veremos como calcular las transiciones de manera más eficiente usando funciones que estén disponibles en algunos paquetes de R. Los métodos presentado aquí son una adaptación de los métodos presentados en [@caswell2000matrix] y pueden ver también una aplicación de estos métodos aplicado a las orquídeas [@tremblay2003population]. Si ha hecho análisis de matrices de transición antes, probablemente ha usado el método tradicional de calcular las transiciones y pueden obviar leer este capítulo. Este método consiste en calcular la proporciones de individuos que transitan de una clase de edad a otra. Este método es tedioso y propenso a errores cuando se hacen a mano.

## Métodos tradicional de calcular las transiciones

El primer paso es la tabla de datos de la orquídea y sus estados en dos periodos de tiempo, digamos un año de intervalo. Aquí adjunto un ejemplo de una tabla de datos de 20 individuos. Tenemos 3 estados en esta planta, "A", "B", "C" y "Muerto". En la tabla de datos, tenemos 19 individuos que fueron muestreados en dos periodos de tiempo. En el primer periodo de tiempo, 7 individuos estaban en el estado "A", 6 en el estado "B" y 6 en el estado "C". Para calcular las transiciones, necesitamos calcular la proporción de individuos que transitaron de un estado a otro. Por ejemplo, de los 7 individuos que estaban en el estado "A" en el primer periodo de tiempo, 1 individuos estaba en el estado "A" en el segundo periodo de tiempo, 2 individuos estaban en el estado "B", 3 individuos estaban en el estado "C", y un individuo que murió, dando las siguientes proporciones

De A a otras clases

-   1/7 = 0.1428, transitaron de "plantas pequeñas" a "plantas pequeñas"
-   2/7 = 0.2857, transitaron de "plantas pequeñas" a "juveniles"
-   3/7 = 0.4285 transitaron de "plantas pequeñas" a "adultos"
-   1/7 = 0.1428 fallecieron o sea que las "plantas pequeñas" en el primer periodo de tiempo fallecieron antes de llegar al segundo muestreo


```{r Trans2}
library(tidyverse)
a=2/6
b=1/6
c=1/6
d=2/6

sum=a+b+c+d
sum

sum2=0.1428+0.1428+0.2857+0.4285
sum2

```

Nota que la suma de todas estas transiciones tienen que sumar a 1.000. NO pueden ser mayor que 1 o menor que 1. Si la suma de las transiciones es mayor que 1, significa que hay un error en los datos. Si la suma de las transiciones es menor que 1, significa que hay un error en los datos. Esto ocurre cuando se redondea excesivamente o incorrectamente. En este caso, nota que la suma da un total de 0.9998, que es suficiente cerca de 1.0.

Ahora calculamos las otras transiciones de juveniles a otras clases - 2/6 = 0.3333, transitaron de "juveniles" a "plantas pequeñas" - 1/6 = 0.1666, transitaron de "juveniles" a "juveniles" - 2/6 = 0.3333, transitaron de "juveniles" a "adultos" - 1/6 = 0.1666, fallecieron de las "juveniles" en el primer periodo de tiempo fallecieron en el segundo periodo de tiempo

De C a otras clases

-   1/6 = 0.1666, transitaron de "adulto" a "plantas pequeñas"
-   2/6 = 0.3333, transitaron de "adulto" a "juveniles"
-   1/6 = 0.1666, transitaron de "adulto" a "adulto"
-   2/6 = 0.3333, fallecieron de las "adulto" en el primer periodo de tiempo fallecieron antes del segundo periodo de tiempo



```{r Trans3, message=FALSE, echo=FALSE}

library(gt)
Orchis_ficticia=tribble(~Num_ind, ~anio_1, ~anio_2,
                        1,  "plantas_pequeñas", "Muerto",
                        2,  "plantas_pequeñas", "juvenil",
                        3,  "plantas_pequeñas", "adulto",
                        4,  "juvenil", "plantas_pequeñas",
                        5,  "juvenil", "juvenil",
                        6,  "juvenil", "adulto",
                        7,  "adulto", "plantas_pequeñas",
                        8,  "adulto", "juvenil",
                        9,  "adulto", "adulto",
                        10,  "plantas_pequeñas", "plantas_pequeñas",
                        11,  "plantas_pequeñas", "juvenil",
                        12,  "plantas_pequeñas", "adulto",
                        13,  "plantas_pequeñas", "adulto",
                        14,  "juvenil", "plantas_pequeñas",
                        15,  "juvenil", "Muerto",
                        16,  "juvenil", "adulto",
                        17,  "adulto", "Muerto",
                        18,  "adulto", "juvenil",
                        19,  "adulto", "Muerto",
                        20,  "", "plantas_pequeñas"
                        )
gt(Orchis_ficticia)                        
```

### Construyendo la matriz de transiciones

Ahora usamos los valores calculados arriba para construir la matriz de transiciones.

Nota que en las columnas representa el estado en el tiempo 1 y las filas los estados en el periodo 2. Importante la transiciones a Muerto no se pone en la matriz, automáticamente los análisis reconoce que 1 menos la suma las transiciones en la matriz, sera la proporciones de fallecimiento.

```{r Trans4}
ficticia_matrix=matrix(c(0.1428, 0.3333, 0.1666,
                         0.2857, 0.1666, 0.3333,
                         0.4285, 0.3333, 0.1666), 
                            nrow=3, byrow=TRUE)

ficticia_matrix
```

### Añadiendo los nombres de las etapas

Es buena práctica añadir el nombre de las etapas a la matriz ya que ayuda a encontrar incosistencia y posible errores. Las dos funciones necesarias son **rownames** y **colnames**.

```{r Trans5}
rownames(ficticia_matrix)<-c("plantas_pequeñas", "juvenil", "adulto")
colnames(ficticia_matrix)<-c("plantas_pequeñas", "juvenil", "adulto")

ficticia_matrix

```

------------------------------------------------------------------------

### Construcción de matriz con funciones en R

En la próxima sección veremos como calcular las transiciones de manera más eficiente usando funciones disponibles en un paquete de R. La función principal que usaremos es la función **projection.matrix** del paquete **popbio**. Sin duda esta función es más eficiente y menos propensa a errores que hacerlo a mano.

Los argumentos de la función **projection.matrix** son los siguientes:

```         
projection.matrix(
  transitions, # el nombre de la tabla de datos
  stage = NULL, # el nombre de la columna con los estados en el primer tiempo
  fate = NULL, # el nombre de la column con los estados en el segundo tiempo
  fertility = NULL, la información sobre la fertilidad
  sort = NULL, # si se quiere ordenar los estados de la historia de vida
  add = NULL,
  TF = FALSE # si quiere que la matriz de transiciones y de fertilidad sean separados usa = TRUE 
   )
```

Nota que el "output" de la función **projection.matrix** es una lista con dos elementos, en dos matrices, una con las transiciones $T$ y otra con la fertilidad $F$. La primera tiene solamente los valores de transiciones y la segunda solamente los valores que corresponde a la fertilidad, o sea la cantidad de individuos que se añaden a cada clase de edad.


Antes de comenzar hacer los análisis es importante que los nombres de las columnas se cambian a nombres que causan menos problemas para la función **projection.matrix**. En este caso, cambiamos los nombres de las columnas de la tabla de datos de "anio_1" a "stage" y de "anio_2" a "fate". Esos nombres corresponde a las etapas en el primer y segundo periodo de tiempo, *fate* se traduce como "destino" en español. 

```{r Trans6}
library(tidyverse)
Orchis_ficticia=Orchis_ficticia %>% rename(stage=anio_1, fate=anio_2)
head(Orchis_ficticia)
```




```{r Trans7}
library(popbio)

Orchis_ficticia_df=as.data.frame(Orchis_ficticia) # Nota que es importante convertir la tabla de datos a un data frame si es en formato de tibble. 
stages=c("plantas_pequeñas", "juvenil", "adulto")
Orchis_ficticia_df$fertilidad<-1/6
projection.matrix(Orchis_ficticia_df, stage, fate, fertilidad, stages, TF=TRUE)


```

Si quiere la matriz con la unión de ambas matrices, puede usar el argumento **TF=FALSE**.

Nota que esta matriz se llama matA = matT + matF (la suma de las matrices de transiciones y de fertilidad)

```{r Trans8}
projection.matrix(Orchis_ficticia_df, stage, fate, fertilidad, stages, TF=FALSE)


```



## Matriz con Clonaje

Muchas orquídeas se reproducen por clonaje, o sea que los individuos son genéticamente idénticos. En algunas ocasiones estos clones se pueden separar de la planta madre (por ejemplo por keiki) y otras especies es una manera de reproducción asexual o ponerse más grande. En este caso, la matriz de transiciones se puede modificar para incluir el clonaje. Hay pocos ejemplos en las orquideas de matriz que incluyen una sub-matriz de clonaje **matC**. 

Vemos un ejemplo del trabajo de *Cypripedium calceolus* en Europa [@garcia2010living]. En este trabajo los autores querían explorar la dinámica de especies que viven a la periferia de su distribución geográfica. La poblaciones se encuentran en los Pirineos y en el norte de Europa. 

```{r Trans9}
library(Rcompadre)

```


```{r Trans10}
compadre <- cdb_fetch("compadre") # Usar este código para bajar los datos del repositorio de COMPADRE. Tiene que haber activado la librería de Rcompadre.


```

Extraer de la base de datos de COMPADRE las matrices de transiciones de *Cypripedium calceolus* de del articulo mencionado arriba. 

 Los pasos son los siguientes
  - Filtrar la base de datos para *Cypripedium calceolus*
  - Filtrar la base de datos para el DOI del articulo
  - Filtrar la base de datos para la dimensión de la matriz de transiciones (6x6)
  - Filtrar la base base de datos para una matriz en particular (242623)
  
  NOTA que se podría haber filtrado parta la MatrixID solamente. 

```{r Trans11}


Cyp_cal_matC=compadre %>% select(MatrixID, SpeciesAccepted, mat, Authors, DOI_ISBN, MatrixDimension) %>% 
  filter(SpeciesAccepted %in% c("Cypripedium calceolus"),
         DOI_ISBN %in% c("10.1111/j.1523-1739.2010.01466.x"),
         MatrixDimension %in% c(6),
         MatrixID %in% c(242623))
  

#Cyp_cal_matC$mat # para el año 2000 a 2001

```


Las matriz de transiciones de *Cypripedium calceolus* tiene una matriz de transiciones, de fecundidad y clonaje, matA=matU+matF+matC

```{r Trans12}


matA <- matA(Cyp_cal_matC) # extraer la matriz a partir de la base de datos de COMPADRE
matcc=as.matrix(as.data.frame(matA)) # convertir la matriz a un data frame y luego a un objeto en forma de matriz 
matcc
```



## Extraer la matriz de Clonaje


NOTE que la matriz de clonaje es la siguiente.

Lo que se observa es que hay NUEVOS individuos en el tiempo t+1, que provienen de los individuos en el tiempo t. En este caso, son individuos de las etapas 4, 5 y 6 que producen individuos nuevos en la etapa 3 y 4. 

```{r Trans13}
matC <- matC(Cyp_cal_matC) # extraer la matriz de clonaje a partir de la base de datos de COMPADRE
matC
```



Ahora vemos el ciclo de vida de *Cypripedium calceolus* en este estudio donde las lineas azules son las transiciones de una etapa las transiciones por clonaje. 




```{r Trans14}
library(DiagrammeR)


#etapas <- c("A1", "A2", "A3", "A4", "A5", "A6")
etapas <- c("Dormant", "Smallest", "Small", "Intermediate", "Large", "Extra Large") # Etapas del articulo

etapas <- factor(etapas, levels =  c("Dormant", "Smallest", "Small", "Intermediate", "Large", "Extra Large"))
title <- NULL
graph <- expand.grid(to = etapas, from = etapas)
graph$trans <- round(c(matcc), 2)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", etapas, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 3
graph$col <- c(
  "red", "black", "black", "black","black",
  "black", "red", "black", "black",
  "black",  "black", "red", "black", "black",
  "black",  "black", "blue", "black", "black",
  "black",  "black", "blue", "black", "black", 
  "black",   "black", "blue", "blue","black", "black"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=etapas;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 
```


***

### Fertilidad

Nota que no se añadió el calculo de la fertilidad en la tabla de datos, por lo que la matriz de fertilidad es una matriz de ceros. En el próximo capitulo veremos como añadir la fertilidad a la matriz.

### Problema con el uso tradicional de calcular las transiciones

El uso de estos métodos tradicionales aun que sean calculado a mano o usar la función **projection.matrix** del paquete **popbio** pudiese ser problemático. Los problemas ocurren por condiciones de muestreo, especialmente cuando trabajan con especies raras y los tamaños de muestra están pequeños o que las transiciones son raras de forma natural [@tremblay2021population; @gascoigne2023standard]. En el capitulo XX: **Impacto de datos sin sentidos** se discute los problemas posibles cuando hay datos sin sentidos y como construir matrices más confiable y cuando se debería usar el método Bayesiano para los análisis. En el capitulo XX se discute como resolver asuntos de matrices para que sean más compatible con la biología de la especies estudiada y por consecuencia.

<!--chapter:end:05-calcular_transiciones.Rmd-->

# Como calcular fecundidad

## Por: Demetria y Aucencia: equipo ECOSUR

## Métodos tradicional de calcular las transiciones



## Problema con el uso tradicional




## Referencias

<!--chapter:end:06-calcular_fecundidad.Rmd-->

# Matrices de transicion, fecundidad y clonal {#MatricesTFC}

## Por: Raymond 


## Tres tipos de matrices

Para facilitar los análisis y interpretaciones es necesario tener claro la diferencias en los parámetros que provienen de transiciones, fecundidades y clonaje, cada sub-matriz se suma para tener un modelo de una matriz poblacional.  La suma de cada una de esas sub-matrices resulta en la matriz de transiciones para evaluar algunos de los parametros del crecimiento poblacional.

Definiciones de las matrices

 - MatU = Matriz de transiciones
 - MatF = Matriz de Fecundidad
 - MatC = Matriz de clonaje
 - MatA = MatU + MatF + MatC
 
 
  ![Relación entre matrices; Diseño: Samuel Gascoigne ](Figures/Matrices_A_U_F_C.jpg){width=90%}

## MatU: Matriz de transiciones

En la matriz de transiciones, **MatU** se encuentra solamente la información sobre de transiciones, estasis o retroceso entre las etapas de vida. Por consecuencia todo información sobre reproducción y clonaje es excluida.  Si el diseño del modelo asume tres etapas de vida, plantulas, juvenil y adultos, se incluye solamente las siguientes transiciones.

Nota que es este modelo los juveniles no pueden regresar a ser plantulas, pero los adultos pudiese regresar a ser juvenil.  Seria probablemente más adecuado re-nombrar la etapa juvenil (que se entiende que no es reproductivo) a algo más claro como "Individuos pequeño".

```{r matA1}
library(DiagrammeR)
library(Rage)
matU <- rbind(
  c(0.1, 0.0, 0.0),
  c(0.5, 0.3, 0.05),
  c(0.001, 0.4, 0.8)
)
stages <- c("Plantulas", "Juvenil", "Adulto")
plot_life_cycle(matU, stages=stages)
```


## MatF: Matriz de fecundidad

 Si uno sigue la figura anterior vemos que los individuos en la segunda etapa se reproducen sexualmente (producen plantulas). Por consequencia seria probablemente más adecuado cambiar de nombre para la segunda etapa de "juvenil" a "individuos pequeños".  Lo que se observa es el ciclo de vida de la oportaciones de plantulas es que los Individuos pequeños y Grande producen plantulas.  
 
 
```{r matA2}
library(DiagrammeR)
library(Rage)
matF <- rbind(
  c(0.0, 0.4, 1.8),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
)
stages <- c("Plantulas", "Ind Pequeños", "Ind Grande")
plot_life_cycle(matF, stages=stages)
```

 
## MatC = Matriz de clonación

Esa matriz representa la información para especies que se reproducen por clonaje.  Nota que hay necesitar de definir lo que es crecimiento por clonaje. Por ejemplo un individuo de *Epidendrum* que crece y que tenga más tallos, no debería ser considerado clonaje, pero crecimiento del individuo. Al contrario un individuo que crece de forma que la planta madre se separa en dos o más partes donde no comparten conexión pudiese ser considerado clonaje.  Otra alternativa es que hay muchas especies de orquídeas que producen *keiki*, el momento que estos se separan de la madre se pueden considerar como el mismo individuo (geneticamente igual) a parte (ecologícamente distinto).  

Necesitamos fotos de orquídeas con clonaje y keiki (quien puede ayudar)

Se debería enfatizar que añadir el concepto de clonaje dentro de la matriz de transiciones resulta en estimados de parámetros diferentes, tal como el tamaño efectivo de población, Ne, en adición de evaluar otros conceptos evolutivos.  En estudios evolutivos no es el individuo como tal que es la unidad de interés pero el individuo como fuente de diversidad genética, por consecuencia individuos (clones) que son genéticamente igual son evolutivamente el mismo individuos aunque estén separado físicamente. Las poblaciones organizados en clones afecta la interpretación de datos tanto en los estudios ecológico y evolutivos @cook1983clonal.  Cuando se estudia especies con clonación hay que diferenciar entre los que es el "ramet" y un "genet".  Los "genets" son la suma de todas las partes "los ramets" que tiene la misma genética.   Los "ramet", son las partes individuales del individuo.  En orquídea se podría considerar cada seudobulbo como un ramet y la suma de todos los seudobulbo como el "genet".  Hay acercamiento para tomar en cuenta la adecuación de los "individuos" en la matriz y por consecuencia intergrar el concepto de clonación en los estimados. vea: @mcgraw1996estimation.    












<!--chapter:end:07-matriz_transicion_fecundidad_clonal.Rmd-->



# Método bayesiano de calcular las transciones y fecundidades

Por: Raymond L. Tremblay

El objetivo de este capítulo es demostrar algunos de los retos cuando uno trabaja con especies raras o con especies que tiene tamaño de muestra limitada o transiciones poco frecuente. Se demostrará como tomar encenta los análisis cuando hay poca información para estimar los parámetros de la matrices y como se puede resolver y estimar parámetros para que sean más realista. Considera este primer ejemplo donde se estima que la especie de interés tenga tres etapas en su ciclo de vida (semillas, plántulas y adultos) y que solamente la etapa más grande (de adultos) puede producir semillas. Cuando se comienza un análisis de dinámica poblacional el primer paso es evaluar y tratar de ver cual son las etapas del ciclo de vida que pudiesen ser representativo de la dinámica principal de la especie y que sea realista cuando se considera el ciclo de vida de la especies y práctico en la recolección de datos.  

En esta primera figura vemos lo que se considera que ocurre en esa especie hipotética.  Ahora se recoge los datos del campo y evalúa las transiciones y fecundidad y tiene información siguiente.  

 1. Todas las semilla germinan y crece a la etapa de plántula.  
  - Es realista que todas las semillas germinan? 
  - Por que no se encontró semillas que NO germinan?
  
 2. Todos las plántulas mueren antes de llegar a la etapa de adulto.
    - Es realista que todas las plántulas se muere dentro del ciclo de vida de una especies?
    
    
Aquí se ve dos de los problemas que resulta en MPM que no son realista, uno que no hay ninguna mortandad o que todo se muere.  El otro componente es el efecto del tamaño de muestra, considera que su especie de interés usted tuvo acceso solamente a 4 plantas adultas (un especies rara), y 4 de los 4 sobrevivieron, por consecuencia 100% de supervivencia.  Si los individuos llegan a esta etapa son inmortales!!!?  Claramente es un resultado del tamaño de muestra y no del ciclo de vida de la especie. Es por pura probabilidades que no se encontró una planta que se muere.  

Es importante reconocer la diferencia entre los valores recolectado y la historia de vida típica de una especies. Uno podría usar los datos que 100% de los individuos sobreviven pero eso es realista a largo plazo? 

El paquete **raretrans** ayuda en resolver estos asuntos ilógicos y crear matrices que son más realistas al considerar el ciclo de vida típica de la especie estudiada.  

Aquí un ciclo de vida que no es biologícamente realista

 - todas las semilla sobreviven y pasan a plántulas
 - ninguna plántula sobrevive y/o pasa a ser adultos
 - los adultos 90% se quedan como adulto pero ninguno produce semillas
 
 NOTA que es posible que los datos que recolectan del campo sean estos, pero muchas veces esas observaciones son un resultado de la falta de tamaño de muestra.   

 
```{r bayes1}
# hidden code to produce figures
library(DiagrammeR)
library(Rage)
library(gt)


matA <- rbind(
  c(0.0, 0.0, 0.0),
  c(1.0, 0.0, 0.0),
  c(0.0, 0.0, 0.9)
)
stages <- c("semillas", "plantulas", "adultos")
title <- NULL


```

```{r bayes2}
plot_life_cycle(matA, stages=stages)

```

Considera este siguiente ejemplo:

 - Si se estudia los arboles *Sequioa* y muestra los arboles grandes (con un dbh de > xxx), aunque muestra 1000+ individuos de esa etapa/tamaño es posible que no encontrará ninguno que muere entre un año y otro. Por consecuencia el estimado de supervivencia de esos arboles es 100%.  Aunque uno sabe que si hubiese muestreado 10,000 o 100,000 arboles se podría haber detectado uno o más individuos que fallece.  En adición la mortandad en planta es frecuentamente relacionado con el tamaño, más grande menos le probabilidad de fallecer.  La mortandad en estos tipo de individuos puede ser dependiente del tiempo, donde hay variación biotica o abiotica que aumenta la mortandad pero son eventos raros.  Por consecuencia, la mortandad en estos individuos es rara pero no es 0.  Es importante considerar la biología de la especie y el tamaño de muestra cuando se analiza los datos.


## El paquete "raretrans"

El manuscrito [@tremblay2021population, @raretrans2024] con la información original del uso del paquete se encuentra aquí https://doi.org/10.1016/j.ecolmodel.2021.109526.

**Population projections from holey matrices: Using prior information to estimate rare transition events**

Abstracto

Las matrices de proyección de población son un medio común para predecir la persistencia de la población a corto y largo plazo para especies raras, amenazadas y en peligro de extinción. Los datos de tales especies pueden sufrir de tamaños de muestra pequeños y, en consecuencia, perder eventos demográficos raros que dan como resultado trayectorias de ciclo de vida incompletas o biológicamente poco realistas. Las matrices con valores faltantes (ceros; p. ej., sin observación de semillas que se transforman en plántulas) a menudo se substituye utilizando información de la literatura, otras poblaciones, períodos de tiempo, otras especies, estimaciones de las mejores conjeturas o, a veces, incluso se ignoran. Para paliar este problema, proponemos usar un modelo multinomial de Dirichlet para parametrizar las transiciones y un Gamma para los estimados de reproducción para substituir los valores faltantes en estas matrices perforadas. Esto integra formalmente la información previa dentro de un marco bayesiano e incluye explícitamente el peso de la información previa en las distribuciones posteriores. Mostramos utilizando dos conjuntos de datos reales que el peso asignado a la información anterior influye principalmente en la dispersión de los posteriores, la inclusión de anteriores da como resultado matrices irreducibles y ergódicas, y se pueden hacer inferencias biológicamente más realistas sobre las probabilidades de transición. Debido a que las previas se establecen explícitamente, los resultados son reproducibles y se pueden volver a evaluar si hay previas alternas disponibles en el futuro.

## Instalación de los paquetes #1

```{r bayes3}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(janitor, tidyverse, devtools)

library(tidyverse)
library(janitor)

```

## Instalación de raretrans #2

Para instalar **raretrans** remover el **#** antes de correr el script para tener aceco a los codigos de **raretrans**. 

```{r bayes4}
#library(devtools)

devtools::install_github("atyre2/raretrans", build = TRUE, build_opts = c("--no-resave-data", "--no-manual"))

library(raretrans)


```

Vea el siguiente enlace para más información en ingles, la información que sigue es una traducción y ampliación de la información del enlace. 

<https://atyre2.github.io/raretrans/articles/onepopperiod.html>

```{r bayes5, message = FALSE}

library(tidyverse)
library(ggplot2)
library(popbio) # para la función projection.matrix()
library(raretrans)
# Mi tema de formato de las gráficas de ggplot2 personal
rlt_theme <- theme(axis.title.y = element_text(colour="grey20",size=15,face="bold"),
        axis.text.x = element_text(colour="grey20",size=15, face="bold"),
        axis.text.y = element_text(colour="grey20",size=15,face="bold"),  
        axis.title.x = element_text(colour="grey20",size=15,face="bold"))
```

El objetivo de esta viñeta es demostrar el uso del paquete `raretrans` para los cálculos de los parámetros en una población y periodo de transición.

## Obtención de la matriz de proyección

`raretrans` asume que la matriz de proyección es una lista de dos matrices, una matriz de transición y una matriz de fertilidad. Este es el formato de salida de `popbio::projection.matrix`. Si tenemos transiciones individuales en un marco de datos, podemos usar `raretrans::get_state_vector` para obtener el número inicial de individuos por etapa. 

Podemos utilizar `popbio::projection.matrix` para obtener los datos necesarios. Hacemos una demostración con los datos de transición y fertilidad de la orquídea epifita *Lepanthes elto* **POPNUM 250** en el **periodo 5**. *Lepanthes eltoroensis* es endémica de Puerto Rico, epifita y limitada a una pequeña región de la isla.  

## Paso 1: Cargar y fusionar los datos de población única para *L. elto*

```{r bayes6}
data("L_elto") # carga el conjunto de datos `L_elto` en la memoria de la computadora (los datos están incluido en el paquete `raretrans`)
head(L_elto) 
```

## Organización de los datos en el "data.frame"

-   el primer paso es seleccionar los datos de una población y un periodo de tiempo.
-   el segundo paso es hacer un cambio en la terminología para el estado más pequeño de "plantula" a "seedling"... Ese cambio es para que la información presentada aquí sea la misma que en el documento en ingles.

Cada fila de este data.frame de datos tiene columnas para la fase actual (*stage*, periodo **t**), la fase siguiente (*next_stage*, periodo **t+1**) y la fertilidad por individuo. Tenga en cuenta que "p" significa "plántula" en español. El primer conjunto de líneas de abajo cambia el nombre de la etapa del ciclo vital de "p" a "s" después de seleccionar la población y el periodo de tiempo.

```{r bayes7_mungeData}
onepop <- L_elto %>%   

  filter(POPNUM == 250, year == 5) %>% # Filtrar la población # 250, el periodo (año=year) 5
 
  mutate(stage = case_when(stage == "p" ~ "s",
                           TRUE ~ stage),
         next_stage = case_when(next_stage == "p"~ "s",
                           TRUE ~ next_stage))  # redefine "p" por plantula a "s" para seedling

# popbio::projection.matrix no funciona con el formato *tibbles*, por consecuencia se convierte en data.frame

head(onepop) # Ahora tenemos solamente datos de la población #250 del periodo 5
# Crear TF = TRUE, añadir para formatear correctamente.
TF <- popbio::projection.matrix(as.data.frame(onepop), 
                        stage = stage, fate = next_stage, 
                        fertility="fertility", sort=c("s","j","a"), TF = TRUE)
TF # Este es la estructura de etapas de vida para esa población.  Nota que tenemos dos matrices, una de transiciones **T** y otra de fertilidad **F**. 
```

## Nota:

Nuestros estadios se codifican ahora como **s** (plántula), **j** (juvenil) y **a** (adulto), y ahora tenemos dos matrices: **T** (transición de estadios) y **F** (fecundidad). La tasa de crecimiento asintótica de la población observada es $\lambda =$ `r format(lambda(TF$T + TF$F),digits = 2)`. Las transiciones raras que faltan en nuestra primera matriz de transición, `TF$T`, son la transición de plántula (*s*) a adulto (*a*) y la transición de *j* a
*s*. Pero sabemos que ocurren.

## Paso 2: Obtener el número inicial de individuos por etapa

Dado que nuestras recuentos (número de individuos, *N*) y el tamaño de *muestreo equivalente* a priori se expresa como múltiplo del número de individuos observados, necesitamos obtener el número de individuos en cada etapa ($N$) en el primer periodo de tiempo.

Utilizamos la función `raretrans::get_state_vector()` para obtener el recuento inicial de individuos, *N*. Se observa que la cantidad de individuos inciales por etapa es el número de individuos en el primer muestreo es muy limitada, con 11 plántulas, 47 juveniles y 34 adultos. 

```{r bayes8}
N <- get_state_vector(onepop, stage = stage, sort=c("s","j","a")) 
N # Un vector # de individuos iniciales para cada etapa, nota que la cantidad por etapa, "stage", son los individuos en el primer muestreo
```


## Metodo alterno de calcular las transiciones, fecundidades y el número de individuos por etapas

La lista de matrices y el vector de cuento de individuales no tienen por qué proceder de un data.frame como hemos hecho aquí. Mientras tengan el formato esperado, pueden crearse a mano. Usamos la población 231 en el periodo 2 como ejemplo, dividiendo la matriz en submatrices de transición **T** y fecundidad **F**. Abajo, *m* significa "muerte", es decir, plantas que están muertas. Nota aquí que las transiciones están estimada de tamaño de muestra todavía más pequeña con solamente 2 plántulas, 6 juveniles y 16 adultos. Ni una de las 2 plántulas crecieron a ser juveniles por consecuencia su transición es de cero. En adición una plántulas falleció, entonces 50%, si hubiese muerto los dos seria 100% mortandad, y si hubiese sobrevivido los dos 100% se quedan como plántulas. No hay valores intermedios!!!



```{r bayes9, echo=FALSE}
Tmat <- L_elto %>% 
  mutate(stage = factor(stage, levels=c("p","j","a","m")),
         fate = factor(next_stage, levels=c("p","j","a","m"))) %>%
  filter(POPNUM == 231, year == 2) %>%
  as.data.frame() %>% 
  xtabs(~fate + stage, data = .) %>% 
  as.matrix()
Tmat <- Tmat[,-4] # remover la columna para transiciones de la muerte
N2 <- colSums(Tmat) # obtener el número total. Averiguar: debe ser antes de 86 en este caso. 
Tmat <- sweep(Tmat[-4,], 2, N2, "/") # normalizar a 1, descartando las transiciones *hacia* la muerte, nota que el "2" es para decir que haga los calculos por columna
# averiguar cuánta reproducción ocurrió en el año 2 mirando el año 3
# L_elto %>% 
#   mutate(stage = factor(stage, levels=c("p","j","a","m")),
#          fate = factor(next_stage, levels=c("p","j","a","m"))) %>%
#   filter(POPNUM == 231, year == 3, stage == "p") %>%
#   count(stage) 
# 2 offspring from N[3] == 16 adults
Fmat <- matrix(0, nrow=3, ncol=3) # crear una matriz de ceros. 
Fmat[1,3] <- 2/16 # contar 16 adultos reproductivos en el tiempo t y dos plántulas en el próximo tiempo t+1, 2/16. 
TF2 <- list(Tmat = Tmat, Fmat = Fmat)
```

```{r bayes10}
TF2
N2
```


¿Como se ve el ciclo de vida de esa población en ese periodo? 

En esta matriz falta la transición de plántula a juvenil, y ninguno de los 6 juveniles murió, lo que lleva a una sobre estimación de la supervivencia. La tasa de crecimiento asimtótico de la población observada es $\lambda =$ `r format(lambda(TF2$T + TF2$F),digits = 2)`. La matriz no es ergódica (no se puede llegar a cualquier otro estado desde uno o más estados), y es reducible, lo que significa que una o más columnas y filas se pueden descartar y tienen las mismas propiedades eigen.

```{r bayes11}
stages2 <- c("plantulas", "juveniles", "adultos")
title <- NULL
plot_life_cycle(Tmat, stages=stages2)
```


Lo que vimos anteriormente fue algunos de los problemas reales que uno encuentra cuando se usa datos de campo, y hay tamaño de muestra pequeña o transiciones raras. 


## Uso de priors para incorporar transiciones raras

### Use priors no informativos

-   Ese paso es solamente para entender porque no se calcula y porque no se usa *prior* uniforme. Si entiende el concepto de valores 
*apriori* y *posteriori* puede saltar este paso y ir a la sección de *Añadiendo realidad a los análisis*.  Tremblay (@tremblay2021population) muestran que los valores de *prior* de una dirichlet funciona para las columnas de la matriz de transición (**T**) y que valores *prior* gamma funciona para las columnas de la matriz de transición (**F**). 

### Matriz de transición

Por lo tanto, vamos a añadir un dirichlet uniforme con prior con un peso = $1$ a la matriz de transición, $T$. Aquí, tenemos 4 destinos (3 + muerte), por lo que cada destino 0,25 a la matriz de destinos *observados* (¡no a la matriz de transiciones!) de transición). Cuando especificamos una matriz con de valores *apriori* para las transiciones, hay una fila más que columnas. Esta fila extra representa la muerte.

NOta que el prior uniforme no es recomendado, pero se usa aquí para demostrar el concepto. Un prior uniforme probablemente no toma en cuenta el ciclo de vida correcta de la especie.  Por ejemplo que las plántulas pueden pasar adulto un ese periodo de tiempo?, Es posible que un adulto puede regresar a ser plántula? 

```{r bayes12_posterior1}
Tprior <- matrix(0.25, byrow = TRUE, ncol = 3, nrow=4)
fill_transitions(TF, N, P = Tprior) # resultado de la matriz de transición básica


# Para entender las diferencias del impacto de las matriz compara los resultados con *$T* del objeto *TF*
TF
```

### Como calcular a mano!

Podemos obtener el mismo resultado 'a mano' - necesitamos el vector de observaciones porque la posterior se calcula a partir de las observaciones de transiciones, no la matriz de transiciones.

```{r bayes13_manualTransitionPost}
Tobs <- sweep(TF$T, 2, N, "*") # obtener las observaciones de transiciones 
Tobs <- rbind(Tobs, N - colSums(Tobs)) # añadir la fila de muerte 
Tobs <- Tobs + 0.25 # añadir los valores a priori
sweep(Tobs, 2, colSums(Tobs), "/")[-4,] # dividir por la suma de la columna y descarta la fila de muerte 
```

El *prior uniforme* rellena las transiciones que faltan, pero también crea problemas porque proporciona valores de transición que son biológicamente imposibles. Por ejemplo, proporciona una transición para adulto-\>plántula, cuando esta transición sólo es posible en la matriz de fecundidad $F$. Por esta razón, no recomendamos el uso de priores uniformes. En otra palabra usando un prior uniforme no toma en cuenta el ciclo de vida de una especie.

### Matriz de fecundidad

Debemos especificar los parámetros para la fertilidad *a priori* como una matriz. Las etapas que no hay reproducción o sea que no se producen por reproducción deben ser `NA`, usando *NA_real\_*. El concepto de *NA_real\_* es que es un valor que no esta presente pero con puntos decimales. Nota que el valor *a priori* de la fertilidad es 0.0001.

```{r bayes14}
alpha <- matrix(c(NA_real_, NA_real_, 1e-5,
                  NA_real_, NA_real_, NA_real_,
                  NA_real_, NA_real_, NA_real_), nrow=3, ncol = 3, byrow = TRUE)
beta <- matrix(c(NA_real_, NA_real_, 1e-5,
                  NA_real_, NA_real_, NA_real_,
                  NA_real_, NA_real_, NA_real_), nrow=3, ncol = 3, byrow = TRUE)
fill_fertility(TF, N, alpha = alpha, beta = beta)
```

El cambio en la fertilidad es \< 0,0001 en comparación con el valor observado.

### Calculando los valores a priori de fertilidad a mano

Métodos a mano, *alfa a priori* es el número de crías observadas y *beta a priori* es el número de adultos observados.

```{r bayes15}
obs_offspring <- N[3]*TF$F[1,3] 
prior_alpha <- 1e-05
prior_beta <- 1e-05
posterior_alpha <- obs_offspring + prior_alpha
posterior_beta <- N[3] + prior_beta
posterior_alpha / posterior_beta # valores esperados de la fertilidad
```

Esto demuestra por qué la estimación puntual posterior de la fecundidad no cambia mucho; los valores no informativos de $\alpha$ y $\beta$ apenas cambian los valores observados.

Ahora podemos juntar todos los valores a priori. NOTA que todavía no se recomienda usar un prior uniforme.

```{r bayes16_uninformativePrior}
unif <- list(T = fill_transitions(TF, N), 
             F = fill_fertility(TF, N, 
                                alpha = alpha,
                                beta = beta))
unif
```

## El crecimiento poblacional

La tasa de crecimiento asintótico de la población es ahora $\lambda =$ `r format(lambda(unif$T + unif$F),digits = 2)`. La tasa de crecimiento se reduce ligeramente porque la aplicación de la prioridad uniforme a las probabilidades de transición hace que las transiciones observadas de crecimiento y supervivencia se reduzcan ligeramente en relación con las transiciones no observadas de crecimiento y supervivencia.

### Otras opciones para el argumento \`returnType

Por defecto, `fill_transitions()` devuelve la matriz de transición $T$, y `fill_fertility()` devuelve la matriz de fertilidad $F$. Existen otros tres otros valores que puede tomar el argumento `returnType`:

1.  `fill_transitions(... returnType = "TN")` puede devolver una matriz aumentada de destinos, que es útil para la simulación. La cuarta fila de este resultado (véase más adelante) es el estado de mortalidad.

```{r bayes17}
fill_transitions(TF, N, returnType = "TN")
```

2.  `fill_fertility(... returnType = "ab")` devuelve los vectores alfa y beta de los vectores posteriores.\

```{r bayes18}
fill_fertility(TF, N, 
               alpha = alpha,
               beta = beta,
               returnType = "ab")
```

3.  Ambas funciones también pueden devolver la matriz completa, la suma de $T$ y $F$.

```{r bayes19}
fill_transitions(TF, N, returnType = "A")
```

## Añadiendo realidad a los análisis

Hasta este punto, el objetivo era de entender las funciones y su aplicaciones. Ahora vamos a añadir realidad a los análisis. Como se ha mencionado no deberíamos usar valores *a priori* uniforme. Debemos usar valores que son más relevante al ciclo de vida de la especie de interés.

### Incorporar priores informativos

Para solucionar el problema de la creación de transiciones imposibles, especificamos una prioridad más informativa obtenida de un experto en
orquídeas epifitas de *Lepanthes* (RLT). La información tiene que tener la misma forma que la matriz de transiciones con una fila más que columnas. Esa ultima fila representa los individuos que se mueren de la etapa correspondiente. Estos valores deberían ser recolectado ANTES de recolectar los datos de campo, para no sesgar los resultados. 

```{r bayes20}
RLT_Tprior <- matrix(c(0.25, 0.025, 0.0,
                       0.05, 0.9,   0.025,
                       0.01, 0.025, 0.95,
                       0.69, 0.05,  0.025), 
                     byrow = TRUE, nrow = 4, ncol = 3)
```

Nota la matriz tiene la 1ª fila, 3ª columna es 0,0, porque esta transición es imposible. Esta prioridad se construye de manera que las columnas suman 1, lo que crea la mayor flexibilidad para la ponderación de los valores **a priori*. Por defecto, la suma es 1, interpretado como un *tamaño de muestra a priori* de 1.

A hora usando la función de **fill_transitions** donde uno añade los valores del campo **TF**, el tamaño de muestra en el tiempo 1 **N**, el la matriz de valores *a priori** informativa, se calcula la matriz de transición *posteriori*.  Compara **TF** con esta matriz para ver los cambios. 

```{r bayes21}
fill_transitions(TF, N, P = RLT_Tprior)
```


### MOdificar el peso de los valores a priori


Podemos especificar el peso de los valores **a priori** modificando el tamaño de muestra de cada etapa.  Nota que si uno tiene poca confianza en los valores **a priori** se le da un valor pequeño para que los datos del campo dominan los resultados.  

```{r bayes22}
fill_transitions(TF, N, P = RLT_Tprior, priorweight = 0.5)
```

En este caso, la prioridad se pondera con la mitad del número observado de transiciones. En este caso, con sólo 2 transiciones, el tamaño efectivo de la muestra **a priori** sigue siendo 1. Si el número de transiciones observadas fuera mayor, una ponderación **a priori** de 0,5N sería mayor que 1, pero permitiría que los datos dominen.

## Intervalos de Confianza de los parámetros

Obtener los intervalos de confianza (IC) para cada entradas de la matriz

La distribución posterior marginal de un elemento en un multinomio es una distribución beta, y usamos esto para obtener intervalos creíbles en nuestro tasas de transición. Podemos usar el tipo de retorno TN para obtener los parámetros de el multinomio deseado.

Esas son las estimaciones puntuales (comparar con la primera columna anterior), inferior y superior $95\%$ de los intervalos creíbles simétricos para transiciones de la etapa de plántula. Existe un alto grado de incertidumbre debido a la tamaño de muestra pequeño ($2$) y bajo peso en el anterior ($1$), lo que lleva a un tamaño de muestra efectivo de 3. 

```{r bayes23}
TN <- fill_transitions(TF, N, P = RLT_Tprior, priorweight = 0.1, returnType = "TN")
a <- TN[,1] # cambie 1 a 2, 3 etc para obtener la distribución beta marginal de cada columna. 
b <- sum(TN[,1]) - TN[,1]# cambie 1 a 2, 3 etc para obtener la distribución beta marginal de cada columna. 
p <- a / (a + b)
lcl <- qbeta(0.025, a, b) # el valor 0.025 de la distribución beta
ucl <- qbeta(0.975, a, b) # el valor 0.975 de la distribución beta
knitr::kable(sprintf("%.3f (%.3f, %.3f)", p, lcl, ucl))
```



### El efecto del tamaño de muestra sobre los intervalos creíbles

Que pasa si uno aumenta el tamaño de muestra efectivo? Si aumentamos el tamaño de muestra efectivo a $20$ especificando: `priorweight`$= 9 (9*2 = 18 + 2 = 20)$ el los intervalos creíbles simétricos se reducen bastante. La importante aquí es que el tamaño de muestra tiene un impacto sobre la confianza que se tiene sobre el estimado de punto (el promedio) de las transiciones y permanencia y mortandad.  Nota como el tamaño de intervalo creíble cambia drasticamente si uno tiene más datos. 

La tasa de transición de plántula a juvenil se reduce cuando el tamaño de la muestra es demasiado grande. IMPORTANTE: En general, el tamaño de la muestra **a priori** debe ser menos que el tamaño de muestra observado. Este solamente un ejmplo para demostrar el concepto. 

```{r bayes24, echo=FALSE}
TN <- fill_transitions(TF, N, P = RLT_Tprior, priorweight = 9, returnType = "TN")
a <- TN[,1]
b <- sum(TN[,1]) - TN[,1] # El parámetro beta es la suma de todos los demás parámetros de Dirichlet.
p2 <- a / (a + b)
lcl2 <- qbeta(0.025, a, b)
ucl2 <- qbeta(0.975, a, b)
alltogethernow <- tibble(priorweight = factor(rep(c(1,9),each = 4)),
                         fate = factor(rep(c("s","j","a","dead"), times = 2), levels = c("s","j","a","dead")),
                         p = c(p, p2),
                         lcl = c(lcl, lcl2),
                         ucl = c(ucl, ucl2))
ggplot(data = alltogethernow,
       mapping = aes(x = fate, y = p, group= priorweight)) + 
  geom_point(mapping = aes(shape = priorweight), 
             position = position_dodge(width =0.5)) + 
  geom_errorbar(mapping = aes(ymin = lcl, ymax = ucl),
                position = position_dodge(width = 0.5)) + 
  rlt_theme
```



## Intervalos creíbles de $\lambda$

Obteniendo intervalos creíbles sobre la tasa de crecimiento asintótica, $\lambda$, requiere simular matrices a partir de las distribuciones posteriores. Esto es algo complicado de hacer correctamente, y hemos escrito una función `raretrans::sim_transitions()` para generar una lista de matrices simuladas dada la matriz observada y especificaciones previas. En otra palabra calcula multiples veces la matriz de transición y fecundidad basado en los datos observados y los valores *a priori* especificados variando los valores de los parámetros de la distribución beta y gamma.

En esta demostración, simulamos 5000 matrices y calculamos el valor $\lambda$ de cada matriz. A continuación, creamos un histograma de la distribución de $\lambda$.

Corren el script múltiples veces, y verán que los valores cambian a cada simulación

```{r bayes25}
sim_transitions(TF, N, P = RLT_Tprior, alpha = alpha, beta = beta,
                priorweight = 0.5)
```

Ahora simulamos 5000 veces, calculamos el valor $\lambda$ de cada matriz y creamos un histograma de la distribución. Se añade el valor de lambda en un objeto llamado RLT_0.5. Subsecuentemente se crea un histograma de la distribución de $\lambda$. Nota que el valor de $\lambda$ de 1 queda dentro de la distribución, en otra palabra el histograma muestra que la mayoría de los valores de $\lambda$ están cerca de 1.



```{r bayes26}
#set.seed(8390278) # make this part reproducible
alpha2 <- matrix(c(NA_real_, NA_real_, 0.025,
                  NA_real_, NA_real_, NA_real_,
                  NA_real_, NA_real_, NA_real_), nrow=3, ncol = 3, byrow = TRUE)
beta2 <- matrix(c(NA_real_, NA_real_, 1,
                  NA_real_, NA_real_, NA_real_,
                  NA_real_, NA_real_, NA_real_), nrow=3, ncol = 3, byrow = TRUE)
# generar 5000 matrices basado en las previas de transciones y de fertilidades, el tamaño de muestra, en adición de los datos
RLT_0.5 <- sim_transitions(TF, N, P = RLT_Tprior, alpha = alpha2, beta = beta2,
                priorweight = 0.5, samples = 5000)
# extract the lambdas for each matrix
RLT_0.5 <- tibble(lposterior = map_dbl(RLT_0.5, lambda)) # convertir la lista en un tibble
ggplot(data = RLT_0.5,
       mapping = aes(x = lposterior)) + 
  geom_histogram(binwidth = 0.01, colour="white") + 
  rlt_theme+ geom_vline(xintercept = 1, 
                color = "blue", size=1.5)
```

## Determinar si el $\lambda$ es significativamente diferente de 1

Esa prueba es basada en la simulación de la distribución posterior.  Se calcula la distribución de los $\lambda$ y se determina si el $\lambda$ observado es significativamente más grande que 1. También podemos calcular algunas estadísticas de resumen. `pincrease` es el probabilidad de que $\lambda > 1$. En este caso el valor de $\lambda$ no es significativamente más grande que 1, con un valor de 0.13. 


```{r bayes27}
RLT_0.5_summary <- summarize(RLT_0.5,
                             medianL = median(lposterior),
                             meanL = mean(lposterior),
                             lcl = quantile(lposterior, probs = 0.025),
                             ucl = quantile(lposterior, probs = 0.975),
                             pincrease = sum(lposterior > 1.)/n())
```

### Tabla de resultado de lambda

```{r bayes28}

gt(signif(RLT_0.5_summary, digits = 2))
```


Revisión RLT: Sept 15, 2024
Revisión RLT: Oct 8, 2024

<!--chapter:end:08-Metodo_bayesiano_transiones.Rmd-->

# Crecimiento Poblacional

Por: Tamara

## Introducción al crecimiento poblacional

Ahora el primer paso es explicar a que .....

  - Crecimiento intrínseco
	- Estimado de intervalos de confianza de lambda



## Métodos


<!--chapter:end:09-Crecimiento_poblacional.Rmd-->

# Estimación de Parametros

## Por: Mariana y Paola

## En este capitulo se cubrirá varios estimación de parametros. 



### Condición basica de las matrices de transición 

## Librerías de R requeridas para el análisis

```{r Indice1, message=FALSE}
library(popdemo)
library(popbio)
library(ggplot2)
library(dplyr)
library(scales)
```

***


```{r Indice2, message=FALSE}

#Capturar los datos de la matriz para L. rubripetala (Tremblay et al. 2015)
Lr1 <- matrix(c(0.4324, 0,      0,     0.15,
               0.3784, 0.8459, 0,     0,
               0,      0.0034, 0.7954,0.2300,
               0,      0.0890, 0.1841,0.7510), byrow=TRUE,ncol=4)

#Capturar las categorias de estado
estadios <- c("PL", "J", "NR", "AR")
colnames(Lr1) <- rownames(Lr1) <- estadios

#Obtener la matriz L. rubripetala 
Lr1 <- matrix(Lr1[1:4, ], nrow = 4, dimnames = list(estadios, estadios))
Lr1

```

*Paso 2: Comprobar que se cumplan los supuestos de la matriz de estudio*. 

Previo al análisis de dinámica transitoria se debe comprobar que la matriz de transición poblacional sea: a) *Cuadrada*, que tiene igual número de filas que de columnas, b) *No negativa*, que todos sus elementos son positivos, por lo que son iguales o mayores a 0.000; c) *Ergódica*, que el crecimiento asintótico es independiente de la estructura poblacional al inicio del estudio; d) *Irreducible*, que los elementos de la matriz de análisis y, por lo tanto, los nodos de la gráfica del ciclo de vida, estén fuertemente conectados, tengan una ruta y desde cualquiera de las etapas pueda llegar a todas las otras formando un ciclo; e) *Primitiva*, que el resultado de elevar a altas potencias una matriz irreducible positiva (i.e. sin elementos negativos) único y tenga un sólo valor positivo (i.e. tasa de crecimiento poblacional). Para más información sobre estas condiciones revisar: [@stott2010reducibility].

Para evaluar si la matriz es cuadrada, no negativa, ergódica, primitiva e irreducible se usan las siguientes funciones de *R*: *dim*, *isErgodic*, *isPrimitive* y *isIrreducible* respectivamente. A través del comando *positiv* se determinó si todos los elementos de la matriz son positivos, por lo tanto, iguales o mayores a 0.000. A continuación se comprueba si la matriz de *L. rubripetala* cumple con estas condiciones o supuestos. 


## PASO 2: CONDICIONES QUE DEBE CUMPLIR LA MATRIZ DE ESTUDIO# 

```{r Indice3}


# a) Dimensión de la matriz (filas x columnas): los valores deben ser iguales
dimension <- dim(Lr1)

# b) No negativa 
positiv <- all(Lr1 >= 0)

# c) Ergódica
ergodica <- isErgodic(Lr1, digits=5, return.eigvec=FALSE)

# d) Irreducible
irreducible <- isIrreducible(Lr1)

# e) Primitiva
primitiva <- isPrimitive(Lr1)


```

<br>

***

*Paso 2a. Comprobación de los supuestos para las matrices de estudio*. En el siguiente cuadro se presentan los resultados que comprueban que la matriz de *L. rubripetala* cumple con los supuestos establecidos para el análisis. Se comprueba que la matriz es cuadrada al tener 4 renglones y 4 columnas; asimismo, cumple con ser no negativa, ergódica, irreducible y primitiva al ser "TRUE" el resultado en los cuatro casos.

```{r Indice4, echo=FALSE}
# a) Dimensión de la matriz (filas x columnas): los valores deben ser iguales
dimension
# b) No negativa. 
positiv 
# c) Ergodicidad
ergodica
# d) Irreducible
irreducible
# e) Primitiva
primitiva
```

<br>

***

*Paso 3: Análisis demográfico básico*.

En el análisis de dinámica transitoria necesitamos conocer cómo se comporta una población en el largo plazo, por lo que se proyecta el crecimiento poblacional de tipo asintótico para la matriz de la población seleccionada. Entonces, a partir de la matriz de proyección poblacional y el correspondiente vector de la estructura poblacional observada al inicio del estudio de *L. rubripetala*, calcularemos la tasa de crecimiento poblacional (i.e.*lambda*, de ahora en adelante *lambda-max*), la estructura poblacional estable (*w*, de ahora en adelante *w-max*) y el valor reproductivo (*v*), así como las matrices de sensibilidad y elasticidad. Con este fin, usaremos el procedimiento de la *Sección X*, desarrollado en el programa *popbio* de *R*.

***

### Analisis de convergencia y "Damping Ratio"

Además de esta información se estimarán dos nuevos indices: el tiempo de convergencia (*convergence-time*) y el índice de amortiguamiento (*damping-ratio*). El primero indica el tiempo esperado en que una población alcanza la estructura estable de una población con un crecimiento asimtótico, mientras que el segundo es una medida de que tan rápido (ciclos en tiempo de la matriz; meses, años) para que converge una población a la estructura estable (Caswell, 2001). Ese ultimo se calula dividiendo el valor propio dominante (el *eigenvalue*) con el segundo valor dominante (la parte real), por consecuencia es una medida de cuan rápido la población regresa a su estructura poblacional estable despues de un disturbio, más grande el indice de *damping ratio* más rapido converge a la estructura estable (@stott2011framework). Nota que el *damping ratio* es un indice sin unidades y es independiente de la estructura original de la población (el vector de tamaño de muestra de cada etapa). 
  

Los siguientes indices son una medida basado en el tiempo de las transiciones si bien, la mayoría de los datos de los estudios poblacionales han sido colectados para un periodo de tiempo anual (Crone et al. 2011), es importante recordar que algunos han sido colectados  mensual, bimensulamente, por estación o de forma bianual, dependiendo del ciclo de vida de la especie de estudio. En el caso de *L. rubripetala* los datos fueron colectados mensualmente, debido a la producción constante de estructuras reproductivas a lo largo del año [@tremblay2015stable].


 -- PASO 3: ANÁLISIS DEMOGRÁFICO BÁSICO: PROYECCIÓN DE LA POBLACIÓN -- 
 
## Análisis asintótico (i.e. largo plazo) del crecimiento poblacional de L. rubripetala.


```{r Indice5}

# PARÁMETROS POBLACIONALES
# Tasa de crecimiento poblacional 
lambda <- lambda(Lr1)

# Estructura estable de estados
Wmax <- stable.stage(Lr1)

# Valor reproductivo
v <- reproductive.value(Lr1) # Este no se habla en el texto

# Matriz de elasticidad
elasticidad <- round(elas(Lr1), digit = 3)

# Relación de amortiguamiento
dampingratio <- dr(Lr1, return.time = TRUE, x = 10)

# Tiempo de convergencia
n0 <- c(0, 46, 38, 82) # la esturctura de la población inicial
tconvergencia <- convt(Lr1, accuracy = 1e-3, vector = n0)
```

***


#### Ergodicidad



#### Irreducible


#### Matriz Primitiva


***

## Estructura estable

La estructura estable de edades/etapas es un indice de la distribución proporcional de la poblacional que se espera que esta población alcance en el largo plazo. En el caso de *Lepanthes rubripetala* se espera que la población alcance una estructura estable de 0.088, 0.206, 0.369 y 0.337 para las categorías de plántulas, juveniles, adultos no reproductivos y adultos reproductivos, respectivamente. Esta estructura asume que el crecimiento poblacional *lambda* $\lambda$ sigue igual y constante en el tiempo. Para una especie alcancar una estructura estable, el ambiente debería ser constante y sin cambios, lo cual es raramente el caso en la naturaleza. Esto asume que el periodo de muestreo y las condiciones abiotica y bioticas son tipica y constante. En un analisis de revisión de literatura Williams et al (@williams2011distance) encontraron que más del 80% de las poblaciones no cumplia con la condición de estructura estable. En adición observarón que mayor desviación se obervaba en poblaciones con tiempo de generación largas y matriz grandes (n x n). 

```{r Indice6}
#Estructura estable de estados
Wmax <- stable.stage(Lr1)
Wmax
```

Uno puede visualizar la estructura la estructura de la población usando el codigo siguiente.

```{r Indice7}
Wdf=data.frame(Wmax)
Wdf$Categorias=c("Plántulas","Juveniles","Adultos no reproductivos","Adultos reproductivos")
Wdf$Categorias=factor(Wdf$Categorias, levels=c("Plántulas","Juveniles","Adultos no reproductivos","Adultos reproductivos"))
library(ggplot2)

ggplot(Wdf, aes(y=Wmax, x=Categorias)) + 
  geom_bar(stat="identity", fill="blue") +
  labs(title="Estructura estable de estados esperada", x="Etapas", y="Proporción") +
  theme_minimal()

```




### Damping Ratio

## Análisis de Amortiguamiento/Damping Ratio

El análisis de amortiguamiento es un indice de la rapidez con la que una población converge a su estructura estable después de un disturbio [@jiang2020life]. El indice de amortiguamiento $d > 0$, y más grande el indice de amortiguamiento más rápido la población converge a la estructura estable. Se ha demostrado que hay una relación entre el indice de amortiguamiento y tiempo de generación de una especie [@jiang2020life].  El tiempo de amortiguamiento se calcula $\tau=1/d$. Usando la función *dr* del paquete **popbio**, en el caso de *Lepanthes rubripetala* se espera estima que el indice de amortigamiento es 1.2 y que la población converga a su estructura estable en 12 meses, ya que los datos fueron recolectado y analizado mensualmente. Si los datos hubiese sido recolectado una vez al año entonces la población converga a su estructura estable en 12 años. Un supuesto importante es que la tasa de crecimiento intrínseca es igual para todos los periodos subsiguientes.  

```{r Indice8}

#Relación de amortiguamiento
dampingratio <- dr(Lr1, return.time=TRUE)
dampingratio
```

***

## Análisis de Convergencia

El tiempo de convergencia puede ser calculado a base de la cantidad de individuos en las diferentes etapas o edades. El tiempo de convergencia es el tiempo esperado en que una población alcanza la estructura estable. En el caso de *Lepanthes rubripetala* se espera que la población alcance la estructura estable en 25 meses si se comienza con una población sesgada de solamente plántulas (n=1000) y ninguno en las etapas subsiguientes. 



```{r Indice9}
# Tiempo de convergencia
n = c(1000, 0, 0, 0)
tconvergencia <- convt(Lr1, accuracy = 1e-3, vector = n)
tconvergencia

```

Si comenzamos con una población mucho más cerca a la estructura estable, podemos calcular el tiempo de convergencia. Digamos que se comienza con una población de 8, 20, 27 34 individuos en las etapas plantulas, juveniles, adultos no reproductivos y adultos reproductivos, respectivamente. En este caso se espera que la población alcance la estructura estable en 6 meses. En este caso vemos que el tiempo de convergencia es mucho más corto que si se comienza con una población sesgada de solamente plántulas.  Es acercamiento puede ser util cuando se hace trabajo de conservación, por ejemplo se establece una nueva población con x cantidades de individuos en cada etapa.


```{r Indice10}

n2 = c(8, 20, 27, 34)
tconvergencia <- convt(Lr1, accuracy = 1e-3, vector = n2)
tconvergencia
```

***




## Valores reproductivos

El valor reproductivo *v* es un indice de la contribución de cada categoría de edad/estado a la tasa de crecimiento poblacional. En el caso de *Lepanthes rubripetala* se espera que la categoría de adultos reproductivos contribuya más a la tasa de crecimiento poblacional, seguido por la categoría de adultos no reproductivos, juveniles y plántulas. Los valores en la lista de *v* se compara con la primera edad/estado y siempre la primera etapa/estado tiene un valor de 1.000. Por consecuencia un individuo de la 4ta etapa (adulto reproductivo) tiene un potencial de dejar 2.7 individuos al comparar que una plantula tiene solamente tiene un valor de 1.0. La diferencia es que los individuos pequeños tienen que sobrevivir y llegar a las etapas mayores para contribuir a la tasa de crecimiento poblacional.

```{r Indice11}

valor_repro=reproductive.value(Lr1)
valor_repro
```



<!--chapter:end:10-Indices.Rmd-->


# Elasticidad

Autores: "Demetria Mondragón, Ernesto Mujica y Elaine González"


## Librerías de R requeridas para el siguiente modulo

```{r Elas1, message=FALSE, warning=FALSE, comment=FALSE}
library(popdemo)
library(popbio)
library(ggplot2)
library(dplyr)
library(scales)
library(gt)
library(janitor)
library(tidyr) 
```

## Qué es la Elasticidad

Las matrices de elasticidad son un complemento de las matrices de transición, que nos permiten evaluar el efecto de “pequeños cambios” en los parámetros de la matriz de transición sobre la tasa de crecimiento de la población ($\lambda$); así, las entradas de la matriz de elasticidad que presenten los valores más altos, serán aquellas que más impacto tendrán sobre el comportamiento de lambda ($\lambda$) [@caswell2001matrix; @de1986elasticity].  Esos cambios pueden tener un efecto positivo o negativo sobre el crecimiento poblacional [@caswell2001matrix]. El uso de las elasticidades en ecología de plantas se remonta a 1974 cuando Sarukan y Gadgil trataron de evaluar la importancia relativa de la reproducción sexual vsv la reproducción vegetativa de tres especies de *Ranunculus* [@sarukhan1974studies; @de1986elasticity]. 

El concepto de elasticidad en biología es un método orientado a evaluar el cambio proporcional en una variable en respuesta a un cambio proporcional en otra variable. En términos de matrices de transición, la elasticidad es una medida de la sensibilidad de la tasa de crecimiento poblacional a cambios. En otra palabra si uno cambia uno de los parámetros de la matriz de transición, la elasticidad mide cuánto cambiaría la tasa de crecimiento poblacional [@de1986elasticity]. En biología, la elasticidad es una herramienta para entender la importancia *del cambio* de cada etapa de la historia de vida sobre la tasa de crecimiento poblacional ya que permite identificar las etapas que más contribuyen a la tasa de crecimiento poblacional. Esa herramienta es muy útil para la conservación de especies y para la gestión de recursos naturales por que en parte nos indica cuan sensitiva esta el crecimiento poblacional cuando se cambia los parámetros de la historia de vida (las transiciones, supervivencia y fecundidad) de una especie. 


La elasticidad en la Biología de la Conservación no solo se basa en la observación de su matriz, que con sus valores podemos interpretar la vulnerabilidad de la población a las transiciones. La elasticidad predice el efecto futuro de las probabilidades medias de hechos pasados, respondiendo a la pregunta: ¿cuál de los cambios en las tasas vitales, tomados de uno en uno y manteniendo constante los demás, produciría el mayor efecto en la tasa de crecimiento de la población? En otras palabras, la elasticidad nos dará los efectos de pequeños cambios en las tasas vitales. Las tasas vitales con una baja elasticidad suelen tener una alta variabilidad, mientras que las de elevada suelen variar poco. La variabilidad de los parámetros vitales suele estar negativamente correlacionada con su elasticidad media [ehrlen1998direct]. Por ello no solamente se debe tener en cuenta cuan sensible es lambda ($\lambda$) a una transición, sino también, cuanta variación en esa transición puede ocurrir, o de hecho ocurre, y cómo covaría con otras transiciones [ehrlen1998direct].

En términos matemáticos la elasticidad es el cambio proporcional de $\lambda$ con cambios proporcionales en los parámetros de la matriz.  En otras palabras, por cada unidad de cambio en un parámetro se reflejará en un cambio en $\lambda$ [@de1986elasticity].  La elasticidad $e_{ij}$ de $\lambda$ con respecto $a_{ij}$ (es el elemento i, j de la matriz) es definida como:

$$e_{ij}=\frac{a_{ij}}{\lambda}\frac{\alpha}{\alpha_{ij}}$$

$$=\frac{\alpha log \lambda}{\alpha log a_{ij}}$$
 
La elasticidad $e_{ij}$ es solamente la pendiente del log de $\lambda$ gráficado contra log $e_{ij}$. Debido a que los incrementos sobre una escala logarítmica corresponden a cambios similares proporcionales en una escala aritmética, por consecuencia la elasticidad mide la sensibilidad proporcional. Las elasticidades pueden ser calculadas y mostradas de manera conveniente como una matriz de elasticidad.

 

$$E=\frac{a_{ij}}{\lambda}\frac{\alpha}{\alpha_{ij}}$$
$$=\frac{1}{\lambda}{S}\circ A$$
Donde **S** es la matriz de sensibilidad y $\circ$  el producto de Hadamard [@caswell2001matrix]. 

Las matrices de elasticidad tienen la ventaja de que la suma de las entradas suman a uno, por lo que permite sumar diferentes entradas de la matriz, para evaluar la importancia de procesos (crecimiento, decrecimiento, permanencia o reproducción) o estadios sobre la $\lambda$ [@silvertown1996interpretation], por lo que ha sido una herramienta ampliamente utilizada para el desarrollo de planes de manejo y conservación de especies ya que permite identificar a que estadios o procesos se deben enfocar los esfuerzos de conservación [@mondragon2009population; tremblay1997lepanthes; @berry2021population; timsina2021six] o en caso opuesto para determinar que estadios pueden ser utilizados sin impactar fuertemente a la población [@mondragon2009population].  En el último concepto si tuviésemos que remover individuos de la población, cuál de los estados tuviese el menos impacto sobre la supervivencia de la población si fuesen removido.   


### Sensibilidad y Elasticidad


La diferencia entre sensibilidad y elasticidad es que la sensibilidad mide el impacto en λ de cambiar la magnitud absoluta de una tasa vital particular en relación con el cambio de otras tasas vitales [@caswell1989analysis], lo que implica que los cambios en las tasas de crecimiento, permanencia tendrán un valor de uno (ya que se estas tasas son proporciones), en tanto que los cambios en fecundidad podrán ser desde uno hasta cientos o miles, ya que se la fecundidad se calcula con en base a otra escala (tal como número de semillas o plántulas). La elasticidad por su parte, calcula la sensibilidad proporcional de λ a los cambios en una tasa vital [@de1986elasticity] evitando de esta forma el efecto de la magnitud del cambio. Cuanto mayor sea el valor de la elasticidad de la tasa vital, mayor será la contribución relativa de esa tasa vital a $\lambda$.





### El impacto de cambio en las etapas


Tomando como ejemplo la matriz de elasticidad de *Erycina crista-galli* una orquídea de ramilla [@mondragon2007life], podremos recapitular todo lo previamente dicho (Tabla 1), así, lo **primero** que hay que recalcar es que el valor más alto de elasticidad para esta orquídea corresponde a la permanencia de los individuos adultos 2, es decir que cualquier pequeño cambio en el valor de dicha entrada (en la matriz de transición), tendrá el mayor impacto en el valor de *\lambda* al comparar con otras estados de vida; **segundo**, es importante observar que al sumar todas las entradas de la matriz se obtiene un valor de uno. Lo mismo se mantiene cuando se suman todos los valores de elasticidad por estadio o por proceso. Es decir, si sumamos todos los valores de cada columna, tendremos el valor de elasticidad de cada estadio, para este caso el valor más alto lo ostenta el estadio de adultos 2 (0.818), lo que implica que el destino de la población de *E. crista-galli* depende mayormente de lo que les pase a los individuos adultos.


```{r Elas2, message=FALSE, warning=FALSE}

etapas <- c ("plántula", "juvenil", "adulto1", "adulto2")


ec <- matrix (c(0, 0, 0.004, 0.062,
                0.195, 0, 0, 0, 
                0.171, 0.120, 0.053, 0.04,
                0.073, 0.10, 0.435, 0.447), 
              nrow = 4, ncol=4, byrow = TRUE, dimnames = list(etapas, etapas))

ec

```



```{r Elas3}
elas(ec)

# Convertir la matriz de elasticidad en un data frame
ec_df=as.data.frame(elas(ec)) |> round(3)

# Sumar las elasticidades por etapas y añadir una fila con las sumas
ec_df=ec_df %>% bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "Total"))




ec_df %>% 
  gt() %>% 
  data_color(
    columns = c(adulto2),
    colors =  c("blue"),
      domain = NULL
    ) %>% 
  tab_style(
    style = cell_fill(color = 'black'),
    locations = cells_body(
      columns = c(adulto2), 
      rows = 5
    ))
  
  
```



### Efecto de cambio en las tansiciones, de crecimiento, permanencia y fecundidad 

En la tabla se ve los diferentes valores de elasticidad por procesos en *Erycina crista-galli* [@mondragon2007life] y el impacto por diferentes procesos de la historia de vida de la población. Ahora, si lo que quisiéramos saber es que proceso o tasa vital es lo que rige el comportamiento de la población, lo que se hace es sumar las entradas de la matriz que lo representan, en este caso hemos puesto en diferentes colores las estradas que manifiestan cada tasa, en rojo es la permanencia, en azul el crecimiento, en amarillo el decrecimiento o retrogresión y en verde la fecundidad.  Eso nos permite determinar que es el impacto de elasticidad por procesos y tasas vitales, sumando cada uno de los valores en cada categoría. Es claro que el impacto principal de la población de *E. crista-galli* depende de la permanencia de los individuos, seguido por el crecimiento, en tanto que la fecundidad y la retrogresión tienen un impacto menor.
 
 La suma de cada grupo: 
 
 - Permanencia: 0.713
 - Crecimiento: 0.170
 - Retrogresión: 0.060
 - Fecundidad: 0.058
 

```{r Elas4}

elas(ec)

# Convertir la matriz de elasticidad en un data frame
ec_df=as.data.frame(elas(ec)) |> round(3)

# Sumar las elasticidades por procesos (crecimiento, permanencia y fecundidad)
ec_df



ec_df %>% 
  gt() %>% 
  tab_style(
    style = cell_fill(color = 'lightgreen'),
    locations = cells_body(
      columns = c(4), 
      rows = c(1)
    )) %>% 
      tab_style(
    style = cell_fill(color = 'lightblue'),
    locations = cells_body(
      columns = c(1), 
      rows = c(2)
    )) %>% 
      tab_style(
    style = cell_fill(color = 'lightblue'),
    locations = cells_body(
      columns = c(1), 
      rows = c(3)
    ))%>% 
      tab_style(
    style = cell_fill(color = 'lightblue'),
    locations = cells_body(
      columns = c(1), 
      rows = c(4)
    ))%>% 
      tab_style(
    style = cell_fill(color = 'lightblue'),
    locations = cells_body(
      columns = c(2), 
      rows = c(3)
    ))%>% 
      tab_style(
    style = cell_fill(color = 'lightblue'),
    locations = cells_body(
      columns = c(2), 
      rows = c(4)
    )) %>% 
      tab_style(
    style = cell_fill(color = 'yellow'),
    locations = cells_body(
      columns = c(3), 
      rows = c(1)
    )) %>% 
      tab_style(
    style = cell_fill(color = 'lightblue'),
    locations = cells_body(
      columns = c(3), 
      rows = c(4)
    )) %>% 
      tab_style(
    style = cell_fill(color = 'yellow'),
    locations = cells_body(
      columns = c(4), 
      rows = c(3)
    )) %>% 

      tab_style(
    style = cell_fill(color = 'red'),
    locations = cells_body(
      columns = c(3), 
      rows = c(3)
    ))%>% 
      tab_style(
    style = cell_fill(color = 'red'),
    locations = cells_body(
      columns = c(4), 
      rows = c(4)
    ))



```



### Como se usa los análisis de elasticidad en un plan de conservación

Por lo que, de manera simplista, pudiéramos decir que, si quisiéramos desarrollar un plan de conservación para esta especie, nuestros esfuerzos debieran enfocarse a asegurar la supervivencia de los individuos adultos, ya que remover o la mortandad de los individuos adultos tiene el mayor impacto sobre la persistencia de la población.  En tanto que si quisiéramos hacer un uso sustentable de esta orquídea lo recomendable sería recolectar individuos juveniles, cuyos valores de elasticidad son menores a la de los estadios adultos.  El impacto de remover plántulas o juveniles de la población tendría menos impacto a largo plazo sobre la supervivencia de la población.  

### Comparación entre especies

Las elasticidades también han sido utilizadas para establecer el comportamiento demográfico de las especies, lo que ha permitido generar patrones entre formas de vida, así como comparaciones tanto entre formas de vida como entre especies [@mondragon2015population; @silvertown1996interpretation].  Así, por ejemplo, si quisiéramos comparar el comportamiento demográfico de las orquídeas de ramillas vs las orquídeas epífitas convencionales (reconstruido de [@mondragon2007life]), veríamos que para ambos tipos de orquídeas en general lo más importante es la permanencia (supervivencia) de los individuos, en tanto que se puede observar que una diferencia entre la orquídea de ramilla y las otras en la contribución de los estadios al comportamiento de *\lambda*, ya que para la primera los individuos reproductivos presentan mayores valores de elasticidad (al igual que para *Lepanthes* eltoroensis), en tanto que para las otras orquídea los valores más altos los tienen los individuos no reproductivos [@mondragon2007life].


En la Figura 1a y b se observa los valores de elasticidad añadidos por proceso de historia de vida para 

 - *Artorima erubescens* [@garcia2003demografia] -rojo-, 
 - *Erycina crista-galli* [@mondragon2007life] -verde-marón-, 
 - *Laelia speciosa* [@hernandez1992dinamica] -verde- 
 - *Lepanthes caritensis* [@tremblay1997lepanthes] -azul- 
 - *Lepanthes eltoroensis* [2tremblay2003population] -violeta-. 

en la figura 1a, la suma por la historia de vida, F: fecundidad, P: permenancia y C: crecimiento y en la figura 1b los valores de elasticidad sumados por estadios (b), P: plántulas, NR; individuos no reproductivos, R: individuos reproductivos o adultos.


Se observa que en los valores de elasticidad estan más altos en los procesos de permanencia seguido por el crecimiento. En la figura 1b se observa que los valores de elasticidad son más altos en los estadios de no reproductivo y reproductivos (adultos activos) al comparar que individuos en la etapa de plántulas. 


```{r Elas5}

Elasticidad_estadios =tribble(~Especie, ~Fecundidad, ~Estasis, ~Crecimiento, ~Plántulas, ~No_reproductivos, ~Reproductivos,
                              "Erycina crista-galli",  0.035, 0.718, 0.247, 0.0345, 0.0456, 0.9197,
                              "Artorima erubescens",   0.000, 0.646, 0.354, 0.0023, 0.7207, 0.277,
                              "Laelia speciosa",       0.116, 0.651, 0.328, 0.120, 0.669, 0.216,
                              "Lepanthes eltoroensis", 0.005, 0.880, 0.115, 0.1133, 0.0784, 0.8083,
                              "Lepanthes caritensis",  0.002, 0.885, 0.114, 0.018, 0.648, 0.335)
```

```{r Elas6}
Elasticidad_estadios
```


```{r}
EE=Elasticidad_estadios %>% 
  select(Especie, Fecundidad, Estasis, Crecimiento) %>%
  pivot_longer(cols = -Especie, names_to = "Estadios", values_to = "Elasticidad")

EE$Estadios=factor(EE$Estadios, levels = c("Fecundidad", "Estasis", "Crecimiento"))



  ggplot(EE, aes(x = Estadios, y = Elasticidad, fill = Especie)) +
  geom_bar(stat = "identity", position = "dodge", color="white") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Elasticidad por proceso demográfico",
       x = "Estadios",
       y = "Elasticidad")+
  scale_fill_discrete(guide =
      guide_legend(label.theme = element_text(angle = 0, face = "italic")))



```


```{r Elas7}


EE1=Elasticidad_estadios %>% 
  select(Especie, Plántulas, No_reproductivos, Reproductivos) %>%
  pivot_longer(cols = -Especie, names_to = "Estadios", values_to = "Elasticidad")

EE1$Estadios=factor(EE1$Estadios, levels = c("Plántulas", "No_reproductivos", "Reproductivos"))

 
  ggplot(EE, aes(x = Estadios, y = Elasticidad, fill = Especie)) +
  geom_bar(stat = "identity", position = "dodge", color="white") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Elasticidad por proceso demográfico",
       x = "Etapas",
       y = "Elasticidad")+
  scale_fill_discrete(guide =
      guide_legend(label.theme = element_text(angle = 0, face = "italic")))

```



## Limitaciones

Aunque las matrices son una herramienta muy útil para determinar el comportamiento demográfico de una especie o un conjunto de estas, es necesario estar conscientes que las diferentes entradas de dicha matriz son el resultado, en la mayoría de los casos, de la conjunción de varias tasas vitales a la vez [@franco2004comparative] ademas que dependen fuertemente de la calidad de los datos (vea capitulo xx ) .  Así mismo, es importante considerar que ciertas entradas son la combinación de varios procesos demográficos, es decir por ejemplo la entrada que representa la transición de plántula a juvenil, implica que el individuo debe sobrevivir y además crecer lo suficiente para pasar al siguiente estadio, o en el caso de la fecundidad que el individuo debe sobrevivir y además, por lo que se recomiendo separar los valores de cada proceso de cada entrada y calcular las elasticidades de las tasas vitales per se. Por consecuencia el acercamiento más reciente de “transient function” desarollado por Stott et al. [@stott2012beyond] pudiese ser un acercamiento más adecuado si los cambios en sean grandes.  

Una de las limitaciones principales de los análisis de elasticidad tradicional mencionado arriba es que el modelo de respuestas es lineal. En otra palabra se asume que los cambios en las tasas vitales son proporcionales a los cambios en la tasa de crecimiento poblacional y que irrelevante del tamaño del cambio el cambio seguirá una respuesta lineal. En la realidad, los cambios en las tasas vitales no son proporcionales y lineal a los cambios en la tasa de crecimiento poblacional. Por ejemplo, si uno aumenta mucho la supervivencia de los individuos de una etapa, la tasa de crecimiento poblacional no aumentará de manera proporcional. Por consecuencia, la elasticidad es una aproximación y no una descripción exacta de la relación entre los cambios en las tasas vitales y la tasa de crecimiento poblacional y es aplicable a solamente analisis de perturbaciones pequeñas. Vea el capitulo x para metodos más avanzados de análisis de elasticidad. 






***

# Introducir los nombres de los estadíos o categorías de tamaño, según sea su caso

# Capturar los datos de la matriz para Erycina crita-galli [@mondragon2007life] (tabla 4 del artículo)

```{r Elas8, message=FALSE, warning=FALSE}

etapas <- c ("plántula", "juvenil", "adulto1", "adulto2")


ec <- matrix (c(0, 0, 0.004, 0.062,
                0.195, 0, 0, 0, 
                0.171, 0.120, 0.053, 0.04,
                0.073, 0.10, 0.435, 0.447), 
              nrow = 4, ncol=4, byrow = TRUE, dimnames = list(etapas, etapas))

ec


# Introducir los valores iniciales por estadío (vector N)

N0_ec<- matrix (c(41,50,246,226), ncol = 1)

N0_ec
```

## Para calcular los autovalores y autovectores de la matriz


```{r Elas9}
eigen.analysis(ec, zero=FALSE) # la función es del paquete popbio
```









<!--chapter:end:11-Elasticidad.Rmd-->

# Dinámica transitoria (Transient dynamics)

Autores: "Mariana Hernández Apolinar y Paola Portillo Tzompa"

## Dinámica poblacional de largo y corto plazo

Los modelos de proyección poblacional (MPP), previamente vistos en la *Sección XX*, son los más utilizados para proyectar la razón de crecimiento de una población después de varios años (i.e. largo plazo) asumiendo que la razón de muertes, la reproducción y el crecimiento de los individuos en las distintas categorías de la población (i.e. tasas vitales) no varían en el tiempo debido a la presencia de condiciones ambientales constantes (Caswell, 2001; Crone et al. 2011; Koons et al. 2021). Al mantenerse constantes estas variables en el largo plazo (i.e. deterministas), la población incrementará o decrecerá a una velocidad constante y no cambiará la proporción de individuos por categoría de tamaño/estado (i.e. comportamiento asintótico), [@bierzychudek1999looking; Caswell, 2001). Sin embargo, en la naturaleza estas variables distan de ser constantes (i.e. deterministas), debido a que las poblaciones experimentan recursos limitados (v.g. alimento, sitios de refugio), ambientes heterogéneos y cambiantes que perturban las poblaciones (v.g. deforestación, sequía, huracanes, enfermedades, etc), afectando su dinámica y sugiriendo que la tasa de crecimiento de largo plazo no es un buen predictor de los cambios que enfrentan dichas las poblaciones (@bierzychudek1999looking). De ahí que, se hayan desarrollado modelos que integran dicha variación y que permiten hacer proyecciones más realistas sobre la dinámica poblacional de la especie de estudio, tal es el caso de los modelos de crecimiento estocástico y los análisis de dinámica transitoria.



En particular, los modelos de dinámica transitoria surgen como una alternativa para analizar la dinámica de una población en el corto plazo, cuando se presenta un evento de perturbación repentino que afecta la abundancia de individuos en una o varias de las categorías de poblacional (i.e.cambios en el modelo) o que la estructura de la población varia en tiempo. El analisis no asume cambios en las entradas de la matriz de transición (i.e. condiciones constantes; Vindeness et al. 2021). De esta forma, en este análisis se evalúa la respuesta inmediata de la población; es decir, antes de alcanzar la estructura estable de estadios/edades y de crecer a una tasa constante (Bierzichudek, 1999; Koons et al. 2021, Stott et al. 2010). Esta respuesta de corto plazo es pasajera o temporal y resulta de suponer que la estructura inicial de la población es inestable; de ahí, el nombre de "dinámica transitoria". Bajo este supuesto, es importante saber qué tanto influye dicha estructura inicial inestable en la dinámica poblacional temporal de corto plazo (Koon et al. 2021). Esta respuesta se determina a través de las discrepancias o diferencias que hay entre la estructura inicial (i.e. corto plazo) y la estructura estable (i.e. largo plazo) de la población analizada [@raventos2015transient].

A partir de lo anterior, es evidente que los dos acercamiento para evaluar la dinamica poblacional usando el método tradicional o de  de dinámica transitoria abordan distintos aspectos de la dinámica poblacional de una especie y, por lo tanto, hacen uso de ecuaciones distintas en su análisis (Koons et al. 2021). A continuación se listan la serie de pasos a seguir para facilitar y asimilar el desarrollo del complejo análisis de la dinámica transitoria. Este análisis fue planteado por Stott y colaboradores [@stott2011framework; @stott2012beyond; @stott2012popdemo] y se lleva a cabo en el Programa de estadística *R*.

<br>
***

*Paso 1. Matriz de transición y estructura poblacional inicial*.

En primer lugar se debe contar con una matriz de proyección poblacional y su correspondiente vector de la estructura poblacional observada al inicio del estudio. A lo largo del desarrollo del análisis en el presente Capítulo se usarán los datos obtenidos por Tremblay et al. [@tremblay2015stable] y Schödelbauerová et al. [@schodelbauerova2010prediction] para la orquídea epífita *Lepanthes rubripetala*; en específico usaremos los datos de la población 1. En esta especie, los individuos se clasificaron en cuatro categorías de estado: plántula (PL), juvenil (J), adulto no reproductivo (NR) y adulto reproductivo (AR). Esta última catergoría florece a largo de todo el año, por lo que el seguimiento de la población fue mensual [@tremblay2015stable; @schodelbauerova2010prediction]. 

En primer lugar se debe contar con una matriz de proyección poblacional y su vector correspondiente de la estructura poblacional observada al inicio del estudio. En en este caso se usarán los datos obtenidos para *Lepanthes rubripetala* por Tremblay y colaboradores [@tremblay2015stable; @schodelbauerova2010prediction].

A continuación incorporamos la información de nuestra matriz y la abundancia de individuos por categoría observada al inicio de nuestro estudio. Las función *matrix* de *R* fue usada para construir la matriz y *n0* se fue usado para nombrar el vector de la estructura inicial obsevada. Cabe señalar que se, a lo largo del análisis de dinámica transitoria se usan cinco paquetes de *R* (*popdemo*, *popbio*, *ggplot2*, *dplyr*, *scales*), por lo que se cargan desde un principio. 

***

## PROYECTO DE DINAMICA TRANSITORIA O DE CORTO PLAZO

### PART I: DINÁMICA POBLACIONAL DE LARGO PLAZO

Éste es un análisis de dinámica transitoria para *Lepanthes rubripetala* (Población 1),  cuyo ciclo de vida fue dividido en cuatro clases de estado:

  -   PL = plántula,
  -   J = juvenil,
  -   NR = adultos no reproductivos,
  -   AR = adultos reproductivos.

<br>



***

## Librerías de R requeridas para el análisis

```{r trans0, message=FALSE}
library(popdemo)
library(popbio)
library(ggplot2)
library(dplyr)
library(scales)
```

***

### PASO 1. MATRIZ DE PROYECCIÓN POBLACIONAL y ESTRUCTURA POBLACIONAL INICIAL $t_{0}$

```{r trans1, message=FALSE}

#Capturar los datos de la matriz para L. rubripetala (Tremblay et al. 2015)
Lr1 <- matrix(c(0.4324, 0,      0,     0.15,
               0.3784, 0.8459, 0,     0,
               0,      0.0034, 0.7954,0.2300,
               0,      0.0890, 0.1841,0.7510), byrow=TRUE,ncol=4)

#Capturar las categorias de estado
estadios <- c("PL", "J", "NR", "AR")
colnames(Lr1) <- rownames(Lr1) <- estadios

#Obtener la matriz L. rubripetala 
Lr1 <- matrix(Lr1[1:4, ], nrow = 4, dimnames = list(estadios, estadios))
Lr1

```

```{r trans3}
# Capturar y obtener el vector inicial (datos de campo) de clases de estado población 1 (Schödelbauerová et al. 2010)

n0 <- c(0, 46, 38, 82) 
n0

```

<br>
***



#### Capturar y obtener el vector inicial (datos de campo) de clases de estado población 1


*Paso 1a. Matriz de transición y estructura poblacional inicial*. En el siguiente cuadro se comprueba que la matriz de la estructura poblacional inicial de *L. rubripetala* haya sido incorporada sin errores. La primera formada por 4 renglones y 4 columnas y la segunda por 4 elementos, que indican el número de individuos encontrados en el estado de plántula (0), juvenil (46), adulto no reproductivo (38) y adulto reproductivo (82) [@tremblay2015stable; @schodelbauerova2010prediction].






```{r trans4, echo=FALSE}
#Matriz de L. rubripetala
Lr1

#Estructura de estados inicial
n0
```


<br>
***



### Crecimiento asintótico

La definición del crecimiento asintótico de la población *lambda* se basa en la tasa de crecimiento poblacional cuando la población este a su nivel estable de estructura de edades/estados. Por consecuencia se asume que la población llegue o este a un nivel estructura de edades/estados estable. Para la población de *Lepanthes rubripetala* se obtiene una tasa de crecimiento poblacional de 1.007, lo que indica que la población crece a una tasa constante de 1.007 entre $t_{0}$ y $t_{1}$. Entonces si la población tuviese 1000 individuos en promedio hubiese 7 individuos más en $t_{1}$ o sea el siguiente mes. Nota que las poblaciones de *Lepanthes* nunca son tan grandes (@tremblay1997distribution), pero es un ejemplo para ilustrar el concepto. 


```{r trans5_asimptotico}

#Análisis asintótico (i.e. largo plazo) del crecimiento poblacional de L. rubripetala
#La orquídea florece todo el año, por lo que el seguimiento de la población fue mensual. 

#PARÁMETROS POBLACIONALES
##lambda: Tasa de crecimiento poblacional


lambda <-lambda(Lr1)
lambda
```










## Dinámica transitoria

En la dinámica transitoria o de corto plazo, Stott y colaboradores (2010, 2012) incorporaron la estocasticidad demográfica para analizar el cambio de la estructura poblacional debido a una perturbación de origen biótico, abiótico o antropogénico (i.e. cambios en la estructura incicial observada). Este tipo de estocasticidad se refiere a la sobrevivencia y reproducción en número entero y finito; es decir, un individuo sobrevive o no, lo cual se representa con 1 ó 0, al igual que puede reproducirse (1) o no (0). La incorporación de esta característica en los individuos genera una variación no cíclica ni predecible en la respuesta de los individuos de una población.

En el análisis transitorio, el modelo sesgado por etapas (i.e. categorías) es el procedimiento que se usa para evaluar la perturbación de la estructura inicial. La perturbación o sesgo en la estructura inicial se evalúa modificando la proporción de individuos presentes en alguna categoría de la estructura poblacional. Cabe señalar que estas modificaciones representan distintos escenarios o simulaciones que ocurren o pueden ocurrir en nuestra población de estudio.

Por ejemplo, la estructura inicial en la población 1 de *Lepanthes rubripetala* fue la siguiente: (0,46,38,82). En este caso, al modificar la proporción de individuos presente en una, dos o en todas las categorías de la población se simuló el cambio en la dinámica en el corto plazo; es decir, en un momento previo a que se alcance el crecimiento estable o de largo plazo. En *Lepanthes rubripetala* se hicieron cinco simulaciones o escenarios al suponer las siguientes proporciones de individuos por categoría (Tremblay et al, 2015):

1.  Límite inferior: (1,0,0,0), los individuos de la población se contran en la categoría de plántulas (Lower bound).
2.  Inicio I: (0.15, 0.35, 0,30, 0.20), mayor proporción de individuos en las categorías juvenil y adulto no reproductivo.
3.  Estructura estable de la población: los individuos de la población tienen una abundancia de acuerdo con *w-max*.
4.  Inicio II: (0.4, 0.2,0.2, 0.2), mayor proporción de plántulas y una proporción similar en las categorías juvenil, adulto no reproductivo y adulto reproductivo.
5.  Límite superior: (0,0,0,1), los individuos de la población se contran en la categoría de adulto reproductivo.

*Dinámica poblacional absoluta*. Como consecuencia de las perturbaciones o escenarios existen cambios en el crecimiento poblacional, los cuales son evidentes si se grafican. Un aspecto a considerar es que, la gráfica que se genera incluye la influencia de la dinámica trasitoria y asintótica, por lo que se le denomina dinámica poblacional absoluta (Fig. 2A de Tremblay y colaboradores, 2015).

```{r trans6}
##PASO 4. DINÁMICA POBLACIONAL ABSOLUTA.    
#Se proyecta el crecimiento poblacional ante cambios en la estructura 
#inicial debidos a la perturbación (5 escenarios). Esta gráfica incluye la 
#influencia de la dinámica trasitoria y asintótica, por lo que se le denomina 
#dinámica poblacional absoluta. Proyección a 50 meses.

#Definir los margenes
par(mfrow = c(1, 1))
par(mar = c(3, 3, 3, 3))

#Librerias de R requeridas para el análisis 
library(popdemo)
library(popbio)
library(ggplot2)
library(dplyr)
library(scales)

#Vector original
nLr0 <- c(0, 46, 38, 82)
#Escenario 1. Límite inferior
nLr1 <- c(166, 0, 0, 0)
#Proporción de individuos por categoría
nLr1 <- nLr1/sum(nLr1)
nLr1
#Gráfica de barras del escenario 1 
barplot(nLr1, names.arg = 1:4)
title(main = "Escenario 1", xlab = "Categoría", ylab = "Proporción")
#Proyección de la dinámica escenario 1
pr1 <- project(Lr1, vector = nLr1, time = 50)
plot(pr1, log = "y", ylim = c(0.1, 1.6), ann = FALSE)
title(main = "Proyección de la dinámica (Escenario 1)", xlab = "Time intervals", ylab = "Population size/density")


#Escenario 2. Inicio I
nLr2 <- c(25, 58, 50, 33)
#Proporción de individuos por categoría
nLr2 <- nLr2/sum(nLr2)
nLr2
#Gráfica de barras del escenario 1 
barplot(nLr2, names.arg = 1:4)
title( main = "Escenario 2", xlab = "Categoría", ylab = "Proporción")
#Proyección de la dinámica escenario 2 
pr2 <- project(Lr1, vector = nLr2, time = 50)
plot(pr2, log = "y", ylim = c(0.1, 1.6), ann = FALSE)
title(main = "Proyección de la dinámica (Escenario 2)", xlab = "Time intervals", ylab = "Population size/density")

#Escenario 3. Estructura estable
# Estructura estable de estados
Wmax <- stable.stage(Lr1)
nLr3 <- Wmax
#Gráfica de barras del escenario 3
barplot(nLr3, names.arg = 1:4)
title( main = "Escenario 3", xlab = "Categoría", ylab = "Proporción")
#Proyección de la dinámica escenario 3 
Lr1st <- (Lr1/lambda)
Lr1st
eigen(Lr1st)
pr3 <- project(Lr1st, vector = Wmax, time = 50)
plot(pr3, log = "y", ylim = c(0.1, 1.6), ann = FALSE)
title(main = "Proyección de la dinámica (Escenario 3)", xlab = "Time intervals", ylab = "Population size/density")

#Escenario 4. Inicio II
nLr4 <- c(66, 33, 33, 33)
#Proporción de individuos por categoría
nLr4 <- nLr4/sum(nLr4)
nLr4
#Gráfica de barras del escenario 4 
barplot(nLr4, names.arg = 1:4)
title( main = "Escenario 4", xlab = "Categoría", ylab = "Proporción")
#Proyección de la dinámica escenario 4 
pr4 <- project(Lr1, vector = nLr4, time = 50)
plot(pr4, log = "y", ylim = c(0.1, 1.6), ann = FALSE)
title(main = "Proyección de la dinámica (Escenario 4)", xlab = "Time intervals", ylab = "Population size/density")

#Escenario 5. Límite superior
nLr5 <- c(0, 0, 0, 166)
#Proporción de individuos por categoría
nLr5 <- nLr5/sum(nLr5)
nLr5
#Gráfica de barras del escenario 5 
barplot(nLr5, names.arg = 1:4)
title( main = "Escenario 5", xlab = "Categoría", ylab = "Proporción")
#Proyección de la dinámica escenario 5 
pr5 <- project(Lr1, vector = nLr5, time = 50)
plot(pr5, log = "y", ylim = c(0.1, 1.6), ann = FALSE)
title(main = "Proyección de la dinámica (Escenario 5)", xlab = "Time intervals", ylab = "Population size/density")

#Gráfica de la dinámica absoluta 
Population_density <- stack(c(as.data.frame(pr1), as.data.frame(pr2), as.data.frame(pr3), as.data.frame(pr4), as.data.frame(pr5)))
Population_density[, "time"] <- rep(seq(1, nrow(pr1), 1), 5)
names(Population_density) <- c("Values", "Projection", "Time")
#Population_density[, "Projection"] <- c(rep("Projection 1", len), rep("Projection 2", len), rep("Projection 3", len), rep("Projection 4", len), rep("Projection 5", len))
abs.plot <- ggplot(data = Population_density) +
theme_classic() +
theme(panel.border = element_blank()) +
theme(legend.position = "none") +
geom_line(aes(x = Time, y = Values, group = Projection, colour = Projection), linewidth = 0.8) +
geom_hline(yintercept = 1, linewidth = 0.8) +
scale_colour_manual(values = c("#C6E2FF", "#B9D3EE", "black", "#9FB6CD", "#6C7B8B")) +
theme(axis.title.x = element_text(vjust = -1, size = 12)) +
theme(axis.title.y = element_text(vjust = 1, size = 12)) + 
theme(axis.text = element_text(size = 12)) +
labs(title = "Absolut population dynamics", x = "Projection intervals", y = "Population density relative to lambda max")+ 
theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 12))
abs.plot 

```

## Dinámica transitoria estandarizada: límites

Con el fin de evaluar en el corto plazo los cambios cuantitativos en la población en respuesta a una perturbación determinada se calculan los límites de la dinámica transitoria a través Índices de transferencia y se proyecta el crecimiento de la población en el corto plazo.

## Dinámica transitoria específica de la población.

a proyección se hace sin la influencia de la dinámica asintótica. hecho que facilita y hace equitativa la comparación entre los modelos de los distintos escenarios. Se elimina el efecto de la dinámica asintótica al estandarizar la matriz y el vector de la estructura. En el primer caso se usa el comando 'standard.A=T', lo cual supone que en el largo plazo la tasa de crecimiento poblacional tendrá un valor de 1 (unidad) -por lo que la población no crecerá ni declinará, en el segundo caso se usa el comando 'standard.vec=T', que implica que éste suma 1 (Stoot et al., 2010, 2012). DINÁMICA POBLACIONAL TRANSITORIA ESTANDARIZADA

*Índices de transferencia*. Con el fin de evaluar en el corto plazo qué cambios cuantitativos habría en la población como respuesta ante una perturbación determinada, se calculan los límites de la dinámica transitoria a través de los *Índices de transferencia*, que incluyen los siguiente tres parámetros (Stoot et al. 2012):

a)  *Reactividad alta y Reactividad baja* (Upper reactivity y Lower reactivity) que representan el crecimiento o el decremento inmediato (i.e. primer intervalo de tiempo) de la población antes de alcanzar la tasa constante de crecimiento poblacional.

b)  *Máxima amplificación/Máxima atenuación* (Maximum amplification/Maximum attenuation) que indican,respectivamente, el incremento o decremento máximo futuro del crecimiento poblacional previo a alcanzar la tasa constante de crecimiento poblacional.

c)  *Inercia alta e Inercia baja* (Upper inertia y Lower inertia) que evalúan el límite más alto o el más bajo en el crecimiento de la población antes de alcanzar la tasa constante de crecimiento poblacional, respectivamente.

```{r trans7}
### PARTE II: DINÁMICA POBLACIONAL TRANSITORIA ESTANDARIZADA.
#Modelo de Dinámica transitoria específica de la población  
## La dinámica de corto plazo se projecta a partir de la matriz de transición y el vector inicial previamente definidos

#Definir los margenes
library(popdemo)
library(ggplot2)

#Vector de estructura inicial: abundancia por categoría de acuerdo con  el estado 
n0 <- c(0, 46, 38, 82) 

## 1) PROYECCIÓN DE LA DINÁMICA DE CORTO PLAZO. Con la función PROJECT se proyectar la  a 50 meses, tomando en 
#cuenta la matriz de transición poblacional y el vector de la estructura.
#En esta función se elimina el efecto de la dinámica asintótica al estandarizar: 
#a) la matriz usando el comando 'standard.A=T', lo cual significa que 
#en el largo plazo la tasa de crecimiento poblacional tendrá 
#un valor de 1 (unidad), por lo que la población no crecerá ni declinará. 
#b) el vector de la estructura usando 'standard.vec=T', lo cual supone que éste suma 1, 
# Ambas estandarizaciones facilitan y hacen equitativa la comparación entre modelos 
#con distintos tamaños poblacionales y distintas tasas de crecimiento de largo plazo. 

#Gráfica de la dinámica de corto plazo por escenario. En la graficación se usa la misma matriz pero se cambia el vector de acuerdo con el escenario
#Escenario 1: Límite inferior
pr2.1 <- project(Lr1, vector = nLr1, time = 50, 
                 standard.A = T, standard.vec = T)
#Plot the amplification projection and label it
# Se atenua (decrece)
plot(pr2.1, log = "y", main = "Dinámica a corto plazo (Escenario 1)", cex.axis = 0.8)

#Escenario 2. Inicio I
pr2.2 <- project(Lr1, vector = nLr2, time = 50, 
                 standard.A = T, standard.vec = T)
#Plot the amplification projection and label it
plot(pr2.2, log = "y", main = "Dinámica a corto plazo (Escenario 2)", cex.axis = 0.8) # Se atenua (decrece)

#Escenario 3. Estructura estable
pr2.3 <- project(Lr1, vector = nLr3, time = 50, 
                 standard.A = T, standard.vec = T)
#Plot the amplification projection and label it
plot(pr2.3, main = "Dinámica a corto plazo (Escenario 3)", cex.axis = 0.8)# Se amplifica (crece)

#Escenario 4. Inicio II
pr2.4 <- project(Lr1, vector = nLr4, time = 50, 
                 standard.A = T, standard.vec = T)
#Plot the amplification projection and label it
plot(pr2.4, log = "y", main = "Dinámica a corto plazo (Escenario 4)", cex.axis = 0.8)# Se atenua (decrece)

#Escenario 5. Límite superior
pr2.5 <- project(Lr1, vector = nLr5, time = 50, 
                 standard.A = T, standard.vec = T)
#Plot the amplification projection and label it
plot(pr2.5, log = "y", main = "Dinámica a corto plazo (Escenario 5)", cex.axis = 0.8)# Se amplifica (crece)

#2) LIMITES TRANSITORIOS POR ESCENARIO.
#Escenario 1: Límite inferior

#Cálculo de los limites transitorios
library(popdemo)

lim.trans <- as.data.frame(matrix(NA, 5, 3))
names(lim.trans) <- c("reac", "maxatt", "inertia")
reac1<-reac(Lr1, vector = nLr1)
lim.trans[1, 1] <- reac1
reac1
maxatt1<-maxatt(Lr1, vector = nLr1, return.t=T)
maxatt1
lim.trans[1, 2] <- maxatt1[1]
inertia1<-inertia(Lr1, vector = nLr1)
inertia1
lim.trans[1, 3] <- inertia1
#Escenario 2. Inicio I
reac2<-reac(Lr1, vector = nLr2)
reac2
lim.trans[2, 1] <- reac2
maxatt2<-maxatt(Lr1, vector = nLr2, return.t=T)
maxatt2
lim.trans[2, 2] <- maxatt2[1]
inertia2<-inertia(Lr1, vector = nLr2)
inertia2
lim.trans[2, 3] <- inertia2

#Escenario 3. Estructura estable
reac3<-reac(Lr1, vector = nLr3)
lim.trans[3, 1] <- reac1
reac3
maxamp3<-maxamp(Lr1, vector = nLr3, return.t=T)
maxamp3
lim.trans[3, 2] <- maxamp3[1]
inertia3<-inertia(Lr1, vector = nLr3)
inertia3
lim.trans[3, 3] <- inertia3

#Escenario 4. Inicio II
reac4<-reac(Lr1, vector = nLr4)
lim.trans[4, 1] <- reac1
reac4
maxatt4<-maxatt(Lr1, vector = nLr4, return.t=T)
maxatt4
lim.trans[4, 2] <- maxatt4[1]
inertia4<-inertia(Lr1, vector = nLr4)
inertia4
lim.trans[4, 3] <- inertia4

#Escenario 5. Límite superior
reac5<-reac(Lr1, vector = nLr5)
lim.trans[5, 1] <- reac5
reac5
maxamp5<-maxamp(Lr1, vector = nLr5, return.t=T)
maxamp5
lim.trans[5, 2] <- maxamp5[1]
inertia5<-inertia(Lr1, vector = nLr3)
inertia5
lim.trans[5, 3] <- inertia5

# Dinamica transitoria plot
len <- nrow(pr2.1)
Population_density <- stack(c(as.data.frame(pr2.1), as.data.frame(pr2.2), as.data.frame(pr2.3), as.data.frame(pr2.4), as.data.frame(pr2.5)))
Population_density[, "time"] <- rep(seq(1, len, 1), 5)
names(Population_density) <- c("Values", "Projection", "Time")
Population_density[, "Projection"] <- c(rep("Projection 1", len), rep("Projection 2", len), rep("Projection 3", len), rep("Projection 4", len), rep("Projection 5", len))

trans.plot <- ggplot(data = Population_density) +
theme_classic() +
theme(panel.border = element_blank()) +
theme(legend.position = "none") +
geom_line(aes(x = Time, y = Values, group = Projection, colour = Projection), linewidth = 0.8) +
scale_colour_manual(values = c("#C6E2FF", "#B9D3EE", "black", "#9FB6CD", "#6C7B8B")) +
theme(axis.title.x = element_text(vjust = -1, size = 12)) +
theme(axis.title.y = element_text(vjust = 1, size = 12)) + 
theme(axis.text = element_text(size = 15)) +
labs(title = "Transient population dynamics" ,x = "Projection intervals", y = "Population density relative to lambda max") + 
theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 12)) +
ylim(0.2, 1.5)
trans.plot + 
geom_text(x = 45, y = 1.09, label = expression(paste(bar(rho) == 0.46)), hjust = 1.0, vjust = -1) +
geom_text(x = 45, y = 0.74, label = expression(paste(bar(rho) == 0.89)), hjust = 1.0, vjust = -1) +
geom_text(x = 45, y = 0.64, label =  expression(paste(bar(rho) == 0.70)), hjust = 1.0, vjust = -1) +
geom_text(x = 45, y = 0.33, label =  expression(paste(bar(rho) == 1)), hjust = 1.0, vjust = -1)

```


<!--chapter:end:12-Dinamica_de_Transiciones.Rmd-->

# Funciones de Transferencias

Autores: "Mariana Hernández Apolinar y Paola Portillo Tzompa"


## La elasticidad no lineal

La elasticidad no lineal (@hodgson2004methodological) se refiere a que los analisis de elasticidad (@caswell2000matrix, @de2000elasticities) como explicado en el capitulo xx no son estrictamente lineal y que las perturbaciones en una población pueden tener efectos no lineales en las respuestas de los parámetros de densidad o indices de crecimientos.  Esos cambios no lineales se pueden observar también en la dinámica de transiciones. Si las perturbaciones son pequeñas el uso de análisis de elasticidad pudiesen ser aceptable, por consecuencia los efectos no lineales pueden ser ignorados, pero si las perturbaciones son grandes, los efectos no lineales pueden ser importantes y impactar los procesos de dinámica poblacionales.  En los análisis de dinámica poblacional estamos interesado a no solamente el crecimiento de la población pero que pudiese pasar si hubiese cambios pequeños y grandes en los parametros de la matriz sobre los indices de crecimiento y densidad poblacional tal como la supervivencia, crecimiento y fecundidad.  La elasticidad no lineal es una herramienta que permite evaluar esos cambios que sean por causa naturales tal como variación ambientales (sucesión, deslizamiento de terreno, mortandad de forofito, cambio climatológico), o antropogénicos (extración de individuos o hasta manejo del sitio para promover el crecimiento de la población). 

Es importante reconocer que los análisis de elasticidad y sensitividad ignoran los efectos de la dinámica de transiciones y provee una aproximación linear de cambios que muchas veces no son lineales (@stott2012beyond).  

La elasticidad no lineal es una herramienta que permite evaluar esos cambios que sean por causa naturales tal como variación ambientales (sucesión, deslizamiento de terreno, mortandad de forofito, cambio climatológico), o antropogénicos (extracción de individuos o hasta manejo del sitio para promover el crecimiento de la población). 

## Metodología

El método que presentamos aquí es el desarollado por Hodgson y Townley (2004) (@hodgson2004methodological, @stott2012beyond), los cuales presentan un método para calcular la elasticidad no lineal. No se discutirá en detalle el método, pero se presentará un ejemplo de como calcular la elasticidad no lineal. 
 

```{r, message=FALSE}
library(popdemo)
```


## Ejemplo tradicional

Aqui la matriz de lefkovitch para la planta *Lepanthes rubripetala* (Tremblay et al. 2015) es presentada.

```{r transF1, message=FALSE}

#Capturar los datos de la matriz para L. rubripetala (Tremblay et al. 2015)
Lr1 <- matrix(c(0.4324, 0,      0,     0.15,
               0.3784, 0.8459, 0,     0,
               0,      0.0034, 0.7954,0.2300,
               0,      0.0890, 0.1841,0.7510), byrow=TRUE,ncol=4)

#Capturar las categorias de estado
estadios <- c("PL", "J", "NR", "AR")
colnames(Lr1) <- rownames(Lr1) <- estadios

#Obtener la matriz L. rubripetala 
Lr1 <- matrix(Lr1[1:4, ], nrow = 4, dimnames = list(estadios, estadios))
Lr1

```

Aqui la matriz de elasticad calculado anteriormente.

Nota que la suma de todos los elementos de la matriz de elasticidad. Proporcionalmente el cambio de la supervivencia de el estado de Adulto Reproductivo (AR) tiene el mayor impacto sobre la tasa de crecimiento poblacional.  Un pequeño cambio resultaria en un cambio de 0.311 en la tasa de crecimiento poblacional. Al contrario una plantula que se queda plantula (estasis) tuviese muy poco impacto en el crecimiento de la población (0.018). Esos cambios son lineales y son validos si las perturbaciones son pequeñas. Recordar que los indices de sensitividad para tansiciones y estasis son en unidades diferentes que los fecundidades. 


```{r transF2, message=FALSE}
 # Matriz de elasticidad
elasticidad<- round(elas(Lr1), digit = 3)

elasticidad
```





## Valor biológico

## Métodos de calculo

En el paquete de R `popdemo` se puede calcular la elasticidad no lineal *transfer function* con la función **tfam_lambda** y **tfam_inertia**.  La función **tfam_lambda** calcula la elasticidad no lineal. 

La función **tfam_lambda** calcula la elasticidad no lineal de la matriz de edad o de etapas de cada elemento de la matriz A que no sean 0 (zero). Esa función es practica para vizualizar como las perturbaciones en las transiciones del ciclo de vida impacto lambda y observar la no-linealidad de los efectos.   


De las 10 transiciones , estasis o fecundidad, 9 tienen un efecto no lineal sobre lambda. Nota primero que el rango de los ejes de "x" (efecto de perturbaciones) y la "y" el crecimiento porblacional intrinsico varia por cada grafico. La transición de plantula a plantula tiene efecto no lineal sobre lambda bastante pronunciado (primer cuadro a la izquierda primera fila). Se observa que aumentar la proporción de individuos que se quedan en esta etapa no tiene mucho efecto hasta que la perturbación aumenta de ± .5, y despues el efecto es bastante consistente. 

La transición de juvenil a no reproductivo tiene un efecto no lineal sobre lambda.  La transición de juvenil a adulto reproductivo tiene un efecto no lineal sobre lambda.  La transición de no reproductivo a adulto reproductivo tiene un efecto no lineal


```{r transF3}
n0 <- c(0, 46, 38, 82)

tfmat_lamb=tfam_lambda(Lr1)

plot(tfmat_lamb)
```





sens1=sens(Lr1)[1,1]
sens1

abline(eigs(Lr1, "lambda"), sens1, lty=2)



La función **tfam_inertia** calcula la cuan grande o pequeña una población que no este a su equilibro estable puede ser perturbada por consecuencia de dinamica de transiciones.  Stott y colegas (@stott2012beyond) presentan no solamente que el efecto de perturbaciones no es lineal sobre el cambio en lambda pero tambien sobre la inertia, entonces el efecto que tiene sobre poblaciones que no esten a su equilibrio estable. 

Usamos la misma temrinalogía de Stott (@stott2012beyond) para calcular el efecto de elasticidad sobre la inertia de la matriz de *L. rubripetala*. Se evalua el efecto del basado en la estructura del vector de estado inicial. En otra palabra si la cantidad de individuos se encuentra en un estado especifico. El "upper" seria los individuos en la etapa mayor (en este caso los adultos reproductivos), el "lower" en la estapa menor (en las plantulas) y una estructura de población en al inicio del estudio.


Para evaluar el efecto de no lineal de 

```{r transF4}


n0 <- c(0, 46, 38, 82)

tf2<-tfa_inertia(Lr1, vector=n0, d=c(0,0,0,1), e=c(0,0,1,1), prange=seq(-0.18,0.02,0.01))
plot(tf2,ylim=c(0, 2),main="Population inertia",cex.axis=1.4,cex.lab=1.5)
inertia<-inertia(Lr1, vector=n0)
sens2<-tfs_inertia(Lr1, vector=n0, d=c(0,0,0,1), e=c(0,0,1,1), tolerance=1e-5)
abline(inertia, sens2, lty=2, col="red")
```



```{r transF5}
n0 <- c(0, 46, 38, 82)

tfmatU=tfam_inertia(Lr1, bound = "upper")
tfmat_I=tfam_inertia(Lr1, vector = n0)
tfmatL=tfam_inertia(Lr1, bound = "lower")
plot(tfmatU)
plot(tfmat_I)
plot(tfmatL)
```




## Paquete de R para calcular le eslaticidad no lineal


## Referencias


*Índices de transferencia*. Con el fin de evaluar en el corto plazo qué cambios cuantitativos habría en la población como respuesta ante una perturbación determinada, se calculan los límites de la dinámica transitoria a través de los *Índices de transferencia*, que incluyen los siguiente tres parámetros (Stoot et al. 2012):

a)  *Reactividad alta y Reactividad baja* (Upper reactivity y Lower reactivity) que representan el crecimiento o el decremento inmediato (i.e. primer intervalo de tiempo) de la población antes de alcanzar la tasa constante de crecimiento poblacional.

b)  *Máxima amplificación/Máxima atenuación* (Maximum amplification/Maximum attenuation) que indican,respectivamente, el incremento o decremento máximo futuro del crecimiento poblacional previo a alcanzar la tasa constante de crecimiento poblacional.

c)  *Inercia alta e Inercia baja* (Upper inertia y Lower inertia) que evalúan el límite más alto o el más bajo en el crecimiento de la población antes de alcanzar la tasa constante de crecimiento poblacional, respectivamente.


## Funciones de transferencia  

Finalmente, el cálculo de las funciones de transferencia representa el último paso en análisis de dinámica transitoria establecido por Stott y colaboradores (2012). A través de estas ecuaciones se evalúa la elasticidad o efecto de la perturbación sobre la dinámica poblacional. A diferencia de las matrices de elasticidad de los modelos de proyección poblacional, estas elasticidades no son lineales y evidencian la importancia relativa de la de la perturbación en la categoría de tamaño/estado sobre el crecimiento de la población en el corto plazo. Estas ecuaciones también están disponibles en el programa *Popdemo* de *R* y sus resultados se representan a través de gráficas.

La perturbación de la estructura está determinada ppor dos vectores *d* y *e*

```{r transF6}
##PASO 6: ANALISIS DE LAS FUNCIONES DE TRANSFERENCIA 
#Establecer márgenes:
#Vector original
library(popdemo)

nLr0 <- c(0, 46, 38, 82)

#PERTURBACIÓN DEL VECTOR ORIGINAL

#1) Entrada de la matriz a(1,1): plántulas a plántulas
tf1 <- tfa_lambda(Lr1, d = c(1, 0, 0, 0),
                  e = c(1, 0, 0, 0),
                  prange = seq(0, 4, 0.01))

#Gráfica de la dinámica poblacional
plot(tf1, ann = FALSE)
title(main = "Dinámica poblacional (Plántulas - Plántulas)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda1 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad 
sens1 <- tfs_lambda(Lr1, d = c(1, 0, 0, 0), e = c(1, 0, 0, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda1, sens1, lty = 2, col = "red")

#2) Entrada de la matriz a(2,1): plántulas y juveniles
tf2 <- tfa_lambda(Lr1, d = c(0, 1, 0, 0),
                  e = c(1, 0, 0, 0),
                  prange = seq(-0.4, 0.6, 0.01))

#Gráfica de la dinámica poblacional
plot(tf2, ann = FALSE)
title(main = "Dinámica poblacional (Plántulas - Juveniles)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda2 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad 
sens2 <- tfs_lambda(Lr1, d = c(0, 1, 0, 0), e = c(1, 0, 0, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda2, sens2, lty = 2, col = "red")

#3) Entrada de la matriz a(2,2): juveniles y juveniles
tf3 <- tfa_lambda(Lr1, d = c(0, 1, 0, 0),
                  e = c(0, 1, 0, 0),
                  prange = seq(-0.8, 0.1, 0.001))

#Gráfica de la dinámica poblacional
plot(tf3, ann = FALSE)
title(main = "Dinámica poblacional (Juveniles - Juveniles)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda3 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad 
sens3 <- tfs_lambda(Lr1, d = c(0, 1, 0, 0), e = c(0, 1, 0, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda3, sens3, lty = 2, col = "red")

#4) Entrada de la matriz a(3,2): juveniles y no reproductivos
tf4 <- tfa_lambda(Lr1, d = c(0, 0, 1, 0),
                  e = c(0, 1, 0, 0),
                  prange = seq(-0.001, 0.03, 0.01))

#Gráfica de la dinámica poblacional
plot(tf4, ann = FALSE)
title(main = "Dinámica poblacional (Juveniles - No reproductivos)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda4 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens4 <- tfs_lambda(Lr1, d = c(0,0,1,0), e = c(0, 1, 0, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda4, sens4, lty = 2, col = "red")

#5) Entrada de la matriz a(4,2): juveniles a adultos
tf5 <- tfa_lambda(Lr1, d = c(0,0,0,1),
                  e = c(0,1,0,0),
                  prange = seq(0,0.8,0.01))

#Gráfica de la dinámica poblacional
plot(tf5, ann = FALSE)
title(main = "Dinámica poblacional (Juveniles - Adultos)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda5 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens5 <- tfs_lambda(Lr1, d = c(0, 0, 0, 1), e = c(0, 1, 0, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda5, sens5, lty = 2, col = "red")

#6) Entrada de la matriz a(3,3): adultos no reproductivos a adultos no reproductivos
tf6 <- tfa_lambda(Lr1, d = c(0, 0, 1, 0),
                  e = c(0, 0, 1, 0),
                  prange = seq(-0.8, 0.2, 0.01))

#Gráfica de la dinámica poblacional
plot(tf6, ann = FALSE)
title(main = "Dinámica poblacional (Adultos No rep - Adultos  No reproductivos)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda6 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens6 <- tfs_lambda(Lr1, d = c(0,0,0,1), e = c(0,1,0,0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda6, sens6, lty = 2, col = "red")

#7) Entrada de la matriz a(4,3): adultos no reproductivos a adultos reproductivos

tf7 <- tfa_lambda(Lr1, d = c(0,0,0,1),
                  e = c(0,0,1,0),
                  prange = seq(-0.2,0.8,0.001))

#Gráfica de la dinámica poblacional
plot(tf7, ann = FALSE)
title(main = "Dinámica poblacional (Adultos No rep - Adultos No rep)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda7 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens7 <- tfs_lambda(Lr1, d = c(0,0,0,1), e = c(0,0,1,0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda7, sens7, lty = 2, col = "red")

#8) Entrada de la matriz a(1,4): adultos reproductivos a plántulas

tf8 <- tfa_lambda(Lr1, d = c(1,0,0,0),
                  e = c(0,0,0,1),
                  prange = seq(-0.2,0.8,0.001))

#Gráfica de la dinámica poblacional
plot(tf8, ann = FALSE)
title(main = "Dinámica poblacional (Adultos reproductivos - Plántulas)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda8 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens8 <- tfs_lambda(Lr1, d = c(1,0,0,0), e = c(0,0,0,1))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda8, sens8, lty = 2, col = "red")

#9) Entrada de la matriz a(3,4): adultos reproductivos a plántulas

tf9 <- tfa_lambda(Lr1, d = c(0, 0,1, 0),
                  e = c(0, 0, 0,1),
                  prange = seq(-0.2, 0.8, 0.001))

#Gráfica de la dinámica poblacional
plot(tf9, ann = FALSE)
title(main = "Dinámica poblacional (Adultos reproductivos - Plántulas)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda9 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens9 <- tfs_lambda(Lr1, d = c(0, 0, 0,1), e = c(0, 0, 1, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda9, sens9, lty = 2, col = "red")

#10) Entrada de la matriz a(4,4): adultos reproductivos a adultos reproductivos

tf10 <- tfa_lambda(Lr1, d = c(0, 0, 0, 1),
                  e = c(0, 0, 0, 1),
                  prange = seq(-0.6, 0.2, 0.001))

#Gráfica de la dinámica poblacional
plot(tf10, ann = FALSE)
title(main = "Dinámica poblacional (Adultos rep - Adultos rep)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda10 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens10 <- tfs_lambda(Lr1, d = c(0,0,0,1), e = c(0,0,0,1))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda10, sens10, lty = 2, col = "red")

#Definir márgenes
par(mfrow = c(4,4))
par(mfg = c(1,1))

#Gráficas de la función de transferencia de la inercia en el ciclo de vida de L. rubripetala (población 1)
tfmatriz <- tfam_inertia(Lr1,vector = nLr0)
plot(tfmatriz)
 
```

Raventós y colaboradores (2015) estimaron el crecimiento poblacional de corto plazo de dos orquídeas epífitas después del paso de un huracán. Dado que a su paso se pierden individuos, se simuló si la reintroducción de plántulas y adultos mitigaban los efectos de este fenómeno en Cuba. Los resultados sugieren que la reintroducción de adultos tiene un efecto positivo sobre

<!--chapter:end:13-Funciones_de_Transferencia.Rmd-->

# LTRE

```{r, message=FALSE}
library(tidyverse)
library(gt)
```



por : Adriana Ramírez-Martínez

## Introducción a **Experimento de Respuesta de Tabla de Vida**

La variación en los estimados de los parámetros de la matriz son inherentes a la biología. Esa variación puede ser a consecuencia de múltiples factores individuales y en combinaciones, incluyendo efectos de tiempo, espacio, genético, tamaño de muestra y suerte (@hernandez2024natural)   La variación en las parámetros de la historia de vida de una especie y las causas de estas diferencias se puede evaluar a diferentes niveles: genético, demográfico, espacial o temporal. Esta variación en ecología es la norma. La variación se encuentra en todos aspectos desde la parte genética de los individuos que compone una población, la variación ambiental y las interacciones bióticas y abióticas; además de la plasticidad fenotípica que es la interacción entre la genética y el ambiente. ¿Cuál es esa variación? ¿en otra palabra qué es lo que varía? y ¿cómo los individuos responden a las variables bióticas y abióticas? son aspectos importantes para determinar la ecología, evolución y conservación de las especies. La causa de la variación en una población se puede resumir a tres componentes principales, la genética, el efecto del ambiente y la interacción entre ambiente y genética (plasticidad fenotípica) (@hastings2021effects; @sun2019multivariate). Se asume que el tamaño de muestra es suficiente grande para no ser la causa de la variación. Dentro de un contexto de dinámica poblacional las condiciones que los individuos en las poblaciones experimentan varían, ya sea durante tratamientos manipulados, localidades o periodos de tiempo, y por consecuencia los datos que colectamos con diferencias en espacio/tiempo también varían y pudieran tener efecto sobre la matriz de proyección poblacional **A**. Por tanto, las entradas (los parámetros) de esa matriz **A** variarán en tiempo/espacio o experimento y esto tendría un impacto sobre la tasa de crecimiento poblacional (λ) y en los estimados de dispersión (Intervalo de confianza o credibilidad; @caswell2000matrix, @caswell2010life).

Tomando en cuenta lo anterior un Experimento de Respuesta de Tabla de Vida (**ERTV**) conocido también como *Life Table Response Experiment* (LTRE por sus siglas en inglés) descompone la diferencia o varianza en *λ* entre múltiples poblaciones o tiempo dentro de las contribuciones de los elementos de la matriz y sus interacciones (@caswell1989analysis). Entonces al realizar este análisis podemos tener una apreciación de cómo los cambios en la matriz de datos recolectados en diferentes tiempos y espacio impactan las tasas vitales y a su vez que causan cambios en el crecimiento intrínseco *λ* y otros parámetros poblacionales (@caswell1989analysis, @caswell2010life). 

Desde la aplicación del primer ERTV por Birch (1953) en su estudio sobre el efecto de la temperatura, humedad y el alimento sobre tres especies de escarabajos de harina, las aplicaciones de estos análisis han sido variadas con diversos fines en las últimas dos décadas (@caswell1989analysis, @caswell2010life). Tanto en diseños fijos en los que se manipulan uno o más factores, como en diseños aleatorios en los que se analizan parámetros demográficos en condiciones naturales no manipuladas a lo largo del tiempo o del espacio (@horvitz1997relative; @teitel2016assessing). Los diseños fijos se han utilizado en poblaciones de animales para investigar las consecuencias demográficas de la exposición a contaminantes, la manipulación del alimento o la manipulación de la densidad poblacional (@hansen1999multiannual, 1999; @levin1996demographic; @oli2001effect). En plantas, los análisis ERTV se han utilizado para evaluar las consecuencias demográficas de la disponibilidad de polinizadores o de la herbívora, competencia, efectos en intensidades de cosecha y de fenómenos naturales e inducidos por el humano (@davison2010demographic; @gaoue2010effects; @garcia2002reproductive; @hart2021simulated; @jacquemyn2012stochastic; @miriti2001effects; @mondragon2009population; @nordbakken2004demography; @schmidt2011matrix).

Los métodos para calcular los ERTV están constantemente actualizándose y de acuerdo con (@hernandez2023exact) existen 186 análisis de ERTV para 75 especies de animales y 1487 para 200 especies de plantas. Aunque en este trabajo no utilizamos la metodología expuesta por dichos autores mostramos una forma práctica de la aplicación de este análisis.

### ¿Cómo se diferencia la elasticidad de ERTV?

A diferencia de la elasticidad, el cual es un tipo de análisis de perturbación que examina cuánto cambiaría el crecimiento de la población si se cambiaran una de las entradas de la matriz comparando múltiples matriz, el análisis ERTV examina cuánto cambió *λ* en función de la variación observada en las entradas de la matriz (@caswell2000matrix, @caswell2010life; @horvitz1997relative); y por consecuencia es un análisis que toma en cuenta el cambio de las variaciones individualmente registradas en matrices en diferentes poblaciones/ tiempo / experimentos, etc. (@caswell2010life). Nota que ERTV es una herramienta suplementaria para evaluar el efecto de perturbaciones como los de elasticidad (@caswell1989analysis), dinámica de transiciones (@stott2011framework) y funciones de transferencias (@stott2012beyond) y no un reemplazos. Cada una de estas herramientas tiene un propósito y una interpretación diferente con sus supuestos.

***

## Métodos

### Ejemplo práctico de ERTV

Para ejemplificar el cálculo de los ERTV utilizaremos los datos recabados por Ramírez-Martínez colectados de a 2017-2018 para la orquídea epífita *Oncidium brachyandrum* Lindl. en un bosque de encino estacional en Oaxaca, México (@ramirez2021host). La pregunta principal del estudio era saber qué tasas vitales estaban ligadas a las variaciones en los valores de λ de poblaciones de *O. brachyandrum* creciendo sobre dos hospederos *Quercus martinezii* C.H.Mull. y *Q. rugosa* Née. Usando el método ERTV se pudo evaluar el efecto que tiene la variación observada en los parámetros de las matrices en función de las especies de hospedero en los que se encontraban creciendo.  

Como el ERTV es una forma de análisis retrospectivo y es análogo al ANOVA (porque cuantifica los efectos observados de los elementos individuales de matriz sobre la variación observada en *λ*, en contraposición a los efectos esperados) se requiere de un valor de referencia para realizar las comparaciones, por lo que se toma la matriz con el valor más alto de *λ* como valor de referencia (@caswell2010life; @timsina2021six).

A continuación, se muestran dos matrices de tipo Lefkovitch (matrices construidas a base de estadíos) para las poblaciones de *O. brachyandrum* y sus valores respectivos de λ en los dos hospederos, *Q. martinezii* (λ=1.3; I.C: 1.11-1.45) y *Q. rugosa* (λ=0.98; I.C: 0.87-0.99) (Cuadro 1). Notamos claramente que el valor de λ era mayor en *Q. martinezii* por lo que la matriz de esta especie fue la matriz de referencia para calcular los ERTV.


***

### Matrices de proyecciones y ciclo de vida por especie de hospedero

Cuadro 1. Matrices de proyección poblaciones de dos poblaciones de *Oncidiun brachyandrum* creciendo sobre *Quercus martinezii* y *Q. rugosa*. Los valores de λ (intervalos de confianza ± 95%) son mostrados en la parte superior izquierda de cada matriz, *qx*, mortalidad por estadío; *w*, categorías estables de tamaño por estadío; valor reproductivo por estadío, *n* = el tamaño de muestra en el tiempo cero (el primer muestreo). p: plántula, i: infantil, j: juvenil, A; adulto (@ramirez2021host).  Los valores en negritas son los valores que representan la proporción de individuos que se queda en ese estadio. 


![](Figures/imagen1.jpg)

***

###	Diagrama del ciclo de vida

### Diagrama para *Quercus martinezii*

Primeramente se creó el ciclo de vida por especie de hospedero utilizando el siguiente código:

```{r LTRE1_Q_martinezii, echo=TRUE}
library(Rage)
library(DiagrammeR)


matmart <- rbind(
  c(0.68, 0.02, 3.88, 16.53),
  c(0.22, 0.76, 0.23, 0.0),
  c(0.0, 0.13, 0.53, 0.58),
  c(0.0, 0.0, 0.17, 0.38))

stages <- c("plántula", "infantil", "juvenil", "adulto") # asignar los nombres de los estadíos
title <- NULL # título del diagrama ninguno
graph <- expand.grid(to = stages, from = stages) # crear un data frame con los estadíos
graph$trans <- round(c(matmart), 4) # redondear los valores de la matriz a 4 decimales
graph <- graph[graph$trans > 0, ] # seleccionar solo los valores mayores a 0
nodes <- paste(paste0("'", stages, "'"), collapse = "; ") # crear los nodos
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 4 # calcular la longitud de las flechas
```

```{r LTRE2, echo=FALSE}
graph$col <- c(
  "steelblue4", "PaleGreen4", "MediumOrchid4", "steelblue4", "PaleGreen4", "Goldenrod1",
  "MediumOrchid4", "steelblue4", "PaleGreen4", "Goldenrod1", "MediumOrchid4", "steelblue4"
) #asignar colores a las flechas
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'", # crear las flechas
                "[minlen=", graph$min_len, # longitud de las flechas
                ",fontsize=", 10, # tamaño del texto
                ",color=", graph$col, # color de las flechas
                ",xlabel=", paste("\"", graph$trans), # texto de las flechas
                "\"]\n", # fin de la flecha
                collapse = "" # unir las flechas
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
)
```

\vspace{-5truemm}

Figura x: Ciclo de vida de *Oncidium brachyandrum* creciendo sobre *Quercus martinezii*. Las flechas representan las transiciones entre estadíos, estasis y fecundidades y los números son las tasas vitales de fecundidad, supervivencia y crecimiento. El color $\color{#ffc125}{\text{amarillo}}$ para fecundidad, $\color{#36648b}{\text{azul}}$ para supervivencia y $\color{#548b54}{\text{verde}}$ para crecimiento, $\color{#7a378b}{\text{violeta}}$ para retroceso y azul oscuro para permanencia.



### Diagrama para Quercus rugosa

```{r LTRE3_Quercus_rugosa, echo=TRUE}


library(Rage)
library(DiagrammeR)

matrug <- rbind(
  c(0.64, 0.06, 0, 0.0045),
  c(0.27, 0.75, 0.27, 0.0),
  c(0.0, 0.08, 0.47, 0.28),
  c(0.0, 0.0, 0.27, 0.68))
stages <- c("plántula", "infantil", "juvenil", "adulto")
title <- NULL
graph <- expand.grid(to = stages, from = stages)
graph$trans <- round(c(matrug), 4)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", stages, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 4
graph$col <- c(
"steelblue4", "PaleGreen4", "MediumOrchid4", "steelblue4", "PaleGreen4", "MediumOrchid4","steelblue4", "PaleGreen4",  "Goldenrod1", "MediumOrchid4", "steelblue4"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
                "[minlen=", graph$min_len,
                ",fontsize=", 10,
                ",color=", graph$col,
                ",xlabel=", paste("\"", graph$trans),
                "\"]\n",
                collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
)
```


Figura x: Ciclo de vida de *Oncidium brachyandrum* creciendo sobre *Quercus rugosa*. Las flechas representan las transiciones entre estadíos, estasis y fecundidades y los números son las tasas vitales de fecundidad, supervivencia y crecimiento. El color $\color{#ffc125}{\text{amarillo}}$ para fecundidad, $\color{#36648b}{\text{azul}}$ para supervivencia y $\color{#548b54}{\text{verde}}$ para crecimiento, $\color{#7a378b}{\text{violeta}}$ para retroceso y azul oscuro para permanencia.

***

##	Procedimiento para ERTV en Excel

Para facilitar el entendimiento de cómo se calcula ERTV se creó la matriz con los términos de referencia (Cuadro 2).

Cuadro 2. Matriz de términos para el entendimiento de los ERTV. Donde: f= fecundidad, g= crecimiento o retrogresión, p= permanencia y s=supervivencia. Los subíndices se refieren a las transiciones entre estadíos.   Nota que los parámetros de juvenil que retrogresan a plántula y y esa etapa produciendo plántulas se suman. 

![](Figures/imagen2.jpg)


Una vez colocadas las matrices en la hoja de trabajo el primer paso será sumar las columnas para cada estadio, esto significará la supervivencia (s) por estadío (s1, s2, s3, s4); para el caso de *Q. martinezii* en plántulas sería s1= 0.68+0.22= 0.90 (Figura 3). Después se tienen que calcular las transiciones con respecto a la supervivencia; por lo que para el caso de la transición g12 para la matriz de *Q. martinezii* tenemos g12= 0.22/0.90=0.25; este cálculo se realiza para todas las transiciones. Los valores de fecundidad (f) se tomarán tal cual de la matriz de fecundidad **mat$F**. Una vez obtenido esto se procederá a realizar los cálculos con las ecuaciones que se muestran del lado derecho para cada una de las celdas y, además, esto nos sirve para verificar que hayamos calculado bien cada una de las tasas vitales. Por ejemplo, observamos que una proporción de plántulas en *Q. martinezii* se mantuvo (0.67) este valor se obtiene de multiplicar la supervivencia de plántulas (s1) por la sustracción de 1 menos el crecimiento de plántulas a infantiles 0.89 (1-0.25) = 0.68 (ecuación s1* (1-g12)).

![](Figures/imagen3.jpg)
 
Figura 3. Forma de calcular las ecuaciones para la base de ERTV.

En un archivo nuevo de Excel se arma la base, con la columna de vital rate al principio, seguido por las especies de hospederos (tratamientos) poniendo primeramente el control y después la columna de matrix (Figura 4). Esta base contendrá las ecuaciones de la matriz de referencia. Como la matriz de *Q. martinezii* tuvo los valores más altos de lambda está ultima de colocará en nuestra base que utilizaremos para correr el análisis ERTV.


 
```{r LTRE4, echo=FALSE}
library(tidyverse)
library(gt)
Oncidium=tribble(~"names.vitalrate", ~"Martinezzi", ~"Rugosa", ~"matrix",
             "lambda",1.30, 0.93,  "",
             "s1",    0.8961, .8636,  "0",
             "g12",   0.2463, 0.2631, "s1*g12",
             "s2",    0.90163, 0.8888,  "0",
             "g21",  0.01818,	0.0625,  "0",
             "g23",   0.1454, 0.0937, "s2*g21",
             "s3",    0.9375, 1.00, "2*(1-g23-g21)",
             "g32",   0.2500, 0.2667, "s2*g23",
             "g34",   0.1833, 0.2667,  "0" ,
             "s4",    0.9667, 0.9545, "f31",
             "g43",   0.6034, 0.2857, "s3*g32",
             "f31",   3.88, 0.0001, "3*(1-g34-g32)",
             "f41",  16.53, 0.0045, "s3*g34",
             NA,     NA, NA ,  "f41",
             NA,       NA  ,NA, "0",
             NA,NA , NA, "s4*g43",
             NA, NA, NA, "s4*(1-g43)"
             )

gt(Oncidium)



```
 
 
 
Figura 4. Ejemplo de base para poder calcular los ERTV.

Es importante colocar en la segunda fila la palabra lambda en la primera columna y después los valores según corresponda a cada tratamiento. Debido a que en *Q. rugosa* no hubo producción de plántulas (f31) pero en *Q. martinezii* si hubo se coloca una cantidad muy pequeña pero mayor a cero (e.g. 0.00001) para que se pueda correr el análisis, para las otras transiciones en valor puede ser 0. Una vez culminada la base se guarda el archivo en formato de texto, para continuar en R. Es importante comenzar a colocar las ecuaciones a partir de la segunda fila en la columna matrix.

***

##	Procedimiento en R

Subir la base de datos de la carpeta de trabajo y cargarla en R. 

- Nota que debería observar la base de datos en la consola de R para verificar que se haya cargado correctamente con los mismos valores que en la hoja de Excel. 



```{r LTRE5, echo=TRUE}
# Asegurarse de tener instalado y cargado el paquete 'popbio' package 



library (popbio)

# oncidium<-read.table("data/vitalratesoncidium.txt", sep="\t", header=TRUE, stringsAsFactors=FALSE, fill=TRUE) 
     # Aqui la alternativa si tiene los datos en una hoja de Excel
#oncidium 

Oncidium
```

Debido a que la columna de matrix contiene más filas con datos nos aparecerá la leyenda NA en las otras columnas esto se refiere a que no hay valores disponibles para esas filas

Para extraer los nombres de las tasas vitales (de la fila 2 a la 13), sin incluir el valor de *λ* el cual está en la primera

```{r LTRE6}
razonvital<-Oncidium$names.vitalrate[2:13] 

razonvital # mostrar los nombres del objeto razonvital

```

### Tasa vital sobre *Q. martinezzi*

Extraer tasas vitales de de la orquídea *Oncidium brachyandrum* que crecen sobre *Q. martinezzi* y dejar a lambda a un lado

```{r LTRE7}
 

Martinezzi<-Oncidium$Martinezzi [2:13] # [2:13] se refiere a la fila 2 hasta la 13. 
names(Martinezzi)<-razonvital # asignar los nombres de las tasas vitales
Martinezzi
```

### Tasa vital sobre *Q. rugosa*

Extraer tasas vitales de de la orquidea *Oncidium brachyandrum* que crecen sobre *Q. rugosa* y dejar a lambda a un lado

```{r LTRE8}
Rugosa<-Oncidium$Rugosa [2:13]
names(Rugosa)<-razonvital # asignar los nombres de las tasas vitales
Rugosa
```




### Extraer los elementos de matriz utilizando los nombres de las tasas vitales

```{r LTRE9}
matrix.el<-as.expression(parse(text=Oncidium$matrix)) 
matrix.el
expression(s1*(1-g12), s1*g12, 0, 0, s2*g21, s2*(1-g23-g21), 
    s2*g23, 0, f31, s3*g32, s3*(1-g34-g32), s3*g34, f41, 0, s4*g43, 
    s4*(1-g43))
```


### Calcular las sensibilidades y elasticidades de *Onciudium brachyandrum* de ambas matrices

Nota que usando la función vitalsens se pueden calcular las sensibilidades y elasticidades de las tasas vitales de las matrices de *Oncidium brachyandrum* creciendo sobre *Q. martinezii* y *Q. rugosa* en un mismo objeto.

#### *Quercus matinezzi*

## HAY algo extraño en la matriz de sensibilidades y elasticidades, no se ve bien., hay elasticidad negativas, y esto no es posible.  Hay que revisar el código.

```{r LTRE10}
Martinezzi.se<-vitalsens(matrix.el, Martinezzi)
Martinezzi.se
```

#### *Quercus rugosa*

```{r chap12_9}
Rugosa.se<-vitalsens(matrix.el, Rugosa)
Rugosa.se
```       

### Calcular las diferencias en tasas vitales entre las especies

En esta parte se calculará la diferencia entre las tasas vitales de *Oncidium brachyandrum* creciendo sobre *Q. martinezii* y *Q. rugosa*.  ¿Como se interpreta estos resultados? 

```{r LTRE11}
vr.dif.Martinezzi.Rugosa<-Rugosa-Martinezzi 
vr.dif.Martinezzi.Rugosa
```
        
### Calcular las tasas vitales para la matriz media

En este paso se calculará la tasa vital media para *Oncidium brachyandrum* creciendo sobre *Q. martinezii* y *Q. rugosa*. La tasa vital media se calcula sumando las tasas vitales de las dos matrices y dividiendo entre 2.

```{r LTRE12}
vr.promedia.Martinezzi.Rugosa<-((Rugosa+Martinezzi)/2) #calcular la tazas vitales parta la matrix promedia

# Nota: si se tuvieran 3 matrices se sumarían las tasas vitales de las tres dividido por 3. 

vr.promedia.Martinezzi.Rugosa
```
        
### Calcular las tasas sensibilidades y elasticidades para la matriz media

En este paso se calculará las sensibilidades y elasticidades para la matriz promedia de *Oncidium brachyandrum* creciendo sobre *Q. martinezii* y *Q. rugosa*.

```{r LTRE13}
media.sens.Martinezzi.Rugosa<-vitalsens(matrix.el, vr.promedia.Martinezzi.Rugosa) 
media.sens.Martinezzi.Rugosa
```


### Calcular las contribuciones de ERTV y ver los resultados

```{r chap12_13}
LTRE.contrib.Martinezzi.Rugosa<-vr.dif.Martinezzi.Rugosa*media.sens.Martinezzi.Rugosa$sensitivity  
LTRE.contrib.Martinezzi.Rugosa
```


### Resultados de ERTV



```{r LTRE14}
LTRE.resultados.Martinezzi.Rugosa<- data.frame(razonvital=razonvital,
                                               rug.vr=Rugosa, 
                                            mart.vr=Martinezzi, 
                                            vr.differencia=vr.dif.Martinezzi.Rugosa, 
                                            media.sens=media.sens.Martinezzi.Rugosa$sensitivity, 
                                            contribucion=LTRE.contrib.Martinezzi.Rugosa)

library(gt)
gt(LTRE.resultados.Martinezzi.Rugosa)
``` 




***

Se puede crear un gráfico de la contribucioón de cada tasa vitales sobre la historia de vida de la especies comparando las dos matrix


```{r LTRE15}
ggplot(LTRE.resultados.Martinezzi.Rugosa, aes(y=contribucion, x=razonvital, fill=razonvital))+
  geom_bar(stat="identity")+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(title="Oncidium vital rate contribución a la diferencia en lambda", x="razonvital", y="contribución")+
  geom_hline(yintercept=0, linetype="dashed", color = "red")+
  xlab("Tasa vitales")
```




Figure 5. Resultados de un Experimento de Respuesta de la Tabla de Vida (ERTV) llevado a cabo para evaluar las contribuciones de las entradas de la matriz a la variación observada en *λ*.

De acuerdo con el análisis de elasticidad para cada una de las poblaciones de *O. brachyandrum*, tanto en *Q. martinezii* como en *Q. rugosa* la permanencia de individuos infantiles es la que tiene un mayor impacto sobre los valores de la tasa de crecimiento poblacional (Figura 6). De acuerdo al ERTV, el cual toma en cuenta las diferencias en las tasas vitales y la sensibilidad de lambda que es una función no linear de esas tasas vitales, podemos observar que la fecundidad (fsa) y el crecimiento de plantulas a juveniles (gsj), de juveniles a adultos (gja) y el retroceso de adultos a juveniles (gaj) tiene las mayores contribuciones a las diferencias en lambda entre Q. martinezii y Q. rugosa que la permanencia de plántulas.
 
Figure 6. Resultados de los análisis de elasticidad, para dos poblaciones de *Oncidium brachyandrum* creciendo sobre *Quercus martinezii* y *Q. rugosa*. Por proceso demográfico (a) y por estadío (b).


```{r LTRE16}
ggplot(LTRE.resultados.Martinezzi.Rugosa, aes(y=media.sens, x=razonvital, fill=razonvital))+
  geom_bar(stat="identity")+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(title="Media Sensitividad ????", x="razonvital", y="contribución")+
  geom_hline(yintercept=0, linetype="dashed", color = "red")+
  xlab("Tasa vitales")
```



***


Ahora enseñar como hacer estos análisis sin tener que usar Excel, aquí un set de script para aplicar a *Oncidium brachyandrum*.

Sugiero que cambie las gráficas a ggplot2 para que se vean más bonitas y consistencia en el libro de herramientas.  YO TE AYUDO CON ESTE PASO


***

AHORA: Si se puede hacer los analisis sin todos los pasos de Excel, se puede hacer directamente en R. 





<!--chapter:end:14-LTRE.Rmd-->

# Variación temporal y Espacial por simulaciones


Por: Raymond L. Tremblay


```{r sim1, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggtext)
library(janitor)
library(popbio)
```


El termino **biología** pudiese ser un sinónimo de variación biológica. No hay dos organismos iguales, ni siquiera gemelos completamente idénticos. La variación biológica es una característica fundamental de la vida y es la base de la evolución, no puede haber evolución sin variación. Cuando se considera los individuos, por ejemplos humanos, fácilmente reconocemos variación, en tamaño, color de ojos, susceptibilidad a cáncer o infección y efecto que tiene el ambiente (por ejemplo la dieta o acceso a la educación) entre muchos factores que impacta la supervivencia o crecimiento y reproducción. Pero desafortunadamente cuando se considera los animales y plantas de una misma especie frecuentemente se obvia la variación en los análisis.  Podemos observar variación a múltiples niveles en una misma especie

- Variación sub-individual (dentro de un individuo)
- Variación entre individuos (dentro de una población)
- Variación entre poblaciones (entre poblaciones)
- Variación entre tiempo (entre periodos de tiempo)

Todos estos componentes de variación tendrán impacto en la confianza de los estimados de los parámetros de la matriz de transición y el crecimiento poblacional en adición del comportamiento de la población en tiempo.  Hay un componente que frecuentemente se deja por olvido es el efecto de la variación en tamaño de muestra pequeña en los estimados de los parámetros de la matriz de transición y el crecimiento poblacional, este es el efecto demográfico por tamaño de muestra. 


### Componentes de Variación 

#### La variación sub-individual

La variación sub-individual es la variación que se observa en un individuo. Por ejemplo, la variación en el **tamaño** o la **cantidad** de hojas, flores, frutos, semillas dentro del mismo individuo. Este tipo de variación es común en plantas y es un componente importante de la variación total pero raramente se considera en los análisis. Carlos Herrera ha demostrado claramente que este componente no solamente es parte de la variación total de las especies pero es importante para entender los procesos ecológicos y evolutivos [@herrera2009multiplicity].  En adición cuando uno compara la variación total por la variación sub-individual, la variación sub-individual es mucho más grande que la variación entre individuos y poblaciones. Esta variación al conocimiento de los presentes autores nunca ha sido incluido en análisis de dinámica poblacional y integrado dentro un PPM.

#### La variación entre individuos

La variación entre individuos es la diferencias que se observa entre individuos de una misma población o en diferentes poblaciones. Por ejemplo, la variación en el tamaño de los individuos, cantidad de hojas, cantidad de flores, cantidad de frutos entre individuos de una misma población influye en la probabilidad de sobrevivir, crecer y reproducirse. La variación entre individuos de diferentes tamaños o etapas impacta grandemente la supervivencia y reproducción de los individuos. Los trabajos de Harper y otros han demostrado que esa variación es común en las plantas [@harper1977population] y típicamente es más importante que la edad de los individuos en muchas especies de plantas.

#### La variación entre poblaciones

La variación entre poblaciones es la variación que se observa entre grupos de individuos de una misma especie. Poblaciones distintas pudiese ser influenciada por las diferencias abióticas y interacciones biótica única a cada población.  Esa variación pudiese influenciar la dinámica de cada población y la dinámica de la especie en general. La diferencias entre poblaciones pudiese ser influenciado por las diferencias genéticas entre poblaciones, variación en el ambiente, variación en la interacción biótica, variación en la historia de la población, entre otros factores, en adición que plasticidad fenotípica que se define como la interacción del ambiente sobre la expresión genética. Sin duda las variables abióticas y bióticas pueden influenciar las transiciones, estasis y reproducción de forma diferencial entre las diferentes etapas del ciclo de vida de la especie.

#### La variación entre tiempo

Este componente de variación incluye la variación típicamente relacionado a la variación *abiótica* que cambia de un periodo de tiempo a otro, por ejemplo el efecto de la cantidad de lluvia, números de días sin lluvia, temperatura entre muchos otras variables. Pero no se debería limitar a considerar solamente la variación abiótica en tiempo ya que la variación *biótica* también puede cambiar de un periodo de tiempo a otro. Por ejemplo la densidad y/o composición de especies en una comunidad cambia de un periodo de tiempo alrededor de la especie de interés y pudiese influenciar la dinámica estimado por la parámetros de la matriz. Por ejemplo considera la variación en presencia de herbívoros o patógenos que cambia de un periodo de tiempo a otro y pudiese influenciar la dinámica de la especie de interés o la competencia inter-especifica. Por consecuencia la variación en tiempo es mucho más que la variación *abiótica* en tiempo. Allí uno también tiene que incluir el efecto de bonanza (eventos raros positivos, ejemplo: reclutamiento excepcional en unos años) y catástrofes (eventos raros negativos, ejemplo: huracanes, mortandad de un hospedero) que pudiese influenciar la dinámica de la especie de interés.

#### Variación en tamaño de muestra pequeña

La gran mayoría de los estudios usando MPP son para evaluar la probabilidad de supervivencia en una especies en peligro de extinción (**Do we have the data in COMPADRE to answer this?**). La razón principal de estos estudios es que queda muy pocos individuos en la población o pocas poblaciones y esas poblaciones son considerando a riesgos. 

Por ejemplo si tuviésemos en una población solamente un adulto y este adulto sobrevive de un año a otro entonces la probabilidad de supervivencia es 1.0. Pero si tuviésemos solamente un adulto y este adulto muere entonces la probabilidad de supervivencia es 0.0. La probabilidad de supervivencia es 1.0 o 0.0 respectivamente y otros valores no son posibles, pero la interpretación biológica es sesgada, porque ya hay solamente dos alternativas. Pero tuviésemos 1,000 o 10,000 individuos es muy poco probable que todos se mueren o todos sobreviven, y hay muchas alternativas posibles. Este es un ejemplo extremo pero ilustra claramente el problema de estimar la probabilidad de supervivencia y transiciones en una población con un tamaño de muestra pequeña y puede resultar en estimados sesgados.  

En las próximas secciones vemos métodos de simulaciones y estimaciones de intervalos de confianza para abordar la variación biológica en tiempo y espacio y la variación por el tamaño de muestra pequeña.  

## Introducción a los métodos de simulaciones

Los métodos de simulaciones para estimar la variación en los parámetros tanto de la matriz como el crecimiento poblacional varia mucho. Lo que es consistente es que se utiliza dados disponible para hacer simulaciones y estimar la variación en los parámetros. En otra palabra se usa la variación entre los elementos de múltiples matrices de transición en tiempo o espacio o el tamaño de muestra para hacer simulaciones y estimar la variación en los parámetros. La manera de expresar la variación puede asumir diferentes formas, por ejemplo, la variación en los parámetros de la matriz de transición puede ser expresado como una distribución normal (distribución en forma de campana), una distribución de Poisson (Datos con valores discretos), una distribución binomial (distribución donde hay solamente dos alternativas) o beta (distribución donde la distribución es limitada de 0 a 1), entre otras distribuciones.  Reconociendo el tipo de variación en los parámetros de la matriz de transición es importante para escoger el método de simulaciones y estimaciones de intervalos de confianza y reconocer sus limitación y su interpretación. 


## Estocasticidad espacial

En este caso vemos el efecto de la variación espacial en la probabilidad en los estimados. Aquí nos interesa descubrir y cuantificar cuan variable son las poblaciones una del otro. El objetivo es determinar si las poblaciones se comporta similar una del otro o varía mucho de un sitio al otro. 


### Entrada de datos

El primer paso es definir la diferentes matriz, una por cada periodo de tiempo. En el siguiente script se enseña como entrar los datos para múltiples matrices en un solo objeto. Nota que es una lista de matriz. 

Los datos provienen de un estudio de la dinámica de una población de *Serapia cordigera* de 1999 al 2012 evaluando el impacto antropogénico sobre la dinámica de la población [@pellegrino2014effects].  En este caso se emplea solamente 6 matrices de transición de la población de *Serapia cordigera* en 1999, tres de estas son poblaciones que tienen impacto antropogénico (A1, A2 y A3) y tres poblaciones naturales, sin impacto antropogénico (N1, N2, N3).


```{r sim2}


Serapia<-list(
  A1_1999=matrix(c(
0.745,	0.152,	0.452,	0.564,
0.125,	0.000,	0.000,	0.000,
0.000,	0.321,	0.205,	0.342,
0.200,	0.365,	0.205,	0.185
  ),
  nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
A2_1999=matrix(c(
0.648,	0.203,	0.414,	0.604,
0.188,	0.000,	0.000,	0.000,
0.000,	0.342,	0.198,	0.377,
0.242,	0.264,	0.225,	0.191
),
 nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
A3_1999=matrix(c(
0.544,	0.223,	0.364,	0.498,
0.148,	0.000,	0.000,	0.000,
0.000,	0.249,	0.243,	0.287,
0.242,	0.303,	0.210,	0.101
),
nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
N1_1999=matrix(c(
0.287,	0.271,	0.054,	0.107,
0.318,	0.000,	0.000,	0.000,
0.000,	0.438,	0.228,	0.273,
0.111,	0.512,	0.585,	0.542
),
nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
N2_1999=matrix(c(
0.299,	0.253,	0.066,	0.182,
0.324,	0.000,	0.000,	0.000,
0.000,	0.461,	0.222,	0.264,
0.339,	0.568,	0.554,	0.547
),
nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
N3_1999=matrix(c(
  0.245,	0.156,	0.052,	0.147,
0.325,	0.000,	0.000,	0.000,
0.000,	0.422,	0.305,	0.252,
0.210,	0.465,	0.498,	0.485
),
nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  )
)



Serapia

```


#### Simulaciones con igual probabilidad de selección

Si uno asume que hay igual cantidad de poblaciones afectada de forma antropogénicas y naturales entonces se puede hacer un análisis de la variación espacial en la probabilidad de supervivencia. Se puede simular el crecimiento con igual probabilidad de selección de las matrices de transición. En otra palabra cada matriz sera seleccionado al azar 1/6 de las veces. Este supuesto es razonable si uno asume que hay igual cantidad de poblaciones afectada de forma antropogénicas y naturales. El objetivo es ver la variación en la probabilidad de supervivencia en la población de *Serapia cordigera* en 1999 o mejor cual seria el tamaño de la poblacional típica de la especies si la especie se comporta como la siguientes matrices [@pellegrino2014effects].

La función `stoch.projection` del paquete `popbio` permite hacer simulaciones de la dinámica de una población y da una lista de la cantidad de individuos esperado por cada etapa de la vida. Comenzamos por definir el tamaño de la población inicial por etapa de la vida, **n**, el nombre de las etapas de la vida y luego usamos la función `stoch.projection` para hacer las simulaciones.



```{r sim3}

n <- c(2, 0, 4, 99) # corresponde a los datos de la especies en la publicación del año 2000 del articulo Pellegrino et al. 2014
names(n) <- c("latente", "plantula", "rosetta", "con flor")
Serapia.eq   <- stoch.projection(Serapia, n, nreps=1000) # simulación con igual probabilidad de selección

head(Serapia.eq) # vemos las primeras 6 simulaciones de los tamaños de muestra esperada por etapa


```


### Cual es la distribución de número de individuos esperado.

Para observar cuantos individuos hubiese en el futuro de la población de *Serapia cordigera* si la especie se comporta como las matrices de transición. Se observa que en la poblaciones tendrían pocos individuos típicamente menor de 2-3 individuo todas las etapas irrelevante si fuesen latente, plántula, rosetta o con flores.  



```{r sim4}
Serapia.eq=clean_names(as.data.frame(Serapia.eq))

Serapia.eq %>% 
  gather(key="etapa", value="individuos") %>% 
  ggplot(aes(x=individuos))+
  geom_histogram(bins=30, fill="blue", color="black")+
  facet_wrap(~etapa, scales="free")+
  theme_minimal()+
  labs(title="Distribución de número de individuos esperado de *Serapia cordigera*",
       x="Número de individuos", y="Frecuencia")+
  theme(title = element_markdown())
```

La suma total de individuos por simulación es una medida de la cantidad de individuos esperado en el futuro. En el siguiente gráfico se muestra la distribución de la cantidad de individuos esperado en el futuro de la población de *Serapia cordigera* si la especie se comporta como las matrices de transiciones arriba y seleccionado al azar por la misma probabilidades. Se observa que la mayoría de las simulaciones tienen menos de 10 individuos en el futuro.

```{r sim5}
Serapia_eq_T=Serapia.eq %>% 
  mutate(total=rowSums(across(where(is.numeric)))) 

  
  ggplot(Serapia_eq_T,aes(x=total))+
  geom_histogram(bins=30, fill="blue", color="black")+
  theme_minimal()+
  labs(title="Distribución de total de individuos esperado de *Serapia cordigera*",
       x="Número Total de individuos por simulación", y="Frecuencia")+
  theme(title = element_markdown())
```


### Simulaciones con diferente probabilidad de selección

La probabilidad de selección de las matrices de transición no tiene que ser igual. En el siguiente script se muestra como hacer simulaciones con diferente probabilidad de selección de las matrices de transición. En este caso se asume que hay las 3 poblaciones afectada de forma antropogénicas y que estas son más común (poblaciones afectada antropogenicamente) que las poblaciones naturales. Las 3 poblaciones naturales son poblaciones raras.  En la sección del script vemos que ahora las poblaciones afectada de forma antropogénicas son seleccionadas con una probabilidad de 0.85 (.30 + .30 + .25) y las poblaciones naturales con una probabilidad de 0.15. En otra palabra las poblaciones naturales son muy raras, y la especies es dominada por sitio donde la especies es afectada de forma antropogénicas. **Importante este es una simulación y no refleja la realidad de la especies ni la publicación**.




```{r sim6}

n <- c(2, 0, 4, 99) # población inicial por etapa
names(n) <- c("latente", "plantula", "rosetta", "con flor")
Serapia.uneq   <- stoch.projection(Serapia, n, nreps=1000, prob=c(.3, .3, .25, .05, .05, .05)) # simulación con igual probabilidad de selección

head(Serapia.uneq) # vemos las primeras 6 simulaciones de tamaño de muestra


```

### Comparar la distribución de cantidad de individuos esperado por simulaciones

Ahora vamos a solapar las dos distribuciones (la de selección por igual y por poblaciones mayormente impactado por humanos) para ver si hay una diferencia en la distribución de tamaño de muestra entre las dos simulaciones. Los resultados de la simulaciones siguiere que las poblaciones afectada de forma antropogénicas (rojo) tienen una mayor cantidad de individuos en el futuro que las poblaciones naturales (azul). 


```{r sim7}
Serapia.uneq=clean_names(as.data.frame(Serapia.uneq))

Serapia.uneq_T=Serapia.uneq %>% 
  mutate(total=rowSums(across(where(is.numeric)))) 


ggplot(Serapia.uneq_T, aes(total))+
  geom_histogram( bins=30, fill="red", color="black", alpha=.5)+
  geom_histogram(data=Serapia_eq_T, aes(x=total), bins=30, fill="blue", color="black", alpha=.5)+
  theme_minimal()+
  labs(title="Distribución de total de individuos esperado de *Serapia cordigera*",
       x="Número Total de individuos por simulación", y="Frecuencia")+
  theme(title = element_markdown())

```


***


#### Simulación de crecimiento poblaciónal de *Serapia cordigera*


En el siguiente script podemos evaluar el crecimiento poblacional y su variación en el espacio.

Nota aquí se calcula el log(crecimiento poblacional estocástica) de la especies de *Serapia cordigera* por aproximación y simulaciones siguiendo la formula de Tuljapukar [@tuljapurkar2013population]. Se puede ver que la especies tiene un crecimiento poblacional negativo en la mayoría de las simulaciones. Esto sugiere que la especies esta en declive. Pero también se puede ver que hay una variación en el crecimiento poblacional de la especies. El script incluye un parámetro para indicar por cuanto tiempo queremos que la simulación ocurre, **maxt=**, en esta caso se simula por 50 periodos de tiempo, si no se añade nada la simulación dura por 50000 periodos de tiempo. Nota que **maxt** es en el tiempo de periodo de la matrix de transición, si esta fue construida en un periodo de meses, entonces la simulación es ese intervalo de tiempo. 


Cuando se usa el log de crecimiento poblacional estocástica se calcula $$r$$, ese valor es $r=ln(\lambda)$ y $r$ se interpretación de forma diferentes que los valores de lambda,

- $r$ = log(crecimiento poblacional estocástica) > 0 la población crece
- $r$ = log(crecimiento poblacional estocástica) < 0 la población decrece
- $r$ = log(crecimiento poblacional estocástica) = 0 la población es estable

El crecimiento estocástico de las poblaciones de *Serapia cordigera* en 1999 es negativo, sugiere que la especies esta en declive. Pero también se puede ver que hay una variación en el crecimiento poblacional de la especies. Se usa la función *stoch.grwoth.rate*

Simulaciones por selección de matriz con igual probabilidad

 - el crecimiento es negativo y los intervalos de confianza también, dando confianza que la especies esta en declive.

```{r sim8}
SGR_eq=stoch.growth.rate(Serapia, maxt=50, verbose=TRUE) # matrices seleccionado con igual probabilidad
SGR_eq
```

Simulaciones por selección de matriz con diferente probabilidad

 - el crecimiento es negativo y los intervalos de confianza solapa el cero, sugiere que hay variación en el crecimiento poblacional de la especies y que no hay evidencia que la especie esta en declive ni aumentando (es estable). La interpretaciones aquí es que si la especie es dominada por poblaciones con impacto antropogénico tienen un crecimiento poblacional no negativo.

```{r sim9}
SGR_uneq=stoch.growth.rate(Serapia, maxt=50, prob=c(.3, .3, .25, .05, .05, .05), verbose=FALSE) # matrices seleccionado con diferente probabilidades

SGR_uneq

```


Para convertir el log(crecimiento poblacional estocástica) a lambda se usa la siguiente formula $e^r$ donde $r$ es el log(crecimiento poblacional estocástica). Como ejemplo se muestra la metodología con las simulaciones con probabilidad desigual de selección de las matrices de transición. 


#### Conversión de $r$ a $\lambda$

 Lambda Igual de probabilidades
```{r sim10}


exp(SGR_uneq$sim) # matrices seleccionado con igual probabilidad
exp(SGR_uneq$sim.CI[1]) #El intervalo de confianza inferior
exp(SGR_uneq$sim.CI[2]) #El intervalo de confianza superior
```




### Impacto antropogénico vs poblaciones naturales

Los análisis anteriores no separan las matrices de transición por el impacto antropogenico vs. los naturales. En el siguiente script se muestra como hacer simulaciones y estimar el crecimiento poblacional de las poblaciones afectada de forma antropogénicas y naturales. 


```{r sim11}
Serapia_A = Serapia[1:3] # poblaciones afectada de forma antropogénicas

Serapia_N=  Serapia[4:6] # poblaciones naturales

```

Asumimos una probabilidad igual de selección por cada población. Simulación de tamaño de poblacional por etapa de la vida para las poblaciones afectada de forma antropogénicas y naturales.


```{r sim12}
n <- c(2, 0, 4, 99) # corresponde a los datos de la especies en la publicación del año 2000
names(n) <- c("latente", "plantula", "rosetta", "con flor")
Serapia.eq_A   <- stoch.projection(Serapia_A, n, nreps=1000)
Serapia.eq_N   <- stoch.projection(Serapia_N, n, nreps=1000)

```


El efecto de las poblaciones con impacto antropogenico tienden a tener tamaño de poblacional más grande que las poblaciones naturales. 
 

```{r sim13}
Serapia.eq_A=clean_names(as.data.frame(Serapia.eq_A)) # limpiar los nombres de las columnas y convertir en un data frame
Serapia.eq_N=clean_names(as.data.frame(Serapia.eq_N)) 

Serapia_eq_A=Serapia.eq_A %>% 
  mutate(total=rowSums(across(where(is.numeric)))) # sumar la cantidad de individuos en una columna

Serapia_eq_N=Serapia.eq_N %>% 
  mutate(total=rowSums(across(where(is.numeric))))


ggplot(Serapia_eq_N, aes(total))+
  geom_histogram( bins=30, fill="red", color="black", alpha=.5)+
  geom_histogram(data=Serapia_eq_A, aes(x=total), bins=30, fill="blue", color="black", alpha=.5)+
  theme_minimal()+
  labs(title="Distribución de total de individuos esperado de *Serapia cordigera*",
       x="Número Total de individuos por simulación", y="Frecuencia")+
  theme(title = element_markdown())
```


***



## Estocasticidad temporal


El objetivo de evaluar la variación en tiempo es para determinar si los cambios temporales son importante en predecir los cambios en el crecimiento o estabilidad poblacional.

Seguimos con los datos *Serapias cordigera*, pero ahora evaluamos cual es el efecto de la variación en los parámetros de la matriz usando múltiple censos. Vemos el efecto de una esas población, por impacto antropogenico, **A1** en los años de 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 y 2012. 

El primer paso en entrar los datos en una lista de matrices de transición. 

```{r sim14}
Serapia_tiempo<-list(
  A1_1999=matrix(c(
0.745,	0.152,	0.452,	0.564,
0.125,	0.000,	0.000,	0.000,
0.000,	0.321,	0.205,	0.342,
0.200,	0.365,	0.205,	0.185
  ),
  nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
A1_2000=matrix(c(
0.578,	0.222,	0.394,	0.394,
0.188	,0.000,	0.000,	0.000,
0.000	,0.322,	0.254,	0.357,
0.244	,0.314,	0.125,	0.302
  ),
  nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
A1_2001=matrix(c(
  0.668,	0.122,	0.294,	0.401,
0.128,	0.000	,0.000,	0.000,
0.000,	0.302	,0.453,	0.366,
0.214,	0.364,	0.185,	0.207
  ),
  nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
A1_2002=matrix(c(
0.645,	0.222,	0.682,	0.504,
0.177,	0.000,	0.000,	0.000,
0.000,	0.421,	0.305,	0.382,
0.102,	0.355,	0.208,	0.208
  ),
  nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
A1_2003=matrix(c(
  0.545,	0.113,	0.424,	0.424,
0.247,	0.000,	0.000,	0.000,
0.000,	0.166,	0.233,	0.277,
0.192,	0.253,	0.209,	0.212

  ),
  nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
A1_2004=matrix(c(
  0.548,	0.191,	0.402,	0.527,
0.327,	0.000,	0.000,	0.000,
0.000,	0.338,	0.127,	0.394,
0.211,	0.262,	0.296,	0.142
  ),
  nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
A1_2005=matrix(c(
  0.602,	0.153,	0.486,	0.562,
0.224,	0.000,	0.000,	0.000,
0.000,	0.491,	0.324,	0.304,
0.139,	0.268,	0.294,	0.277

  ),
  nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
A1_2006=matrix(c(
  0.487,	0.471,	0.425,	0.607,
0.318,	0.000,	0.000,	0.000,
0.000,	0.438,	0.328,	0.373,
0.211,	0.212,	0.285,	0.142
  ),
  nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
A1_2007=matrix(c(
  0.544,	0.423,	0.374,	0.578,
0.348,	0.000,	0.000,	0.000,
0.000,	0.441,	0.248,	0.288,
0.145,	0.203,	0.311,	0.201

  ),
  nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
A1_2008=matrix(c(
 0.568,	0.325,	0.294,	0.607,
0.227,	0.000,	0.000,	0.000,
0.000,	0.402,	0.553,	0.256,
0.194,	0.364,	0.275,	0.217

  ),
  nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
A1_2009=matrix(c(
  0.545,	0.356,	0.472,	0.398,
0.225,	0.000,	0.000,	0.000,
0.000,	0.322,	0.304,	0.452,
0.110,	0.225,	0.298,	0.185

  ),
  nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
A1_2010=matrix(c(
  0.399,	0.352,	0.486,	0.580,
0.424,	0.000,	0.000,	0.000,
0.000,	0.561,	0.312,	0.264,
0.239,	0.168,	0.354,	0.247

  ),
  nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  ),
A1_2011=matrix(c(
  0.497,	0.352,	0.465,	0.622,
0.324,	0.000,	0.000,	0.000,
0.000,	0.361,	0.321,	0.264,
0.139,	0.368,	0.367,	0.177

  ),
  nrow=4, byrow=TRUE,
  dimnames=list(c("latente", "plantula", "rosetta", "con flor"),
                c("latente", "plantula", "rosetta", "con flor")
  )
  )
)


 Serapia_tiempo
 
  
  
  
```

#### Simulaciones con igual probabilidad de selección.

El análisis evalúa la variación temporal en el crecimiento poblacional de la especies de *Serapia cordigera* en 1999 a 2012. Usando la función *stoch.projection* se observa la variación en cantidad de individuos por etapa. 

```{r sim15}
n <- c(2, 0, 4, 99) # población inicial por etapa
names(n) <- c("latente", "plantula", "rosetta", "con flor")
Serapia_tiempo_eq   <- stoch.projection(Serapia_tiempo, n, nreps=1000) # simulación con igual probabilidad de selección

head(Serapia_tiempo_eq) # vemos las primeras 6 simulaciones de tamaño de muestra

```

Para evaluar el cambio de crecimiento poblacional en la especies de *Serapia cordigera* en 1999 a 2012 se usa la función *stoch.growth.rate*.
 
Se observa que el crecimiento poblacional es cerca de cero en la mayoría de las simulaciones, sugiere que la especie no esta en declive ni creciendo. Los intervalos de confianza solapa el cero sugiriendo que no hay evidencia que el crecimiento temporal de la población es diferentes de estable.

Nota que se puede cambiar la probabilidades de selección de las matrices de transición, en este caso se asume que hay igual cantidad de poblaciones afectada de forma antropogénicas y naturales. Pero considera por ejemplo que hay eventos abióticos como temperatura o lluvia fuera de lo común en un año, entonces se puede cambiar la probabilidad de selección de las matrices de transición para evaluar el efecto de estos eventos de cambio climatológico en el crecimiento poblacional de la especies.  Si por ejemplo en el área donde este estas especies hay predicción que un factor abiótico, por ejemplo reducción en lluvia (aumento en sequía) en las próximas décadas se pudiese cambiar la probabilidad de selección para de las matrices que son en periodos de sequía y que sean seleccionado más frecuentemente en la simulaciones. El objetivo es de similar los efectos de cambio en tiempo sobre el crecimiento poblacional de la especies. 
 


```{r sim16}

SGR_Temp_eq=stoch.growth.rate(Serapia_tiempo, maxt=50) # matrices seleccionado con igual probabilidad por 50 años
SGR_Temp_eq

# Conversión a valores de Lambda

exp(SGR_Temp_eq$sim) # Lambda de matrices seleccionado con igual probabilidad
exp(SGR_Temp_eq$sim.CI[1]) #Lambda del intervalo de confianza inferior
exp(SGR_Temp_eq$sim.CI[2]) # Lambda del intervalo de confianza superior
```


#### Comparación entre la variaciones espacial y temporal


Comparar la variación temporal en el crecimiento poblacional de la especies de *Serapia cordigera* en 1999 a 2012 con la variación espacial.

Lo que se observa es que la variación temporal y la variación espacial es más o menos igual (el rango de variación), pero que hay menos variación temporal que espacial. Por lo menos para los datos seleccionado de [@pellegrino2014effects] la variación temporal no es tan grande como la variación espacial y solapa el lambda de 1, al contrario la variación espacial no solapa el lambda de 1 (ambos CI son menores de 1, sugiriendo una reducción posible de las poblaciones). Note que no usamos todos los datos del articulo pero un sub-grupo y por consecuencia el análisis es sesgado. 



```{r sim17}
Tabla_resultado=tribble(
  ~tipo, ~valor, ~CI_inf, ~CI_sup,~diff_ci,
  "Espacial", exp(SGR_eq$sim), exp(SGR_eq$sim.CI[1]), exp(SGR_eq$sim.CI[2]), exp(SGR_eq$sim.CI[2])-exp(SGR_eq$sim.CI[1]),
  "Temporal", exp(SGR_Temp_eq$sim), exp(SGR_Temp_eq$sim.CI[1]), exp(SGR_Temp_eq$sim.CI[2]), exp(SGR_Temp_eq$sim.CI[2])-exp(SGR_Temp_eq$sim.CI[1])
) 
Tabla_resultado
```


### Comparación de la variación temporal y espacial en un gráfico

Observación de la variación temporal y espacial en el crecimiento poblacional de la especies de *Serapia cordigera* en un gráfico. 

Se nota que el crecimiento poblacional intrínsico de la especies de *Serapia cordigera* es negativo en la mayoría de las simulaciones cuando se evalúa múltiple poblaciones, pero la población **A1** en general tiene un crecimiento positivo o es estable cuando se evalúa tomando en cuanta la variación temporal. La linea horizontal representa el crecimiento poblacional de 1, si el crecimiento poblacional es mayor de 1 la población crece, si es menor de 1 la población decrece. En el análisis temporal vemos que el intervalo de confianza solapa el 1, sugiere que no hay evidencia que el crecimiento poblacional es diferente de estable.



```{r sim18}


 
  ggplot(Tabla_resultado, aes(x=tipo, y=valor))+
  geom_point(stat="identity", fill="blue")+
  geom_errorbar(aes(ymin=CI_inf, ymax=CI_sup), width=.2)+
  theme_minimal()+
  geom_hline(yintercept=1, linetype="dashed", color = "red")+
  labs(title="Comparación de crecimiento poblacional de *Serapia cordigera*",
       x="Tipo de variación", y="Crecimiento poblacional")+
  theme(title = element_markdown())
```



## Estocasticidad demográfica


En esta sección vemos el efecto del tamaño de muestra sobre los parámetros de la matriz de transición.

Este método usa un acercamiento Bayesiano y una distribución de probabilidad beta para estimar los parámetros de la matriz de transición conocida como la distribución Dirichlet múltiples para grupos discretos. Primero vemos a que se refiere un análisis Bayesiano y la función Dirichlet. A lo que corresponde al presenta análisis Bayesiano, incluimos una previa al análisis, en otra palabra, se usa información previa para incluirlos en los cálculos para estimar los parámetros, se llaman los estimados posteriores.  En nuestro caso haremos una previa con poco peso, en otra palabra, no influirá mucho (o casi nada) en los resultados. El concepto de previa es importante en el análisis Bayesiano, es inherente a la filosofía de la estadística Bayesiana. Se asume que información anterior al estudio ayuda a tomar decisión en los cálculos los datos actuales. Como biólogos, siempre tenemos información previa, por ejemplo, sabemos que la probabilidad de que un individuo muera no es cero, aunque esto es evidente es una información adquirido por nuestra experiencia previa. Ahora cual es la probabilidad exacta de la muerte de un individuo, eso es lo que se estima en el análisis Bayesiano tomando en cuanta tanto la información previa y la información recolectado de un estudio. 

La función Dirichlet es una expansión de una función bien básica de probabilidad, usando una distribución beta. La función beta es una distribución de probabilidad continua en el intervalo de [0,1] y se usa para modelar la probabilidad de un evento binario. La función Dirichlet es una generalización de la función beta y se usa para modelar la probabilidad de un evento multinomial (múltiples grupos) donde la suma de cada probabilidades es igual a 1 y las probabilidades tienen que estar dentro del intervalo de [0,1]. En otra palabra no puede haber valores menores de 0 o mayores de 1, incluyendo la suma de estos.  

Comenzamos con lo más básico, probabilidades de dos grupos. Consideramos un grupo de 10 individuos, si 6 de estos individuos sobreviven, cual es la proporción que no sobreviven. La probabilidad de sobrevivir es $p=6/10$, entonces la probabilidad de no sobre vivir $\hat{p}=1-p$, porque siempre la suma de $p + \hat{p}= 1$.

Si tenemos tres grupos, digamos, plántulas que se quedan como plántula, que crecen a juveniles o que mueren. En este caso tenemos tres grupos (multinomial) y la probabilidad de que un individuo de las proporciones tiene que sumar a 1. En este caso la probabilidad de que un individuo se queda como plántula es $p_1=0.5$, la probabilidad de que un individuo crece a juvenil es $p_2=0.3$ y la probabilidad de que un individuo muere es $p_3=0.2$. La suma de estas probabilidades tiene que ser igual a 1, en otra palabra $p_1 + p_2 + p_3 = 1$.

La otra ventaja de usar la función Dirichlet es que se basa en la distribución beta. Este es una distribución donde tanto los parámetros como el promedio, y los intervalo de confianza son limitado a 0 y 1. Otra manera de decir lo mismo es que no se puede tener intervalos de confianza menos 0 o mayor de 1.  Hagan el ejercicio mental de tratar de entender un intervalo de confianza con una probabilidad de -0.10. Nota que si uno usa una distribución normal, los intervalos de confianza pueden ser negativos o mayores de 1, lo que no tiene sentido en el contexto de probabilidad. De allí viene la ventaja de usar la distribución beta para calcular los parámetros y tener claro cual distribuciones se usa para estimar los parametros. 




```{r sim19}
library(popbio)
n <- c(2, 0, 4, 99) # población inicial por etapa
names(n) <- c("latente", "plantula", "rosetta", "con flor")
Serapia_A3   <- splitA(Serapia$A3) # simulación solamente la matriz A1 de la lista de matriz


```

En el siguiente paso vamos a asignar una previa a los datos. Estas previas proviene de Tremblay, no representa la visión de los autores del articulo. Se añade una previa también para la proporción de plantas que fallece en cada etapa (la quita fila). Nota que es importante que la suma de cada columna sea igual a 1. Típicamente uno debería tratar de obtener la previa de la literatura, pero en este caso no se tiene información previa. 


```{r sim20}
RLT_Serapia_previa <- matrix(c(0.5, 0.1,   0.4,   0.4,
                        0.2,  0.,    0.0,   0.0,
                        0.0,  0.025, 0.25,  0.3,
                        0.15,  0.05,  0.25,  0.2,
                        0.05,  0.025, 0.1,   0.1), 
                     byrow = TRUE, nrow = 5, ncol = 4)


```


```{r sim21}
library(raretrans)

```


### Obtener los inertvalos de confianza (IC) para entradas de matriz individuales

La distribución posterior marginal de un elemento en un multinomio es una
distribución beta, y usamos esto para obtener intervalos creíbles en nuestro
tasas de transición. Podemos usar el tipo de retorno TN para obtener los parámetros de el multinomio deseado.

Nota que: 

 -TF tiene que ser una matriz divido entre la transición y de fecundidad (matT + matF),
 - N es el tamaño de muestra de cada etapa de la vida,
 - P es la previa de la matriz de transición,
 - priorweight es el peso de la previo (en este caso estamod dando muy poca importancia a la previa, como si fuese una décima de un individuo), lo que resulta en que los datos del campo domina el análisis.
 - Regresa el análisis posterior de la matriz de transición.
 
En el script vemos los intervalos de confianza de la matriz de transición de *Serapia cordigera* en 1999 para la población A3. 

Lo más dramático de ese primer análisis que que los intervalos de credibilidad son bien grandes, casi todos los intervalos de credibilidad **lcl** y **ucl** an de muy cerca de cero a valores muy grande. Esto sugiere que hay mucha incertidumbre en los datos. Este resultado es esperado, porque la muestra es muy pequeña, solamente 2 individuos fueron muestreado en el campo de esta etapa. 




```{r sim22} 
TN <- fill_transitions(Serapia_A3, N=n, P = RLT_Serapia_previa, priorweight = .01, returnType = "TN")
a <- TN[,1] # cambie 1 a 2, 3 etc para obter la distribución beta marginal de cada columna. 
b <- sum(TN[,1]) - TN[,1]# cambie 1 a 2, 3 etc para obter la distribución beta marginal de cada columna. 
p <- a / (a + b)
lcl <- qbeta(0.025, a, b)
ucl <- qbeta(0.975, a, b)
A3=knitr::kable(sprintf("%.3f, %.3f, %.3f", p, lcl, ucl))

A3df_lat=round(data.frame(p, lcl, ucl), digits=3)
A3df_lat

```


Ahora vemos que pasa con la etapa que tenemos más datos, los adultos con flores. En este caso vemos que los intervalos de credibilidad son más pequeños, pero todavía son grandes, ya que el tamaño de muestra es de 99 para esta etapa. 



```{r sim23}
TN <- fill_transitions(Serapia_A3, N=n, P = RLT_Serapia_previa, priorweight = 0.01, returnType = "TN")
a <- TN[,4] # cambie 1 a 2, 3 etc para obter la distribución beta marginal de cada columna. 
b <- sum(TN[,4]) - TN[,4]# cambie 1 a 2, 3 etc para obter la distribución beta marginal de cada columna. 
p <- a / (a + b)
lcl <- qbeta(0.025, a, b)
ucl <- qbeta(0.975, a, b)
 A3=knitr::kable(sprintf("%.3f, %.3f, %.3f", p, lcl, ucl))

A3df=round(data.frame(p, lcl, ucl), digits=3)

A3df
```


Como ejercicio, vemos que tipo de intervalos si tuviesemos tamaño de muestra de 500 individuos en la etapa de adulto. Nota que aun que los intervalos de credibilidad son más pequeños, no se debería asumir que no hay variación demográfica en la etapa de adulto, por procesos estocasticos.


```{r sim24}

n500 <- c(2, 0, 4, 500) # población inicial por etapa
TN <- fill_transitions(Serapia_A3, N=n500, P = RLT_Serapia_previa, priorweight = 0.01, returnType = "TN")
a500 <- TN[,4] # cambie 1 a 2, 3 o 4 ect. para obtener la distribución beta marginal de cada columna (etapas). 
b500 <- sum(TN[,4]) - TN[,4]# cambie 1 a 2, 3 ect. para obtener la distribución beta marginal de cada columna. 
p500 <- a500 / (a500 + b500)
lcl <- qbeta(0.025, a500, b500)
ucl <- qbeta(0.975, a500, b500)
 A3=knitr::kable(sprintf("%.3f, %.3f, %.3f", p, lcl, ucl))

A3df=round(data.frame(p, lcl, ucl), digits=3)

A3df
```


Ahora vemos como se distribuye una distribución beta. 

Usamos los datos de la etapa de adulto con flores con 99 individuos. Ninguna de la transiciones o estasis tiene una distribución normal.  La distribución que demuestra bien este patrón son los adultos con flores que pasan a latente. La linea reja vertical representa el promedio, o sea el valor en la matriz de transición. 



```{r sim25, warning=FALSE}

a # los valores del shape alpha 
b # los valores del shape beta

# Función para visualizar la distribution beta
plot_beta <- function(alpha, beta) {
  x <- seq(0, 1, length.out = 100)
  y <- dbeta(x, alpha, beta)
  data <- data.frame(x = x, y = y)
  ggplot(data, aes(x, y)) +
    geom_line()
}

# Distirbuciones beta
Latentes=plot_beta(0.396, 99.594)+
  xlim(0, .1)+
    labs(title = paste("Distribución de latentes \n (alpha =", 0.396, ", beta =", 99.594, ")"),
         x = "Probabilidad", y = "Densidad")+
    theme(text = element_text(size = 6))+
  geom_vline(xintercept = 0.004, linetype = "dashed", color = "red")

Plantulas=plot_beta(0.000, 99.990)+
  xlim(0, .025)+ylim(0, .05)+
    labs(title = paste("Distribución de plántulas \n (alpha =", 0.000, ", beta =", 99.90, ")"),
         x = "probabilidad", y = "Densidad")+
    theme(text = element_text(size = 6))+
  geom_vline(xintercept = 0.000, linetype = "dashed", color = "red")

Rosetta=plot_beta(28.710, 71.280)+
  xlim(0, .5)+
    labs(title = paste("Distribución de rosettas \n (alpha =", 28.710, ", beta =", 71.280, ")"),
         x = "probabilidad", y = "Densidad")+
    theme(text = element_text(size = 6))+
  geom_vline(xintercept = 0.287, linetype = "dashed", color = "red")

Adultos=plot_beta(10.197, 89.793)+
  xlim(0, .27)+
    labs(title = paste("Distribución de Ind. con flores \n (alpha =", 10.197, ", beta =", 89.793, ")"),
         x = "probabilidad", y = "Densidad")+
    theme(text = element_text(size = 6))+
  geom_vline(xintercept = 0.102, linetype = "dashed", color = "red")

Fallecidos=plot_beta(60.687, 39.303)+
  xlim(.40, .8)+
    labs(title = paste("Distribución de fallecidos \n (alpha =", 60.687, ", beta =", 39.303, ")"),
         x = "probabilidad", y = "Densidad")+
    theme(text = element_text(size = 6))+
  geom_vline(xintercept = 0.607, linetype = "dashed", color = "red")



library(ggpubr)
ggarrange(Latentes, Plantulas, Rosetta, Adultos, Fallecidos, ncol=3, nrow=2)
```



***

## Ventaja de usar simulaciones

La primera ventaja de usar métodos de análisis por simulaciones es que se puede calcula intervalos de confianza. Si los intervalos de confianza de lambda solapa el uno (1) (si solapa el 0 para log(lambda)) entonces no hay evidencia de que el crecimiento poblacional es diferente de estable.

La segunda ventaja de usar simulaciones es que hay que recordar que los análisis están basado en datos limitados y que si hubiese más o menos datos para estimar los elementos de la matriz la parámetros de la matriz pudiese ser diferentes. Entonces hay un componente de incertidumbre en los estimados de los parámetros de la matriz, los valores de promedio no recolectan esa variación entre individuos, tiempo y espacio. 

La incertidumbre por causas intrínsicas (el individuos, genética, tamaño de muestra) y extrínsicas (hábitat, tiempo, variación en polinizadores, herbívoros, ect.) se evalúa usando análisis de variación espacial, temporal y demográficos. La incertidumbre en los parámetros de la matriz de transición se puede cuantificar con intervalos de confianza o el intervalo de credibilidad (concepto Bayesiano). Es de suma importancia que se evalué la incertidumbre en los parámetros de la matriz de transición para tener un mejor entendimiento de la variación en el crecimiento poblacional de una especies y saber si hay suficiente evidencia que la especies esta en declive, crece o no.






Fecha de actualización: 2024-09-30


<!--chapter:end:15-Metodos_de_simulaciones.Rmd-->

# El uso de matrices para estudios evolutivos 


Por: Roberto Salguero-Gómez






<!--chapter:end:16-Estudio_evolutivo.Rmd-->

# Historia breve de la dinámica poblacional en orquídeas.


### Familia de plantas evaluadas

La cantidad de estudios de demográfica usando PPM es bastante impresionante y incluye al momento de la publicación del libro 136 familias de plantas y 509 generos y 792 especies en la base de datos de COMPADRE (octubre 3, 2024).  La familia Orquidaceae (>50 especie) se encuentra en una de las familias donde hay más especies que han sido evaluado, después de Asteraceae (>65 especie) y Leguminaceae (> 55 especies), pero la gran mayoría de las familias tienen de 3 (mediana) o menos especies evaluada. En la tabla del Apéndice A se presentan los estudios de dinámica poblacional en orquídeas que usaron PPM y que están incluido en la base de COMPADRE. Se incluye en la table algunas de las preguntas o conceptos principales que los autores evaluarón. En la gran mayoría de los trabajos se considera múltiples hipótesis/ideas sobre la dinámica poblacional de las orquídeas. Para información especifica sobre la metodología usada en cada estudio se recomienda revisar los trabajos originales. 


### Los primeros estudios con Orquídeas

En esta sección se hará una revisión breve de los estudios de dinámica poblacional en orquídeas que usaron PPM. Se presentarán algunos de estudios en orden cronológico y se resumirán las preguntas principales que los autores intentaron responder. 

Uno de los primeros esfuerzos de integrar y unir estudios de demografía en orquídeas fue el libro *Population Ecology of Terrestrial Orchids* editado por Wells y Willems [@wells1991population]. Ese libro es el resultado de una reunión de especialistas en orquídeas en 1990 en South Limburg, Holanda. En el libro se presentan estudios de demografía de orquídeas de diferentes partes de Europa, Norte América y Australia se discuten los métodos y resultados de los estudios. Los temas principales de los artículos incluye la dinámica de poblaciones y el manejo,  la dinámica de producción de flores y frutos, la fenología del crecimiento y la partición de recursos a las diferentes partes de la planta y la dinámica de población usando matrices.  En esta ultima sección Katherine Gregg presenta la variación en la dinámica de cuatro poblaciones de *Cleistes divaricata* [@gregg1991variation] distribuido entre West Virginia, Florida y North Carolina, USA. En ese trabajo se enseña claramente el problema de estimar latencia (dormancy) y la variación entre población de los parámetros del ciclo de vida. La latencia es un tema recurrente en los estudios de orquídeas y en general en estudios de demografía de plantas perennes. En el trabajo de Waite y Hutchings presentan sus estudios de *Ophrys sphegodes* donde evalúan el impacto de herbivoría por vacas y ovejas del ambiente rodeando la orquídea en la dinámica de la población [@waite1991effects]. Los autores señala que es importante tomar en cuanta el momento donde ocurre la herbivoría en las localidades donde se encuentre la orquídea, ya que impacta el crecimiento de la *O. sphegodes* de forma diferencial, en adición que la hervivoría de las plantas competidores a la orquídea consumido por vacas no es suficiente para reducir la competencia y reduce la viabilidad de la orquídea al comparar con herbivoría por oveja.   El libro es una buena introducción a los estudios de demografía de orquídeas y a los problemas que se enfrentan en esos estudios.

En una reunión posterior a la de Holanda, hubo otra en Ceske Budejocive, República Checa en 2001 que también resulto en un libro editado por Kindlmann, Willems and Whigham [@kindlmann2002trends]. El libro esta dividido en cuatro secciones, la demográfica y dinámica de poblaciones, la biología de florecer y producción de frutos, miccoriza y germinación de semillas y el manejo y conservación.  Solamente un trabajo usa PPM para los análisis evaluando la dinámica de *Orchis usulata* en Estonia [@tali2002dynamics].  Los trabajos en este libro no usaron PPM pero se observa múltiples avances en conceptos y metodología para ampliar el estudio de la dinámica poblacional de orquídeas, específicamente la importancia de la micorriza en la germinación de semillas. 

Estos dos libros se enfocan en especies terrestres y ninguno tiene ejemplos de especies tropicales y epifitas. El primer trabajo con especies epifitas es de [@hernandez1992dinamica] con *Laelia speciosa* evaluando el impacto de cosecha sobre el potencial de supervivencia. En este trabajo de tesis de pre-grado se evalúa el impacto de la cosecha de flores en la dinámica de la población de *L. speciosa* en México.  Hasta el momento no hay un libro o un conjunto de publicaciones en el mismo volumen que es similar a los dos libros mencionados anteriormente que se enfoque en orquídeas epifitas o tropicales.


### Latencia en Orquídeas

El problema de latencia y estimar los parámetros relevante a esa etapa del ciclo de vida de la matriz de transición es un tema recurrente en los estudios de orquídeas terrestres. No es claro si la latencia es algo común en la mayoría de las orquídeas terrestres o si es un componente de la historia de vida que esta mayormente limitado a cierta área geográfica o grupos taxonómicos. De los xx estudios de orquídeas que usaron PPM, xx mencionan el problema de latencia en la estimación de los parámetros y xx son estudios dedicados exclusivamente a estimar latencia o considerar métodos alternos para calcular los parámetros.  Por que es tan importante estimar la etapa de latencia?  La dificultad es realmente determinar la supervivencia de los individuos, si los individuos pueden estar latentes por varios años, entonces la supervivencia de los individuos no es observada y por lo tanto no se puede estimar.  La latencia es un problema en la mayoría de las plantas perennes.  

### Métodos alternos para estimar la latencia incluye 

Un de los científicos que ha dedicado mucho de su carrera en considerar la latencia es Richard P. Shefferson que ha desarrollado múltiples métodos para incluir la latencia en la dinámica de las especies [@shefferson2001estimating, @shefferson2002dormancy,@shefferson2007dormancy, @shefferson2017predicting]. Shefferson ha demostrado que hay un costo a la latencia [@shefferson2012linking] y que individuos que son latente múltiples años tienen una probabilidad de sobrevivir menor que individuos que no son latentes.  

Kery y Gregg [@kery2004demographic] presentan un otro método para estimar la latencia en orquídeas terrestres.  Ellos usan un modelo de supervivencia para estimar la latencia en *Cleistes divaricata* en West Virginia, USA.  **EXPANDIR**.


Tremblay et al. [@tremblay2009dormancy] evaluaron la latencia en 9 especies de *Caladenia* con diferentes cantidad de individuos muestreados y años de datos usando un acercamiento bayesiano.  Encontraron que la latencia en el genero *Caladenia* se modela mejor cuando se asume que cada especies tiene su propria supervivencia y probabilidad de emerger entre años.  Uno habría asumido que como todas las especies son del mismo genero, la latencia seria más similar entre especies. Pero los autores encontraron que la latencia varia entre especies y que la latencia es variable entre especies. Claramente si esto se confirma en otros géneros de orquídeas, la latencia es un problema que se tiene que considerar individualmente por cada especie y que especies del mismo genero no necesariamente se comportan de forma igual. La ventaja de usar un acercamiento bayesiano es que se puede estimar la latencia y la supervivencia de múltiples especies simultáneamente aprovechando de la información de todas las especies para estimar los parámetros. En muchas ocasiones los estudios de orquídeas se enfocan en una sola especie y no se considera la variación entre especies ademas el tamaño de muestra de una especie en particular puede ser limitado y no se puede estimar la latencia de forma confiable. 



### Perspectiva Histórica de la Dinámica Poblacional en Orquídeas

Los primeros trabajos de dinámica poblacional usando PPM fueron publicado en revista revisado por pares o en libros o tesis se enfocaron en orquídeas comienzan en los años 1990.  La lista de trabajos de orquídeas que usaron PPM incluye:

 - *Cleistes divaricata* [@gregg1991variation]
 - *Cypripedium acaule* [@cochran1992simple]
 - *Laelia speciosa* [@hernandez1992dinamica] tesis de pregrado
 - *Tolumnia variegata* [@calvo1993evolutionary]
 - *Platanthera praeclara* [@sieg1995influence]
 - *Lepanthes caritensis* [@tremblay1997lepanthes]
 - *Herminium monorchis* [@wells1998flowering]
 - *Himantoglossum hircinum* [@wells1998flowering; @carey1998modelling]
 
Es interesante que en estos primeros años hay 3 trabajos con especies tropicales de las 8 trabajos realizados. En general hay menos estudios de orquídeas tropicales (n= xx) que de especies de templadas (n= xx).  

La cantidad de publicaciones por autores varia mucho con la mayoría de los autores con solamente un articulo (tesis o capitulo) usando PPM con orquídeas.  Los autores con más de un articulo incluye a Tremblay, Raventos, Shefferson, González-Hernández, Gregg y Hutchings entre otros. Es importante notar muchos de los siguientes autores pueden haber publicado más trabajos con orquídeas pero no usaron PPM (estos no están contabilizados). 

Publicaciones de dinámica poblacionales sin el uso de PPM son múltiples y deberían ser considerados en una revisión mas amplia de la literatura.  Esos trabajos traen una perspectiva única y muchas veces innovadoras para tratar de entender los cambios en la cantidad de individuos en tiempos. Aqui veremos algunos de estos estudios que no usaron PPM.  

En el trabajo de Hutchings evaluando la dinámica de *Cephalanthera rubra* de 1979 a 2000 en Inglaterra, el autor encuentra que la población ha disminuido en 50% en 20 años [].  Hutchings describió el estado de las plantas basado si estén emergente, reproductiva o no, y la cantidad de hojas y flores producidas. El enseña el patrón de 7 individuos entre 1979 a 2000 y el estado de cada uno (Figura x).



Vanhecke [@vanhecke1991population] demuestra el cambio en de densidad en el tiempo y espacio en la especies *Dactylorhiza praetermissa* entre 1974 y 1985. ......



Willems y Bik [@willems1991population] siguen una población de *Orchis simia* por 22 años, desde 1968 a 1990, y contabilizan la cantidad de individuos en cada estado de desarrollo, categorizando estos como nuevas plantas, plantas fallecidas, con flores, latentes y la cantidad de plantas totales. .........

Haciendo una busqueda en Google Scholar para [Orchid "Population dynamics"] 

1940-1950 

 - Carl Olaf Tamm publica el primer articulo sobre dinámica de orquídea en *Botaniska Notisen* [@tamm1948observations]. Esta publicación tiene datos de *Orchis mascula* y *Orchis sambucina* entre otras especies de plantas en Suecia.  Vea el capitulo de Tamm para más información.

1950-1960 - ninguno

1960-1970 - ninguno

1970-1980 

 - Margaret Bradshaw [@bradshaw1978plant] hace un resumen de los valores de estudios de demografía incluyendo orquídeas y menciona los trabajos de Tamm  [@tamm1948observations, @tamm1972survival].
 
 - Carl Olaf Tamm [@tamm1972survival] revisito sus análisis de dinámica poblacional de *Dactylorhiza sambucina*, *D. incarnata*, *Orchis mascula* y *Listera ovata*. Estos muestreos fueron comenzando en en los años 1940, y publicado por la primera vez en 1948 [@tamm1948observations]. Vea el capitulo sobre Tamm para más información.


1980-1990 

  - Loyal A. Mehrhoff [@mehrhoff1989dynamics] evaluó la la dinámica de *Isotria medeoloides* en cinco poblaciones en Georgia (n=2), North Carolina (n=2), y South Carolina (n=1), USA por seis años consecutivos.  El autor encontró que la supervivencia de las plantas varia entre poblaciones y que la supervivencia de las plantas en la poblaciones no tienden a persistir. Tres de las cinco poblaciones había desaparecido o reducido dramáticamente en el periodo de seis años.
  
  - Clare Alexander [@alexander1984seasonal] comparó el patrón de fenología de número de rosetta y supervivencia en *Goodyera repens* en tres poblaciones en Inglaterra en dos años. Los autores evaluaron la longevidad de las rosettas de los individuos y estimaron que el promedio es de 4.3 ± 1.1 años. En adición encontraron que la supervivencia de las rosettas varia basado en la densidad, y que mayor la densidad menor la longevidad de estos individuos.   Este trabajo pudiese ser el primero que apoya la idea que la densidad en orquídea influencia la supervivencia de los individuos.
  
  
 - Micheal J. Hutchings [@hutchings1987population] evaluó el efecto del tiempo desde la primera vez que una planta emerge y su probabilidad de florecer en *Orphys sphegodes* en Inglaterra.  Demostró que las plantas con mayor edad (tiempo de primera avistamiento) florecen más y se acerca 100% cuando no son latente. Al contrario parece que las plantas de mayor edades (8 años o más) demuestra una reducción en sus la altura de la inflorescencia, número de hojas y cantidades de flores. En adición demostró que las plantas que son más robusta en termino de un mayor promedio de flores por año están correlacionado con el largo de vida (lifespan). 



 -  Katherine Gregg [@gregg1989reproductive]















           
```{r Hist_1, message=FALSE, warning=FALSE, echo=FALSE, eval=FALSE}
library(Rcompadre) # Paquete para trabajar con la base de datos de COMPADRE y COMADRE
library(tidyverse) # Paquete para activar multiples paquetes
library(gt) # Paquete para formatear tablas
library(kableExtra) # Paquete para formatear tablas
```


```{r Hist_2, message=FALSE, warning=FALSE, echo=FALSE, eval=FALSE}
compadre <- cdb_fetch("compadre") # Usar este código para bajar los datos del repositorio de COMPADRE. Tiene que haber activado la librería de Rcompadre.



```



Number of studies using PPM by family


```{r Hist3, message=FALSE, warning=FALSE, echo=FALSE, eval=FALSE}
compadre %>% n_distinct("Family")

Genera=(as.data.frame(sort(unique(compadre$Genus))))

Genera
  

as.data.frame(sort(unique(compadre$SpeciesAccepted)))


# filter(Family %in% c("Orchidaceae")) 


```


```{r Hist4, message=FALSE, warning=FALSE, echo=FALSE, eval=FALSE}
SPECIES_Number=compadre%>% select(Family, StudyStart, StudyEnd, SpeciesAccepted, YearPublication, Authors, DOI_ISBN, OrganismType, MatrixPopulation, mat) %>% 
  group_by(Family) %>% 
  summarize(n_species = length(unique(SpeciesAccepted))) %>% 
  arrange(desc(n_species))



summary(SPECIES_Number)
```


Oct 1, 2024

<!--chapter:end:17_Historia_breve.Rmd-->

# Carl Olaf Tamm


```{r, OCTamm_1, eval= T, echo=FALSE, message=F}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(janitor, tidyverse, devtools, popbio, knitr, gt)

library(tidyverse)
library(janitor)
library(popbio)
library(knitr)
library(gt)

# Mi tema de formato de las gráficas de ggplot2 personal
rlt_theme <- theme(axis.title.y = element_text(colour="grey20",size=15,face="bold"),
        axis.text.x = element_text(colour="grey20",size=15, face="bold"),
        axis.text.y = element_text(colour="grey20",size=15,face="bold"),  
        axis.title.x = element_text(colour="grey20",size=15,face="bold"))
```


## Quien es Carl Olaf Tamm?

Carl Olaf Tamm (1919-2007) fue un biólogo Sueco y profesor de botánica y suelos de la escuela de "Soil Science at the Royal College of Forestry" (1957-1962) en Estocolmo y el primer profesor de **ecología de bosques** de dicha universidad (1962). Su carrera académica se desarrolló en la Universidad de Estocolmo, donde fue profesor de ecología de bosques desde 1957 hasta 1985. Los trabajos de Tamm son reconocidos por trabajos a largo plazo, de múltiples años y décadas, enfatizando la importancia de la variabilidad temporal en los ecosistemas. 

Tamm desarrollado protocolos de muestreos de plantas y suelos en bosques, donde la recolección de datos era anuales y continuos. Algunos de estos trabajos son ahora conocidos como clásicos en ecología de poblaciones y comunidades. Tres de estos trabajos relevante a la dinamica poblacional incluye: 

 - Observation on reproduction and survival of some perrenial herbs [@tamm1948observations].
 - Further observations on the survival and flowering of some perennial herbs, I [@tamm1956further].
 - Survival and flowering of some perennial herbs. II. The behaviour of some orchids on permanent plots [@tamm1972survival].
 
 En la descripción de la dinámica de los individuos muestreado a través del tiempo Tamm incluyo la variabilidad temporal en la reproducción y supervivencia de las plantas, basado en su presencia o ausencia, si eran reproductivo o no, reclutamiento y individuos que se clonan en adición de si las plantas eran latentes. El utilizo un sistema de presentación de la dinámica de los individuos usando una linea por individuo y identificando en que etapa estuviese en cada año.

*** 
Representación de los datos de Tamm

Los datos de Tamm fueron compartido de forma visual usando gráficos. En la figura cada linea vertical representa un individuo

  - linea gruesa, individuo reproductivo
  - linea fina, individuo vegetativo
  - linea entrecortada: individuo no muestreado
  - linea bifurcada: individuo que se clonan
  
  
  
  WRONG FIGURE; use Fig. 1 D. incarnata from Tamm 1972 
```{r, OCTamm_2, echo=FALSE, out.width="50%", fig.cap="Tamm: 1972, Orchis mascula"}
knitr::include_graphics("Figures/Tamm_1972_Orchis_mascula.jpg")
```
 


En la publicación de 1972, Tamm describe la dinámica de múltiples especies de orquideas, y alguna especies en múltiples sitios.

```{r, OCTamm_3, echo=FALSE, message=FALSE}
library(tidyverse)
library(gt)
 Tamm=tribble(~Especies, ~"Núm de la Población", ~"Año del primer muestreo", ~"Año del último muestreo",
              "Dactylorhiza incarnata", 46, 1944, 1971,
              "Dactylorhiza sambucina", 17, 1942, 1971,
              "Dactylorhiza sambucina", 18, 1943, 1964,
              "Dactylorhiza sambucina", 19, 1943, 1957,
              "Dactylorhiza sambucina", 20, 1943, 1957,
              "Dactylorhiza sambucina", 21, 1943, 1957,
              "Dactylorhiza sambucina", 22, 1943, 1957,
              "Orchis mascula", 24, 1943, 1956,
              "Listera ovata", 48, 1944, 1971)

gt(Tamm)
```

***

Tamm creo en el campo parcela de 0.5m x 0.5m o de 1.0m x 1.0m y muestreo todos los individuos en la parcela en años consecutivos (las lineas entrecortada son años no muestreados). Tamm estaba interesado en la dinámica de las orquídeas porque había notado que los individuos no florecen todo los años, y que la floración era un evento raro. Por ejemplo que en *Orchis sambucina* (ahora *Dactylorhiza sambucina*) nota que en 1942 solamente 7 plantas florecieron y que en 1945 había 40 con flores [@tamm1948observations]. Tamm sugiere que la poca cantidad de nuevos individuos pudiese ser correlacionado con la competencia para recursos (nutrientes, luz y agua) y que la capacidad de las plantas de sobrevivir eventos difíciles en parte esta correlacionado con la plantas de mayor edad que pudiese tener una menor probabildad de supervivencia [@tamm1948observations]. 

En la publicación de 1972, Tamm describe la dinámica de cuatro especies orquídea. Esta información no esta disponible en COMPADRE al momento. En *Dactylorhiza incarnata* observa que múltiples individuos desaparece de un año a otro, que después de 1951 la población es mayormente vegetativa (sin flores).  Usando las figuras Tamm trato de ver si había un patrón en la dinámica basado en el cambio de la comunidades, por ejemplo la presencia de un árbol de pino que se estableció cerca de la población de *D. sambucina*. La población de *D. sambucina* disminuyo un poco entre 1942 a 1963, pero fue balanceado por el reclutamiento de la misma cantidad de individuos en el mismo periodo. Después de revisar sus datos Tamm sugiere que lo que parece ser individuos nuevos por clonaje pudiese ser realmente de nuevos individuos independiente, solamente muy cerca de un individuo establecido anteriormente.  La dificultad de muestrear con confianza los individuos en su ambiente es un reto en la interpretación de los datos de plantas pereniales.
 
En *Orchis mascula*, Tamm observa claramente que la plantas florecen de forma irregular, y que parece tener patrones entre años, que algunos años favorecen la presencia de inflorescencias y otros años no.  En *Listera ovata*, Tamm observa que la población crece, y que hay mucho reclutamiento entre 1944 y 1971, con un incremento de individuos de más de 200% comparando al primer año de muestreo.

En adición el demuestra que hay individuos que pueden vivir por muchos años. La edad de algunos individuos de los que muestreo es de 30 años para *D. sambucina*, 28 años para *L. ovata*, 25 años *D. incarnata* y 14 años para *O. mascula*.

Tamm fue un pionero en la ecología de poblaciones y comunidades, y sus trabajos son reconocidos por su enfoque en la variabilidad temporal en los ecosistemas. 


***

## Re-evaluación de los datos de Tamm


En la próxima sección se estará re-evaluando los datos de Tamm con métodos recientes.  

Primero se estará digitalizando los datos, seguido de construcción de matriz siguiendo de análisis de viabilidad de poblaciones y otras métricas de dinámica de poblaciones. 


## Instalación de raretrans #2

Para instalar **raretrans** remover el **#** antes de correr el script para tener acceso a los códigos de **raretrans**. 

```{r OCTamm_4}
#library(devtools)

#devtools::install_github("atyre2/raretrans", build = TRUE, build_opts = c("--no-resave-data", "--no-manual"))

library(raretrans)


```



Subir los datos de Tamm

Se puede tener acceso a los datos de Tamm en el archivo "Tamm_1972.xlsx" en la carpeta "data" en Github.

Estos datos estan limitado a la especie de *Dactylorhiza incarnata* y se tiene información de los 35 individuos monitoreado en los años 1944 hasta 1971.

```{r OCTamm_5}
library(readxl)
Tamm_1972_column <- read_excel("data/Tamm_1972.xlsx", 
    sheet = "D_incarnata_by_column")

Tamm_1972_column %>% head()
```



El primer paso es encontrar la matriz de valores *prior* para añadir al modelo de construcción de los parámetros de la matriz.  Como no puedo discutir de estos valores con Tamm, use valores de la literatura. Hay dos especies de *Dactylorhiza* con matrices en COMPADRE, usando la que más se parece a los datos de los datos de Tamm, se uso como valores **prior** los de *Dacylorhiza lapponica* [@sletvold2010long].  Se modifico la matriz porque podemos solamente determinar si un individuo falleció después de ser latente. Entonces la suma de probabilidades de vegetativo y reproductivo suman a 1.0 y los latentes no suma a 1.0 (la diferencia es los fallecidos). 



```{r OCTamm_6}
Dacty_apriori=matrix(c(0.637, 0.571, 0.740,
                       0.273, 0.271, 0.049,
                       0.090, 0.158, 0.059,
                       0,     0,     0.152),  nrow = 4, ncol = 3, byrow=TRUE) # la última fila es la proporción de individuos en esta etapa que fallece. 

Dacty_apriori


```


## Construcción de la matriz de transición

- Las etapas en el modelo son Vegetativo (sin flores), Floreciendo (con flores), y Latente (no avistamiento en un año particular) más los fallecidos. 
- La matriz de transiciones es una matriz de 3x3, donde las filas son las etapas actuales (tiempo t) y las columnas son las etapas futuras (tiempo t+1).

- Supuestos:
   - que los individuos no pueden ser latentes más de dos años consecutivos. Todo individuo que no es visto después de dos años es considerado fallecido.  Ese supuesto proviene de haber evaluado la figura de Tamm y ver que no hay individuos que no son vistos después de dos años consecutivos de ser latentes.
   - un individuo fallecido no puede regresar en un estado en el futuro.


```{r OCTamm_7}

Tmat_D <- Tamm_1972_column %>% 
  dplyr::select(Year, stage, next_stage, Fertility) %>% 
  mutate(stage = factor(stage, levels=c("V","F","D","m")),
         fate = factor(next_stage, levels=c("V","F","D","m"))) %>%
  drop_na(stage, fate) %>%
  as.data.frame() %>% 
  xtabs(~fate + stage, data = .) %>% 
  as.matrix() 

Tmat_D # se contabiliza la cantidad de individuos que pasan de una etapa a otra.

Tmat2 <- Tmat_D[,-4] # remover la columna para transiciones de la muerte (es imposible pasar de fallecido a otra etapas)
Tmat2

N2_D <- colSums(Tmat2) # obtener el número total de una etapa.
N2_D
Tmat <- sweep(Tmat2[-4,], 2, N2_D, "/") # normalizar las transiciones, nota que el "2" es para decir que haga los cálculos por columna
Tmat # la matriz de transiciones normalizada con los datos del campo
```

***

## Constucción de la matriz de fertilidad


Para tomar en cuanta la fecundidad, se necesita una matriz de fertilidad. En este caso los datos son muy limitados, tenemos solamente la cantidad de individuos que florecieron en 1944.  Para simplificar, se asume que la cantidad de individuos que florecieron en 1944 (n=5), 1948 (n=1), 1949 (n=2) y 1951 (n=1) es la cantidad de semillas que producen. Solamente el individuo #5 se reprodujo dos veces.  Asumimos que todos los nuevos individuos en la población provienen de estos individuos floreciendo y que ningún reclutamiento proviene de fuentes externas, entonces la matriz de fertilidad es la siguiente. De 9 individuos florecidos tenemos 15 individuos nuevos entre 1949 a 1967. Nota aquí que no es la cantidad de semillas producidas, por que no tenemos la información de cual es la cantidad de semillas que germinan y se establecen. Lo que tenemos es la cantidad de individuos que florecen y por consecuencia producen nuevos individuos vegetativo. El calculo es 15 individuos nuevos por 9 individuos florecidos = 1.66667 individuos nuevos por individuo florecido. El otro supuesto es que las semillas pueden ser latentes por múltiples años, o se puede que germinan pero no producen individuos vegetativo o con flores inmediatamente, entonces un periodo de latencia después de germinar (esa etapa no esta en el modelo). 



```{r OCTamm_8}

Fmat <- matrix(0, nrow=3, ncol=3) # crear una matriz de ceros. 
Fmat[1,2] <- 15/9 # contar 9 adultos reproductivos en el tiempo t y 15 nuevos individuos en el tiempo t+1 en la población. 
TF2 <- list(Tmat = Tmat, Fmat = Fmat)
TF2
```

***

¿Como se ve el ciclo de vida de esa especie en esto años? 



```{r OCTamm_9, echo=FALSE, message=FALSE, warning=FALSE}
library(Rage)
library(DiagrammeR)


matA=TF2$Tmat+TF2$Fmat

etapas <- c("Vegetativo", "Florecido", "Latente")
title <- NULL
graph <- expand.grid(to = etapas, from = etapas)
graph$trans <- round(c(matA), 3)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", etapas, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 3
graph$col <- c(
  "red2", "PaleGreen4", "PaleGreen4",
  "goldenrod1", "PaleGreen4",
  "PaleGreen4", "red2"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 8,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 


```



Ahora usamos la información las matrices de transiciones, fertilidades y sus valores de prior para calcular los parámetros de la especie

Comparan la matriz original con los valores de la matriz posterior, usando la función "priorweight" uno puede reducir la confianza que uno tiene sobre los valores prior. Nota que como estos valores provienen de otra especies es buen idea reducir la confianza que uno tiene sobre estos valores en los análisis usando un priorweight pequeño. 
El valor de 0.01, es que se usa 1% de los valores prior y 99% de los valores del campo. Por consecuencia domina los valores del campo. 

. 
```{r OCTamm_10}

TF2$Tmat

TF3=fill_transitions(TF2, N2_D, P = Dacty_apriori, priorweight = .1)

TF3 # la matriz de transiciones posterior
```

Como esperado la población de *Dactylorhiza incarnata* disminuye en el tiempo y el indice de crecimiento es menor que 1.0. 


```{r OCTamm_11}
popbio::lambda(TF3)


```


## Simulando el crecimiento poblacional 


Simulado los matriz, el tamaño de muestra (N2_d), las matriz de los valores del campo (TF2), la matriz de los valores prior (Dacty_apriori), el peso de los valores prior (priorweight), los prior de fertilidad y el número de simulaciones (samples = 5000). Con esta simulación podemos calcular el intervalo de confianza del crecimiento poblacional de *Dactylorhiza incarnata* muestreado por Tamm desde 1944 a 1971.  

las matrices alpha2 y beta2, representan los parámetros de la distribución gamma con media alpha/beta.  En este caso se usan valores muy pequeños para los valores alpha y beta, para que la distribución gamma sea informativa (non-informative priors) y que los valores de lambda sean muy dispersos. En otra palabra no ponemos peso en los valores prior de la fertilidad, y dejamos que los valores del campo dominan los análisis.  



```{r OCTamm_12, eval=TRUE, echo=TRUE}
library(popbio)

alpha2 <- matrix(c(NA_real_, 1e-5, NA_real_,
                   NA_real_, NA_real_, NA_real_,
                   NA_real_, NA_real_, NA_real_), nrow=3, ncol = 3, byrow = TRUE) # la matriz de los valores alpha
beta2 <- matrix(c( NA_real_, 1e-5, NA_real_,
                   NA_real_, NA_real_, NA_real_,
                   NA_real_, NA_real_, NA_real_), nrow=3, ncol = 3, byrow = TRUE) # la matriz de los valores beta
```

```{r OCTamm_11b, eval=TRUE, echo=TRUE}

Dacty_0.1 <- sim_transitions(TF2, N2_D, P = Dacty_apriori, alpha = alpha2, beta = beta2,
                priorweight = 0.1, samples = 5000) # generar 5000 matrices basado en las previas de transiciones y de fertilidades, el tamaño de muestra, en adición de los datos


```






```{r OCTamm_13, eval=TRUE, echo=TRUE}
Dacty_0.1b <- tibble(lposterior = map_dbl(Dacty_0.1, lambda))

```


## Visualización de las distribuciones de los lambda

```{r OCTamm_14}
ggplot(data = Dacty_0.1b,
     mapping = aes(x = lposterior)) + 
  geom_histogram(binwidth = 0.01, colour="white") + 
  rlt_theme+ geom_vline(xintercept = 1, 
                color = "blue", size=1.5)
```

***


Para concluir, la población de *Dactylorhiza incarnata* muestreado por Tamm desde 1944 a 1971 tiene un crecimiento poblacional menor que 1.0 (lambda promedio de 0.82), con un intervalo de confianza de 0.76 a 0.87.  Esto indica que la población esta reduciendo en el tiempo por aproximadamente 18%.




```{r OCTamm_15, eval=T}
Dacty_0.1bdf=as.data.frame(Dacty_0.1b)
Dacty_0.1_summary <- dplyr::summarize(Dacty_0.1bdf,
                            medianL = median(lposterior),
                             meanL = mean(lposterior),
                             lcl = quantile(lposterior, probs = 0.025),
                             ucl = quantile(lposterior, probs = 0.975),
                             pincrease = sum(lposterior > 1.)/n()
                            )


```



```{r OCTamm_16, eval=T}
gt(signif(Dacty_0.1_summary, digits = 3))


```


Revisión RLT: Oct 7, 2024

Revisión RLT: Oct 8, 2024



```{r OCTamm_17, echo=FALSE, eval=FALSE}

D_incarnata_1 <- Tamm_1972 %>%   
 select("1944", "1948", "F_1944") |> 
  rename("stage" = "1944", "next_stage" = "1948") %>% 
  drop_na()


TF <- popbio::projection.matrix(as.data.frame(D_incarnata_1), 
                        stage = stage, fate = next_stage, 
                        fertility="F_1944", sort=c("V","F","D"), TF = TRUE)


N <- get_state_vector(D_incarnata_1, stage = stage, sort=c("V","F","D")) 
N = N %>% 
  replace_na(0) # Un vector de la cantidad de individuos iniciales para cada etapa, nota que la cantidad por etapa, "stage", son los individuos en el primer muestreo, si no hay se añade un cero


```



```{r, OCTamm_18, echo=F, eval=FALSE}


D_incarnata_1 <- Tamm_1972 %>%   
 select("1944", "1948") |> 
  rename("stage" = "1944", "fate" = "1948")



head(D_incarnata_1) # ahora tenemos solamente los años 1944 y 1948. 
# Crear TF = TRUE, añadir para formatear correctamente.
TF <- popbio::projection.matrix(as.data.frame(D_incarnata_1), 
                        stage = stage, fate = fate, 
                         sort=c("V","F"), TF = TRUE)
TF # Este es la estructura de etapas de vida para esa población en este tiempo.  Nota que tenemos dos matrices, una de transiciones **T** y otra de fertilidad **F**. 





```

```{r OCTamm_19, eval=FALSE, echo=FALSE}
D_incarnata_2 <- Tamm_1972 %>%   
 select("1948", "1949") |> 
  rename("stage" = "1948", "fate" = "1949")



head(D_incarnata_2) # ahora tenemos solamente los años 1944 y 1948. 
# Crear TF = TRUE, añadir para formatear correctamente.
TF <- popbio::projection.matrix(as.data.frame(D_incarnata_2), 
                        stage = stage, fate = fate, 
                        sort=c("V","F"), TF = TRUE)
TF # Este es la estructura de etapas de vida para esa población en este tiempo.  Nota que tenemos dos matrices, una de transiciones **T** y otra de fertilidad **F**. 
```


```{r OCTamm_20, echo=F, eval=FALSE}
D_incarnata_3 <- Tamm_1972 %>%   
 select("1949", "1950") |> 
  rename("stage" = "1949", "fate" = "1950")



head(D_incarnata_3) # ahora tenemos solamente los años 1949 y 1950. 
# Crear TF = TRUE, añadir para formatear corectamente.
TF <- popbio::projection.matrix(as.data.frame(D_incarnata_3), 
                        stage = stage, fate = fate, 
                        sort=c("V","F"), TF = TRUE)
TF # Este es la estructura de etapas de vida para esa población en este tiempo.  Nota que tenemos dos matrices, una de transiciones **T** y otra de fertilidad **F**. 
```

<!--chapter:end:18-Carl_Olaf_Tamm.Rmd-->

# Compadre_Orchid PPM y su uso


Raymond y Roberto



Uno de los esfuerzos más grandes en la ecología de poblaciones es la base de datos de COMPADRE y COMADRE. COMPADRE es una base de datos de matrices de transición de estados de poblaciones de plantas y COMADRE es una base de datos de matrices de transición de estados de poblaciones de animales. Estas bases de datos son una fuente de información para evaluar la dinámica de poblaciones de plantas y animales. En este capítulo se presenta una introducción a la base de datos de COMPADRE y algunas de las funciones en los paquetes de **Rcompadre** y **Rage**. La información aquí no sustituye la información provista en la página web de COMPADRE \<<https://compadre-db.org/>\> y los tutoriales que se encuentran en la siguiente página \<<https://compadre-db.org/Education>\>.


El valor de las bases de datos es tener en un mismo sitio una gran cantidad de información donde la información este organizado de la misma manera y accesible en adición a tener la información en un formato que se puede usar en análisis. En el caso de COMPADRE y COMADRE, la información esta organizada en matrices de transición de estados de poblaciones (MPM) que se pueden usar para evaluar la dinámica de poblaciones de plantas y animales y con múltiples variables, tal como sus coordinadas geográficas, el tipo de hábitat, la duración de los estudios, la fuente de la información, entre otros.

En este capitulo se aprende a utiliza la base de datos de COMPADRE para evaluar la dinámica de poblaciones de orquídeas. Se evalúa como extraer diferentes tipos de datos para responder a preguntas específicas. 


## Activar los siguiente paquetes

```{r Compr_1, message=FALSE}
library(Rcompadre) # Paquete para trabajar con la base de datos de COMPADRE y COMADRE
library(tidyverse) # Paquete para activar multiples paquetes
library(gt) # Paquete para formatear tablas
library(kableExtra) # Paquete para formatear tablas
```

```{r Compr_2, echo=FALSE}
library(tidyverse)

rlt_theme <- theme(axis.title.y = element_text(colour="grey20",size=10,face="bold"),
        axis.text.x = element_text(colour="grey20",size=10, face="bold"),
        axis.text.y = element_text(colour="grey20",size=15,face="bold"),  
        axis.title.x = element_text(colour="grey20",size=15,face="bold"))+
  theme(
  # Remove panel border
  panel.border = element_blank(),  
  # Remove panel grid lines
  panel.grid.major = element_blank(),
  panel.grid.minor = element_blank(),
  # Remove panel background
  panel.background = element_blank(),
  # add thicker border lines
    axis.line.x = element_line(colour = "black", linewidth  = 1),
    axis.line.y = element_line(colour = "black", linewidth  = 1)
  )

# The palette with grey:
cbPalette1 <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

# The palette with black:
cbPalette2 <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

# To use for fills, add
#  scale_fill_manual(values=cbPalette)

# To use for line and point colors, add
  #scale_colour_manual(values=cbPalette)

```


***

### Acceso a los datos de COMPADRE.

#### Bajando el archivo de datos 

Hay dos métodos de tener acceso a los datos de COMPADRE (datos de dinámica poblacional de plantas) y COMADRE (datos de dinamica poblacional de animales). Los datos se pueden accesar directamente de la pagina de web o bajar el archivo de datos al siguiente enlace \<<https://compadre-db.org/Data/Compadre>\> seleccionando la pestaña de **Download COMPADRE** o **Download COMADRE**.

Para tener acceso a los datos cuando no esta conectado al internet es necesario bajar el archivo y instalar en su proyecto de RStudio. Al momento de construir el libro la versión más reciente de COMPADRE es la versión 6.23.5.5.0 (May_06_2023) y se puede bajar al siguiente enlace \<<https://compadre-db.org/Data/Compadre/COMPADRE_v. 

#####  Acesso a los datos de su computadora

- USAR el código siguiente si tiene los datos bajado a su computadora. 
 
 load(dirección/al/archivo/a/su/proyecto/de/RStudio) si tiene el repositorio en su computadora (preferiblemente en su proyecto de RStudio)

```{r Compr3, echo=FALSE}
#load("~/Library/CloudStorage/Dropbox/GitHub_Dropbox_Drive/GitHub/Diagnostico_Poblacional/Diagnostico_Poblacional/COMPADRE_v.6.23.5.0.RData")

#load("~/Dropbox/GitHub_Dropbox_Drive/GitHub/Diagnostico_Poblacional/Diagnostico_Poblacional/COMPADRE_v.6.23.5.0.RData") # work computer
```

***

#### Rastreando los datos con el enlace de web

  - Usando la función *cdb_fetch()* se puede bajar los datos directamente de la pagina de web de COMPADRE. Esta función se encuentra en el paquete de **Rcompadre**.

```{r Compr4}
compadre <- cdb_fetch("compadre") # Usar este código para bajar los datos del repositorio de COMPADRE. Tiene que haber activado la librería de Rcompadre.


```

#### Renombrar la base datos a algo sencillo

  - En este script se renombrar la base de datos de COMPADRE a algo más sencillo **TodasSp**, reemplazando **compadre**.
  - Se visualiza el nombre de cada columna en la base de datos.
    - Hay 59 variables en la base de datos de COMPADRE.

```{r Compr5}
#TodasSp=as_cdb(compadre)  # Un paso critico: Convertir la base de datos anterior COM(P)ADRE (de clase 'list') en la base en un objeto CompadreDB (COMPADRE Database)

TodasSp=compadre
names(TodasSp) # La lista de los nombres de las variables en el archivo COMPADRE, Nota que 59 variables en la base de datos de COMPADRE.

dim(TodasSp) # La base de datos de COMPADRE tiene 8994 filas y 59 columnas (variables)

```

***

#### Evaluar si un genero o especie este en la base de datos de COMPADRE

 - Para filtrar para un genero específico se puede usar el siguiente código.
    - Aquí seleccionamos todas las matrices del genero **Epipactis**. 
    - Nota que hay 59 filas, que corresponde típicamente a 59 matrices de diferentes poblaciones, tiempo o un análisis teóricos.
    
  
  **This shows that the species added *Epidendrum xanthinum* is not yet included in the data base**

```{r Compr6}
Epi = TodasSp %>% 
  filter(Genus %in% c("Epipactis")) # Filtrar la información de *Epipactis* en la base de datos.
Epi # Nota que en el genero *Epipactis*, tenemos 51 fila, pero todas son de la misma especie de dos estudios distintos. 
```

***

### Filtrar para la familia de Orquidaceae

 - Extraer (filter) solamente las especies de la familia **Orchidaceae** de la base completa de datos de COMPADRE.

```{r Compr7}
index_O=TodasSp %>% 
 filter(Family %in% c("Orchidaceae")) # Extraer la orquídeas de la base de datos. 

head(index_O, n=3) # para visualizar las primera 3 filas de la base de datos de COMPADRE para las orquídeas.

```

***

### Cual son los géneros de la familia Orchidaceae


 - Cual son los géneros de la familia **Orchidaceae** incluidos en la base de datos de COMPADRE?
  - se usa la función **unique()** para seleccionar los géneros únicos en la base de datos.
  - se crea un data frame con los géneros únicos.


```{r Compr8}

Genera=(as.data.frame(sort(unique(index_O$Genus))))

kbl(Genera)
```


***

### Lista de especies únicas de orquídeas en la base de datos de COMPADRE.

 - ¿Cual son las especies únicas de la familia Orchidaceae incluidos en la base de datos de COMPADRE?
  - se usa la función **unique()** para seleccionar las especies únicas en la base de datos con la variable *SpeciesAccepted*.
  - se crea un data frame con las especies únicas.
  - Se arregla el data frame por orden alfabético.

Note que al momento hay 46 especies con nombres únicos en la base de datos

```{r Compr9}

Especies_unicas=as.data.frame(sort(unique(index_O$SpeciesAccepted)))

kbl(Especies_unicas)
```

***

## Contabilizar cuantas matrices y variables estan incluidas en el archivo

La base de datos de orquídea tiene un total de 647 filas con 59 variables, por consecuencia tiene 647 matrices. Esas matrices de la misma especie son de diferentes poblaciones, tiempo o un análisis teóricos. 

```{r Compr10}
dim(index_O)

```


***

### La fuente de la información

Para saber cuantos especies distintas y los manuscritos asociado a los estudios. En este caso los de esas 53 fuentes de información publicada, revisada por pares, tesis o informes técnicos. Algunas especies fueron estudiada y publicada en más de un manuscrito.

```{r Compr11}
index_O |> select(mat, SpeciesAccepted, DOI_ISBN) |>
  filter(!duplicated(paste0(pmax(SpeciesAccepted, DOI_ISBN), pmin(SpeciesAccepted, DOI_ISBN))))

```


## Frecuencia de autores unicos en la base de datos

Igualmente podemos evaluar cuantos distintos autores son responsable de esas publicaciones. Un total de 37 grupos de autores únicos la fuente de esos artículos.

## *ROBERTO*:

¿HAY una manera de contabilizar los nombres específicos (únicos), no por grupo? Para saber quien más publica sobre orquídeas.

```{r Compr13}
unique(index_O$Authors)
```




## Extraer información de una especie específica

En el siguiente script se enseña como extraer la información de una especie específica. En este caso se selecciona la especie **Telipogon helleri**.

```{r Compr14}
Th=index_O %>% select(SpeciesAccepted, mat, Authors, DOI_ISBN, MatrixDimension) %>% 
  filter(SpeciesAccepted %in% c("Telipogon helleri"))

Th

```

En el siguiente script se enseña la matrices de **Telipogon helleri** y las etapas de esta matrices.  Nota que el objeto **mat** es una lista de matrices que incluye la matriz de transición (matU) de estados de una población, la matriz de fecundidad (matF), la matriz de clonaje (matC) y la suma de las tres matrices (matA=matU+MatF+matC) vea el capitulo de [Matrices de transición, fecundidad y clonal](#MatricesTFC)

La información incluye la clases/etapas que los autores usaron. El ciclo de vida incluyo 3 etapas, 1 inmaduras (S1-2) y 2 maduras (S3 y S4). 


```{r Compr15}
Th$mat
```



## Cuantos estudios unicos?

Para evaluar el largo de tiempo por estudio se necesita seleccionar una combinación de variables única

NOTA: OrganismType es una variable que indica si la orquídea es un epifita o terrestre. **Roberto MUCHOS están erroneos**.  
    - Todos las *Lepanthes* son epifitas, pero hay unas que son terrestres en la base de datos.
    - Todas las *Caladenia* son terrestres, pero hay unas que son epifitas en la base de datos.

```{r chap16}
#names(index_O) Los nombres de las variables
SPECIES_O=index_O %>% select(StudyStart, StudyEnd, SpeciesAccepted, YearPublication, Authors, DOI_ISBN, OrganismType, MatrixPopulation, mat) %>% 
  group_by(SpeciesAccepted, YearPublication, OrganismType, StudyStart, StudyEnd) %>% 
  summarize(n_populations = length(unique(MatrixPopulation))) %>% 
  arrange(SpeciesAccepted) %>% 
  mutate(StudyStart=as.numeric(StudyStart)) %>% 
  mutate(StudyEnd=as.numeric(StudyEnd)) %>% 
  drop_na(StudyStart, StudyEnd)

SPECIES_O


#write_csv(SPECIES_O, "DATA/Species_O.csv")
```


****

### Determinar cuantas poblaciones fueron muestreadas por especies

 - Cual es la frecuencia de cantidad de poblaciones por especies en la base de datos. La mayoría de los estudios usaron una sola población, pero hay estudios que usaron hasta 18 poblaciones distintas. Estas poblaciones pudiese ser de diferentes publicaciones o de las mismas poblaciones pero de diferentes fuentes (referencias). 

```{r Compr17}
as.data.frame(table(SPECIES_O$n_populations))


```


### ¿Cuan largo fueron los estudios?

 - La duración de los estudios en la base de datos de COMPADRE. La mayoría de los estudios duraron pocos años.
 - Aquí vemos cuando comenzaron los estudios comenzaron y terminaron basado si las plantas son epifitas o no. 



```{r Compr18}

SPECIES_O$SpeciesAccepted <- fct_reorder(SPECIES_O$SpeciesAccepted, SPECIES_O$StudyStart, .desc = FALSE)

ggplot(SPECIES_O, aes(SpeciesAccepted, color=OrganismType))+
  geom_linerange(aes(x= SpeciesAccepted  , ymin=StudyStart, ymax=StudyEnd))+
  coord_flip()+
  theme(legend.position = c(0.2, 0.8))+
  ylab("")+
  xlab("")+
  rlt_theme+
  theme(axis.text.x = element_text(color = "grey20", size = 9, angle = 90, hjust = .5, vjust = .5, face = "plain"),
        axis.text.y = element_text(color = "grey20", size = 7, angle = 0, hjust = 1, vjust = 0, face = "plain"),  
        axis.title.x = element_text(color = "grey20", size = 12, angle = 0, hjust = .5, vjust = 0, face = "plain"),
        axis.title.y = element_text(color = "grey20", size = 12, angle = 90, hjust = .5, vjust = .5, face = "plain"))


ggsave("Figures_MS/Lenght_survey.png")

```

***


### Tiempo de duración de las investigaciones.

 - Figura de las duración de las investigaciones en la base de datos de COMPADRE. La mayoría de los estudios de orquídeas epifitas duraron pocos años al comparar con especies terrestres.


```{r Compr19}

index_O=index_O %>% 
  mutate(StudyDuration=as.numeric(StudyDuration))

#table(index_O$StudyDuration)
#table(index_O$OrganismType)

ggplot(index_O, aes(StudyDuration, fill=OrganismType))+
         geom_histogram(colour="white")+
  facet_wrap(~OrganismType)+
  theme(legend.position = "none")+
  xlab("Study duration")+
  ylab("Frequency")+
  rlt_theme

#ggsave("Duración_Epi_Ter.pdf")

ggsave("Figures_MS/Duración_Epi_Ter.png")
```




### Evaluación de la ergodicidad e irreducibilidad y el valor propio de las matrices

Para los analisis de PMP es necesario que la matrices cumple con ciertas condiciones. Dependiendo de la pregunta científica se tiene que evaluar si esas matriz tienen las condiciones necesarias. Una de estas condiciones es la ergodicidad e irreducibilidad.

 - check_ergodic: Para la definición de ergodicidad vea Capitulo xx.
 
 - check_irreducible: Para la definición de irreducibilidad vea Capitulo xx.

 - check_NA_A: Determinar si hay valores faltantes en 'matA' Los valores faltantes ("NA") en las matrices impiden que la mayoría de los cálculos utilicen esas matrices.

 - check_NA_U: Determinar si hay valores faltantes en 'matU' Los valores faltantes ("NA") en las matrices impiden que la mayoría de los cálculos utilicen esas matrices.

 - check_NA_F: Determinar si hay valores faltantes en 'matF' Los valores faltantes ("NA") en las matrices impiden que la mayoría de los cálculos utilicen esas matrices.

 - check_NA_C: Determinar si hay valores faltantes en 'matC'. Los valores faltantes ("NA") en las matrices impiden que la mayoría de los cálculos utilicen esas matrices.

 - check_zero_U: Determinar si la 'matU' tiene todos ceros (incluido 'NA'). Las submatrices compuestas enteramente de valores cero pueden resultar problemáticas. Puede haber buenas razones biológicas para este fenómeno. Por ejemplo, en la población focal particular en el año focal particular, realmente no se registró una supervivencia. Sin embargo, las submatrices de valor cero pueden provocar que algunos cálculos fallen y puede ser necesario excluirlas.

 - check_zero_F: Determinar si la 'matF' tiene todos ceros (incluido 'NA'). Las submatrices compuestas enteramente de valores cero pueden resultar problemáticas. Puede haber buenas razones biológicas para este fenómeno o de preguntas científicas. Por ejemplo, en la población particular en el año particular, realmente no se registró reproducción. Sin embargo, las submatrices con valores de cero pueden provocar que algunos cálculos fallen y puede ser necesario excluirlas. En otros estudios no se evaluó la fecundidad ya que estos parámetros no eran necesaria para contestar las preguntas científicas.

- check_zero_U_colsum: Determinar si las columnas de 'matU' suman a cero, esto implica que no hay supervivencia de esa etapa en particular. Esta puede ser una parametrización perfectamente válida para un año/lugar en particular, pero es biológicamente irrazonable a largo plazo y los usuarios pueden desear excluir matrices problemáticas de su análisis.

 - check_singular_U: Determinar si 'matU' es singular. Se dice que las matrices son singulares si no se pueden invertir. Se requiere inversión para muchos cálculos matriciales y, por lo tanto, la singularidad puede hacer que algunos cálculos fallen.
 
 - check_component_sum: Determinar si las submatrices 'matU'/'matF'/'matC' suman a 'matA'. Un MPM completo ("matA") se puede dividir en las submatrices que lo componen (es decir, "matU", "matF" y "matC"). La suma de estas submatrices debe ser igual al MPM completo (es decir, 'matA' = 'matU' + 'matF' + 'matC'). A veces, sin embargo, se producen errores de modo que las submatrices NO suman 'matA'. Normalmente, esto se debe a errores de redondeo, pero es posible que se produzcan errores más importantes.

 - check_ergodic: Determinar si 'matA' es ergódico (ver isErgodic). Algunos cálculos matriciales requieren que el MPM ("matA") sea ergódico. Los MPM ergódicos son aquellos en los que existe un único estado estable asintótico que no depende de la estructura de la etapa inicial. Por el contrario, los MPM no ergódicos son aquellos en los que existen múltiples estados estables asintóticos, que dependen de la estructura de la etapa inicial. Los MPM que no son ergódicos suelen ser biológicamente irrazonables, tanto en términos de la descripción de su ciclo de vida como de su dinámica proyectada. Hacen que algunos cálculos fallen.

 - check_irreducible: Determinar si 'matA' es irreducible (ver isIrreducible). Algunos cálculos matriciales requieren que el MPM ("matA") sea irreducible. Los MPM irreducibles son aquellos en los que las tasas de transición parametrizadas facilitan el paso de todas las etapas a todas las demás etapas. Por el contrario, los MPM reducibles representan ciclos de vida incompletos donde no son posibles caminos desde todas las etapas a todas las demás etapas. Los MPM que son reducibles suelen ser biológicamente irrazonables (pero no siempre), tanto en términos de la descripción de su ciclo de vida como de su dinámica proyectada. Hacen que algunos cálculos fallen. La irreductibilidad es necesaria pero no suficiente para la ergodicidad. 

 - check_primitive: Detemrminar si 'matA' es primitivo (ver isPrimitive). Una matriz primitiva es una matriz no negativa que es irreducible y tiene un solo valor propio de módulo máximo. Por lo tanto, esta verificación es redundante debido a la superposición con 'check_irreducible' y 'checkErdogic'.

 - check_surv_gte_1: Determinar si 'matU' contiene valores iguales o mayores que 1. La supervivencia está limitada entre 0 y 1. Los valores superiores a 1 no son biológicamente razonables (vea capitulo Impacto de Datos sin sentidos).


Usando la función cdb_flag se puede evaluar todas las opciones en la base de datos de COMPADRE. 

Usando la función **cdb_flag** se identifica problemas potenciales en las matrices de transición de estados de las poblaciones. Esa función añade una fila por opciones en la matriz. Nota que para cada prueba anterior crea una columna con **TRUE** o **FALSE** para cada matriz en la base de datos.

```{r Compr20}
#Orchids_New=as_cdb(index)
#compadre$mat[index]

Compadre_flagged <- cdb_flag(index_O) # Evaluación de todas las opciones en la base de datos de COMPADRE

Compadre_flagged %>% select(mat, SpeciesAccepted, starts_with("check"))

```


#### Ergodicidad e Irreducibilidad


En los siguientes scripts se filtra para las matrices con ciertas condiciones para evaluar si las matrices son ergódicas e irreducibles.  Notas las matrices que son ergódica son irreducibles, pero no todas las matrices irreducibles son ergódicas. Evalué la cantidad de filas en cada caso.




```{r Compr21}

Mat_ergodic <- subset(Compadre_flagged, check_NA_A == FALSE & check_ergodic == TRUE) # para evaluar si las matrices son ergódicas
Mat_ergodic 

Mat_irred <- subset(Compadre_flagged, check_NA_A == FALSE & check_irreducible == TRUE) # para evaluar si las matrices son irreducibles
Mat_irred


Mat_erg_irred <- subset(Compadre_flagged, check_NA_A == FALSE & check_irreducible == TRUE & check_ergodic == TRUE) # para evaluar si las matrices son ergódicas e irreducibles al mismo tiempo
Mat_erg_irred 


```


### Ahora usando las matrices que cumple con las condiciones de ergodicidad y irreducbilidad se puede calcular el valor propio de lambda.

 - La función **eigs** calcula los valores propios de una matriz, la función proviene de la library(popdemo). En este caso se calcula el valor propio de lambda para las matrices que son ergódicas e irreducibles previamente seleccionado. Usando la función **sapply** se aplica la función **eigs** a todas las matrices en la base de datos y crea una lista de los cálculos. Si mira la lista de valores propios de lambda en el objeto **lambdaVals** se un valor por cada **matA** incluido en el archivo.
 - Se usa la función **summary** para resumir los valores propios de lambda.
 - Se usa la función **hist** para visualizar la distribución de los valores propios de lambda.


```{r Compr22}

lambdaVals <- sapply(matA(Mat_erg_irred), popdemo::eigs, what="lambda")
summary(lambdaVals) # la distribuciones de los lambdas
hist(lambdaVals, main = "Lambda values")
```


Una segunda alternativa es usar la función **map_dbl** de la librería **purrr** para calcular cada uno los valores propios de lambda. 
 
 - Las función de **map_dbl** transforman su entrada aplicando una función a cada elemento de una lista y devolviendo un objeto de la misma longitud que la entrada. En este caso por cada **matA**, habrá un lambda. 

```{r Compr23}

library(purrr)
## con el paquete popdemo
lambdaVals1 <- map_dbl(matA(Mat_erg_irred), ~popdemo::eigs(.x, what="lambda"))
 
 
##O con el paquete popbio, que evita algunos mensajes de advertencia

lambdaVals2 <- map_dbl(matA(Mat_erg_irred), ~popbio::lambda(.x))
```


### Need to move this before as the Caladenia's are terrerstrial and not epiphytes
## Resolve the name of this data frame... Give it a more reasonable name

```{r Compr24}
x2=Mat_erg_irred %>% 
  mutate(OrganismType = case_when(
    Genus ==  "Caladenia" & OrganismType == "Epiphyte" ~ "Herbaceous perennial",
    TRUE ~ OrganismType
  ))

epi=x2 %>% 
  filter(OrganismType=="Epiphyte")

terr=x2 %>% 
  filter(OrganismType=="Herbaceous perennial")



```

Compadre_flagged \<- cdb_flag(index_O)

x \<- subset(Compadre_flagged, check_NA_A == FALSE & check_ergodic == TRUE)

lambdaVals \<- sapply(matA(x), popdemo::eigs, what="lambda") summary(lambdaVals) hist(lambdaVals, main = "Lambda values")

```{r Compr25}

Compadre_flagged_epi <- cdb_flag(epi)

x_epi <- subset(Compadre_flagged_epi, check_NA_A == FALSE & check_ergodic == TRUE)

#sapply(matA(x_epi), popdemo::eigs, what="lambda")

library(purrr)
lambda_epi <- map_dbl(matA(x_epi), ~popdemo::eigs(.x, what="lambda"))

#Or with popbio, which avoids some warning messages…
lambda_terr <- map_dbl(matA(terr), ~popbio::lambda(.x))
```


Con la función evaluando las especies terrestres y epifitas uno observa que las especies terrestres tienen valores propios de lambda más dispersos que las especies epifitas, y aunque los promedios son distintos la mediana es similar. 


```{r Compr26}
summary(lambda_epi)
hist(lambda_epi, main = "Lambda values")

summary(lambda_terr)
hist(lambda_terr, main = "Lambda values")
```
Para visualizar loa datos en una figura de **ggplot2**, hay que convertir estas filas en un data.frame y añadir una columna con el tipo de habitad, renombrar la columna lambda y unir los dos data.frames en uno solo.


```{r Compr27}
df_Lamb_epi=as.data.frame(lambda_epi)
df_Lamb_epi=df_Lamb_epi %>% 
  add_column(Habit_Type = "Epiphyte") %>% 
  rename(lambda=lambda_epi)


df_Lamb_terr=as.data.frame(lambda_terr)
df_Lamb_terr=df_Lamb_terr %>% 
  add_column(Habit_Type = "Terrestrial")%>% 
  rename(lambda=lambda_terr)


ALL_Lambdas=rbind(df_Lamb_epi, df_Lamb_terr)
```



```{r Compr28}

ggplot(ALL_Lambdas, aes(lambda, fill=Habit_Type ))+
  geom_histogram(colour="white") + 
  facet_wrap( ~Habit_Type)+
  rlt_theme

ggsave("Figures_MS/Terr_Epi_lambda.png")
```

Para calcular los coeficientes (el promedio) es significativamente diferentes entre los grupos se puede usar un modelo lineal y la función **lm**. En este caso se usa la variable **Habit_Type** para predecir el valor propio de lambda. Añadiendo un **-1** al modelo hace que los coeficientes para cada grupo este en la tabla de salida y no hay que hacer un calculo suplementario. Note que lo más interesante de este análisis es que las especies terrestres tienen menos dispersión cuando evaluado con el error estandar que las especies epifitas, y aunque los cuartiles son más amplios (análisis anterior).



```{r Compr29}
model_lambda=lm(lambda ~ Habit_Type-1, data=ALL_Lambdas)
summary(model_lambda)

library(broom)
tidy(model_lambda)

```

Uno puedo visualizar estas distribuciones usando la librería **ggdist** y **distributional**, con la función **stat_halfeye**. Es importante notar que la función **stat_halfeye** requiere que se especifique la distribución de los datos y que la información proviene del modelo anterior (model_lambda).  En este analisis se asume que los $\lambda$ tienen una distribución normal.  

```{r Compr30}

library(ggdist)
library(distributional)
model_lambda %>%
  tidy() %>%
  ggplot(aes(y = term)) +
  stat_halfeye(
    aes(xdist = dist_student_t(df = df.residual(model_lambda), mu = estimate, sigma = std.error))
  )
```


La gráfica anterior puede esconder la dispersión de los datos, específicamente los datos sesgados, por lo que se puede añadir los datos originales a la figura. En el siguiente caso se añade un **|** por cada lambda en la posición inferior de la figura. Nota ahora que la dispersión de los datos es varia si uno mira la distribución con el promedio y el error estandard versus los datos originales, los **|**. es claro que con esta figura uno puede apreciar la dispersión de los datos y la distribución de los datos.\ dando una perspectiva más completa de los datos.


```{r Compr31}
ALL_Lambdas %>%
  expand(Habit_Type) %>%
  augment(model_lambda, newdata = ., se_fit = TRUE) %>%
  ggplot(aes(y = Habit_Type, colour=Habit_Type)) +
  stat_halfeye(
    aes(xdist = dist_student_t(df = df.residual(model_lambda), mu = .fitted, sigma = .se.fit)),
    scale = .5
  ) +
  geom_point(aes(x = lambda), data = ALL_Lambdas, pch = "|", size = 2, position = position_nudge(y = -.15))

```




### La cantidad de poblaciones por especies en la base de datos de COMPADRE.

 - La cantidad de poblaciones por especies en la base de datos de COMPADRE varia grandemente. La mayoría de las especies tienen una sola población, pero hay especies que tienen hasta 20 poblaciones distintas. Estas poblaciones pudiese ser de diferentes publicaciones. Por ejemplo los datos de *Lepanthes rupestris* provienen de dos publicaciones distintas [@tremblay2001gene; @tremblay2014bayesian], hasta pudiese en parte ser matrices recolectado de la misma población en los años, pero con objetivos distintos. En la primera publicación [@tremblay2001gene] se uso para evaluar el tamaño efectivo de la poblaciones, Ne. En la segunda publicación [@tremblay2014bayesian] se uso para lo datos de las misma poblaciones anterior y periodo de tiempo para evaluar un nuevo método para calcular los elementos de la matriz cuando hay pocos datos en cada población o tiempo y se aprovecha del conocimiento de la información para tener estimados de los parámetros más biologícamente realista.  

Lista de números de poblaciones únicas por especies. 


```{r Compr32}
x2 %>% 
  group_by(SpeciesAccepted) %>% 
  summarize(n_populations = length(unique(MatrixPopulation))) %>% 
  arrange(desc(n_populations))
```

### Filtrar para las especies con más de 10 poblaciones distintas

 - Si uno quisiera evaluar variación entre poblaciones uno necesita filtrar y extraer las especies que tienen más de una población.   Aquí el script para hacerlo.  En este caso se selecciono especies que tienen de 10 o más poblaciones.  


```{r Compr33}

compadre_replicated_pops <- x2 %>% 
  group_by(SpeciesAccepted) %>% 
  mutate(n_pops = length(unique(MatrixPopulation))) %>% 
  ungroup() %>%
  subset(n_pops >= 10)

compadre_replicated_pops
```


## Crear un mapa de las distribuciones de las orquídeas.

En este primer mapa se visualiza la distribución de las orquídeas en la base de datos de COMPADRE sin poner el mapa del mundo. La base de datos incluye orquídeas de todo el mundo .  


```{r Compr34}
plot(index_O$Lon,index_O$Lat,main = "Location")
```


Ahora usamos el paquete ggplot2 para visualizar la distribución de las orquídeas en la base de datos de COMPADRE. En este caso se usa la función **borders** para añadir los bordes de los países al mapa. La función **borders** usa funciones en el paquete **maps** para añadir los bordes de los países al mapa. 




```{r Compr35}
ggplot2::ggplot(x2, aes(Lon, Lat,colour=OrganismType)) +
  borders(database = "world", fill = "grey80", col = NA) +
  geom_point(size = 1.8, alpha = 0.5)+
  theme(legend.position = c(.55, 0.2))

#ggsave("orchid_map.jpg")
```



## La esperanza de vida de las orquídeas

Cada especies tiene un promedio de largo de vida y una distribución de supervivencia. En los humanos el largo de vida promedio es de ±72 años (y varia por país y otros factores), pero hay personas que viven hasta 100 años o más. En las orquídeas el largo de vida promedio es de 10 años, pero hay individuos que viven hasta 100 años o más. Para calcular el largo de vida y su distribuciones de una especies se usa la matriz de transición **matU** y la etapa de inicio de la vida **start_life**. La función **lifeExpectancy** calcula el largo de vida de una especies. Nota que este caso no se usa la matriz de fecindidad **matF** o la matriz de clonaje **matC**. 

Para calcular y comparar los datos es importante que la matriz sea del mismo largo de tiempo, por ejemplo no se debería comparar una matriz de 1 año con una matriz de 1 mes o de 10 años. Los valores de tiempo es la unidad de los datos de la matriz. 

Aquí el script crea un data frame de los valores del largo de vida para cada especies con matrices de transiciones de un año.

```{r Compr36}
library(Rage) # función para calcular el largo de vida esperada
lifeExpectancy <- function(matU, startLife) {
  N <- solve(diag(nrow(matU)) - matU)
  return(colSums(N)[startLife])
}

compadre_life_expect <- x2 %>% 
  filter(ProjectionInterval == 1.0) |> # filtrar para matriz de un año
  filter(MatrixComposite == "Mean", # filtrar para la matriz promedia
         MatrixTreatment == "Unmanipulated", # filtrar para la matriz sin manipulación
         MatrixCaptivity == "W" # filtrar para poblaciones naturales (no en cautiverio)
         ) %>% 
  mutate(StageID = cdb_id_stages(.)) %>% # crear un ID para las etapas
  cdb_collapse(columns = "StageID") %>% # colapsar las etapas
  cdb_flag() %>% # evaluar las matrices y crear una columna para cada evaluación
  filter(check_NA_U == FALSE, # filtrar para matrices sin valores faltantes
         check_zero_U == FALSE, # filtrar para matrices sin valores cero
         check_singular_U == FALSE) %>% # filtrar para matrices no singulares
  mutate(matU = matU(.), start_life = mpm_first_active(.)) %>% # extraer la matriz de transición y la etapa de inicio de la vida
  mutate(life_expectancy = mapply(lifeExpectancy, matU, start_life)) %>% # calcular el largo de vida
  mutate(var_life_expectancy = mapply(life_expect_var, matU, start= 1)) %>% # calcular la varianza del largo de vida
  mutate(low_CI_var_LS= life_expectancy-1.96*sqrt(var_life_expectancy)) %>% # calcular el intervalo de confianza inferior
  mutate(high_CI_var_LS= life_expectancy+1.96*sqrt(var_life_expectancy)) %>%  # calcular el intervalo de confianza superior
  mutate(OrganismType = reorder(OrganismType, life_expectancy, median)) # ordenar las especies por el largo de vida





OrchidLS=compadre_life_expect %>% select(mat, SpeciesAccepted, OrganismType, SpeciesAccepted, life_expectancy, low_CI_var_LS, high_CI_var_LS) %>% 
  arrange(desc(life_expectancy))

```


```{r Compr37}
x2 %>% 
  filter(ProjectionInterval == 1.0) |> # filtrar para matriz de un año
  filter(MatrixComposite == "Mean", # filtrar para la matriz promedia
         MatrixTreatment == "Unmanipulated", # filtrar para la matriz sin manipulación
         MatrixCaptivity == "W" # filtrar para poblaciones naturales (no en cautiverio)
         ) %>% 
  mutate(StageID = cdb_id_stages(.)) %>% # crear un ID para las etapas
  cdb_collapse(columns = "StageID") %>% # colapsar las etapas
  cdb_flag() %>% # evaluar las matrices y crear una columna para cada evaluación
  filter(check_zero_C == FALSE) # filtrar para matrices sin valores faltantes
          # filtrar para matrices sin valores cero
         
```


Visualizar el largo de vida por plantas epifitas versus terrestres. Nota aquí que algunas especies están representada múltiple veces. Por consecuencia la distribución de los datos no es una buena representación de la diferencia entre las especies epifitas y terrestres, debido a lo que se llama pseudoreplicación. Este figura representa la distribución los datos del data frame anterior. 



Calculando el promedio y la desviación estándar de la esperanza de vida de las orquídeas.


```{r Compr38}

OrchidLS |> 
  group_by(OrganismType) |> 
  summarize(mean_LS= mean(life_expectancy, na.rm=TRUE),
            sd_LS = sd(life_expectancy, na.rm=TRUE))
```

Haciendo una figura del largo de vida de las especies epifitas y terrestres. Nota que la escala de y es logarítmica.

```{r}

ggplot2::ggplot(OrchidLS, aes(OrganismType, life_expectancy, colour=OrganismType)) +
  geom_boxplot() +geom_point()+
  scale_y_log10() +
  coord_flip() +
  labs(x = NULL, y = "Life expectancy (log(years))")+
  rlt_theme+
  theme(legend.position = "none")

ggsave("Figures_MS/Life_Span.png")
```


https://jonesor.github.io/Rage/reference/life_expect.html

En el siguiente script y grafico vemos la visualización por genero de los estimados de la esperanza de vida. Nota que la esperanza de vida es un estimado y no un valor exacto. En este caso se usa la función **life_expect_var** para calcular la varianza de la esperanza de vida. La escala de x (el largo de vida fue cambiado a log10 de la esperanza de vida). 

**How to calculate CI of life span, it is in the table above, use gamma, not normal**

low_CI_var_LS
high_CI_var_LS

```{r Compr39}

#SPECIES_O$SpeciesAccepted <- fct_reorder(SPECIES_O$SpeciesAccepted, SPECIES_O$StudyStart, .desc = FALSE) # Ordenar por fecha de inicio del estudio 

#compadre_life_expect |> select(mat, Genus, SpeciesAccepted, life_expectancy) |> 
#  group_by(SpeciesAccepted) |> 
 # summarize(low_CI_var_LS= life_expectancy-1.96*sqrt(var_life_expectancy),
#            high_CI_var_LS= life_expectancy+1.96*sqrt(var_life_expectancy))


ggplot(compadre_life_expect, aes(x=reorder(SpeciesAccepted, life_expectancy), life_expectancy, colour=OrganismType)) +
 # geom_boxplot() +
  geom_point()+
  scale_y_log10() +
  coord_flip() +
  labs(x = NULL, y = "Life expectancy (log(years))")
#  rlt_theme+
  #theme(legend.position = "none")

#ggsave("Figures_MS/Genus_Life_Span.png")
```


Evaluando el largo de vida de las especies de *Caladenia* solamente

```{r Compr40}

#SPECIES_O$SpeciesAccepted <- fct_reorder(SPECIES_O$SpeciesAccepted, SPECIES_O$StudyStart, .desc = FALSE)

compadre_life_expect |> 
  group_by(Genus) |> 
  summarize(mean_LS= mean(life_expectancy, na.rm=TRUE),
            sd_LS = sd(life_expectancy, na.rm=TRUE)) |> 
  filter(Genus %in% c("Caladenia"))

compadre_life_expect |> 
  filter(Genus %in% c("Caladenia")) |> 
ggplot( aes(x=reorder(SpeciesAccepted, life_expectancy), life_expectancy, colour=OrganismType)) +
  geom_point()+
  scale_y_log10() +
  coord_flip() +
  labs(x = NULL, y = "Life expectancy (years)")+
  rlt_theme+
  theme(legend.position = "none")

ggsave("Figures_MS/Caladenia_Life_Span.png")
```











Test difference in life span.

```{r Compr41}
unique(compadre_life_expect$OrganismType)

t.test(life_expectancy~OrganismType, data=compadre_life_expect)


shapiro.test(compadre_life_expect$life_expectancy) # Not normaly distributed


library(car)

leveneTest(life_expectancy~OrganismType, data=compadre_life_expect) # equal variance but not notmaly distributed

```

Use robust Approach

Para el siguiente análisis se necesita instalar el paquete **WRS2**.

Y se necesita cargar el archivo de funciones de **Rallfun-v38.txt** que se encuentra en el siguiente enlace \<<https://github.com/rrwilcox/Rallfun>\> y guardarlo en su directorio de trabajo. Pudiese ser que haya versiones más recientes de este archivo. Nota que la dirección abajo funciona para mi computadora, uds tienen que ajustar la dirección del archivo a su directorio de trabajo.

```{r Compr42}
library(WRS2)
source("/Users/rlt/Library/CloudStorage/Dropbox/GitHub_Dropbox_Drive/GitHub/Diagnostico_Poblacional/Diagnostico_Poblacional/Rallfun-v38.txt", chdir = T) # Home computer
#source("/Users/rlt/Dropbox/METAS+COHORT_D/Rallfun-v38.txt", chdir = T)
#source("/Users/rlt/Dropbox/Ackermanstuff/Pollinator_Interaction/Specificity_Index_pollinators/Rallfun-v38.txt", chdir = T) ## Work laptop Computer
#source("/Users/raymondtremblay/Dropbox/METAS+COHORT_D/Rallfun-v38.txt", chdir = T) #When used on Monique
```

```{r Compr43}
unique(compadre_life_expect$OrganismType)

Cf=cdb_flatten(compadre_life_expect)


YSEC_T=Cf %>% 
  dplyr::select("life_expectancy", "OrganismType") %>% 
  filter(OrganismType== "Herbaceous perennial")

YSEC_T
YSEC_E=Cf %>% 
  dplyr::select("life_expectancy", "OrganismType") %>% 
  filter(OrganismType== "Epiphyte")

yuenbt(YSEC_T$life_expectancy, YSEC_E$life_expectancy, alpha=.05, nboot=10000, side=T)

```

```{r Compr44}
library(Rcompadre)
library(popdemo)
data(Compadre)


Compadre$matA <- matA(Compadre)

# create empty vector to store output
Compadre$dim <- numeric(nrow(Compadre))

#index$dim <- numeric(nrow(index_O))

# loop through all rows of Compadre
for (i in seq_len(nrow(Compadre))) {
  Compadre$dim[i] <- nrow(Compadre$matA[[i]])
}

# function to determine whether matrix 'mat' has any stages with no transitions
NullStages <- function(mat) any(colSums(mat) == 0)

# apply function to every element of A
Compadre$null_stages <- sapply(Compadre$matA, NullStages)

NullStages(Compadre$matA[[1]]) # apply function to single element
Compadre$null_stages <- sapply(matA(Compadre), NullStages)
```



### Calcular el promedio y la varianza en la expectativa de vida de un modelo de matriz poblacional



```{r Compr45}
# función para calcular la esperanza de vida

library(Rage)
data(mpm1)

life_expect_mean(mpm1$matU, start = 1)
rep_stages <- repro_stages(mpm1$matF)
(n1 <- mature_distrib(mpm1$matU, start = 2, repro_stages = rep_stages))

life_expect_mean(mpm1$matU, mixdist = n1, start = NULL)

life_expect_var(mpm1$matU, start = 1)


```






http://127.0.0.1:29465/rmd_output/1/compadre_orchid-ppm-y-su-uso.html



Revisión RLT: Sept 15, 2024

<!--chapter:end:19-COMPADRE_ORCHIDS.Rmd-->

---
editor_options:
  markdown:
    wrap: 72
output:
  word_document: default
  pdf_document: default
---

# Un protocolo para informar sobre modelos discreto de estructura de población

## "A standard protocol to report discrete stage-structured demographic information"

Samuel J. L. Gascoigne<sup>1</sup> | Simon Rolph<sup>2</sup> | Daisy Sankey<sup>1</sup> | Nagalakshmi Nidadavolu<sup>1</sup> | Adrian S. Stell Pičman<sup>1,3</sup> | Christina M. Hernández<sup>4</sup> | Matthew E. R. Philpott<sup>1</sup> | Aiyla Salam<sup>1</sup> | Connor Bernard<sup>1</sup> | Erola Fenollosa<sup>1</sup> | Young Jun Lee<sup>1</sup> | Jessica McLean<sup>1</sup> | Shathuki Hetti Achchige Perera<sup>1</sup> | Oliver G. Spacey<sup>1</sup> | Maja Kajin<sup>1,3</sup> | Anna C. Vinton<sup>1</sup> | C. Ruth Archer<sup>5</sup> | Jean H. Burns<sup>6</sup> | Danielle L. Buss<sup>7,8</sup> | Hal Caswell<sup>9</sup> | Judy P. Che-Castaldo<sup>10</sup> | Dylan Z. Childs<sup>2</sup> | Pol Capdevila<sup>11</sup> | Aldo Compagnoni<sup>1,12,13</sup> | Elizabeth Crone<sup>14</sup> | Thomas H. G. Ezard<sup>15</sup> | Dave Hodgson<sup>8</sup> | Tiffany M. Knight<sup>12,13,16</sup> | Owen R. Jones<sup>17</sup> | Eelke Jongejans<sup>18,19</sup> | Jenni McDonald<sup>20,21</sup> | Brigitte Tenhumberg<sup>22</sup> | Chelsea C. Thomas<sup>23</sup> | Andrew J. Tyre<sup>2,4,25</sup> | Satu Ramula<sup>26</sup> | Iain Stott<sup>27</sup> | Raymond L. Tremblay<sup>28,29,30</sup> | Phil Wilson<sup>8</sup> | James W. Vaupel<sup>31,‡</sup> | Roberto Salguero-Gómez<sup>1,32,33</sup>

<sup>1</sup>Department of Biology, University of Oxford, Oxford, UK; <sup>2</sup>Department of Animal & Plant Sciences, University of Sheffield, Sheffield, UK; <sup>3</sup>Department of Biology, University of Ljubljana, Ljubljana, Slovenia; <sup>4</sup>Department of Ecology and Evolutionary Biology, Cornell University, Ithaca, New York, USA; <sup>5</sup>Institute of Evolutionary Ecology and Conservation Genomics, University of Ulm, Ulm, Germany; <sup>6</sup>Department of Biology, Case Western Reserve University, Cleveland, Ohio, USA; <sup>7</sup>Department of Archaeology, University of Cambridge, Cambridge, UK; <sup>8</sup>College of Life and Environmental Sciences, University of Exeter, Penryn, UK; <sup>9</sup>Institute for Biodiversity and Ecosystem Dynamics, University of Amsterdam, Amsterdam, The Netherlands; <sup>10</sup>Branch of Species Status Assessment Science Support, U.S. Fish and Wildlife Service, Washington, DC, USA; <sup>11</sup>School of Biological Sciences, University of Bristol, Bristol, UK; <sup>12</sup>Institute of Biology, Martin Luther University Halle-Wittenburg, Halle (Saale), Germany; <sup>13</sup>German Centre for Integrative Biodiversity Research (iDiv) Halle-Jena-Leipzig, Leipzig, Germany; <sup>14</sup>Department of Biology, Tufts University, Medford, Massachusetts, USA; <sup>15</sup>School of Ocean and Earth Science, University of Southampton, Southampton, UK; <sup>16</sup>Department of Community Ecology, Helmholtz Centre for Environmental Research-UFZ, Halle (Saale), Germany; <sup>17</sup>Department of Biology, University of Southern Denmark, Odense, Denmark; <sup>18</sup>Animal Ecology and Physiology, Radboud University, Nijmegen, The Netherlands; <sup>19</sup>NIOO-KNAW, Animal Ecology, Wageningen, The Netherlands; <sup>20</sup>Veterinary Department, Cats Protection, National Cat Centre, Haywards Heath, UK; <sup>21</sup>Bristol Veterinary School, University of Bristol, Bristol, UK; <sup>22</sup>School of Biological Sciences and Department of Mathematics, University of Nebraska, Lincoln, Nebraska, USA; <sup>23</sup>Alexander Center for Applied Population Biology, Conservation & Science Department, Chicago, Illinois, USA; <sup>24</sup>School of Natural Resources, University of Nebraska-Lincoln, Lincoln, Nebraska, USA; <sup>25</sup>Global Resistance Management Team, Bayer U.S. –Crop Science, Chesterfield, Missouri, USA; <sup>26</sup>Department of Biology, University of Turku, Turku, Finland; <sup>27</sup>School of Life Sciences, University of Lincoln, Lincoln, UK; <sup>28</sup>Department of Biology, University of Puerto Rico, San Juan, Puerto Rico, USA; <sup>29</sup>Center for Applied Tropical Ecology and Conservation, University of Puerto Rico, San Juan, Puerto Rico, USA; <sup>30</sup>Department of Biology, University of Puerto Rico-Humacao, Puerto Rico, USA; <sup>31</sup>Interdisciplinary Centre on Population Dynamics, University of Southern Denmark, Odense, Denmark; <sup>32</sup>Centre for Biodiversity and Conservation Science, University of Queensland, St Lucia, Queensland, Australia y <sup>33</sup>Evolutionary Demography Laboratory, Max Planck Institute for Demographic Research, Rostock, Germany

Persona de contacto

Samuel J. L. Gascoigne Email: samuel.gascoigne@pmb.ox.ac.uk

Roberto Salguero-Gómez Email: rob.salguero@biology.ox.ac.uk

Traducido por *Raymond L. Tremblay,  Roberto Salguero-Gómez, Anne Damon y Diana Molina Ozuna*

Nota: Cualquier conflicto entre el texto en inglés y español, siempre se debería dar prioridad al texto en inglés.

Cuando cite el artículo use la siguiente información, [@gascoigne2023standard]

::::: {.defbox}

Abstract

1. Los métodos demográficos que se basan en estadios del ciclo de vida, como los Modelos Matriciales Poblacionales (MPM, por sus siglas en inglés), son herramientas poderosas que se utilizan para abordar una amplia gama de preguntas que son fundamentales en la ecología, biología evolutiva y ciencias de la conservación. Debido a su potencial, ahora existen MPM para más de 3,000 especies en todo el mundo. Estos datos se están digitalizando como un proceso continuo y se publican periódicamente en dos grandes repositorios online de forma totalmente abierta: la base de datos de matrices de plantas de COMPADRE y la base de datos de matrices de animales de COMADRE. Sin embargo, durante la última década, el análisis y la curación de los datos de COMPADRE y COMADRE, y la investigación comparativa posterior, han revelado una variación pronunciada en la forma en que se parametrizan y reportan los MPM.

2. Aquí resumimos los retos y aspectos de mejora actuales relacionados con la parametrización y difusión de los MPM, los que surgen con más frecuencia, y describimos cómo afectan la construcción, el análisis y la interpretación de los MPM. Para cuantificar la variación en cómo se difundan los MPM, presentamos los resultados de una encuesta que buscaba identificar aspectos clave de los MPM que con frecuencia no se presentan en los manuscritos. Luego evaluamos las bases de datos de COMPADRE y COMADRE para cuantificar con qué frecuencia se omiten piezas clave de información en los manuscritos donde manejan los MPM.

3. Más del 80 % de los investigadores entrevistados (n = 60) comentaron positivamente sobre las ventajas de adoptar metodologías más estandarizadas para difundir y compartir los MPM. Además, más del 85% de los 300 MPM evaluados por COMPADRE y COMADRE omitieron uno o más de los elementos clave para su correcta interpretación. Basado en estos resultados, identificamos los principales problemas que pueden surgir a partir de la construcción y difusión de los MPM y ofrecemos sugerencias para mejorar la claridad y la reproducibilidad y así contribuir a la investigación futura utilizando MPM y los metadatos requeridos. Para fortalecer la reproducibilidad y capacitar a los investigadores para aprovechar al máximo sus datos demográficos, presentamos un protocolo estandarizado para presentar los MPM en las publicaciones. Este estándar está vinculado con el contenido de www.compadre-db.org, para que los autores que deseen archivar sus MPM puedan hacerlo antes de someter sus publicaciones, siguiendo ejemplos de otros repositorios de acceso abierto como DRYAD, Figshare y Zenodo.

4. La combinación y estandarización de MPM parametrizados provenientes de poblaciones de todo el mundo, y de todo el árbol de la vida, abre poderosas oportunidades de investigación en la biología evolutiva, ecología y conservación. Sin embargo, enfatizamos que este potencial solo se logrará mediante la adopción de métodos estandarizados para garantizar la reproducibilidad.

PALABRAS CLAVE 

demografía comparativa, modelos matriciales de población, acceso abierto, reproducibilidad.

:::::



1 | INTRODUCCION

La ecología de poblaciones ha llegado a la mayoría de edad. El desarrollo de teorías, enfoques experimentales, y metodologías estadísticas han dado como resultado la publicación de información demográfica para una muestra cada vez más representativa de la biodiversidad mundial [@de2009database; @levin2022rpadrino; @salguero2015compadre; @salguero2016comadre]. Estos datos abarcan el árbol taxonómico desde los microbios [@jouvet2018demographic] hasta macrovertebrados [@fujiwara2001demography], y cubren prácticamente todos los continentes y biomas, aunque con importantes sesgos taxonómicos [@conde2019data; @romer2023plant]. El potencial de esta cantidad tan impresionante de información y en rápido aumento está comenzando a realizarse. De hecho, mediante la combinación de estos modelos demográficos, los investigadores han identificado características funcionales que explican la variación en las estrategias de la historia de vida de las plantas [@adler2014functional; ver también @bernard2023mosaic], características a corto plazo (transitorias) que impulsan la evolución demográfica, la dinámica de las poblaciones de plantas en ambientes variables [@mcdonald2016transients], y las formas en que las estrategias de historia de vida permiten que las especies persistan en un entorno de clima cambiante [@jelbert2019demographic; @paniw2019life].

Una de las herramientas más utilizadas para describir y analizar las complejas historias de vida de las especies es la de los modelos de población matricial (MPM). Brevemente, en un MPM, los individuos de una población se clasifican por etapas discretas y/o edades (st/edad en adelante) de acuerdo con algunos criterios biológicos [@caswell2001matrix, p. 31] o estadísticos/de muestreo [@salguero2010matrix]. Estos individuos son seguidos en pasos de tiempo discretos, típicamente ajustados por el tiempo generacional de cada especie. De hecho, los pasos de tiempo pueden variar de 12 a 24 h, como en los gusanos nematodos *Caenorhabditis elegans* y pulgones *Myzus periscae* [@bruijning2019demographic; @li2014assessment], a períodos mensuales/anuales en mamíferos y plantas [@coulson2001age; @ferreira2016marsupial], y hasta los 50 años en los “red woods” de crecimiento lento [@namkoong1974extinction]. A partir de estos datos, los investigadores estiman probabilidades de supervivencia, probabilidades de transición entre estadios/edades, y su contribuciones per cápita a/sexuales a través de la reproducción [@nordstrom2021fires; @omeyer2021investigating].

A partir de un solo MPM se puede calcular un amplio repertorio de resultados biológicamente interesantes Estos resultados incluyen indicadores estimados del desempeño y la viabilidad de las poblaciones, como tasas de crecimiento demográfico deterministas (γ) o estocásticas (γs) [@doak2005correctly], riesgo de cuasi-extinción [@davis2022managed], respuesta de la población a perturbaciones de las tasas vitales subyacentes, como la supervivencia o la reproducción [@fujiwara2001demography, p. 206], dinámica transitoria [@capdevila2020towards, @ezard2010matrix; @stott2011framework] y rasgos de historia de vida, como tasas de senescencia [@baudisch2013pace], grado de iteroparidad [@salguero2017fast] y edad a la madurez [@fujiwara2001demography, p. 124]. Esta gran cantidad de inferencias demográficas destaca el por qué han sido tan importantes los MPM para el desarrollo de la demografía y la teoría de la historia de vida [@franco1996life; @pfister1998patterns; @saether2013life; @tuljapurkar1989uncertain].

Los MPM para plantas y animales han sido archivados, corregidos, complementados con información adicional (p. ej., coordenadas GPS, estado de conservación de la UICN) y publicados en medios de acceso abierto en la Base de Datos de Matrices Vegetales de COMPADRE [@salguero2015compadre] y el Base de Datos de Matrices Animales COMADRE [@salguero2016comadre]. En la publicación más reciente, COMPADRE v. 6.22.5 [COMADRE v. 4.21.8] se presentan datos de 8851 [3317] MPM de 760 [415] especies distintas, trabajadas en 643 [395] estudios. Al momento de redactar este informe, otras 1307 especies están pendientes de digitalización en la red COMPADRE, con una tasa aproximado de 4.5 nuevos trabajos que contienen MPM siendo analizados, digitalizados y pasados por un proceso de control de calidad cada semana (S. Gascoigne, obs. pers.). Sin embargo, uno de los desafíos del proceso de digitalización es la enorme variación en la forma en que se recopilan, presentan y utilizan los datos para parametrizar los MPM. La estandarización de datos mejora la capacidad de replicación y facilita el intercambio de datos entre disciplinas de investigación [@powers2019open]. Por lo tanto, la estandarización de los datos, y los metadatos detallados asociados, es clave para que la investigación se replique, valide, y discuta abiertamente para que la ciencia avance [@powers2019open; @reichman2011challenges; @salguero2021four]. Ejemplos de estos estándares incluyen, informar del tamaño de la muestra y de la varianza de las estimaciones, además de detallar la lista completa de fuentes originales de datos [@gerstner2017will]. En este contexto, los estándares se pueden utilizar como elementos de una lista de requisitos para mejorar la calidad y la reproducibilidad de las publicaciones y el proceso de arbitraje por pares [@reichman2011challenges]. Este proceso de estandarización hará posible ampliar el alcance del análisis, mediante la inclusión de los meta-análisis [@gurevitch2018meta] y los análisis comparativos filogenéticos [@healy2019animal; @salguero2017fast], que ofrecen oportunidades valiosas para examinar patrones generales e identificar lagunas en el conocimiento, y en ambos casos también dependen de datos que conforman a determinadas normas.

Los MPM se están adaptando, ampliando y aplicando más allá de su contexto original especie-específica en la demografía comparativa. Sin embargo, no todos los MPM se construyen y se reporten de la misma manera. La presentación actual de las MPM en COMPADRE y COMADRE nos podría dar la falsa impresión de que todos los MPM se conformen a un formato homogéneo predeterminado, y esto a pesar de las diferencias en cómo y por qué fueron concebidos los MPM [@caswell2001matrix]. Esta impresión pudo haber surgido por el extenso proceso de verificación que realiza el equipo de digitalización de COMADRE y COMPADRE atrás de las escenas (p. ej., validación de los resultados del modelo, correspondencia con el autor para obtener información adicional). Si bien la verificación es un aspecto inevitable de la curación de bases de datos, la mayor parte de nuestros esfuerzos se dedica a comunicarnos con los autores en lugar de la digitalización de datos. Nuestro objetivo aquí es (i) presentar el estándar actual de comunicación de los MPM en la literatura, (ii) identificar problemas comunes en la comunicación de los MPM y sus impactos, (iii) sugerir formas de apoyar la comunicación clara de datos y metadatos de los MPM, (iv) destacar las ventajas para los autores y la comunidad científica en general y (v) introducir un método estándar para compartir datos y metadatos de los MPM.

2 | COMUNICACIÓN MPM: ESTADO DEL ARTE

Para presentar las prácticas actuales en la comunicación de datos y metadatos de los MPM, con el objetivo final de evaluar la necesidad de estandarizar informes de datos y metadatos, realizamos una encuesta de investigadores y examinamos un subconjunto de publicaciones que se han utilizado para generar MPMs y que han sido almacenados en COMPADRE y COMADRE.

2.1 | Una encuesta sobre comunicación matricial

Entrevistamos especialistas de ecología de poblaciones, a quienes identificamos por haber publicado artículos revisados por pares que incluyen MPM, con respecto a nuestra capacidad actual para comunicar datos y metadatos de los MPM con fines de reproducibilidad. Específicamente, preguntamos qué tan bien las publicaciones revisadas por pares transmiten los atributos de los MPM necesarios para asegurar la reproducibilidad. Además, preguntamos si los investigadores pensaban que un método estandarizado de comunicación matricial es "necesario para la comunicación coherente de los MPM en la literatura" (la lista completa de 11 preguntas se puede encontrar en Información de apoyo). La encuesta se distribuyó mediante Google Forms. Identificamos 1390 participantes potenciales bajo el criterio de ser el autor principal y/o de correspondencia de una publicación que contiene al menos un MPM. Más del 50% de las direcciones de correo electrónico correspondientes estaban desactualizadas y no hubo seguimiento. De los aproximadamente 650 investigadores restantes que fueron contactados, 60 participantes completaron la encuesta. Como era de esperar, los investigadores comentaron de una gran heterogeneidad en los componentes incluidos en la comunicación de los MPM (Figura 1). Los atributos mejor comunicados según estos participantes de la encuesta son los nombres de los rasgos (es decir, el fenotipo mediante el cual se estructuró el MPM: etapa/edad/tamaño clases), la duración del censo e intervalo de proyección, mientras que los atributos peor comunicados son los gráficos del ciclo de vida, fórmulas que definen las tasas vitales y los vectores de población (es decir, número/frecuencia de individuos en cada etapa/edad). Es importante destacar que el 83% de los participantes de la encuesta acordaron que la disciplina si necesita un método estandarizado para la comunicación de los MPM.


![FIGURA 1: Resultados de la encuesta a expertos en ecología de poblaciones que participaron (n = 60). Los participantes calificaron su confianza en el comunicación adecuada de los componentes de los modelos matriciales de población (MPM) en sistemas revisados por pares. Cada componente de MPM comunicación en el eje y representa una declaración que se muestra en la encuesta (consulte SOM para ver la encuesta completa). Para todas las declaraciones por encima del línea discontinua, se preguntó a los participantes si ese atributo (por ejemplo, intervalo de proyección) estaba suficientemente bien informado en la publicación revisado por pares revisión. La afirmación "método estandarizado" indica la respuesta de los participantes sobre si el campo de la ecología de poblaciones se beneficiaría de un método estandarizado de informes MPM. El tamaño de los puntos indica el número de encuestados con esa respuesta y están coloreados (es decir, naranja = desacuerdo; gris = neutro; azul = acuerdo). Para facilitar, el porcentaje de acuerdo (es decir, el porcentaje de participantes que estuvieron de acuerdo o muy de acuerdo con la afirmación) se muestra en el lado derecho lado de la trama.](Figures/Survey_paper.png)






<br>




2.2 | Una muestra de publicaciones en COMPADRE y COMADRE

Para cuantificar qué tan bien se comunican los datos y metadatos de los MPM en publicaciones revisadas por pares, seleccionamos al azar 300 artículos entre los que contenían MPM ya digitalizados en COMPADRE y COMADRE, quedando con 150 artículos en cada caso. Entre los diferentes atributos clave de los MPM que examinamos, hubo una variación considerable en la confiabilidad con la que los autores proporcionaron los datos y metadatos necesarios para digitalizar, archivar y realizar análisis comparativos (Figura 2). Por ejemplo, la ubicación genérica de la población examinada (i.e. provincia/ciudad/monumento; COMPADRE: 95.1%, COMADRE: 86.2% de los trabajos lo reportaron), el MPM totalmente parametrizado (93.3%, 88.9%) y la fecha del censo (89.6 %, 77.7 %) se indicaron explícitamente con frecuencia en los artículos, mientras que la latitud y longitud de la población examinada (52.4 %, 39.9 %), su diagrama de ciclo de vida (44.5 %, 40.1 %) y el vector de población (es decir, si la distribución por edades de los individuos en el momento t) (33.2 %, 32.6 %) se indicaron con menor frecuencia. Curiosamente, los estudios de plantas que utilizan MPM (COMPADRE) contienen en general datos y metadatos más completos y claros que los estudios de animales (COMADRE; Figura 2). Utilizamos esta información para categorizar la calidad de cada uno de los 300 artículos examinados en términos de su reproducibilidad, definida como la inclusión de los componentes necesarios para la comunicación de los MPM (Figura 3). La distribución de estos componentes de comunicación entre los reinos es similar. Fundamentalmente, solo el 13.9 % de los artículos en COMADRE y el 15.8 % de los artículos en COMPADRE contienen toda la información necesaria para realizar análisis comparativos y proyecciones precisas (Figura 3). Por lo tanto, en aproximadamente el 85 % de los artículos se requiere enviar un correo electrónico a los autores para solicitar la información faltante.

<br>


![FIGURA2: Tanto los artículos sobre MPM de plantas como de animales muestran patrones similares en cuanto a qué componentes presentados de MPM se comunican. El eje y indica el porcentaje de revisión por pares publicaciones en COMPADRE y COMADRE que contienen un determinado atributo necesario para la comunicación clara de la información de MPM y su reproducibilidad de un subconjunto aleatorio de 150 artículos del total de 643 artículos de COMPADRE y 150 de los 395 artículos totales de COMADRE (300 artículos en total). Los atributos son: Ubicación: provincia/ciudad/punto de referencia; MPM: fue el MPM incluido en el manuscrito; Duración del censo: fechas de inicio y finalización de la recopilación de datos; Fórmulas de tasa vital: descomposición de los elementos de la matriz en sus componentes subyacentes (es decir, contribuciones de la supervivencia, el crecimiento y la reproducción); Intervalo de proyección: el período de tiempo entre observaciones; Latitud longitud: coordenadas espaciales; Gráfico del ciclo de vida: la representación visual de la demografía. transiciones y a/sexual per cápita contribuciones; Vector de  oblación: distribución st/edad de los individuos en el tiempo t asociada con la información reportada MPM.](Figures/Database_paper.png)


<br>

![FIGURA 3: En los artículos sobre MPM de plantas y animales, la mayoría de las publicaciones no contienen suficiente información para la reproducibilidad. Proporción de artículos en COMPADRE y COMADRE agrupados por su acceso abierto información en publicaciones revisado por pares publicaciones sobre población matricial datos (MPM) y metadatos del modelo. Siguiendo el mismo esquema que en la Figura 2, los artículos se clasificaron en seis grupos, desde "inadecuados" hasta ‘MPM + VR + POP+ECO’ (es decir, totalmente reproducible). "Inadecuado" se refiere a artículos a los que les falta el MPM y/o el intervalo de proyección (es decir, un MPM intervalo de tiempo específico necesario para la proyección), sin el cual la mayoría de los resultados demográficos no pueden calcularse. 'MPM': el papel contiene el MPM e intervalo de proyección, pero no hay fórmulas de tasa vital que describan los elementos de la matriz. 'MPM + VR': contiene toda la información de 'MPM' junto con fórmulas de tasa vital para los elementos de la matriz. 'MPM + VR + POP': contiene toda la información de 'MPM + VR' junto con la vector de población. 'MPM + VR + ECO': contiene toda la información para 'MPM + VR' junto con la latitud y longitud coordenadas y censo duración de la población examinada. ‘MPM + VR + POP + ECO’: contiene toda la información para ‘MPM + VR’ junto con el vector de población/ distribución, latitud-longitud coordenadas y duración del censo.](Figures/COMPADRE_MADRE.png)


<br>

3 | PROBLEMAS COMUNES CON LA CONSTRUCCIÓN DE MATRICES

Aquí, identificamos problemas clave en la parametrización de los MPM para ilustrar el impacto de la metodología en el potencial de extrapolación demográfica. Para hacerlo, nos basamos en los hallazgos de la sección anterior y nuestra experiencia con la curación de COMPADRE y COMADRE. Señalamos las siguientes cuestiones por dos razones: (i) para guiar los demógrafos en cómo identificar estas cuestiones en la literatura y (ii) para evitar que persistan estos problemas en futuras publicaciones. Señalamos que un lista completa fue difundido recientemente por [@kendall2019persistent, véase también @che2020comments]. Aquí, ampliamos estos documentos anteriores indicando los pasos necesarios para que los investigadores puedan evitar/mitigar estos problemas en su propia investigación. Un resumen de estos problemas, desde la ocurrencia hasta impacto, se detalla en la Figura S1. 

3.1 | Tipo de censo, temporalidad y frecuencia 

Los MPM son modelos demográficos de tiempos medidos, parametrizados mediante el seguimiento de individuos tras los muestreos o censos. Por lo tanto, el tipo (p. ej., longitudinal, transversal), el momento y la frecuencia de los muestreos o censos deben planificarse cuidadosamente. Estos criterios son particularmente importantes ya que el tipo de censo afecta directamente a la construcción de la matriz, y el momento y la frecuencia del censo pueden influir involuntariamente en los resultados demográficos [@emery2005effects].

Por lo general, los MPM se manejan de dos formas con respecto a la medición de la reproducción entre censos: nacimiento-flujo o nacimiento-pulso (ver @caswell2001matrix, p. 22]. La distinción se basa en si la reproducción se produce de forma continua (es decir, nacimiento-flujo) o en una estrecha ventana temporal (nacimiento-pulso). Los MPM de nacimiento-pulso a su vez se subclasifican en censo previo versus pos-reproductivo. Aunque tanto los censos pre-reproductivos como los pos-reproductivos a menudo conducen a un escenario demográfico similar (ver @cooch2003apparent], su diferencia radica en la relación entre el tiempo del censo de la población y la posición de la estrecha ventana reproductiva. En el primero, las poblaciones son censadas inmediatamente antes de una ventana reproductiva, mientras que los censos post-reproductivos continúan después de una ventana reproductiva. Un censo pre-reproductivo requiere la inclusión de la supervivencia de la descendencia en los elementos de la matriz reproductiva, mientras que un censo post-reproductivo requiere la inclusión de la supervivencia de los padres en los elementos de la matriz reproductiva. A menudo encontramos errores en el acomodo de la descendencia o la supervivencia de los padres en los elementos de la matriz reproductiva (ver también @kendall2019persistent]. Un paso clave en la construcción de la matriz que puede evitar el acomodo incorrecta de la supervivencia sería dibujar el gráfico del ciclo de vida (según @ebertbookplant p. 61] con respecto al momento del censo (demostrado en @ellner2016data, p. 13], así como también detallar explícitamente el tipo de censo utilizado para parametrizar el MPM. Sin embargo, a veces dibujar el gráfico del ciclo de vida puede que sea inviable o poco informativo. Por ejemplo, el gráfico de un modelo clasificado por edad si tuviera 100 clases de edad sería demasiado grande para dibujarlo y no muy útil; sin embargo, se podría simplificar con una línea discontinua si varias clases adyacentes tienen las mismas tasas demográficas (por ejemplo, @ebertbookplant, p. 2]. Los modelos con muchas etapas y transiciones altamente conectadas no son viables para dibujar el gráfico del ciclo de vida (por ejemplo, el gráfico de *Calathea ovandensis* en @neubert2000demography]. Pero incluso, en situaciones complejas (por ejemplo, la serie de gráficos estacionales para el pingüino emperador en @jenouvrier2010mating], el gráfico puede ser útil para organizar la estructura del modelo. El tiempo y la frecuencia del censo afectan la construcción del modelo, lo que hace que un MPM construido no sea práctico para la inferencia demográfica si no se considera la historia de vida del organismo examinado. Considere a un investigador que compara los procesos demográficos de las moscas de la fruta y los árboles frutales. El investigador primero nota que hay cuatro etapas discretas en la historia de vida de las moscas de la fruta: tres etapas juveniles que abarcan el desarrollo desde el huevo hasta el estadio y la pupa, y una etapa adulta donde los individuos se dispersan y reproducen. Dado que el desarrollo de huevo a adulto tarda ~10 días en esta especie, el investigador decide realizar el censo cada 10 días tanto para la mosca de la fruta como para los árboles frutales durante un período de 3 meses. Sin embargo, debido a que ni la mortalidad ni la reproducción ocurren en un censo tan corto en la población de árboles frutales, el MPM de árboles frutales resultante, cuando se proyecta hacia adelante, persistirá para siempre, sin aumentar ni disminuir. Este mismo problema ocurriría al revés. Si los intervalos de 5 años se consideraran suficientes para los árboles frutales, las moscas de la fruta medidas individualmente nunca sobrevivirían a lo largo de los períodos de tiempo. Existe una solución a este problema, utilizando modelos de matrices periódicas para incluir períodos mucho más cortos o más largo que otros períodos. Por ejemplo, [@hunter2010climate] analizaron la pardela negra *Puffinus griseus* incluyendo dos períodos de cosecha de varias semanas de duración y luego un intervalo anual para la especie, con una vida útil de décadas. [@smith2005stochastic] y [@shyu2013seasonal] utilizaron modelos estacionales periódicos para adaptarse a los ciclos de vida en los que algunas etapas solo están presentes durante una parte del ciclo anual. El enfoque [@caswell2001matrix, sección 13.1] es poderoso y general.

3.2 | Supervivencia etapa-específica poco realista

Los problemas en la parametrización de la supervivencia etapa-específica, si bien son fáciles de diagnosticar, son difíciles de controlar y pueden dar lugar a una variedad de historias de vida no naturales. Las probabilidades de transición y supervivencia están limitadas entre 0 (el evento nunca sucede) y 1 (el evento siempre ocurre). Es evidente que, considerando la etapa-específica supervivencia de un MPM, los elementos no reproductivos sumados en una columna dada del MPM A no deben exceder 1. Cuando lo hace, los individuos en esa etapa tienen una probabilidad poco realista de sobrevivir >100%, lo que resulta en una representación incorrecta de la historia de vida del organismo. Los valores de >1 de supervivencia etapa-específica generalmente surgen debido a errores de redondeo, errores tipográficos, e inclusión de eventos reproductivos a/sexuales no declarados y generalmente se recomienda omitir estos MPM en un análisis comparativo [@jones2014diversity]. Los eventos reproductivos a/sexuales no declarados ocurren cuando un elemento $a_{i,j}$ en el MPM $A$ combina procesos dependientes de la supervivencia, como el crecimiento/encogimiento, pero también la fertilidad, y que estos no se han informado por separado. De preferencia, los autores identificarían cuidadosamente si varias tasas vitales se confunden con procesos demográficos dependientes de la supervivencia en cada elemento del MPM. Para el demógrafo comparativo que utiliza COMPADRE y COMADRE, recomendamos evitar los modelos MPM donde supervivencia etapa-específica llega a ser >1, y también evitar alterar el modelo para hacer que la supervivencia etapa-específica se fije a un máximo de 1 (p. ej., @buckley2010causes]. En muchos MPM publicados, algunas de las etapas de la vida tienen un tiempo estimado probabilidad de supervivencia de 1 o un ciclo de vida incompleto, probablemente el resultado de un tamaño de muestra pequeño o algún evento raro a lo largo de la historia de vida del especies. La supervivencia perfecta (es decir, mortalidad = 0) es poco probable y es posible que el valor deba estimarse o imputarse [@johnson2018climate]. Un método para estimar valores realistas de supervivencia y transición fue propuesto recientemente por @tremblay2021population, utilizando un enfoque bayesiano para estimar los valores de los parámetros utilizando datos previos, además de los datos observados, para obtener los MPM. Una ventaja de este enfoque es que los intervalos de confianza de los parámetros que representan probabilidades (estásis, transición, supervivencia) se obtienen a partir de una distribución beta. La ventaja de usar una distribución de Dirichlet multinomial bayesiana inferida para estimar los valores medios es que los investigadores pueden inferir la varianza y el sesgo de las distribuciones posteriores para informar mejor la construcción de MPM y la interpretación demográfica (p. ej., @tremblay2009dormancy, @tremblay2009population]. Por último, dado que el tamaño de la muestra puede ser un factor causante de la supervivencia etapa-específica poco realista, el tamaño de la muestra y la incertidumbre (p. ej., intervalo de confianza, desviación estándar) deben informarse para (1) transmitir la precisión de la supervivencia los valoes estimada para y (2) para la inclusión precisa de los valores de supervivencia en metaanálisis y métodos comparativos.

3.3 | Parametrización incorrecta de la fertilidad

La fertilidad a menudo presenta un desafío para la construcción de MPM precisos. Este desafío se debe en parte a la ambigüedad del término "fertilidad". El problema surge cuando las contribuciones individuales (per-cápita) de los adultos reproductivos a los nuevos reclutas (por ejemplo, huevos, neonatos, semillas, etc.) no representan los enlaces que contempla el intervalo de proyección completo del estudio. Recuerda que la entrada $a_{i,j}$ en un MPM es el número (esperado) de individuos en etapa $i$ en $t + 1$ por estadio $j$ individuo en el tiempo $t$. Si la etapa $i$ es efectivamente un tipo de individuo 'recién nacido', entonces $a_{i,j}$ debe incluir todos los procesos entre tiempo $t$ y tiempo $t + 1$ [@caswell2001matrix, p. 61). Rendimiento reproductiva, a su vez, es un proceso demográfico compuesto del número de descendientes producidos en un evento reproductivo y la supervivencia pertinente que penalizará en cuanto al número de descendientes nuevos que alcanzarán a la siguiente observación. El no tener en cuenta esta descomposición de la tasa vital puede resultar en la introducción de un retraso por un unidad de tiempo (en los términos del caso particular) en el ciclo de vida del organismo, ya que la descendencia recién creada pasaría un intervalo de proyección 'en limbo 'antes de su transiciones hacia delante. El ejemplo más conocido está en el modelo clásico del cardo *Dipsacus sylvestris*, de [@werner1977population], en el que las plantas con flores en el momento $t$, pasaron a tener semillas en el tiempo $t + 1$, y que éstas solo germinaron para formar plántulas en el tiempo $t + 2$. Este tema fue discutido y corregido en [@caswell2001matrix]. Además, este problema se ha reportado, por ejemplo, en estructuras reproductivas, tales como semillas, que no forman parte de un banco de semillas. Si se presenta este tipo de problema en un MPM, generalmente [@kendall2019persistent, pero no siempre [@nguyen2019consequences], se subestima la tasa de crecimiento γ de la población asintótica, y de allí se enfrenta el desafío de estimar la importancia relativa del banco de semillas y la vida útil de estas semillas aun no germinadas. El efecto de parametrizar incorrectamente la fertilidad dentro de la tasa de crecimiento γ es mayor en casos de crecimiento extremo, por ejemplo, en especies invasoras, o, al contrario, disminución extrema, como la que observamos en especies en peligro de extinción crítico [@steiner2021quantifying]. Este fenómeno también puede causar una sobre-estimación de la envoltura transitoria [ver @ezard2010matrix]. Por ello, recomendamos especificar las fórmulas de la tasa vital de fecundidad en conjunto con los MPM asociados e identificar claramente los valores de estas tasas vitales subyacentes (como en el Recuadro 1).

3.4 | Cálculo indirecto de tasas vitales

La estimación de las tasas vitales a menudo implica una combinación de medidas directas e indirectas. La medición directa deriva empíricamente las tasas vitales a partir de datos basados en individuos, donde se censan los mismos individuos etiquetados varias veces, como en los estudios de tablas de vida de cohortes, métodos de captura-marcado-recaptura y muchos estudios de cuadrantes de plantas marcadas. Sin embargo, las tasas vitales pueden ser difíciles de observar en especies con altas tasas de reproducción, fenología compleja y/o poblaciones pequeñas [@beissinger1998use]. En consecuencia, las estimaciones de reclutamiento a menudo se usan para complementar los MPM desarrollados en condiciones controladas, por ejemplo, en el laboratorio [@jouvet2018demographic), en un invernadero [@gontijo2020using], en un zoológico [@clubb2009fecundity] o en un jardín botánico [@jimenez2010population]. Dado que algunos métodos para el desarrollo de los MPM requieren de un ciclo de vida completo para obtener las métricas clave [por ejemplo, métricas transitorias: @stott2011framework], se tiende a utilizar sitios de estudio externos o fuentes de la literatura para parametrizar los componentes que hacen falta para 'cerrar el ciclo' [@omeyer2021investigating]. Sin embargo, hay que tomar en cuenta que las poblaciones cautivas o de alguna forma domesticadas pueden no presentar la misma dinámica poblacional que la población natural [@clubb2003captivity], particularmente en relación a supervivencia [@che2021comparative] o reproducción [@clubb2009fecundity].

Otro método para estimar indirectamente las tasas vitales consiste en utilizar métodos ex situ para obtener los límites superior e inferior del reclutamiento (u otras tasas vitales) y explorar los espacios ocupados por los parámetros dentro de esos límites. Este enfoque fue introducido por [@caswell1998harbor] en un estudio sobre los efectos de la mortalidad por captura incidental en la marsopa común. Los cronogramas de supervivencia y fertilidad específicos por edad se seleccionaron de otras especies con ciclos de vida similares, se reajustaron para que coincidieran con la longevidad de la marsopa común y se usaron para producir distribuciones de incertidumbre para el crecimiento de la población y los efectos de la captura incidental medida. La información así generada de la distribución y los parámetros asociados proporciona una medida de incertidumbre a partir de la cual informar la construcción de un MPM [@tenhumberg2008monte]. Además, el uso de la jerarquía en los modelos para estimar los valores faltantes y la fuerza de préstamo de otras poblaciones o especies pueden mejorar la estimación de los parámetros [@tremblay2014bayesian; @james2021bridging].

Por último, los modelos poblacionales integrados representan un marco valioso para estimar indirectamente las tasas demográficas y la dinámica de la población (tamaño y estructura) mediante la combinación de fuentes de datos, en particular la combinación de datos individuales longitudinales con datos de censos poblacionales [@plard2019integrated; @schaub2021integrated]. Los modelos de población integrados permiten la construcción de modelos de población (incluyendo los MPM) mediante, (1) la combinación de diversas fuentes de datos, (2) la definición de una historia de vida a priori (a menudo se trata de algún tipo de modelo de población estructurado por etapas) y (3) la cuantificación de la máxima probabilidad de las tasas demográficas codificadas en la historia de vida, y citando las fuentes de los datos. Los modelos de población integrados son particularmente útiles cuando se conoce la incertidumbre en torno a la adquisición de datos (por ejemplo, en estudios de captura-marcado-recaptura) [@riecke2019integrated].

3.5 | Vector de población

Una estimación de la estructura de la población, clasificada por edad o etapa, es una pieza útil de información cuando está disponible, pero no siempre se cuenta con esta información. Tiene lógica utilizar la estructura actual de la población como punto de partida para las proyecciones de la viabilidad de la población a corto y largo plazo [@werner2019savanna]. Además, el utilizar la población vector (es decir, abundancia y distribución de etapas) para las proyecciones ayuda para tener en cuenta los efectos de la dinámica transitoria, que mide el efecto de la estructura de población no estacionaria en tasas de crecimiento de “near term” de las poblaciones [@capdevila2020towards]. Los vectores reportados de etapa o edad de la población reflejan dos componentes clave: la estructura de población real en el censo en el tiempo t y las opciones metodológicas. Este segundo componente es fundamental para representar con precisión la población estudiada.

A través del desarrollo y curación de COMPADRE y COMADRE, hemos notado dos fuentes de error que afectan la estimación de los vectores de población. El primer error es un sesgo de detección, donde los investigadores identifican ciertas etapas/edades con una mayor tasa de detección que las etapas más crípticas (por ejemplo, plantas adultas versus bancos de semillas). El segundo error es la apropiación indebida de los métodos utilizados para cuantificar las tasas demográficas como base para estimar la abundancia de etapa. Este segundo error proviene de un malentendido de la diferencia entre estimar tasas y estimar números. Para medir las tasas demográficas, durante un censo, los investigadores a veces aumentan el esfuerzo de muestreo de ciertas clases de etapa/edad en relación a otras. Este diferencia en el esfuerzo en relación a etapa/edad es particularmente común cuando las clases de etapas/edades tienen probabilidades de supervivencia cercanas a sus límites (es decir, 0 y 1). Por ejemplo, en la demografía de los árboles, normalmente solo hay unos pocos individuos muy grandes por área examinada. Por lo tanto, a menudo los investigadores complementan el tamaño de la muestra de esta categoría al muestrear fuera del área predefinida [@jones2006demographic]. Sin embargo, muchos métodos para la estimación de tasas demográficas no proporcionan ninguna información sobre números y estructura de la población. Las tablas de vida de cohortes, que siguen a una cohorte de individuos a medida que envejecen, son ciegos a la estructura de la población en la que se desarrolla la cohorte. De hecho, puede que no haya tal población (por ejemplo, toda la historia de demografía basado en el estudio de cohortes realizada en laboratorio, que se remonta a Pearl en la década de 1920 [@pearl1927experimental]. La estimación de tasas mediante la técnica de captura-marcar-recaptura a partir de datos longitudinales extrae toda su inferencia de los individuos marcados y en ningún momento hace referencia al número y la estructura de los no marcados. La literatura sobre métodos de captura-marcar-recaptura para la estimación de tasas reconoce que estimar el tamaño de la población es mucho más difícil que estimar las tasas [@lebreton1992modeling] y requiere diferentes modelos de captura-marcar-recaptura (por ejemplo, la inclusión de la evaluación de la respuesta hacía las trampas (dispuesto / renuente) en la estimación de tasas vitales.


::::: {.defbox}

CAJA 1: Ejemplo de presentación de un hipotético sistema de tres etapas de modelo de población de matriz de una planta (MPM) usando una presentación explícita de datos aplicables a la mayoría de las técnicas de construcción MPM.

(A) Tipo de matriz

Una matriz simple determinista y independiente de la densidad.*

*Este campo de texto libre permite la breve descripción del tipo de matriz. Si la matriz está estructurada por una variable, la matriz es simple. Si en caso contrario, la matriz se considera general (por ejemplo, edad x etapa). Determinista se refiere a si las tasas demográficas que construyen el MPM se mantienen
constante (determinista) o extraída de una distribución (estocástica). Independiente de la densidad
versus dependiente de la densidad indica si el las tasas demográficas están o no influenciadas por la densidad de población.

(B) Diagrama de ciclo de vida
```{r Proto1, eval=TRUE, echo=FALSE}
library(Rage)

# hidden code to produce figures
library(DiagrammeR)
matA <- rbind(
  c(0.0, 0.0, 3.2),
  c(0.5, 0.0, 0.0),
  c(0.0, 0.4, 0.9)
)


stages <- c("1", "2", "3")
title <- NULL
graph <- expand.grid(to = stages, from = stages)
graph$trans <- round(c(matA), 3)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", stages, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 3
graph$col <- c(
  "PaleGreen4", "PaleGreen4", "Goldenrod1", "PaleGreen4"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 

```


***

(c) Descripción del Censo

```{r Proto2, eval=TRUE, echo=FALSE}
library(tibble)
library(gt)
Descripcion_censo=tribble(~"Atributo del censo", ~"Ejemplo",
                          "Duración del Censo", "May 2021 to May 2022",
                          "Localidad", "Sheffield, UK (53°24′41.5 N 1°30′02.3 W)",
                          "Intervalo de proyección", "1 año",
                          "Modo de reproducción", "Pico de reproducción* (En Junio y Julio)",
                          "Tipo de Censo", "Pre-reproductivo")



gt(Descripcion_censo) %>% 
  cols_align(
    align = "right",
    columns = 2
  ) %>% 
  tab_footnote(
    footnote = "Pico de reproducción = Birth-Pulse",
    locations = cells_body(columns = Ejemplo, rows = 4),
    placement = "right")


```

***

(D) Nombres de las etapas y clasificación

```{r Proto3, eval=TRUE, echo=FALSE}

Etapas=tribble(~"Número de las Etapas", ~"Nombre de la Etapa", ~"Critrio de Clasificación",
               1, "Plantulas", "Un individuo recientemente germinado que tiene menos de cuatro hojas y no ha desarrollado la estructura de roseta radial. El las hojas miden menos de tres centímetros de largo",
               2, "Rosetta", "Un individuo con una morfología radial pronunciada en la estrucura de la hoja. Las hojas miden entre tres y seis centímetros en longitud",
               3, "Plantas adultas", "Un individuo con una morfología radial pronunciada en la estrucura de la hoja. Las hojas miden más de seis centímetros en longitud"
               
               
               
)

gt(Etapas) %>% 
  cols_align(
    align = "left",
    columns = 1
    
  )
```

***

(E) Definiciones de las Tasas vitales

```{r Proto4, eval=TRUE, echo=FALSE}
Vital=tribble(~"Tasa Vital", ~"Definición", ~"Provenencia de los valores",
               "$S_{ij}$", "Supervivencia de la etapa *j* a la etapa *i*", "Datos de campo",
               "$N_{s}$", "Número de semillas por fruto", "Datos de campo",
               "$N_{fx}$", "Número de frutos producido por un idividuo en el tamaño de categoria *x*", "Datos de campo",
               "$P_{rx}$", "La probabilidad de reprodución de un adulto en la categoria *x*", "Datos de campo",
               "$P_{s}$", "Probabilidad de germinación de semillas y supervivencia de plantulas en el intervalo de proyección", "Datos de Invernadero"
)
knitr::kable(Vital, escape = FALSE)

#Vital



```



:::::

<br> 

::::: {.defbox}

(F) Valores de las razones de transición vitales












| Etapas Vitales | Estimados*| Error Estandard** |Tamaño de muestra (N)***|
|:--------------|--------:|---------------:|-------------------:|
| $S_{21}$| 0.400| 0.100| 80|
| $S_{32}$|  0.850| 0.050 |160 |
| $S_{33}$ | 0.900| 0.020| 160|
|$N_{s}$ |1000| 150 | 80|
|$N_{f3}$ | 2.000 | 300| 80|
|$P_{r3}$ | 0.300 | 0.040 |  200|
|$P_{s}$| 0.005 | 0.001|  500|


*Si estas estimaciones dependen del tamaño de la población (es decir, dependencia de la densidad) o en respuesta a una variable ambiental (es decir, ambiental, estocasticidad), la estimación debe comunicarse como una función (por ejemplo, $S_{33}\sim\ 0,9\ +\ \beta_{precipitacion}\ \cdot\ 0,01$ donde la precipitación ∼ N(5, 1)).
Además, si se trata de una estimación puntual, los investigadores deben indicar si los valores representan valores medios o medianos.

**Esta medida de incertidumbre también puede ser la desviación estándar, la varianza o un intervalo de confianza/creíble de la estimación, a discreción.
del investigador.

***Indique si la unidad de medida/replicación es a nivel de organismos individuales o a nivel de grupos (por ejemplo, cohortes, colonias, familias). 





***



(G) Fórmula MPM (Mayo 2021 a Mayo 2022)

```{r Proto5, eval=TRUE, echo=FALSE}
Matriz=tribble(~"Plantulas", ~"Rosettas", ~"Adultos",
               "0", "0", "$N_{s}*N_{f3}*P_{r3}*P{s}$",
               "$S_{21}$", "0", "0",
                "0", "$S_{32}$", "$S_{33}$",

)
knitr::kable(Matriz, escape = FALSE)
```


(H)  Vector de la población (Mayo 2021)

```{r, eval=TRUE, echo=FALSE}
Vector=tribble(~"Etapa", ~"Cantidad", ~"Intervalo de Confienza de 95%*",
               "1", "1350", "1150-1550",
               "2", "550", "530-570",
                "3", "300", "290-310"

)
gt(Vector)




```
*Esta medida de incertidumbre también puede ser la desviación estándar de la estimación, la varianza o un intervalo de confianza/creíble a discreción.
del investigador.

::::

<br>

3.6 | Omitir etapas de vida crípticas

La identificación y estimación de tasas vitales en etapas crípticas representa un reto en ecología de poblaciones. Se determinan las etapas crípticas como puntos a lo largo del ciclo de vida de un organismo que están, de una forma u otra, ocultos o se pasan por alto por ecologistas de poblaciones al construir modelos de población [@doak2002population]. Una etapa de la vida puede ser críptica porque es logísticamente difícil de observar, o, aunque si es observable, a su vez es indistinguible de otra etapa [@nguyen2019consequences]. En las plantas, etapas crípticas pueden surgir de los bancos de semillas, como en el caso de las orquídeas, donde las semillas son demasiado pequeñas para ser observadas e identificadas en el campo [@paniw2017accounting] o algunas perennes herbáceas (por ejemplo, *Astragulus scaphoides*) donde períodos de latencia vegetativa permiten que los individuos permanezcan escondidos bajo tierra durante una o más temporadas de crecimiento [@gremer2013risky]. Además, los animales pueden exhibir etapas crípticas al pasar por diapausa o retrasos en el desarrollo debido a condiciones ambientales adversas (p. ej. *Aedes albopictus*: @jia2016climate]. Aves marinas pelágicas (albatros, petreles, pingüinos) a menudo pasan etapas pre-reproductivas en el mar, a veces de duraciones de muchos años, y al ser así, se mantienen completamente crípticas hasta volver a la colonia reproductora como adultos. Métodos sofisticados de marcado-recaptura multi-estado pueden proporcionar estimaciones de parámetros para estas partes del ciclo de vida [p. ej., @jenouvrier2018interacting, usando el algoritmo de eventos múltiples de @choquet2009program]. Omitir una etapa críptica de la vida puede reducir la realismo biológico de un MPM y alterar el número de etapas en el MPM, que, en su conjunto puede impactar aún más los resultados demográficos [@salguero2010matrix; @tenhumberg2009model]. En algunos casos, las etapas de la vida crípticas solo se identificarán a través de un enfoque multidisciplinario. incluyendo métodos de campo y de laboratorio, junto con marcos bayesianos para integrar datos y conocimientos previos [por ejemplo, @paniw2017accounting].

3.7 | Modelos de uno versus dos sexos

Gran parte de la demografía se centra en las hembras, bajo los supuestos que la fertilidad está determinada por las hembras sin limitación por los machos [ver @caswell2001matrix p. 568]. Dichos modelos pueden incluir machos [por ejemplo, @hunter2010climate], pero si la reproducción está determinada por las tasas femeninas (es decir, dominado por la etapa de hembras). Los machos representan un conjunto de etapas que no contribuyen al crecimiento de la población. La mayoría de los MPM de animales existentes están a base de hembras y femenino dominante [@salguero2016comadre] dados sesgos de muestreo hacia mamíferos y aves [@conde2019data], a menudo no es factible, o necesario para la pregunta de investigación, rastrear interacciones reproductivas masculinas [@archer2022sex]. Estos estudios, por lo general, asumen una proporción de sexos 1:1, y las tasas vitales son congruente por sexo y la reproducción no es limitada por los machos de la especie [@compagnoni2017can; @miller2022two]. Mientras que un sexo los modelos son comunes en animales MPM'S (actualmente 77% en Comadre v. 4.21.8), se debe tener cuidado no hacer suposiciones sobre la relación sexual dinámica dependiente dentro estos sistemas [@archer2022sex]. De hecho, estos supuestos no pueden ser cumplido cuando cualquiera de los siguientes es cierto: que haya un sesgo en la proporción de sexos [@archer2022sex], hay reproducción sesgadas [@sky2022female], o un alta sensibilidad de la dinámica de la población en respuesta a la elección de apareamiento [@veran2009demographic]. Además, la detectabilidad de los diferentes sexos en el muestreo dependiente del sexo puede confundir más las estimaciones de la relación sexual y sus inpactos asociados sobre las tarifas vitales si no se tiene en cuenta. Los modelos de dos sexos que no asumen la dominancia por un sexo no son lineales y requiere especificaciones de una función de apareamiento que describe la fertilidad en función del macho y la abundancia hembras [@caswell2001matrix]. La definición de tales funciones de apareamiento es generalmente difícil o imposible, excepto en casos específicos como la estricta monogamia [@jenouvrier2010mating].

Informar sobre las proporciones de sexos puede expandir enormemente el alcance de un estudio [@shyu2016demographic, @shyu2016frequency]; Por ejemplo, evaluar el impacto de la razón de sexo cuando hay efecto Allee [@boukal2002single]. Desafortunadamente, este tipo de análisis es raro y pocos ejemplos son notado en la bases de datos de COMPADRE y COMADRE. Además, si hay diferencias en los valores de la tasa vital entre sexos, como supervivencia, crecimiento y/o producción reproductiva en los modelos basado en un sexo solamente los MPM puede omitir procesos importantes [@archer2022sex; @caswell2001matrix p. 568]. En plantas, ejemplos de investigaciones que incluye la dinámica de dos sexos raro (0.2% en COMPADRE v. 6.22.5). Este bajo porcentaje probablemente refleja en parte la rareza de la plantas dioecía u otros sistemas de apareamiento con dos o más sexos [@gabriel2017rarity] y los sistemas de apareamiento polígamos que hace que la reproducción y la dinamica poblacional limitado a los macho es raro [ver @compagnoni2017can; @miller2022two].

3.8 | Irreductibilidad y ergodicidad

Las propiedades de la irreductibilidad tiene implicaciones sobre la diversidad de eigenvalue de una matriz y, por lo tanto, interpretaciones biológicamente relevantes (e.g. tasas de crecimiento de la población, estructuras de etapa estable). Estas implicaciones son bien conocidos en la literatura sobre MPM [@caswell2001matrix]. Matriz que son irreducible son aquellas en la que el gráfico del ciclo de vida está completamente conectado; es decir, existe una ruta directa o indirecta desde cualquier etapa a cualquier otra etapa. A veces se afirma que los MPM reducibles son de alguna manera inválido; ellos no son inválido. Hay (al menos) cuatro situaciones en que matrices reducibles ocurren naturalmente.

Ciclos de vida con etapas post-reproductiva. Las etapas post-reproductiva no pueden contribuir a la potencialmente reproductiva (por ejemplo, MPM's para humanos, Orcas).

Modelos de dos sexos dominado por un sexo (generalmente mujeres, pero podría ser hombre). En un modelo dominado por hembras, toda la reproducción es acreditado a las mujeres. Los machos son producidos por las hembras, pero los machos no hacen contribución a la parte femenina del ciclo de vida [por ejemplo, @hunter2010climate] para osos polares).

Modelos espaciales en los que la dispersión es un direccional, como en los sistemas fluviales (ríos) o corrientes oceánicas.

En los modelos de Edad × Etapas [@caswell2009stage; @caswell2013age]. En estos modelos, la reproducción produce (por definición) individuos en la clase de edad 1, pero el modelo incluye todo combinaciones de edad y etapa, incluidas combinaciones imposibles de edad de clase 1 y etapas que no existen a los 1 años.

La reductibilidad puede o no ser fácil de detectar desde el gráfico del ciclo de vida, pero se puede evaluar numéricamente. La matriz A es irreducible si y solo si la matriz $\left(I+A\right)^{s-1}$ es positiva [@caswell2001matrix]. La irreductibilidad, junto con la primitividad, es una condición suficiente para Ergodicidad, garantizando que la población convergerá a la misma estructura estable independientemente de la condición inicial. Una matriz reducible puede no tener esta propiedad; claramente, por ejemplo, si una población comenzó con un solo individuo post-reproductivo no convergerán a la misma estructura que uno comenzó con algunos pre-reproductivos individuos. Con respecto a la ergodicidad, también se sabe que un MPM es ergódico si y solo si todas las entradas de su vector propio dominante izquierdo (v) son positivos [@stott2010reducibility]. En resumen, a pesar del modelo apropiado estructura y parametrización correcta, los datos demográficos pueden conducir a matrices reducibles y/o no ergódico.

4 | Representación completa de un MPM en publicaciones

En esta sección, justificamos la necesidad de una presentación clara de MPM's en la literatura científica, sugerencias dónde archivar los MPM's en base da datos de acceso abierto, y discutir cómo estas dos acciones benefician a los autores, revista editorial, lectores, demógrafos comparativos, meta-analistas y la disciplina en general. Una tabla que contiene la lista de los datos a incluir al publicar MPM's junto con una justificación para la inclusión. Se pueden encontrar ejemplos de buenas prácticas en Tabla S1.

4.1 | Partición de los procesos demográficos

Es importante definir a que se refiere cada elemento de una matriz de un MPM's. Varios procesos demográficos pueden superponerse al mismo elemento matriz en un MPM, particularmente en especies con un rápido y/o variable ciclo de vida relativo a los intervalos de proyección del MPM. Por ejemplo, el parámetro en un MPM que representa el enlace entre individuos grandes en el tiempo $t$ y individuos más pequeños en el tiempo $t+1$ podría corresponder a la reproducción sexual, reproducción clonal, fisión, retroceso o un conjunto de los procesos anteriores. Las derivaciones matemáticas de parámetros clave de la historia de vida (por ejemplo, generación el tiempo, la esperanza de vida, la tasa de senescencia, el grado de iteroparidad) requieren que estos procesos están claramente separados [@jones2022rcompadre]. Esto separaciones es crítica para la familia de análisis basados en las cadenas de Markov; la matriz U define las transiciones de estado transitorio en un análisis de Chain de Markov absorbente [@caswell2011beyond; @caswell2013age]. Claramente describiendo la estructura subyacente de las tasas demográficas en un diagrama del ciclo de vida y su consecuente modelo de población de la matriz completa A, se puede separar matrices en los procesos de supervivencia (por ejemplo, progresión/crecimiento, retroceso/ contracción, fisión, fusión, estasis) en la submatriz U, una matriz de reproducción sexual en el submatriz F y la reproducción clonal en la submatriz C (Figura 4). Es importante destacar que tanto que las matrices de F y C incluye elementos que deben incorporar la supervivencia de acuerdo con el tipo de censo (es decir, pre-/post-reproductivo censo).

Informando claramente la matriz A y las submatrices U, F y C se lleva dos beneficios clave: (1) indica explícitamente cómo se generan los valores de la matriz A de tasas vitales subyacentes; y (2) los submatrices pueden ser utiliza para calcular una gran gran cantidad de medidas demográficas que no pueden calcularse a partir de solamente la matriz A, como la longevidad (promedio y varianza), tiempos de ocupación (promedio y variaciones), la distribución de la reproductiva de por vida de los individuos (promedio y variaciones), taza de reproducción neta, tiempo de generación y entropía (KeyFitz Entropy [@keyfitz1968changing] y la entropía de Demetrius [@demetrius1992growth] entre otros.




4.2 | Atribución de fuentes de datos secundarias

Las fuentes de datos secundarias son críticas para la reproducibilidad. Las fuentes de datos proporcionan información y soporte para las metodologías utilizadas en la construcción MPM. En algunos casos, los MPM simplemente usan datos secundarios para estimar algunos parámetros del ciclo de vida, mientras que otros se construyen puramente de fuentes secundarias (ver Tabla S1). Las fuentes secundarias incluyen estudios previos, datos de bases de datos, simulaciones, observaciones indirectas y estimaciones teóricas. El uso de fuentes de datos secundarias puede significar que el MPM final no representa con precisión las tasas de razón vitales, y así debe reconocerse en la sección de métodos de la publicación o su información de apoyo. La comunicación de fuentes secundarias debería ser suficiente para determinar su proveniencia e incluye la fuente de los datos, si se estimó un punto, el intervalo de confianza o la distribución y como se integró con la fuente de datos primaria, así como la justificación de su inclusión. Por ejemplo, @omeyer2021investigating] presenta una tabla de fuentes de datos utilizadas en la construcción de MPM. Si estas fuentes secundarias no se reconocen en conjunto con el MPM, los inferidos procesos demográficos, por realista que sean, pueden no pasar revisión por pares ni aceptada de la comunidad científica. A su vez, la comunicación clara de estas fuentes secundarias es muy recomendable.

<br>

![FIGURA 4:  La descomposición de un MPM en sus submatrices permite aislar tasas vitales que de otro modo estarían enmascaradas. La matriz A representa la MPM. Dado que las transiciones individuales pueden representarse por múltiples tasas demográficas (por ejemplo, regresión, reproducción sexual y clonalidad), reproducción), descomponer A en sus submatrices U, F y C permite realizar inferencias demográficas específicas sobre qué transiciones demográficas están impulsando la dinámica de la población.](Figures/Matrices_A_U_F_C.jpg)
<br>

4.3 | Archivando los datos en COMPADRE y COMADRE

Proponemos que las bases de datos de la matriz de COMPADRE y COMADRE proporcione la forma más adecuada de archivar y acceder a MPM's. Mientras reconocemos que hay otros repositorios de bases de datos ecológicas (por ejemplo, Dryad: <https://datadryad.org/>; figshare: <https://figshare.com>; Zenodo: <https://zenodo.org>), la base de datos de COMPADRE COMADRE de acceso abierto (<https://compadre-db.org/Contribute>) proporciona una plataforma de archivo de datos dedicada, específicamente para MPM's, que permite contribuciones directas de los investigadores y la digitalización de MPM publicados por nuestros equipos de validación de datos. La integración de un portal usando una pagina web para la entrada de datos proporciona un proceso de curación de datos estructurado (es decir, desde la detección, la estandarización, hasta la validación) que pueden acomodar MPM de diferentes dimensiones y diversas historias de vida. Al ingresar, los MPM se complementan con variables biogeográfico relevante y detalles sobre la metodología del censo en COMPADRE y COMADRE. Detalles de la publicación original, incluyendo doi y citas funcional (ver <https://compadre-db.org/Education/article/obtaining-references> donde se almacenan junto con cada MPM para garantizar que su contribución a cualquier publicación futura es reconocida. Todos los datos están archivados a largo plazo a través de Oxford Open Access y con apoyo de la Biblioteca Bodleian.

Otras mejoras recientes integradado a COMPADRE y COMADRE ayudará aún más a la comunidad de cientfica. Anteriormente, las bases de datos solo eran accesibles a través de la descarga de un archivo R-Object que contenía todas las matrices en esa versión de la base de datos. La base de datos es ahora accesible a través de un sitio web (<https://compadre-db.org/QueryDatabase>) que permite a los usuarios encontrar y descargar matrices individuales. También nos esforzamos por empoderar a los investigadores y educadores con materiales de enseñanza (<https://compadre-db.org/Education>) y la producción de nuevos paquetes R [@jones2022rcompadre] para facilitar escalabilidad de MPM investigación. Junto con estos materiales, todos los detalles de la estructura de la base de datos y el flujo de trabajo son de acceso libre (<https://jonesor.github.io/CompadreGuides/user-guide.html>). Estas mejoras en las bases de datos y su estructura de interfaz ha sido directamente dirigido a equipar a los demógrafos con más herramientas para realizar investigaciones y capacitar a los estudiantes en MPM's junto con el mejoras en transparencia de la base de datos para garantizar buenas prácticas en la investigación.

5 | Un protocolo estandarizado para reportar MPM's

Aquí presentamos una lista de verificación propuesta sobre cómo reportar un MPM en publicaciones (Recuadro 1). Recomendamos utilizar la lista de verificación cuando diseñar la recopilación de datos, así como al redactar el MPM para publicación. Recomendamos utilizar esta plantilla como apoyo de la información necesaria para los MPM ya que permite una comunicación clara de la construcción de los modelos además de la facilidad para integrar publicaciones MPM a las bases de datos COMPADRE y COMADRE.

6 | La teoría non es estática: la no linealidad, dependencia del medio ambiente y los modelos de múltiple estados.

Los MPM se han convertido en un enfoque predominante en la lista de herramientas en el estudio de ecología de población en parte debido a su simplicidad de construcción y análisis. Pero la teoría subyacente basada en matrices para estudiar demografía no se detiene y en los últimos 20 años ha aumentado espectacularmente. Estos nuevos métodos producen modelos cuya estructura no se ajusta en los marcos para la presentación de informes que parecían tan completos en el pasado. Estos avances recientes en la teoría y los métodos de MPM permiten investigadores vincular la dinámica demográfica y el efecto del medio ambiente sobre la demografía y múltiples rasgos individuales (por ejemplo, sexo y edad) [@childs2016evolution]; edad y parentesco [@Caswell_41_24; @caswell2020formal] en lugar de un solo rasgo de la especie. Estos avances también ofrecen beneficios para el estudio de respuestas de la población al clima extremo [@jenouvrier2022detecting], en adición de investigaciones demográfica más matizadas de aspectos comparativos y evolutivos [@childs2016evolution]. En esta sección repasamos algunas áreas interesantes de demografía estructurada que pueden abrir nuevas preguntas de investigación para el demógrafo y enumerar algunas de las desafíos que plantean para la comunicación y la presentación de informes.

6.1 | Modelos no lineal

Los MPM no lineales son aquellos en los que las entradas de la matriz de proyección dependen del estado de la población (números y estructura) y pueden ser influenciado por la frecuencia o la densidad denso-dependiente. Los modelos que son influenciado por la densidad de frecuencia no lineal dependen sólo de la relativa abundancia de etapas; ellos ocurren en los modelos de dos sexos en los que el apareamiento depende de la relación abundancia de machos y hembras, y en modelos genéticos de poblaciones donde la dinámica depende de la abundancia relativa de genotipos [@de2019selection]. Los modelos denso-dependiente dependen de la abundancia y estructura de la población; ejemplos recientes incluyen a [@pardini2009complex] y [@shyu2013seasonal] para análisis de estrategias de control de la mostaza con ajo *Alliaria petiolata* y de [@de2019selection] para estudios de laboratorio de resistencia a pesticidas en *Tribolium*.

Los análisis de MPM no lineales se centra en los resultados demográficos diferentes a los de los modelos lineales; equilibrios, atractores, bifurcaciones, oscilaciones y estabilidad [ver @caswell2001matrix Capítulos 16 y 17, y @cushing2003chaos para el análisis más detallado]. Sin embargo, ¿qué hace que estos modelos sean problemáticos para la situación actual? El estatus de COMPADRE y COMADRE es que la unidad del modelo no es una matriz, sino más bien una función matricial, en la que las entradas de la matriz de proyección son funciones del estado de la población. Los análisis de sensibilidad están disponibles para estudiar prácticamente cualquier grupo demográfico resultado en respuesta a cualquier parámetro [@caswell2019sensitivity], pero informar las funciones que definen el MPM no lo es en absoluto estandarizado.

6.1 | Dependencia del Ambiente

Un problema similar surge en entornos dependientes del medio ambiente. En algunos modelos, algunas o todas las tasas demográficas son funciones de algunos aspectos del medio ambiente; por ejemplo, los osos polares como funciones de los parámetros estadísticas del hielo marino del Ártico [@regehr2010survival], los sifaka de Madagascar como funciones de lluvia [@lawler2009demography], el pingüino emperador en función de los patrones estacionales del hielo marino en la Antártida [@jenouvrier2012effects] y la ballena franca del Atlántico norte en función del tiempo y de las tendencias en el tiempo [@fujiwara2001demography]. Al igual que con los MPM no lineales, el modelo no es una matriz, sino una función que se mapea desde las variable(s) ambientales a las entradas de la matriz. Los protocolos para informar dichas funciones aún no están disponibles pero es importante desarrollarlas.

6.3 | Modelos de múltiples estados

Un área emergente en la investigación demográfica es la construcción y análisis de MPM multiestatales, en los que se clasifican los individuos por más de una variable de estado. Esto incluye edad y etapa. [@caswell2013age], escenario y localización espacial [@hunter2005selective], estadio y genotipo [@de2019selection], estadio y estado de infección [@klepac2011stage], edad y heterogeneidad no medida [@hartemink2017stochasticity] y etapas específicas de incidencia de enfermedades [@caswell2021healthy]. Una presentación detallada de los métodos se se encuentra en [@caswell2018age] y la extensión a más de dos ejes estatales (los llamados matrices de hiperestado) se proporciona en [@roth2016hyperstate]. La incorporación de estados adicionales permite a los investigadores separar varias fuentes de información individual de heterogeneidad, la varianza en la historia de vida de los individuos del mismo modelo poblacional y sus resultados, en adición de plantear comparaciones más profundas y preguntas evolutivas. Por ejemplo, la edad materna tiene un fuerte impacto en las tasas vitales en rotíferos monogonones [@bock2019maternal]. Aplicando métodos de permutación-vec [@caswell2012matrix] para construir MPM multi-estatales han permitido a los investigadores cuantificar el nivel de población impactos del efecto observado de la edad materna e investigar los procesos evolutivos que pueden conducir a este tipo de senescencia en rotíferos [@hernandez2020demographic]. MPM multidimensionales y los métodos de la cadena de Markov han sido particularmente importantes en el estudio de la "suerte" en las historias de vida, que explora por qué algunos individuos viven mucho tiempo y prosperan, mientras que otros no [@snyder2022snared]. En estudios de "suerte", la variación entre individuos en la historia de vida se divide en contribuciones de la variación entre grupos y dentro del grupo [por ejemplo, @snyder2018pluck; @van2017lifetime]. Ejemplos de fuentes de heterogeneidad individual incluyen edad materna [@van2022contributions], año de nacimiento ambiente [@snyder2022snared] y variación genética [@steiner2021quantifying]. El efecto de la variación dentro se llama estocasticidad individual o "suerte" y surge del hecho de que las tasas vitales son procesos probabilísticos.

Estos modelos plantean un desafío para la presentación de informes porque el MPM no consta de una única matriz, sino de cuatro conjuntos de matrices. Considerar un modelo clasificado como edad × etapa. Esos modelos son compuesto por un conjunto de matrices dando transiciones entre etapas para cada clase de edad, un conjunto de matrices D asignando transiciones de edad para cada etapa y un conjunto de matrices F que asignan transiciones de edad específicas para cada etapa de fecundidad, y un conjunto de matrices H que asignan crías recién nacidas a las edades apropiadas. Estos están ensamblados en matrices de transición y fertilidad estructuradas en bloques a partir de las cuales todos los resultados demográficos habituales se pueden calcular y relacionar con tanto la edad como la etapa [por ejemplo, ver @caswell2013age para un análisis de gradientes de selección tanto para edad como para tamaño].

7 | Discusión

La investigación demográfica ha avanzado mucho desde la introducción de los estudios demográficos a base de edad [@leslie1945use] y modelos matriciales basado en etapas [@lefkovitch1965study]. Los avances en este campo se han visto impulsados en parte mediante una comunicación clara de los métodos y el código asociado. Deseamos continuar expandir el uso de esas herramientas con la comunicación de MPM.

A medida que la profundidad y amplitud de la literatura continúa expandiéndose, estamos empezando a construir una imagen integral de la demografía y explorar el espectro de la vida biologica [@adler2014functional; @healy2019animal; @salguero2017fast]. A través de la base de datos de COMPADRE y COMADRE, hemos llegado a apreciar la utilidad y oportunidades de una forma estandarizada de compilar MPM. De hecho, una parte importante del tiempo (>50%) que dedicamos a curar estas bases de datos en realidad no se trata de digitalización, verificación de errores, y complementar datos, sino en contactar a los autores para obtener aclaraciones y solicitud de datos y metadatos faltantes. A través de este arduo proceso, hemos identificado valiosas información en MPM que no estaba en las publicaciones originales. Si bien los datos faltantes se destacan aquí como particularmente importante y refleja principalmente los intereses y perspectivas de demógrafos comparativos, incluidos los datos descritos en el métodos estandarizado qué beneficiaría a la demografía en su conjunto.

Este artículo pretende actuar como una referencia útil para autores, editores, revisores, gestores/conservacionistas y demógrafos comparativos. Además, esperamos que este manuscrito promueva una discusión constructiva sobre el propósito, la construcción y la presentación de información demográfica a base de etapas. El cuadro 1 contiene un ejemplo completo de la información clave que creemos que debería incorporarse a la publicación de cualquier MPM. Al adoptarse los métodos que se sugiere aquí, habrá claros beneficios para el crecimiento de las bases de datos demográficas COMPADRE y COMADRE; sin embargo, creemos que estos beneficios se extienden más allá de COMPADRE y usuarios de COMADRE hacia todo el campo de la ecología de poblaciones y campos que utilizan MPM para su propia beneficio (por ejemplo, conservación biología y monitoreo de la biodiversidad). Un mayor nivel de detalle y transparencia al describir cómo y por qué se produce un MPM dará como resultado una mayor precisión, accesibilidad, reproducibilidad y citabilidad; eso tiene claros beneficios para el campo en su conjunto y para los investigadores. Además, una mayor coherencia y transparencia facilita la revisión por pares y, de hecho, estas directrices pueden ofrecer una herramienta que puede ser citada por editores asociados y revisores por pares y puede ser recomendado como guia para los pasos sugeridos aquí. Además, la adopción de los pasos sugeridos aquí puede aumentar confianza en los resultados presentados y facilitar el aprendizaje/adopción de MPM por investigadores que inician su carrera.

Finalmente, cerramos con una precaución. Hemos utilizado el término "preciso" en puntos a lo largo de este documento, aplicados a los MPM, pero debemos reconocer que no existe un modelo exacto, ya sea un MPM o cualquier otro tipo. Un modelo es una serie de selección de parámetros, selección de aspectos o variables que se incluyen y otros que no se incluye. La selección de modelos como técnicas de selección como AIC (Akaike Information Criterion; @anderson2002avoiding] hacen estas opciones explícitas y miden su apoyo en términos de probabilidad. Pero incluso sin utilizar el método estadístico explícito, el mensaje es claro. La opciones de "i"-estado/variables, de intervalos de proyección, de tipos de variación temporal, de dependencia funcional de un conjunto elegido de factores ambientales, etc., todos ellos son inexactos. La cuestión no es buscar la precisión: es ser claro al comunicar las decisiones que tomó al construir el modelo, los análisis usted eligió aplicar y la interpretación de los resultados. Una modelo 'precisa' de un sistema ecológico, experimental u observacional sería tan complicado como un sistema real. Eso no termina bien [@borges1999collected].


Supporting Information

Additional supporting information can be found online in the
Supporting Information section at the end of this article.
Data S1: A survey on matrix communication.




<!--chapter:end:20-Traduccion_protocolo_informacion.Rmd-->

# Impactos de datos sin sentido biológicos

Por: Raymond L. Tremblay

```{r}
if (!require("pacman")) install.packages("pacman")
pacman::p_load("DiagrammeR", "Rage", "popdemo", "popbio", "interpretCI", 
               "MCMCpack", "ggplot2", "plyr", "reshape")

```

El valor principal de los estudios científicos proviene en que los datos representa una visión suficiente cerca a la realidad y sirve para inferir información sobre la ecología de la especie de interés. Este supuesto de que los datos representa realmente la realidad es mito, es que esperamos que se acerca a la realidad suficiente para tener confianza en los resultados. En ningún estudio ecológico se podrá obtener **TODOS** los datos para evaluar la relación biótica y abiótica sobre un organismos y todas sus interacciones. Ese modelo es primero demasiado complejo y irreal dentro del concepto de lo que puede lograr un trabajos científicos. El objetivo es tener una apreciación de los parámetros más importante para definir patrones y interacciones suficiente cerca a la realidad para ser útil. Por consecuencia la base de todo estudios esta fundado en las unidades de los muestreos y de la recolección de datos. Si los datos no representa la realidad del estudio la interpretaciones de los análisis pudiese ser errónea. La matemática y sus ecuaciones y modelos no harán que la biología sea más cerca a la realidad si desde el principio los datos y el método de recolección de datos es erróneo.

En esta sección evaluamos diferentes aspectos de los análisis matriciales poblacional de proyección y diferentes aspectos de la recolección de datos que pudiese ser problemáticos cuando uno considera la biología de una especie. La lista de *Impactos* no pretende incluir todos las posibles efecto de datos sin sentido, sino unos ejemplos si uno no considera estos problemas y cómo pueden distorsionar las interpretaciones. Por lo tanto, una advertencia a todos los biólogos de población para que estén consciente de estos temas y siempre evaluar críticamente si los datos desde la recolección a los análisis y interpretaciones considerando que es solamente un modelo (una caricatura) de muchos posibles. 

***

## Tamaño de muestra pequeñas o eventos raros

Sin duda, el tema principal para el uso de PPM ha sido evaluar la proyección de población de especies raras o en peligro de extinción (otras cuestiones son ecológicas o evolutivas) [@caswell2000matrix; @gascoigne2023standard]. En consecuencia, las especies raras o en peligro de extinción son naturalmente pequeñas y el tamaño de la muestra del estudio o de algunas de las etapas/edades de la vida son frecuentemente pequeñas. Estos tamaños de muestra reducidos provocan estimaciones de parámetros y, a menudo, resultados sin sentido biológicos. Algunos de los problemas incluye no haber observado eventos raros (transiciones pocos comunes), como la muerte de un adulto o la germinación de una semilla. En estos casos, la probabilidad de supervivencia o transición pudiese ser de cero, lo que pudiese resultar en una matriz reducible o no irreducible.

***

### Sin Mortalidad/Supervivencia Perfecta

Muestreos donde uno no observa mortalidad o una supervivencia perfecta son problemáticos. Considere una especie donde se recopilan datos de una especies **Sp1** y la matriz de transición **Sp1matU** y la matriz de fertilidad es **Sp1matF** siguientes son un ejemplo de este caso. Nota que ninguno de los individuos murió en la etapa adulta (supervivencia perfecta). En consecuencia, el tamaño de la población nunca disminuye o aumenta después de un período de tiempo. Bajo TODOS los modelos biologícamente realistas, esperaríamos que el tamaño de la población comenzaría a disminuir si una población no tiene reproducción, ademas que ninguna especie tiene una probabilidad de supervivencia de 100% (0% de probabilidad de mortandad). Pero en este caso como todos los individuos de la etapa sobreviven la población es *eterna* (algo irreal).

```{r, message=FALSE}
library(DiagrammeR)

Sp1matU <- rbind(
  c(0.0, 0.0, 0.0),
  c(0.5, 0.3, 0.0),
  c(0.0, 0.4, 1.0)
) # transition matrix

Sp1matF <- rbind(
  c(0.0, 0.0, 1.0),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA = Sp1matU+Sp1matF # TF matrix
library(Rage)
stages <- c("plantula", "juvenil", "adulto")

plot_life_cycle(Sp1matA, stages=stages, fontsize = 0)
```

Si analizamos esta matriz asumimos que ninguno de los individuos en etapa adulta muere, en ningún momento!!!. Claramente esto no es realista. Para cualquier especie, la probabilidad de muerte en cualquier etapa nunca es cero (aunque podría ser muy pequeña) y, por lo tanto, nuestra matriz no tiene sentido. Considere una especie de árbol, como los arboles de *Sequoia*, es probable que para los árboles grandes de esta especie la supervivencia sea muy alta entre un año y otro y nuestro muestreo observado es de 100%, pero ese 100% no es realista a largo plazo. Hay que diferenciar entre lo que se observa en un periodo de muestreo y las probabilidades a largo plazo. Es posible que en el sitio donde se muestreo NO se observo mortalidad de los arboles grandes entre dos periodos de muestreo, que resultaría en una mortalidad de cero pero no es un valor real a largo plazo. Ese estimado de campo puede ser un resultado de tamaño de muestra pequeña o que estos eventos son raros (aun con tamaño de muestra grandes). 

En el siguiente *script* mostramos que la población no cambia después de 7-8 periodos/años y se mantiene cercana a uno y no cambia (usamos la matriz de transición sin fecundidad). Si no hay reclutas (matriz de fertilidad), el tamaño de la población debería reducirse con el tiempo. Todo modelos de transiciones que no incluye la matriz de fertilidad (solamente la matU) debería resultar en reducción de tamaño poblacional en tiempo.

```{r}
n=c(50,50,50)

library(popdemo)
library(popbio)
truelambda(Sp1matU) # despues de unos periodos de tiempo vemos que el crecimiento poblacional es 1
pop.projection(Sp1matU, n=n)$pop.changes # lista del cambio poblacional en 16 años
```

***

#### Un cambio pequeño en la mortalidad.

El efecto de aumentar el tamaño de muestra impacta directamente los posibles valores en la matriz.  Considera la siguiente situación.  ¿Si tenemos solamente 5 individuos en la etapa uno, cual son la valores posible de mortalidad? Ningun individuo muere, o 1, 2,...o todos los individuos mueren. Entonces las probabilidades que entraría en la matriz son 0, 0.2, 0.4, 0.6, 0.8, 1.0.   NOTA que los valores intermedios NO existen en la matriz.  Por lo tanto, si uno tiene un tamaño de muestra pequeño, es probable que los valores en la matriz no representan la realidad biológica. 

Ahora si aumentamos el tamaño de muestra con los resultados visto en la siguiente matriz, el tamaño de muestra tiene que haber sido mucho mayor. Este valor sugiere que se muestreo 1000 individuos y que 995 sobrevivieron. Si el tamaño fue de 1000, uno pudiese tener mayor confianza en el parámetro. Tenga en cuenta que en este nuevo modelo de la especie *SP1*, aunque la tasa de supervivencia es muy cercana a 100% (0,995) es posible una disminución de la población en cada período de tiempo (aunque solo sea en una pequeña fracción). Siempre hay que considerar si esta taza de mortalidad es biologícamente real o es un resultado del tamaño de la muestra. 



```{r}
Sp1matU_2 <- rbind(
  c(0.0, 0.0, 0.0),
  c(0.5, 0.3, 0.0),
  c(0.0, 0.4, 0.995)
) # transition matrix

Sp1matF <- rbind(
  c(0.0, 0.0, 1.0),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA_2=Sp1matU_2+Sp1matF

pop.projection(Sp1matU_2, n=n)$pop.changes


```


En la mayoría de las investigaciones el tamaño de muestra es limitado. Por lo tanto, es importante considerar si la tasa de mortalidad/transición es realista y si el tamaño de la muestra es suficiente para estimar la tasa de mortalidad/transición con confianza. Si la tasa de mortalidad es muy baja cerca de cero o 100%, es probable que el tamaño de la muestra sea demasiado pequeño para estimar la tasa de mortalidad con precisión. En consecuencia, la tasa de mortalidad estimada puede ser lejos de la realidad si hubiese tenido un estimado basado en una *N* más grande. 


Cual son los tamaños de muestra típica en los estudios de orquídeas?
Recopilado por Fabiola Hernández-Ramirez

Hacer una lista de algunas especies de orquídeas y sus tamaños de muestra.





***

### Irreductibilidad: No hay transiciones entre etapas

La *irreductibilidad* es un concepto importante en los análisis de matrices poblacionales. Como lo muestra [@caswell2000matrix] y explorado más recientemente por [@stott2010reducibility], las matrices deben de ser *irreducibles*. El concepto de *irreductibilidad* está asociado con el ciclo de vida de la especie y la matriz incluye las transiciones de todas las etapas a todas las demás etapas. En la figura del ciclo de vida anterior le faltan dos componentes importantes en la historia de vida de la especie, ningún juvenil crece para convertirse en adulto y ninguno de los adultos produce plántulas (semillas que crecen hasta convertirse en plántulas).

En el escenario actual, los juveniles no crecen para convertirse en adultos, todos los juveniles siguen siendo juveniles o mueren. Tenga en cuenta la figura del ciclo de vida donde no hay flechas que conecten a los juveniles con los adultos.

```{r}
library(DiagrammeR)

Sp1matU_NT <- rbind(
  c(0.0, 0.0, 0.0),
  c(0.5, 0.7, 0.0),
  c(0.0, 0.0, 0.995)
) # transition matrix

Sp1matF <- rbind(
  c(0.0, 0.0, 1.0),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA_NT = Sp1matU_NT+Sp1matF # TF matrix
library(Rage)
stages <- c("plantula", "juvenil", "adulto")

plot_life_cycle(Sp1matU_NT, stages=stages, fontsize = 0)
```


#### Función para evaluar si una matriz es irreducible

Una manera fácil de determinar si la matriz es irreducible es correr el siguiente script *isIrreducible* en el paquete (popdemo). Tenga en cuenta que, en este caso, el resultado es *Falso* para la matriz anterior.

```{r}
isIrreducible(Sp1matU_NT) # para la matriz de transición, faltando una etapa de transición y fertilidad
isIrreducible(Sp1matA_NT) # para la matriz TF, falta una etapa de transición

# Ahora considerando Sp1matA_2
# En esta matriz que incluye todas las transiciones y la fertilidad el resultado es "TRUE"
Sp1matA_2
isIrreducible(Sp1matA_2) 
```

***

### Ninguna supervivencia

La mortalidad es uno de los estadios del ciclo de vida de una especies, pero raramente se añade al diagrama del ciclo de vida porque es implícito en los cálculos, la 1-suma de la columna es la proporción de mortalidad de esta etapa. A menudo se observa que la supervivencia de los individuos más pequeños o la primera etapa del ciclo de vida de una especie es muy arriesgada, donde la probabilidad de supervivencia es muy baja. Por ejemplo, la mayoría de las semillas no sobreviven para germinar. Esta es probablemente la norma en las orquídeas donde la producción de semillas es muy alta, a veces millones de semillas en una cápsula [@arditti2000numerical], pero pocas germinan (ref). Sin embargo, esto no se limita a las orquídeas, en los árboles se puede observar el mismo patrón, por ejemplo, en *Nothofagus pumilio* el reclutamiento de plántulas fue inferior al 1,5 % [@torres2015seed]. En general los patrones de germinación *In Situ* varia por grupos taxonómicos y distribución ecológica [@iralu2019ecology] .

Como es bien conocido en el campo, la germinación de semillas en las orquídeas no es sencilla ya que depende de la disponibilidad de mycorhizae [@rasmussen1995terrestrial].  Hay evidencia que las micorhizae son especifica por las especies orquídeas [@balducci2024narrow] y al contrario no son especificas [@petrolli2022spatial], pero sin duda la diversidad asociado a la germinación no limitado a ciertos grupos taxonómicos de hongos [@rasmussen2015germination]. Muchas variables pueden influir en la germinación de semillas incluyendo las condiciones abióticas y bióticas [@callaway2002epiphyte; @rasmussen2015germination; @gonzalez2024host] pero aun no hay mucha información sobre la germinación de semillas de orquídeas en la naturaleza al comparar con los trabajos en el laboratorio.

En el gráfico del ciclo de vida actual, ninguna de las plántulas sobrevive o crece a la siguiente etapa. Tenga en cuenta que en la primera columna de la matriz de transición todos los valores son cero. La población puede haber comenzado con muchas (incluso miles) de plántulas, pero ninguna creció hasta convertirse en un juvenil o permaneció como plántula antes del siguiente muestreo. Esto da como resultado una matriz que es reducible *isIrreducible* = *FALSE* y por consecuencia no cumple con los requisitos necesarios para muchos de los análisis de matrices poblacionales.


```{r}
library(DiagrammeR)

Sp1matU_NS <- rbind(
  c(0.0, 0.0, 0.0),
  c(0.0, 0.7, 0.0),
  c(0.0, 0.25, 0.995)
) # transition matrix

Sp1matF <- rbind(
  c(0.0, 0.0, 1.0),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA_NS = Sp1matU_NS+Sp1matF # TF matrix
library(Rage)
stages <- c("plantula", "juvenil", "adulto")

plot_life_cycle(Sp1matU_NS, stages=stages, fontsize = 0)

isIrreducible(Sp1matU_NS)
```

***

## Redondeo excesivo de valores

Uno de los errores más comunes en la construcción de los elementos de la matriz es el error de redondeo excesivo u otras estimaciones que dan como resultado valores de supervivencia superiores a 100%. Una estimación de supervivencia de mayor de 1.00 es que de la nada aumenta (por milagro matemático) la cantidad de individuos sin reproducción o clonaje. El estimado de supervivencia de una etapa siempre tiene que ser menor o igual a 100%. En el siguiente ejemplo, la supervivencia de las plántulas es 1.01, lo que significa que la población de plántulas aumenta en un 1% en cada período de tiempo (pero no por reproducción o clonaje). Esto es un error en la recolección de datos o en el cálculo de la supervivencia de la etapa.


Por ejemplo en un análisis de *Serapia cordigera* [@pellegrino2014effects]. Aquí los autores evaluaron las transiciones entre latencia, plántulas, roseta vegetativa y floración, en este orden aparece en la matriz. Aquí mostramos una de estas matrices que esta incluida en el material suplementario del articulo. Período de tiempo 2001-2002, A1. En la primera columna de la matriz de transición, la supervivencia de las plántulas es 1.01, lo que significa que la población de plántulas aumenta en un 1% en cada período de tiempo. Esto es un error que es probablemente debido al redondeo de los parámetros de la supervivencia y transiciones de esta etapa. 

```{r}
library(DiagrammeR)

SerapiaU <- rbind(
  c(0.668, 0.122, 0.294, 0.401),
  c(0.128, 0.000, 0.000, 0.000),
  c(0.000, 0.302, 0.453, 0.366),
  c(0.214, 0.364, 0.185, 0.207)
) # transition matrix

colSums(SerapiaU) # la suma de las columnas, nota que la primera columna es mayor de 100%. 

SerapiaF <- rbind(
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0, 0.0)
) # fertility matrix

SerapiaA = SerapiaU+SerapiaF # TF matrix
library(Rage)
stages <- c("latente", "plantulas", "vegetativa", "adulto")

plot_life_cycle(SerapiaA, stages=stages)

# Tenga en cuenta que la suma de supervivencia para la etapa inicial es mayor de 1, igual a 1.01

```

***

## Estimaciones de fertilidad y ciclo de vida

La importancia de considerar cómo se incluye la fertilidad en el ciclo de vida es extremadamente influyente en los resultados de los modelos, y si se considera erróneamente puede dar lugar a interpretaciones sin sentido. Mostramos algunos ejemplos de cómo estos pueden incluirse en el ciclo de vida y la matriz y dar como resultado problemas de causa. Vea el capitulo \@ref(Fertilidad) para más detalle.

### **QUIERO OTRO EJEMPLO DE ESTO**

### Ciclo de vida y etapa de fertilidad incorrectos

Suponga que tiene una especie en la que modela el ciclo de vida como plántula, juvenil y adulto. La fertilidad se mide como el número de semillas producidas por un adulto (número medio de semillas por adulto). Después de recopilar los cálculos de datos, se determina que el número medio de semillas por adulto es 1100. Si agregamos a la matriz de transición y fertilidad a continuación y evaluamos el lambda y graficamos el crecimiento de la población con la función *proyect*, tenemos un lambda de 4.93 y después de solo 5 períodos de tiempo, el número de adultos supera los 250,000. Por consecuencia, la estimación de la tasa de crecimiento de la población sería incorrecta y engañosa, donde 30% de 11,000 semillas crecen a ser plántulas, un total de 3,300 plántulas!!!

El error es que el valor en la matriz de fertilidad debería corresponder a la primera etapa de la matriz, en este caso la etapa de plántula. Por lo tanto, la esquina superior derecha de la matriz de fertilidad NO debe ser la **cantidad media de semillas** por planta, sino la **cantidad media de semillas que transitan a plántulas** producidas por una planta adulta.

```{r}
library(DiagrammeR)

Sp1matU_Fert <- rbind(
  c(0.0, 0.0, 0.0),
  c(0.3, 0.7, 0.0),
  c(0.0, 0.25, 0.995)
) # matriz de transición

Sp1matF <- rbind(
  c(0.0, 0.0, 1100.0),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
) # matriz de fertilidad

Sp1matA_Fert = Sp1matU_Fert+Sp1matF # TF matriz combinada: matA = matU + matF
library(Rage)
stages <- c("plantula", "juvenil", "adulto")

lambda(Sp1matA_Fert)
  
# El cambio de tamaño de la población en 5 periodos de tiempo
n
pr <- project(Sp1matA_Fert, vector="n", time=5)
plot(pr) # Nota que después de solamente 5 años ya la población aumentó a 250,000 individuos
```

Si deseamos agregar una etapa de semilla, debemos incluir la etapa en nuestro modelo y matriz con una nueva etapa *la etapa de semilla*, y tener una estimación del número de semillas que germinan y se convierten en plántulas. En el caso de las orquídeas, es probable que sea una estimación difícil de lograr porque las semillas de las orquídeas son difíciles de seguir en la naturaleza a menos que se haya usado el método del paquete de semillas [@rasmussen1993seed; @batty2006situ; @shao2024improved] o se utilizó algún método de huella genética para determinar la procedencia de las semillas. Por lo tanto, la estimación de la fertilidad en las orquídeas es un desafío y requiere un muestreo y análisis cuidadoso. A continuación una matriz modificada con la etapa de semillas y la cantidad de semillas promedio por adulto. 


```{r}
library(DiagrammeR)

Sp1matU_Fert2 <- rbind(
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0001, 0.0, 0.0, 0.0),
  c(0.0, 0.3, 0.7, 0.0),
  c(0.0, 0.0, 0.25, 0.995)
) # transition matrix

Sp1matF2 <- rbind(
  c(0.0, 0.0, 0.0, 1100.0),
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA_Fert2 = Sp1matU_Fert2+Sp1matF2 # TF matrix
library(Rage)
stages <- c("semillas", "plantula", "juvenil", "adulto")

plot_life_cycle(Sp1matA_Fert2, stages=stages)

lambda(Sp1matA_Fert2)

# show change in population size
pr <- project(Sp1matA_Fert2, vector="n", time=5)
plot(pr) # Note that now the number of adults did not increase to the level of the previous model
```



En el ejemplo anterior no hemos incluido una etapa de latencia de semillas. En muchas especies de plantas, las semillas pueden permanecer latentes durante uno o más años. No se sabe si las semillas de las orquídeas están inactivas durante mucho tiempo [gale2010constraints], excepto para algunas especies que han demostrado que las semillas aún están vivas después de varios años en el suelo usando la prueba de tinción de tetrazolio [@rasmussen1993seed y @whigham2006seed]. **MAS REFERENCIAS!!**

***

## Problemas de análisis de datos

### Estimaciones de intervalos de confianza incorrectas

Las estimaciones de dispersión en los parámetros de la matriz de supervivencia, transición, muerte y fertilidad son útiles por múltiples razones. El enfoque más básico es comprender la incertidumbre en el parámetro como una función del tamaño de la muestra, los parámetros con gran dispersión deben verse con precaución. Los parámetros de dispersión pueden ser útiles para simulaciones y comprender la incertidumbre en los parámetros de población como lambda y la probabilidad de persistencia y extinción.

Los parámetros de supervivencia, muerte, estasis y transiciones NO se distribuyen normalmente ya que los valores van de cero a 1. Ningún valor puede ser menor que cero o mayor que uno, incluidos los intervalos de confianza del 95 % (limitados por 0 y 1). Si se usa la distribución gaussiana (normal) es probable que el intervalo de confianza del 95 % esté fuera de los límites. Supongamos que deseamos calcular la probabilidad de supervivencia de una etapa y sus intervalos de confianza del 95%.

Se determina que de 20 individuos 1 fallecen y 19 sobrevivieron entre el primer muestreo y al segundo muestreo.

-   Construya un intervalo de confianza del 95% de la proporción de individuos que murieron

Donde la proporción que murió es $\hat{p}$ y el número que murió es $n_d$ y $n$ es el tamaño de la muestra

$$\hat{p}=\frac{n_d}{n}$$ con una probabilidad de muerte del 20%.

```{r}
p=1/20
p
```

El IC del 95% de una proporción se calcula usando la siguiente formula si se asume una distribución normal

$$\hat{p}\pm Z_{0.05}*\sqrt{}(\frac{\hat{p}(1-\hat{p})}{n})$$ 
  - Z\_{0.05} es el valor crítico de Z para un IC del 95% = 1.955. Nota que ese calculo, uno de los intervalos de confianza es negativo lo que es ilógico.

```{r}
n=20
HCI=p+(1.96*sqrt((p*(1-p))/n)) # IC alto
HCI

LCI=p-(1.96*sqrt((p*(1-p))/n)) # IC bajo
LCI # Nota que el valor es sin sentido, ya que es negativo (que es una proporción negativa?)
```

Un método más fácil es usar la función R *propCI* de la **library(interceptCI)**. La función *propCI* calcula el intervalo de confianza del 95% de una proporción binomial. La función requiere el tamaño de la muestra, el número de eventos (1 individuos fallecieron) y el nivel de significancia. En este caso, el tamaño de la muestra es 20, el número de eventos es 1 y el nivel de significancia es 0.05. Nota que el intervalo de confianza incluye valores negativos. Para resolver esto hay que usar funciones estadísticas alternativas como la distribución de Dirichlet donde no se distribuye de forma normal.

```{r}
library(interpretCI)

resultado=propCI(n=20, p=0.05, alpha=0.05)

resultado
```

***

## Distribución Dirichlet de intervalo de confianza

Sin embargo, ¿cómo se calcula el IC del 95% cuando hay más de 2 proporciones? Debido a que la proporción de todas las etapas depende de la proporción de las otras etapas, el análisis debe considerar la proporción y el IC del 95% debe incluir todas las etapas simultáneamente. La función requerida es la función de Dirichlet multinomial (multigrupo).

La distribución de Dirichlet es una distribución de probabilidad continua multivariables que se utiliza para modelar la distribución de proporciones en un espacio de probabilidad. La distribución de Dirichlet es una generalización de la distribución beta a más de dos categorías. La distribución beta esta limitado a valores de zero a uno inclusivo. La distribución de Dirichlet se utiliza comúnmente en el análisis de datos de proporciones, donde las proporciones de las categorías deben sumar a uno.

En el análisis estimamos los intervalos de confianza del 95% de la transición y estasis de plántulas a plántulas (50%), juveniles (20%), adultos (0%) y muerte (30%). Tenga en cuenta el gráfico del ciclo de vida que, como de costumbre, excluye la probabilidad de que mueran las plántulas.

```{r}

Dirichlet <- rbind(
  c(0.5, 0.0, 0.0),
  c(0.2, 0.0, 0.0),
  c(0.0, 0.3, 0.7)
) # transition matrix

library(Rage)
stages <- c("plantula", "juvenil", "adulto")

plot_life_cycle(Dirichlet, stages=stages)
```

Para evaluar el intervalo IC del 95% simultáneamente de las cuatro transiciones simultáneamente (plántulas a plántulas, plántulas a juvenil, plántulas a adultos y plántulas a muerto), usamos la **library(MCMCpack)**, que es un paquete dedicado a realizar simulaciones de *Markov Chain Monte Carlo*. Usaremos la función *MCmultinomdirichlet*. Tenga en cuenta que la primera lista son las proporciones que se muestran en la matriz para la etapa de plántula c(.50*n,.02*n,.0*n,.3*n) multiplicadas por el tamaño de la muestra n= 25. La segunda lista son los priores bayesianos c(0.5,0.2,0.0001,0.2999), en este caso asumí que la suma de los previas es igual a 1. Esto da como resultado una confianza muy baja en la percepción previa de lo que es la transiciones. Estamos dando muy poco peso a la percepción previa en los análisis. Otro tipo de previa para la transición es que sean iguales, sin embargo, podríamos haber usado c(1,1,.0001, 1), donde este previa sugiere una transición igual para todos menos las plántulas que hay muy poca probabilidad que crezcan hasta convertirse en adultos. IMPORTANTE: las previas deberían ser biologicamente realistas, usando lo conocido de la biología de los organismos que se estudian. Por experiencia y literatura se puede hacer un estimado de las transiciones y usarlo como previa. El concepto de lo anterior no se puede explicar completamente aquí, consulte las siguientes referencia [@tremblay2021population; @van2021bayesian]. 

Los resultados en la figura muestran que hay mucha dispersión alrededor de la proporción media de las estadísticas y la transición como se esperaba debido al pequeño tamaño de la muestra. 

 - Hacemos una simulación de 10000. 
 - recolectamos los resultados en la variable **L**.
 - Convertimos esta lista en un data frame.
 - Re-organizamos el data frame para que sea más fácil de gráficar con la función *stack*.
 - Añadimos una columna con el tamaño de muestra, n=25. 
 - Cambiamos los nombres de las etapas de la vida para que sean más fáciles de leer en la gráfica.
 

```{r, message=FALSE}

library(MCMCpack)
```

```{r}
library(gt)
n=25
L=posteriorPRIORL <- MCmultinomdirichlet(c(.50*n,.2*n,.0*n,.3*n), c(.5,.2,0.0001,.3), mc=10000)
dfL=as.data.frame(L)
t(summary(dfL))

#head(dfL)
stack_dfL=stack(dfL)
comb_dfbL= cbind(stack_dfL, T="25")

All_Data3=comb_dfbL
levels(All_Data3$ind)[levels(All_Data3$ind)=="pi.1"]="Plantulas"
levels(All_Data3$ind)[levels(All_Data3$ind)=="pi.2"]="Juvenil"
levels(All_Data3$ind)[levels(All_Data3$ind)=="pi.3"]="Adulto"
levels(All_Data3$ind)[levels(All_Data3$ind)=="pi.4"]="Muerto"

```


- Graficamos los resultados

```{r}
library(ggplot2)
ggplot(data=All_Data3, aes(x=values, fill=ind))+
  geom_density(alpha=.5) +
  scale_y_continuous(limit=c(0, 5.5))+
  scale_colour_hue(l=60)+
  facet_grid(~ind)+
  ylab("La distribución de las proporciones \n de plantulas que crecen a la siguiente etapas")+
  xlab("Proporciones")+
  labs(fill="Etapa de vida")



```

Ahora calculemos el IC del 95% de las transiciones

-   Intervalos de confianza de transiciones, estasis y supervivencia basados en simulación y distribución de Dirichlet.

Aspectos importantes a tener en cuenta.

-   los IC del 95% están acotados entre 0 y 1. Los valores por debajo de cero o por encima de uno en los parámetros no tendrían sentido.
-   la suma de los promedios es igual a 1.
-   la forma de la distribución NO se distribuye normalmente, ver figura anterior. La forma de la distribución se llama distribución beta.

```{r}

library(plyr)
library(reshape2)

Transitions=ddply(All_Data3, c("ind"), summarise,
            mean = round(mean(values),3), sd = round(sd(values),4),
            median= median(values),
            #sem = round(sd(values)/sqrt(length(values)),6),
            CI5 = quantile(values, probs = c(0.05)),
            CI95 = round(quantile(values, probs = c(0.95)), 4),
            min=min(values),
            max=max(values)
            )

Transitions

```


*** 

### Tamaño de muestra y estimaciones de intervalos de confianza con n=250

Para comparar con el ejemplo anterior asumimos que en lado de tener solamente 25 plantas teníamos 250 plantas para los estimados.

Nota que la mediana sigue en el mismo lugar (casi) pero los IC cambian mucho y son más reducido el ancho de la dipersión, ya que con más datos en el muestreo resulta en más confianza y reducción en el IC. Este análisis es primordial para entender la confianza que uno debería tener sobre los estimados de los parámetros de la matriz. Si se observa un IC muy grande eso pudiese ser utilizado para modificar la recolección de datos en el campo para aumentar el tamaño de muestra de esa etapa especifica.

```{r}
b=250
L=posteriorPRIORL <- MCmultinomdirichlet(c(.50*b,.2*b,.0*b,.3*b), c(.5,.2,0.0001,.3), mc=10000)
dfL=as.data.frame(L)
t(summary(dfL))

#head(dfL)
stack_dfL=stack(dfL)
comb_dfbL= cbind(stack_dfL, T="25")

All_Data4=comb_dfbL
levels(All_Data4$ind)[levels(All_Data3$ind)=="pi.1"]="Plantulas"
levels(All_Data4$ind)[levels(All_Data3$ind)=="pi.2"]="Juvenil"
levels(All_Data4$ind)[levels(All_Data3$ind)=="pi.3"]="Adulto"
levels(All_Data4$ind)[levels(All_Data3$ind)=="pi.4"]="Muerto"

library(ggplot2)
ggplot(data=All_Data4, aes(x=values, fill=ind))+
  geom_density(aes(alpha=.5)) +
  scale_y_continuous(limit=c(0, 18))+
  scale_colour_hue(l=60)+
  facet_grid(~ind)+
  labs(fill="Etapa de vida")



```


### Los estimados de Intervalo de camfianza con una n=250

```{r}

library(plyr)
library(reshape2)

Transitions=ddply(All_Data4, c("ind"), summarise,
            mean = round(mean(values),3), sd = round(sd(values),4),
            median= median(values),
            #sem = round(sd(values)/sqrt(length(values)),6),
            CI5 = quantile(values, probs = c(0.05)),
            CI95 = round(quantile(values, probs = c(0.95)), 4),
            min=min(values),
            max=max(values)
            )

Transitions

```

<!--chapter:end:21-Impacto_de_Datos_sin_Sentido.Rmd-->

# Nhora


Por: Nhora




<!--chapter:end:22-Nhora_Dracula.Rmd-->

# Dinámica transitoria (Transient dynamics)

Autores: "Mariana Hernández Apolinar y Paola Portillo Tzompa"

## Dinámica poblacional de largo y corto plazo

Los modelos de proyección poblacional (MPP), previamente vistos en la *Sección XX*, son de carácter determinístico; es decir, éstos suponen que las muertes, la reproducción y el crecimiento individual (i.e. tasas vitales) en las distintas categorías de la población no varían en el tiempo; por lo tanto, al mantenerse constantes la población crece a una velocidad constante y la proporción de individuos por categoría de tamaño/estado no cambia en el largo plazo [@bierzychudek1999looking; **Caswell, 2001? es el libro?**]. Sin embargo, en la naturaleza estas variables distan de ser constantes, debido a que las poblaciones experimentan recursos limitados, ambientes heterogéneos tanto abioticos y bioticos y cambiantes que perturban las poblaciones, afectando su dinámica y sugiriendo que la tasa de crecimiento de largo plazo no es un buen predictor de los cambios que enfrentan dichas las poblaciones [@bierzychudek1999looking; Caswell, 2001]. De ahí que, se hayan desarrollado modelos que integran dicha variación y que permiten hacer proyecciones más realistas sobre la dinámica poblacional de la especie de estudio, tal es el caso de los modelos de de crecimiento estocástico y los análisis de dinámica transitoria.

En particular, los análisis de la dinámica transitoria surgen como una alternativa para analizar cómo cambia la dinámica de una población en el tiempo al presentarse un evento de perturbación (cambios bioticos o abioticos en el tiempo). En este análisis se evalúa la respuesta de la población en el corto plazo; es decir, antes de alcanzar la estructura estable de estadios/edades y de crecer a una tasa constante **(ref)**. Dicha respuesta se determina a través de las discrepancias o diferencias que hay entre la estructura actual (i.e. corto plazo) y la estructura estable (i.e. largo plazo) de la población analizada [@raventos2015transient].

Debido a que el análisis de la dinámica transitoria es complejo, para facilitar y asimilar su desarrollo, a continuación se listan la serie de pasos que se deben seguir. El análisis se lleva a cabo en el Programa de estadística *R* y la serie de pasos fue definida por Stott y colaboradores [@stott2011framework; @stott2012beyond; @stott2012popdemo].

<br>

*Paso 1. Matriz de transición y estructura poblacional inicial*.

En primer lugar se debe contar con una matriz de proyección poblacional y su vector correspondiente de la estructura poblacional observada al inicio del estudio. En en este caso se usarán los datos obtenidos para *Lepanthes rubripetala* por Tremblay y colaboradores [@tremblay2015stable; @schodelbauerova2010prediction].

## PROYECTO DE DINAMICA TRANSITORIA O DE CORTO PLAZO

### PART I: DINÁMICA POBLACIONAL DE LARGO PLAZO

Este es un análisis de dinámica transitoria para *Lepanthes rubripetala* (Población 1) con cuatro clases de estado en su ciclo de vida:

-   plántula,

-   juvenil,

-   adultos no reproductivos,

-   adultos reproductivos.

<br>

### PASO 1. MATRIZ DE PROYECCIÓN POBLACIONAL y ESTRUCTURA POBLACIONAL INICIAL $t_{0}$

```{r Extra1, message=FALSE}


#Librerias de R requeridas para el análisis 
library(popdemo)
library(popbio)

#Capturar los datos de la matriz para L. rubripetala (Tremblay et al. 2015)
Lr <- matrix(c(0.4324, 0,      0,     0.15,
               0.3784, 0.8459, 0,     0,
               0,      0.0034, 0.7954,0.2300,
               0,      0.0890, 0.1841,0.7510), byrow=TRUE,ncol=4)

#Capturar las categorias de estado
categoria <- c("1","2","3","4")

#Obtener la matriz L. rubripetala 
Lr1 <- matrix(Lr[1:4, ], nrow = 4, dimnames = list(categoria, categoria))
Lr1

```

<br>

#### Capturar y obtener el vector inicial (datos de campo) de clases de estado población 1

Los datos provienen de la siguiente fuenta: [@tremblay2015stable; @schodelbauerova2010prediction] y se refieren a la estructura poblacional inicial de *Lepanthes rubripetala* en la población 1. La estructura poblacional inicial de la población 1 de *L. rubripetala* fue la siguiente:

-   plántula, n= 0

-   juvenil, n= 46

-   adultos no reproductivos, n= 38

-   adultos reproductivos, n = 82

```{r}


n0 <- c(0, 46, 38, 82) 
n0

```

<br>

*Paso 2: Condiciones que debe cumplir la matriz de estudio*.

Previo al análisis de dinámica transitoria se debe comprobar que la matriz de transición poblacional sea: a) Irreducible, que los elementos de la matriz de análisis y, por lo tanto, los nodos de la gráfica del ciclo de vida, estén fuertemente conectados, tengan una ruta, de modo que formen un ciclo. b) Ergódica, que la dinámica asintótica sea independiente de las condiciones iniciales (i.e. estructura poblacional inicial)\
c) Primitiva, que al elevar a altas potencias una matriz irreducible positiva (i.e. sin elementos negativos) su resultado sea único y tenga un sólo valor positivo (i.e. tasa de crecimiento poblacional). (Caswell, 2001)

Así que, a continuación se comprueba si la matriz de *L. rubripetala* cumple con estas condiciones o supuestos.

#### Definición de términos Ergodicidad, Irrecucible y Primitiva

-   El primer punto para cualquier análisis de dinámica poblacional es que la matriz tiene que ser cuadricular n\*n y no negativa.

-   La matriz tiene que ser **ergódica**: Irrelevante de la estructura de etapas inicial que se usa para proyectar el crecimiento poblacional siempre tendrá el mismo crecimiento asintomático.

-   La matriz tiene que ser **irreducible**: El ciclo de vida de la especie tiene las transiciones para que cualquier etapas puede llegar a todas las otras etapas.

Para una discusión sobre estas condiciones vea a [@stott2010reducibility]

Para evaluar si las matrices son ergodica y irreducible se usa las funciones **isErgodic** y **isIrreducible**. Vea que en las cajas siguiente el resultado es "TRUE" por consecuencia cumple con ambas condiciones.

#### a) Ergodicidad

```{r Extra2}


ergo <- isErgodic(Lr1, digits = 5, return.eigvec = FALSE)
ergo
```

#### b) Irreducible

```{r chap10_irreduc}
irreduc <- isIrreducible(Lr1)
irreduc


```

<br>

*Paso 3: Análisis demográfico básico*.

En el análisis de dinámica transitoria necesitamos conocer cómo se comporta una población en el largo plazo, por lo que se proyecta el crecimiento poblacional de tipo asintótico para la matriz de la población seleccionada. Entonces, a partir de la matriz de proyección poblacional y el correspondiente vector de la estructura poblacional observada al inicio del estudio de *L. rubripetala*, calcularemos la tasa de crecimiento poblacional (i.e.*lambda*, de ahora en adelante *lambda-max*), la estructura poblacional estable (*w*, de ahora en adelante *w-max*) y el valor reproductivo (*v*), así como las matrices de sensibilidad y elasticidad. Con este fin, usaremos el procedimiento de la *Sección X*, desarrollado en el *Programa "popbio" de R*.

Además de esta información, se estimarán dos nuevos términos: el tiempo de convergencia (*convergence-time*) y la relación de amortiguamiento (*damping-ratio*). El primero indica el tiempo esperado en que una población alcanza la estructura estable, mientras que el segundo es una medida de que tan rápido converge una población a la estructura estable (Caswell, 2001).

### Crecimiento asintótico

La definición del crecimiento asintótico de la población *lambda* se basa en la tasa de crecimiento poblacional cuando la población este a su nivel estable de estructura de edades/estados. Por consecuencia se asume que la población llegue o este a un nivel estructura de edades/estados estable.

Para la población de *Lepanthes rubripetala* se obtiene una tasa de crecimiento poblacional de 1.007, lo que indica que la población crece a una tasa constante de 1.007 entre $t_{0}$ y $t_{1}$. Entonces si la población tuviese 1000 individuos hubiese 7 individuos más en $t_{1}$.

```{r Extra3}

#Análisis asintótico (i.e. largo plazo) del crecimiento poblacional de L. rubripetala
#La orquídea florece todo el año, por lo que el seguimiento de la población fue mensual. 

#PARÁMETROS POBLACIONALES
##lambda: Tasa de crecimiento poblacional


lambda <-lambda(Lr1)
lambda
```

## Estructura estable

La estructura estable de edades/etapas es un indice de la distribución proporcional de la poblacional que se espera que esta población alcance en el largo plazo. En el caso de *Lepanthes rubripetala* se espera que la población alcance una estructura estable de 0.088, 0.206, 0.369 y 0.337 para las categorías de plántulas, juveniles, adultos no reproductivos y adultos reproductivos, respectivamente. Esta estructura asume que el crecimiento poblacional *lambda* $\lambda$ sigue igual y constante en el tiempo.

```{r Extra4}
#Estructura estable de estados
Wmax <- stable.stage(Lr1)
Wmax
```

Uno puede visualizar la estructura la estructura de la población usando el codigo siguiente.

```{r}
Wdf=data.frame(Wmax)
Wdf$Categorias=c("Plántulas","Juveniles","Adultos no reproductivos","Adultos reproductivos")
Wdf$Categorias=factor(Wdf$Categorias, levels=c("Plántulas","Juveniles","Adultos no reproductivos","Adultos reproductivos"))
library(ggplot2)

ggplot(Wdf, aes(y=Wmax, x=Categorias)) + 
  geom_bar(stat="identity", fill="blue") +
  labs(title="Estructura estable de estados", x="Categoría", y="Proporción") +
  theme_minimal()

```

## Valores reproductivos

El valor reproductivo *v* es un indice de la contribución de cada categoría de edad/estado a la tasa de crecimiento poblacional. En el caso de *Lepanthes rubripetala* se espera que la categoría de adultos reproductivos contribuya más a la tasa de crecimiento poblacional, seguido por la categoría de adultos no reproductivos, juveniles y plántulas. Los valores en la lista de *v* se compara con la primera edad/estado. Por consecuencia un individuo de la 4ta etapa (adulto reproductivo) tiene un potencial de dejar 2.7 individuos al comparar que una plantula tiene solamente tiene un valor de 1.0. La diferencia es que los individuos pequeños tienen que sobrevivir y llegar a las etapas mayores para contribuir a la tasa de crecimiento poblacional.

```{r Extra5}

valor_repro=reproductive.value(Lr1)
valor_repro
```

## Análisis de elasticidad

La elasticidad es un indice de la sensibilidad de la tasa de crecimiento poblacional a los cambios en las tasas de supervivencia, crecimiento y reproducción de cada categoría de edad/estado. La suma de todas las proporciones es 1.0, por consecuencia uno puede comparar el efecto de cambios proporcional en cada parámetro y evaluar su impacto. En el caso de *Lepanthes rubripetala* se espera que la tasa de crecimiento poblacional sea más sensible a los cambios en la supervivencia de los etapas 3 y 4 ya que tienen una elasticidad de 0.313 y 0.311 respectivamente. Si sumamos el componente de supervivencia (la diagonal) de la matriz de transición poblacional, la suma es (0.018 + 0.122 + 0.313 + 0.311) = 0.764. Por consecuencia, las etapas de supervivencia de los individuos contribuyen a 76.4% y son las etapas más sensitivas a los cambios demográficos. Al comparar si uno fuese a hacer un cambio proporcional en la reproducción (los adultos que dejan plántulas) tendría un impacto mucho más pequeño, solamente de 2.3%.

Los análisis de elasticidad pueden ser usado para evaluar que etapas que pudiese ayudar en enfocar las alternativas de manejo para cambiar la tasa de crecimiento poblacional. Por ejemplo si es una especie en peligro de extinción, uno puede enfocar los trabajos de manejo de la especie en mejorar la supervivencia de los individuos de las etapas más sensitivas. Al contrario si es una especie invasora, uno puede enfocar los trabajos de manejo en reducir la supervivencia de las etapas más sensitivas. En este caso seria reducir la supervivencia de los adultos reproductivos y no reproductivos. Enfocando en las etapas más sensitivas es una forma de maximizar el impacto de los trabajos de manejo con menos recursos. Naturalmente se asume que el manejo de estas etapas es posible, por ejemplo si la elasticidad es alta en una de las tranciciones, por ejemplo juvenil a adultos, pero no se conoce cual son la variables ambientales que impacta esa transiciones no se puede hacer un manejo efectivo. 


```{r Extra6}
#Matriz de elasticidad
elasticidad <- round(elas(Lr1),digit=3)
elasticidad
```

## Análisis de Amortiguamiento/Damping Ratio

El análisis de amortiguamiento es un indice de la rapidez con la que una población converge a su estructura estable después de un disturbio [@jiang2020life]. El indice de amortiguamiento $d > 0$, y más grande el indice de amortiguamiento más rápido la población converge a la estructura estable. Se ha demostrado que hay una relación entre el indice de amortiguamiento y tiempo de generación de una especie [@jiang2020life].  El tiempo de amortiguamiento se calcula $\tau=1/d$. Usando la función *dr* del paquete **popbio**, en el caso de *Lepanthes rubripetala* se espera estima que el indice de amortigamiento es 1.2 y que la población converga a su estructura estable en 12 meses, ya que los datos fueron recolectado y analizado mensualmente. Si los datos son recolectado fueron recolectado una vez al año entonces la población converga a su estructura estable en 12 años. Un supuesto importante es que la tasa de crecimiento intrínseca es igual para todos los periodos subsiguientes.  

```{r Extra7}

#Relación de amortiguamiento
dampingratio <- dr(Lr1, return.time=TRUE, x=10)
dampingratio
```

## Análisis de Convergencia

El tiempo de convergencia puede ser calculado a base de la cantidad de individuos en las diferentes etapas o edades. El tiempo de convergencia es el tiempo esperado en que una población alcanza la estructura estable. En el caso de *Lepanthes rubripetala* se espera que la población alcance la estructura estable en 25 meses si se comienza con una población sesgada de solamente plántulas (n=1000) y ninguno en las etapas subsiguientes. 



```{r Extra8}
# Tiempo de convergencia
n = c(1000, 0, 0, 0)
tconvergencia <- convt(Lr1, accuracy = 1e-3, vector = n)
tconvergencia

```

Si comenzamos con una población mucho más cerca a la estructura estable, podemos calcular el tiempo de convergencia. Digamos que se comienza con una población de 8, 20, 27 34 individuos en las etapas 1, 2, 3 y 4 respectivamente. En este caso se espera que la población alcance la estructura estable en 6 meses. En este caso vemos que el tiempo de convergencia es mucho más corto que si se comienza con una población sesgada de solamente plántulas.


```{r Extra9}

n2 = c(8, 20, 27, 34)
tconvergencia <- convt(Lr1, accuracy = 1e-3, vector = n2)
tconvergencia
```


## Dinámica transitoria

En la dinámica transitoria o de corto plazo, Stott y colaboradores (2010, 2012) incorporaron la estocasticidad demográfica para analizar el cambio de la estructura poblacional debido a una perturbación de origen biótico, abiótico o antropogénico (i.e. cambios en la estructura incicial observada). Este tipo de estocasticidad se refiere a la sobrevivencia y reproducción en número entero y finito; es decir, un individuo sobrevive o no, lo cual se representa con 1 ó 0, al igual que puede reproducirse (1) o no (0). La incorporación de esta característica en los individuos genera una variación no cíclica ni predecible en la respuesta de los individuos de una población.

En el análisis transitorio, el modelo sesgado por etapas (i.e. categorías) es el procedimiento que se usa para evaluar la perturbación de la estructura inicial. La perturbación o sesgo en la estructura inicial se evalúa modificando la proporción de individuos presentes en alguna categoría de la estructura poblacional. Cabe señalar que estas modificaciones representan distintos escenarios o simulaciones que ocurren o pueden ocurrir en nuestra población de estudio.

Por ejemplo, la estructura inicial en la población 1 de *Lepanthes rubripetala* fue la siguiente: (0,46,38,82). En este caso, al modificar la proporción de individuos presente en una, dos o en todas las categorías de la población se simuló el cambio en la dinámica en el corto plazo; es decir, en un momento previo a que se alcance el crecimiento estable o de largo plazo. En *Lepanthes rubripetala* se hicieron cinco simulaciones o escenarios al suponer las siguientes proporciones de individuos por categoría (Tremblay et al, 2015):

1.  Límite inferior: (1,0,0,0), los individuos de la población se contran en la categoría de plántulas (Lower bound).
2.  Inicio I: (0.15, 0.35, 0,30, 0.20), mayor proporción de individuos en las categorías juvenil y adulto no reproductivo.
3.  Estructura estable de la población: los individuos de la población tienen una abundancia de acuerdo con *w-max*.
4.  Inicio II: (0.4, 0.2,0.2, 0.2), mayor proporción de plántulas y una proporción similar en las categorías juvenil, adulto no reproductivo y adulto reproductivo.
5.  Límite superior: (0,0,0,1), los individuos de la población se contran en la categoría de adulto reproductivo.

*Dinámica poblacional absoluta*. Como consecuencia de las perturbaciones o escenarios existen cambios en el crecimiento poblacional, los cuales son evidentes si se grafican. Un aspecto a considerar es que, la gráfica que se genera incluye la influencia de la dinámica trasitoria y asintótica, por lo que se le denomina dinámica poblacional absoluta (Fig. 2A de Tremblay y colaboradores, 2015).

```{r Extra10}
##PASO 4. DINÁMICA POBLACIONAL ABSOLUTA.    
#Se proyecta el crecimiento poblacional ante cambios en la estructura 
#inicial debidos a la perturbación (5 escenarios). Esta gráfica incluye la 
#influencia de la dinámica trasitoria y asintótica, por lo que se le denomina 
#dinámica poblacional absoluta. Proyección a 50 meses.

#Definir los margenes
par(mfrow = c(1, 1))
par(mar = c(3, 3, 3, 3))

#Librerias de R requeridas para el análisis 
library(popdemo)
library(popbio)
library(ggplot2)
library(dplyr)
library(scales)

#Vector original
nLr0 <- c(0, 46, 38, 82)
#Escenario 1. Límite inferior
nLr1 <- c(166, 0, 0, 0)
#Proporción de individuos por categoría
nLr1 <- nLr1/sum(nLr1)
nLr1
#Gráfica de barras del escenario 1 
barplot(nLr1, names.arg = 1:4)
title(main = "Escenario 1", xlab = "Categoría", ylab = "Proporción")
#Proyección de la dinámica escenario 1
pr1 <- project(Lr1, vector = nLr1, time = 50)
plot(pr1, log = "y", ylim = c(0.1, 1.6), ann = FALSE)
title(main = "Proyección de la dinámica (Escenario 1)", xlab = "Time intervals", ylab = "Population size/density")


#Escenario 2. Inicio I
nLr2 <- c(25, 58, 50, 33)
#Proporción de individuos por categoría
nLr2 <- nLr2/sum(nLr2)
nLr2
#Gráfica de barras del escenario 1 
barplot(nLr2, names.arg = 1:4)
title( main = "Escenario 2", xlab = "Categoría", ylab = "Proporción")
#Proyección de la dinámica escenario 2 
pr2 <- project(Lr1, vector = nLr2, time = 50)
plot(pr2, log = "y", ylim = c(0.1, 1.6), ann = FALSE)
title(main = "Proyección de la dinámica (Escenario 2)", xlab = "Time intervals", ylab = "Population size/density")

#Escenario 3. Estructura estable
nLr3 <- Wmax
#Gráfica de barras del escenario 3
barplot(nLr3, names.arg = 1:4)
title( main = "Escenario 3", xlab = "Categoría", ylab = "Proporción")
#Proyección de la dinámica escenario 3 
Lr1st <- (Lr1/lambda)
Lr1st
eigen(Lr1st)
pr3 <- project(Lr1st, vector = Wmax, time = 50)
plot(pr3, log = "y", ylim = c(0.1, 1.6), ann = FALSE)
title(main = "Proyección de la dinámica (Escenario 3)", xlab = "Time intervals", ylab = "Population size/density")

#Escenario 4. Inicio II
nLr4 <- c(66, 33, 33, 33)
#Proporción de individuos por categoría
nLr4 <- nLr4/sum(nLr4)
nLr4
#Gráfica de barras del escenario 4 
barplot(nLr4, names.arg = 1:4)
title( main = "Escenario 4", xlab = "Categoría", ylab = "Proporción")
#Proyección de la dinámica escenario 4 
pr4 <- project(Lr1, vector = nLr4, time = 50)
plot(pr4, log = "y", ylim = c(0.1, 1.6), ann = FALSE)
title(main = "Proyección de la dinámica (Escenario 4)", xlab = "Time intervals", ylab = "Population size/density")

#Escenario 5. Límite superior
nLr5 <- c(0, 0, 0, 166)
#Proporción de individuos por categoría
nLr5 <- nLr5/sum(nLr5)
nLr5
#Gráfica de barras del escenario 5 
barplot(nLr5, names.arg = 1:4)
title( main = "Escenario 5", xlab = "Categoría", ylab = "Proporción")
#Proyección de la dinámica escenario 5 
pr5 <- project(Lr1, vector = nLr5, time = 50)
plot(pr5, log = "y", ylim = c(0.1, 1.6), ann = FALSE)
title(main = "Proyección de la dinámica (Escenario 5)", xlab = "Time intervals", ylab = "Population size/density")

#Gráfica de la dinámica absoluta 
Population_density <- stack(c(as.data.frame(pr1), as.data.frame(pr2), as.data.frame(pr3), as.data.frame(pr4), as.data.frame(pr5)))
Population_density[, "time"] <- rep(seq(1, nrow(pr1), 1), 5)
names(Population_density) <- c("Values", "Projection", "Time")
#Population_density[, "Projection"] <- c(rep("Projection 1", len), rep("Projection 2", len), rep("Projection 3", len), rep("Projection 4", len), rep("Projection 5", len))
abs.plot <- ggplot(data = Population_density) +
theme_classic() +
theme(panel.border = element_blank()) +
theme(legend.position = "none") +
geom_line(aes(x = Time, y = Values, group = Projection, colour = Projection), linewidth = 0.8) +
geom_hline(yintercept = 1, linewidth = 0.8) +
scale_colour_manual(values = c("#C6E2FF", "#B9D3EE", "black", "#9FB6CD", "#6C7B8B")) +
theme(axis.title.x = element_text(vjust = -1, size = 12)) +
theme(axis.title.y = element_text(vjust = 1, size = 12)) + 
theme(axis.text = element_text(size = 12)) +
labs(title = "Absolut population dynamics", x = "Projection intervals", y = "Population density relative to lambda max")+ 
theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 12))
abs.plot 

```

##Dinámica transitoria estandarizada: límites

Con el fin de evaluar en el corto plazo los cambios cuantitativos en la población en respuesta a una perturbación determinada se calculan los límites de la dinámica transitoria a través Índices de transferencia y se proyecta el crecimiento de la población en el corto plazo.

#Dinámica transitoria específica de la población.\
a proyección se hace sin la influencia de la dinámica asintótica. hecho que facilita y hace equitativa la comparación entre los modelos de los distintos escenarios. Se elimina el efecto de la dinámica asintótica al estandarizar la matriz y el vector de la estructura. En el primer caso se usa el comando 'standard.A=T', lo cual supone que en el largo plazo la tasa de crecimiento poblacional tendrá un valor de 1 (unidad) -por lo que la población no crecerá ni declinará, en el segundo caso se usa el comando 'standard.vec=T', que implica que éste suma 1 (Stoot et al., 2010, 2012). DINÁMICA POBLACIONAL TRANSITORIA ESTANDARIZADA

*Índices de transferencia*. Con el fin de evaluar en el corto plazo qué cambios cuantitativos habría en la población como respuesta ante una perturbación determinada, se calculan los límites de la dinámica transitoria a través de los *Índices de transferencia*, que incluyen los siguiente tres parámetros (Stoot et al. 2012):

a)  *Reactividad alta y Reactividad baja* (Upper reactivity y Lower reactivity) que representan el crecimiento o el decremento inmediato (i.e. primer intervalo de tiempo) de la población antes de alcanzar la tasa constante de crecimiento poblacional.

b)  *Máxima amplificación/Máxima atenuación* (Maximum amplification/Maximum attenuation) que indican,respectivamente, el incremento o decremento máximo futuro del crecimiento poblacional previo a alcanzar la tasa constante de crecimiento poblacional.

c)  *Inercia alta e Inercia baja* (Upper inertia y Lower inertia) que evalúan el límite más alto o el más bajo en el crecimiento de la población antes de alcanzar la tasa constante de crecimiento poblacional, respectivamente.

```{r Extra11}
### PARTE II: DINÁMICA POBLACIONAL TRANSITORIA ESTANDARIZADA.
#Modelo de Dinámica transitoria específica de la población  
## La dinámica de corto plazo se projecta a partir de la matriz de transición y el vector inicial previamente definidos

#Definir los margenes
library(popdemo)
library(ggplot2)

#Vector de estructura inicial: abundancia por categoría de acuerdo con  el estado 
n0 <- c(0, 46, 38, 82) 

## 1) PROYECCIÓN DE LA DINÁMICA DE CORTO PLAZO. Con la función PROJECT se proyectar la  a 50 meses, tomando en 
#cuenta la matriz de transición poblacional y el vector de la estructura.
#En esta función se elimina el efecto de la dinámica asintótica al estandarizar: 
#a) la matriz usando el comando 'standard.A=T', lo cual significa que 
#en el largo plazo la tasa de crecimiento poblacional tendrá 
#un valor de 1 (unidad), por lo que la población no crecerá ni declinará. 
#b) el vector de la estructura usando 'standard.vec=T', lo cual supone que éste suma 1, 
# Ambas estandarizaciones facilitan y hacen equitativa la comparación entre modelos 
#con distintos tamaños poblacionales y distintas tasas de crecimiento de largo plazo. 

#Gráfica de la dinámica de corto plazo por escenario. En la graficación se usa la misma matriz pero se cambia el vector de acuerdo con el escenario
#Escenario 1: Límite inferior
pr2.1 <- project(Lr1, vector = nLr1, time = 50, 
                 standard.A = T, standard.vec = T)
#Plot the amplification projection and label it
# Se atenua (decrece)
plot(pr2.1, log = "y", main = "Dinámica a corto plazo (Escenario 1)", cex.axis = 0.8)

#Escenario 2. Inicio I
pr2.2 <- project(Lr1, vector = nLr2, time = 50, 
                 standard.A = T, standard.vec = T)
#Plot the amplification projection and label it
plot(pr2.2, log = "y", main = "Dinámica a corto plazo (Escenario 2)", cex.axis = 0.8) # Se atenua (decrece)

#Escenario 3. Estructura estable
pr2.3 <- project(Lr1, vector = nLr3, time = 50, 
                 standard.A = T, standard.vec = T)
#Plot the amplification projection and label it
plot(pr2.3, main = "Dinámica a corto plazo (Escenario 3)", cex.axis = 0.8)# Se amplifica (crece)

#Escenario 4. Inicio II
pr2.4 <- project(Lr1, vector = nLr4, time = 50, 
                 standard.A = T, standard.vec = T)
#Plot the amplification projection and label it
plot(pr2.4, log = "y", main = "Dinámica a corto plazo (Escenario 4)", cex.axis = 0.8)# Se atenua (decrece)

#Escenario 5. Límite superior
pr2.5 <- project(Lr1, vector = nLr5, time = 50, 
                 standard.A = T, standard.vec = T)
#Plot the amplification projection and label it
plot(pr2.5, log = "y", main = "Dinámica a corto plazo (Escenario 5)", cex.axis = 0.8)# Se amplifica (crece)

#2) LIMITES TRANSITORIOS POR ESCENARIO.
#Escenario 1: Límite inferior

#Cálculo de los limites transitorios
library(popdemo)

lim.trans <- as.data.frame(matrix(NA, 5, 3))
names(lim.trans) <- c("reac", "maxatt", "inertia")
reac1<-reac(Lr1, vector = nLr1)
lim.trans[1, 1] <- reac1
reac1
maxatt1<-maxatt(Lr1, vector = nLr1, return.t=T)
maxatt1
lim.trans[1, 2] <- maxatt1[1]
inertia1<-inertia(Lr1, vector = nLr1)
inertia1
lim.trans[1, 3] <- inertia1
#Escenario 2. Inicio I
reac2<-reac(Lr1, vector = nLr2)
reac2
lim.trans[2, 1] <- reac2
maxatt2<-maxatt(Lr1, vector = nLr2, return.t=T)
maxatt2
lim.trans[2, 2] <- maxatt2[1]
inertia2<-inertia(Lr1, vector = nLr2)
inertia2
lim.trans[2, 3] <- inertia2

#Escenario 3. Estructura estable
reac3<-reac(Lr1, vector = nLr3)
lim.trans[3, 1] <- reac1
reac3
maxamp3<-maxamp(Lr1, vector = nLr3, return.t=T)
maxamp3
lim.trans[3, 2] <- maxamp3[1]
inertia3<-inertia(Lr1, vector = nLr3)
inertia3
lim.trans[3, 3] <- inertia3

#Escenario 4. Inicio II
reac4<-reac(Lr1, vector = nLr4)
lim.trans[4, 1] <- reac1
reac4
maxatt4<-maxatt(Lr1, vector = nLr4, return.t=T)
maxatt4
lim.trans[4, 2] <- maxatt4[1]
inertia4<-inertia(Lr1, vector = nLr4)
inertia4
lim.trans[4, 3] <- inertia4

#Escenario 5. Límite superior
reac5<-reac(Lr1, vector = nLr5)
lim.trans[5, 1] <- reac5
reac5
maxamp5<-maxamp(Lr1, vector = nLr5, return.t=T)
maxamp5
lim.trans[5, 2] <- maxamp5[1]
inertia5<-inertia(Lr1, vector = nLr3)
inertia5
lim.trans[5, 3] <- inertia5

# Dinamica transitoria plot
len <- nrow(pr2.1)
Population_density <- stack(c(as.data.frame(pr2.1), as.data.frame(pr2.2), as.data.frame(pr2.3), as.data.frame(pr2.4), as.data.frame(pr2.5)))
Population_density[, "time"] <- rep(seq(1, len, 1), 5)
names(Population_density) <- c("Values", "Projection", "Time")
Population_density[, "Projection"] <- c(rep("Projection 1", len), rep("Projection 2", len), rep("Projection 3", len), rep("Projection 4", len), rep("Projection 5", len))

trans.plot <- ggplot(data = Population_density) +
theme_classic() +
theme(panel.border = element_blank()) +
theme(legend.position = "none") +
geom_line(aes(x = Time, y = Values, group = Projection, colour = Projection), linewidth = 0.8) +
scale_colour_manual(values = c("#C6E2FF", "#B9D3EE", "black", "#9FB6CD", "#6C7B8B")) +
theme(axis.title.x = element_text(vjust = -1, size = 12)) +
theme(axis.title.y = element_text(vjust = 1, size = 12)) + 
theme(axis.text = element_text(size = 15)) +
labs(title = "Transient population dynamics" ,x = "Projection intervals", y = "Population density relative to lambda max") + 
theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 12)) +
ylim(0.2, 1.5)
trans.plot + 
geom_text(x = 45, y = 1.09, label = expression(paste(bar(rho) == 0.46)), hjust = 1.0, vjust = -1) +
geom_text(x = 45, y = 0.74, label = expression(paste(bar(rho) == 0.89)), hjust = 1.0, vjust = -1) +
geom_text(x = 45, y = 0.64, label =  expression(paste(bar(rho) == 0.70)), hjust = 1.0, vjust = -1) +
geom_text(x = 45, y = 0.33, label =  expression(paste(bar(rho) == 1)), hjust = 1.0, vjust = -1)

```

##Funciones de transferencia Finalmente, el cálculo de las funciones de transferencia representa el último paso en análisis de dinámica transitoria establecido por Stott y colaboradores (2012). A través de estas ecuaciones se evalúa la elasticidad o efecto de la perturbación sobre la dinámica poblacional. A diferencia de las matrices de elasticidad de los modelos de proyección poblacional, estas elasticidades no son lineales y evidencian la importancia relativa de la de la perturbación en la categoría de tamaño/estado sobre el crecimiento de la población en el corto plazo. Estas ecuaciones también están disponibles en el programa *Popdemo* de *R* y sus resultados se representan a través de gráficas.

La perturbación de la estructura está determinada ppor dos vectores *d* y *e*

```{r Extra12}
##PASO 6: ANALISIS DE LAS FUNCIONES DE TRANSFERENCIA 
#Establecer márgenes:
#Vector original
library(popdemo)

nLr0 <- c(0, 46, 38, 82)

#PERTURBACIÓN DEL VECTOR ORIGINAL

#1) Entrada de la matriz a(1,1): plántulas a plántulas
tf1 <- tfa_lambda(Lr1, d = c(1, 0, 0, 0),
                  e = c(1, 0, 0, 0),
                  prange = seq(0, 4, 0.01))

#Gráfica de la dinámica poblacional
plot(tf1, ann = FALSE)
title(main = "Dinámica poblacional (Plántulas - Plántulas)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda1 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad 
sens1 <- tfs_lambda(Lr1, d = c(1, 0, 0, 0), e = c(1, 0, 0, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda1, sens1, lty = 2, col = "red")

#2) Entrada de la matriz a(2,1): plántulas y juveniles
tf2 <- tfa_lambda(Lr1, d = c(0, 1, 0, 0),
                  e = c(1, 0, 0, 0),
                  prange = seq(-0.4, 0.6, 0.01))

#Gráfica de la dinámica poblacional
plot(tf2, ann = FALSE)
title(main = "Dinámica poblacional (Plántulas - Juveniles)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda2 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad 
sens2 <- tfs_lambda(Lr1, d = c(0, 1, 0, 0), e = c(1, 0, 0, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda2, sens2, lty = 2, col = "red")

#3) Entrada de la matriz a(2,2): juveniles y juveniles
tf3 <- tfa_lambda(Lr1, d = c(0, 1, 0, 0),
                  e = c(0, 1, 0, 0),
                  prange = seq(-0.8, 0.1, 0.001))

#Gráfica de la dinámica poblacional
plot(tf3, ann = FALSE)
title(main = "Dinámica poblacional (Juveniles - Juveniles)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda3 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad 
sens3 <- tfs_lambda(Lr1, d = c(0, 1, 0, 0), e = c(0, 1, 0, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda3, sens3, lty = 2, col = "red")

#4) Entrada de la matriz a(3,2): juveniles y no reproductivos
tf4 <- tfa_lambda(Lr1, d = c(0, 0, 1, 0),
                  e = c(0, 1, 0, 0),
                  prange = seq(-0.001, 0.03, 0.01))

#Gráfica de la dinámica poblacional
plot(tf4, ann = FALSE)
title(main = "Dinámica poblacional (Juveniles - No reproductivos)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda4 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens4 <- tfs_lambda(Lr1, d = c(0,0,1,0), e = c(0, 1, 0, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda4, sens4, lty = 2, col = "red")

#5) Entrada de la matriz a(4,2): juveniles a adultos
tf5 <- tfa_lambda(Lr1, d = c(0,0,0,1),
                  e = c(0,1,0,0),
                  prange = seq(0,0.8,0.01))

#Gráfica de la dinámica poblacional
plot(tf5, ann = FALSE)
title(main = "Dinámica poblacional (Juveniles - Adultos)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda5 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens5 <- tfs_lambda(Lr1, d = c(0, 0, 0, 1), e = c(0, 1, 0, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda5, sens5, lty = 2, col = "red")

#6) Entrada de la matriz a(3,3): adultos no reproductivos a adultos no reproductivos
tf6 <- tfa_lambda(Lr1, d = c(0, 0, 1, 0),
                  e = c(0, 0, 1, 0),
                  prange = seq(-0.8, 0.2, 0.01))

#Gráfica de la dinámica poblacional
plot(tf6, ann = FALSE)
title(main = "Dinámica poblacional (Adultos No rep - Adultos  No reproductivos)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda6 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens6 <- tfs_lambda(Lr1, d = c(0,0,0,1), e = c(0,1,0,0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda6, sens6, lty = 2, col = "red")

#7) Entrada de la matriz a(4,3): adultos no reproductivos a adultos reproductivos

tf7 <- tfa_lambda(Lr1, d = c(0,0,0,1),
                  e = c(0,0,1,0),
                  prange = seq(-0.2,0.8,0.001))

#Gráfica de la dinámica poblacional
plot(tf7, ann = FALSE)
title(main = "Dinámica poblacional (Adultos No rep - Adultos No rep)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda7 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens7 <- tfs_lambda(Lr1, d = c(0,0,0,1), e = c(0,0,1,0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda7, sens7, lty = 2, col = "red")

#8) Entrada de la matriz a(1,4): adultos reproductivos a plántulas

tf8 <- tfa_lambda(Lr1, d = c(1,0,0,0),
                  e = c(0,0,0,1),
                  prange = seq(-0.2,0.8,0.001))

#Gráfica de la dinámica poblacional
plot(tf8, ann = FALSE)
title(main = "Dinámica poblacional (Adultos reproductivos - Plántulas)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda8 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens8 <- tfs_lambda(Lr1, d = c(1,0,0,0), e = c(0,0,0,1))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda8, sens8, lty = 2, col = "red")

#9) Entrada de la matriz a(3,4): adultos reproductivos a plántulas

tf9 <- tfa_lambda(Lr1, d = c(0, 0,1, 0),
                  e = c(0, 0, 0,1),
                  prange = seq(-0.2, 0.8, 0.001))

#Gráfica de la dinámica poblacional
plot(tf9, ann = FALSE)
title(main = "Dinámica poblacional (Adultos reproductivos - Plántulas)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda9 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens9 <- tfs_lambda(Lr1, d = c(0, 0, 0,1), e = c(0, 0, 1, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda9, sens9, lty = 2, col = "red")

#10) Entrada de la matriz a(4,4): adultos reproductivos a adultos reproductivos

tf10 <- tfa_lambda(Lr1, d = c(0, 0, 0, 1),
                  e = c(0, 0, 0, 1),
                  prange = seq(-0.6, 0.2, 0.001))

#Gráfica de la dinámica poblacional
plot(tf10, ann = FALSE)
title(main = "Dinámica poblacional (Adultos rep - Adultos rep)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda10 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens10 <- tfs_lambda(Lr1, d = c(0,0,0,1), e = c(0,0,0,1))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda10, sens10, lty = 2, col = "red")

#Definir márgenes
par(mfrow = c(4,4))
par(mfg = c(1,1))

#Gráficas de la función de transferencia de la inercia en el ciclo de vida de L. rubripetala (población 1)
tfmatriz <- tfam_inertia(Lr1,vector = nLr0)
plot(tfmatriz)
 
```

Raventós y colaboradores (2015) estimaron el crecimiento poblacional de corto plazo de dos orquídeas epífitas después del paso de un huracán. Dado que a su paso se pierden individuos, se simuló si la reintroducción de plántulas y adultos mitigaban los efectos de este fenómeno en Cuba. Los resultados sugieren que la reintroducción de adultos tiene un efecto positivo sobre

<!--chapter:end:31-Dinamica_de_Transiciones.Rmd-->

# Appendix A {.unnumbered}

## Lista completa de todos los trabajos dinámica poblacional en orquídea que han usado matriz {.unnumbered}



En esta sección se hará recopilación de los estudios de dinámica poblacional en orquídeas que han usado matrices de transición de estados y de edades. Se identifica algunos de los temas principales de los trabajos.   

En la siguiente tabla se presentan los estudios de dinámica poblacional en orquídeas que usaron PPM y la(s) preguntas principales que los autores intentaron responder. En la gran mayoría de los trabajos se evalúa múltiples hipótesis/ideas sobre la dinámica poblacional de las orquídeas. Para información especifica sobre la metodología usada en cada estudio, se recomienda revisar los trabajos originales. 

- Clave de las variables

    - Riesgo: Si se evaluó el riesgo de extinción de la especie.
    - Variación espacial: Si se evaluó la variación espacial de la especie.
    - Variación temporal: Si se evaluó la variación temporal de la especie.
    - Latencia: Si se evaluó la importancia de la latencia (Dormancy) de la especie.
    - Métodos de estimación de parametros: Si se evaluó métodos alternos de estimación de parametros (no tradicional).
    - Historia de Vida: Si se evaluó la historia de vida de la especie en un contexto evolutivo.
    - Otro: Si se evaluó otra pregunta no incluida en las anteriores.
    - Referencia: Referencia del estudio.
  
  
```{r, message=FALSE, warning=FALSE}
library(readr)
library(dplyr)
library(gt)
library(flextable)
library(ftExtra)
```
                   
                      

```{r, table, echo=FALSE, message=FALSE, warning=FALSE}



list <-dplyr::tribble(
  ~"Genero", ~Especies, ~Riesgo, ~"Var esp.", ~"Var temp", ~"Lat", ~"Est param", ~"Hist vida", ~Otro, ~Ref, 
"*Aspasia*" , "*principissa*",  "Si" ,    "-"       ,  "Si"  ,  "-"     ,    "-"          ,   "-"       , "-"  , "@zotz2006population" ,
"*Brasavolla*", "*cucullata*",  "Si"     , "Si"         , "Si"         ,  "-"   ,         "-"    ,     "-"       , "IPM Transient Dynamics Transfer Function"  , "@ackerman2020small",
 "*Broughtonia*", "*cubensis*" , "Si", "Si" , "Si", "-", "-", "-","Transient Dynamics",  "@raventos2021effects",
 "*Caladenia*", "*amoena*"      , "Si", "-" , "-", "Si", "Si", "Si","Selección de modelos, Método de estimar latencia ", "@tremblay2009population @tremblay2009dormancy",
 "*Caladenia*", "*argocalla*"   , "Si", "-" , "-", "Si", "Si", "Si","Selección de modelos, Método de estimar latencia", "@tremblay2009population @tremblay2009dormancy",
 "*Caladenia*", "*clavigera*"  , "Si", "-" , "-", "Si", "Si", "Si","Selección de modelos, Método de estimar latencia", "@tremblay2009population  @tremblay2009dormancy",
 "*Caladenia*", "*elegans*"     , "Si", "-" , "-", "Si", "Si", "Si","Selección de modelos, Método de estimar latencia", "@tremblay2009population @tremblay2009dormancy",
 "*Caladenia*", "*graniticola*" , "Si", "-" , "-", "Si", "Si", "Si", "Selección de modelos, Método de estimar latencia","@tremblay2009population @tremblay2009dormancy",
 "*Caladenia*", "*macroclavia*" , "Si", "-" , "-", "Si", "Si", "Si","Selección de modelos, Método de estimar latencia", "@tremblay2009population @tremblay2009dormancy",
 "*Caladenia*", "*oenochila*"   , "Si", "-" , "-", "Si", "Si", "Si","Selección de modelos, Método de estimar latencia", "@tremblay2009population @tremblay2009dormancy",
 "*Caladenia*", "*rosella*"   , "Si", "-" , "-", "Si", "Si", "Si","Selección de modelos, Método de estimar latencia", "@tremblay2009population @tremblay2009dormancy",
 "*Caladenia*", "*valida*"   , "Si", "-" , "-", "Si", "Si", "Si","Selección de modelos, Método de estimar latencia", "@tremblay2009population @tremblay2009dormancy",
"*Caladenia*", "*orientalis*"  , "Si", "Si" , "Si", "Si", "-", "-","Interacciones abiotica, Alondra" ,"@coates2009demographic",
"*Cephalanthera*", "*longifolia*", "-", "-" , "-", "Si", "Si", "Si", "Interacciones abiótica y biótica","@shefferson2012linking",
"*Cleistes*", "*divaricata* var. *divaricata*"   , "Si", "Si" , "Si", "Si", "Si", "-","-" ,"@gregg1991variation",
"*Cleistes*", "*divaricata* var. *bifaria*"   , "Si", "Si" , "Si", "Si", "Si", "-","-" ,"@gregg1991variation",
"*Cleistes*", "*bifaria*", "-", "Si" , "-", "Si", "-", "-", "Estructura de tamaño y estado","@gregg2006comparison",
"*Corallorhiza*", "*trifida*", "Si", "-" , "Si", "Si", "-", "-","-" ,"@iriondo2009peligro",
"*Crepidium*", "*acuminatum*", "Si", "-" , "Si", "-", "-", "-","Efecto de cosecha, Diana" ,"@timsina2021six",

"*Cypripedium*", "*acaule*", "-", "-" , "-", "-", "Si", "-", "Leslie matrix, Javielise","@cochran1992simple",
"*Cypripedium*", "*calceolus*", "Si", "Si" , "Si", "Si", "-", "-","Selección de modelos" ,"@nicole2005population",
"*Cypripedium*", "*calceolus*", "Si", "Si" , "Si", "Si", "-", "-","Efecto de aislamiento" ,"@garcia2010living",
"*Cypripedium*", "*calceolus*", "-", "-" , "-", "-", "-", "-","Costo de latencia, Interacciones abiótica y biótica" ,"@shefferson2012linking",

"*Cypripedium*", "*fasciculatum*", "Si", "Si" , "Si", "Si", "-", "-","Selección de modelos, Interacciones abióticas" ,"@thorpe2011trends",
"*Cypripedium*", "*parviflorum*", "-", "-" , "-", "Si", "-", "Si", "-","@shefferson2014life",
"*Cypripedium*", "*reginae*", "-", "Si" , "-", "Si", "-", "Si","Selección de modelos, Interaccione bióticas" ,"@kery2004demographic",
"*Cypripedium*", "*lentiginosum*", "-", "-" , "-", "-", "Si", "-","Leslie matrix" ,"@zhongjian2008correlation",
"*Dactylorhiza*", "*hatagirea*", "Si", "Si" , "Si", "Si", "-", "-","Efecto de cosecha, Gabriela" ,"@chapagain2021illegal",
"*Dactylorhiza*", "*lapponica*", "-", "Si" , "Si", "Si", "-", "-", "Efecto antropogénico, Interaccione abióticas","@sletvold2010long @sletvold2013climate",
"*Dendrophylax*", "*lindenii*", "Si", "-" , "Si", "-", "-", "-","Efecto de densidad" ,"@gonzalez2009dinamica @raventos2015population ",
"*Epidendrum*", "*xanthinum*", "Si", "Si" , "-", "-", "-", "-", "Tremblay","@farfan2008estrategias",
"*Epipactis*", "*atrorubens*", "Si", "Si" , "Si", "Si ", "-", "-","Incorporación de variable de endogamía" ,"@hens2017low",
"*Epipactis*", "atrorubens", "-", "-" , "-", "- ", "-", "-","-" ,"jakalaniemi2011orchids",
"*Erycina*", "*crista-galli*", "Si", "Si" , "-", "-", "-", "-","Aucencia","@mondragon2007life",
"*Erycina*", "*crista-galli*", "-", "-" , "-", "-", "-", "-","-","@maldonado2005patron",
"*Guarianthe*", "*aurantiaca*", "Si", "Si" , "-", "-", "-", "-","Efecto de cosecha","@mondragon2009population",

"*Herminium*", "*monorchis*", "Si", "-" , "Si", "Si", "-", "-","Efecto abiótico","@wells1998flowering",
"*Himantoglossum*", "*hircinum*", "Si", "-" , "Si", "-", "-", "-","Efecto abiótico: sequia","@wells1998flowering", 
"*Himantoglossum*", "*hircinum*", "Si", "-" , "Si", "-", "-", "-","Modelando expanción","@carey1998modelling", 
"*Himantoglossum*", "*hircinum*", "Si", "-" , "Si", "Si", "-", "-","Efecto abiótico: Precipitación y Temp del suelo", "@pfeifer2006influence",

"*Isotria*", "*medeoloides*", "Si", "-" , "Si", "-", "-", "-","Nayliz","@dibble2019demography",
"*Jacquiniella*", "*leucomelana*", "Si", "-" , "Si", "-", "-", "-","Metapopulation approach","@winkler2009population",
"*Jacquiniella*", "*teretifolia*", "Si", "-" , "Si", "-", "-", "-","Metapopulation approach","@winkler2009population",
"*Laelia*", "*autumnalis*", "Si", "Si" , "Si", "-", "-", "Efecto de cosecha to be digitized","Aucencia","@emeterio2021does",
"*Laelia*", "*speciosa*", "Si", "-" , "Si", "-", "-", "-","Efecto de cosecha, Mariana","@hernandez1992dinamica",
"*Lepanthes*", "*caritensis*", "Si", "Si" , "Si", "-", "-", "-","-","@tremblay1997lepanthes",
"*Lepanthes*", "*caritensis*", "Si", "Si" , "Si", "-", "-", "-","Efecto de huracanes","@crain2019sheltered",
"*Lepanthes*","*eltoroensis*", "Si", "Si" , "-", "-", "-", "-","Tamaño efectivo de Población, Ne y largo de vida","@tremblay2001gene", 
"*Lepanthes*","*eltoroensis*", "Si", "Si" , "Si", "-", "-", "-","-","@tremblay2003population",
"*Lepanthes*","*eltoroensis*", "Si", "Si" , "Si", "Si", "-", "-","Nueva metodología de estimar parametros","tremblay2021population",
"*Lepanthes*", "*rubripetala*", "-", "-" , "-", "-", "-", "-","Tamaño efectivo de Población, Ne y largo de vida", "@tremblay2001gene",
"*Lepanthes*", "*rubripetala*", "Si", "Si" , "Si", "-", "-", "-","Dinamica de transiciones","@tremblay2015stable",
"*Lepanthes*", "*rupestris*", "-", "-" , "-", "-", "-", "-","Tamaño efectivo de Población, Ne y largo de vida","@tremblay2001gene",
"*Lepanthes*", "acuminata", "Si", "-" , "-", "-", "-", "-","Dinamica de transiciones","@raventos2018comparison",
"*Lycaste*" , "*aromatica*", "Si", "-" , "Si", "-", "-", "-","Metapopulation approach","@winkler2009population",
"*Neotinea*", "*ustulata*", "Si", "Si" , "-", "Si", "-", "Si","Metodo de estimar latencia, Tremblay","@shefferson2007dormancy",
"*Oeceoclades*", "*maculata*", "Si", "Si" , "Si", "-", "-", "-","Especie invasiva","@riveron2019spatio",
"*Oncidium*", "*poikilostalix*", "Si", "-" , "-", "-", "-", "-","Dinamica de transiciones","@raventos2018comparison",

 "*Orchis*", "*purpurea*", "Si", "-" , "Si", "-", "-", "-","LTRE", "@jacquemyn2010seed",
"*Orchis*", "*ustulata*", "Si", "Si" , "-", "-", "-", "-","See **Neotinea ustulata**","@tali2002dynamics",
 "*Phaius*", "*australis*", "Si", "Si" , "-", "-", "-", "-","Efecto abiótico", "@simmons2016Viability",
 "*Platanthera*", "*hookeri*", "Si", "Si" , "-", "-", "-", "-","-","@reddoch2007population",
 "*Platanthera*", "*praeclara*", "Si", "Si" , "Si", "Si", "-", "-","Variación temporal", "@sieg1995influence",
 "*Platanthera*", "*macrophylla*", "Si", "Si" , "Si", "-", "-", "-","Incluye estado de protocormo, **needs digitizing**", "@cleavitt2017life @berry2021population",
 "*Platanthera*", "*orbiculata*", "Si", "Si" , "Si", "-", "-", "-","Incluye estado de protocormo, **needs digitizing**","@cleavitt2017life @berry2021population",
 "*Prasophyllum*", "*correctum*", "Si", "" , "Si", "Si", "-", "-","Efecto de fuego, Nayliz","@coates2006effects",
 "Pseudorchis", "albida", "-", "-" , "-", "-", "-", "-","-","@stipkova2013mowing",
 "*Rodriguezia*", "*granadensis*", "Si", "Si" , "Si", "-", "-", "Javeilise","Efecto antropogénico","@ospina2023effect",
 "*Serapias*", "*cordigera*", "Si", "Si" , "Si", "Si", "-", "-","Efecto antropogénico","@pellegrino2014effects",
 "*Spathoglottis*", "*plicata*", "Si", "Si" , "Si", "-", "-", "-","Orquídea invasiva y interacciones bióticas", "@falcon2017quantifying",

 "*Spiranthes*", "*delitescens*", "Si", "Si" , "Si", "Si", "-", "-","Efecto abiótico: sequia","@mcclaran1992population",
 "*Spiranthes*", "*parskii*", "Si", "" , "-", "-", "-", "-","Efecto abiótico: herbivoría","@wonka2010herbivores",

 "*Telipogon*", "*helleri*", "Si", "-" , "-", "-", "-", "Si","Dinámica de transición","@raventos2018comparison",
 "*Tolumnia*", "*variegata*", "Si", "Si" , "Si", "-", "-", "Efecto ","El costo de reproducción","@calvo1993evolutionary",
 "*Trichocentrum*", "*undulatum*", "-", "-" , "-", "-", "-", "Gabriela","Efecto de aislamiento","@borrero2023populations"

)

```



Notas para añadir a la tabla
 
 - IPM - Integrated Population Model
 - Transient dynamics
 - Transfer function

```{r, flextable, echo=FALSE, message=FALSE, warning=FALSE}

list_fl=list %>%
  flextable() %>%
  theme_zebra() %>%
  theme_box() |> 
  colformat_md() %>% 
  set_table_properties(layout = "autofit")

list_fl

```


****




## Lista parcial de especies de orquídeas que han sido estudiadas que no incluye matrices {.unnumbered}


. 
```{r, table2, echo=FALSE, message=FALSE, warning=FALSE}
NO_matrix <-dplyr::tribble(
  ~"Genero", ~Especies, ~Riesgo, ~"Var esp.", ~"Var temp", ~"Lat", ~"Est param", ~"Hist vida", ~Otro, ~Ref,
"*Isotria*", "*medeoloides*", "-", "-" , "-", "-", "-", "-","no matrix","@alahuhta2017instant",
"*Cyclopogon*", "*luteoalbus*", "-", "-" , "-", "-", "-", "-", "no matrix","@juarez2014viability",
"*Cypripedium*", "*calceolus*", "-", "-" , "-", "-", "-", "-","no matrix" ,"@davison2013contributions",
"*Cypripedium*", "*candidum*", "-", "-" , "-", "-", "-", "-","no matrix" ,"@shefferson2017predicting",
"Gymnadenia", "conopsea", "-", "-" , "-", "-", "-", "-","no matrix","@oien2002flowering",

"*Ophrys*", "*sphegodes*", "-", "-" , "-", "-", "-", "-","no matrix","@hutchings2010population",
"*Ophrys*", "*sphegodes*", "-", "-" , "-", "-", "-", "-","no matrix" ,"@shefferson2017predicting",
"*Orchis*", "*morio*", "-", "-" , "-", "-", "-", "-","no matrix", "@wells1998flowering",
"*Spiranthes*", "*spiralis*", "-", "-" , "-", "-", "-", "-","no matrix", "@jacquemyn2007long"
  
)


```



```{r, flextable2, echo=FALSE, message=FALSE, warning=FALSE}

list_no_matrix=NO_matrix %>%
  flextable() %>%
  theme_zebra() %>%
  theme_box() |> 
  colformat_md() %>% 
  set_table_properties(layout = "autofit")

list_no_matrix

```



Fecha de actualización: 2024-09-30























<!--chapter:end:Appendix_A_Species_List.Rmd-->

# Appendix B {.unnumbered}

## Hojas de datos en el campo {.unnumbered}

Por: Raymond L. Tremblay

La hoja de recolección de datos debería estar preparada antes de ir al campo y estar imprimido sobre papel que es impermeable y escribir con lápiz.   Ese ultimo punto es bien importante ya que la gran mayoría de los bolígrafos son soluble en agua y si el papel se moja se puede perder sus datos.  Considerando que estas hojas de datos pudiese ser usado como fuente de averiguar los datos por decadas en el futuro.  **RECUERDA que no se puede regresar en el tiempo para recoger los datos**. Si Ud tiene su hoja de datos en el laboratorio y se le cae la taza cafe y fue escrito con bolígrafo se puede perder los datos.  No se arriesga!!


Antes de ir al campo es importante tener la lista completa de todos los individuos en la hoja de datos, ya que esto le ayuda asegurarse durante el muestreo que no se le olvida ningún individuo.  *Datos olvidado no se puede recuperar*.


Hoja en blanco para llevarse

 


```{r, message=FALSE, echo=FALSE}
library(tidyverse)
library(gt)
Hoja_de_campo = tribble(
 ~anio, ~Número_de_Ind, ~Etapa, ~Cantidad_flores_abierta, ~Cantidad_capullo, ~ Cantidad_Frutos, ~Numero_Hojas, ~Ancho_hoja_mm, ~etc,
2023,  23001,"...","...","...","...","...","...","...",
2023,  23002,"...","...","...","...","...","...","...",
2023,  23003,"...","...","...","...","...","...","...",
2024,  23001,"...","...","...","...","...","...","...",
2024,  23002,"...","...","...","...","...","...","...",
2024,  24003,"...","...","...","...","...","...","...",
2024,  24004,"...","...","...","...","...","...","...",
2024,  24005,"...","...","...","...","...","...","...",
  
)
```

```{r}
Hoja_de_campo %>% gt()
```

***

## Ejemplos de tablas de Datos {.unnumbered}

### Usando ejemplo de Tremblay [] y su codificación  {.unnumbered}

 - p == **plantula**.
 - j == **juvenil**
 - A0 == **adulto non-reproductivo**
 - A1 == **adulto reproductivo**
 - M = **muerto** 

Hoja llena al final del muestreo 

```{r}
library(tidyverse)
library(gt)
Hoja_llena = tribble(
  ~Número_de_Ind, ~Etapa, ~Cantidad_flores_abierta, ~Cantidad_capullo, ~ Cantidad_Frutos, ~Numero_Hojas, ~Ancho_hoja_mm, ~etc,
  23001,"p",NA, NA,NA,NA,NA,NA,
  23002,"j",NA, NA,NA,2,10,NA,
  23003,"A1",5, 10,1, 5,32,NA,
  23004,"Ao",0, 0,0,2,14,NA,
  23005,"m",NA, NA,NA,NA,NA,NA,
  24006,"p",NA, NA,NA,NA,NA,NA,
  24007,"j",NA, NA,NA,1,7,NA,
  24008,"p",NA, NA,NA,NA,NA,NA,
  
)
```

```{r}
Hoja_llena %>% gt()
```


Nota que solamente los individuos 23003 y 23004 son adultos, uno tiene flores, capullos y frutos y el otro nada.   A todos los adultos hay que llenar la información, no dejarlo en blanco.  Para las otras etapas, no es necesario llenar la mayoria de las columnas ya que para las plantulas y muertos no PUEDEN tener esas, pero los juveniles, se puede llenar la cantidad de hojas y sus tamaño.  Nota que el individuo 23005 se murio. 



### Almacenamiento de datos de forma digital {.unnumbered}


Esa misma estructura de recoger los dados puede ser utilizado para ponerlo en una hoja de MSExcel, Google Sheet o MacOS Numbers.  

 - Es muy importante que haya dos hojas, una para los datos y otra para la metadata.
 - La metadata es la descripción de los datos, como se recogieron, donde, cuando, por quien, las unidades, objetivo de la investigación, etc.
 - En la hoja de datos, cada columna tiene información de solamente UNA variable y cada fila tiene información de solamente UN individuo. No debería tener las unidades indicado en las celdas de la hoja de datos, sino en la metadata o en nombre de la columna. 
    - La primera fila tiene los nombres de las variables y la primera columna tiene los nombres de los individuos.
    - Los nombres de las columnas no pueden tener espacios, ni caracteres especiales, ni acentos, ni tildes, como en ñ.
    - Los nombres de los individuos no pueden tener espacios, ni caracteres especiales, ni acentos, ni tildes, como en ñ, Preferiblemente que sea un alfanumérico.
 - La hojas de datos preferiblemente se guarda en hoja de datos separados, como .csv, .xls, .xlsx, .ods, etc. La ventaja de usar .csv es que es un archivo de texto y se puede abrir en cualquier programa de hoja de datos. Ese formato .csv, *comma seperated variable*, es uno de los más viejo para almacenar datos, y es compatible con casi todos los programa de estadística. **NUNCA** guarda sus datos en un formato de programas especializados como SPSS, STATA, JMP, SAS, porque típicamente no se puede abrir en otros programas, y si no tiene la licencias se puede que no los podrán abrir en el futuro. 
    
    
    



<!--chapter:end:Appendix_B_Hoja_de_datos.Rmd-->



# Variación Demográfica, Espacial y Temporal

La variación en los estimados de parámetros tienen impacto sobre la estimación de lambda. 

Hay 3 tipos de variación que podemos tomar en cuenta y evaluar su impacto sobre la estimación de lambda:

- Variación Demográfica
- Variación Espacial
- Variación Temporal
 

 
## Variación Demográfica

Uno de las preguntas principales que se hace sobre la confiabilidad de los trabajos de dinámica poblacional con especies raras, es cual es el impacto de tener pocos individuos para estimar los parámetros de la matriz poblacional sobre lambda.  
Aqui se presente un método de calcular la varianza de lambda, tomando en cuenta los parámetros, la sensitividad y el tamaño de muestra que se uso para calcular los parámetros.  Con experiencia es lógico que con muchos individuos, la varianza es pequeña, pero con pocos individuos, la varianza debería ser ser grande. Pero en el caso del impacto de esa varianza sobre lambda se debería tomar en cuenta la sensitividad de lambda a los parámetros de la matriz. En otra palabra parámetros con alta sensitividad sobre lambda, deberían tener una varianza grande cuando los tamaños de muestra son pequenõs, pero que el efecto de confianza sea basado en el tamaño de muestra. El método presentado aquí es una modificación de la formula sugerido por Thomas A. Ebert en su libro **Plant and Animal Populations. Methods in Demography** [@ebert1999demography]. 

La varianza de lambda deberia ser ajustado por el tamaño de muestra y la sensitividad de lambda a los parámetros de la matriz poblacional.

$$Var(\lambda) = \sum_{i=1}^{n} \sum_{j=1}^{n} \frac{\partial \lambda}{\partial a_{ij}}^2 V(a_{ij})$$

 La sensitividad, $\frac{\partial \lambda}{\partial a_{ij}}$, de lambda a los parámetros de la matriz poblacional, $a_{ij}$, se puede calcular con la función **sens** del paquete popbio. 
 
 y por consecuencia la varianza de cada parámetros es $$Var(a_{ij}) = \frac{a_{ij}(1-a_{ij})}{N_{ij}}$$, donde N es el tamaño de muestra. 
 
En este primer ejemplo usamos la formula presentado por Ebert para calcular la varianza de lambda, tomando en cuenta la sensitividad de lambda a los parámetros de la matriz poblacional y el tamaño de muestra. Pero note que estamos asumiendo que 1) la sensitividad de lambda a los parámetros de la matriz poblacional es constante, 2) la razón son binomio (sobrevive o no), que los intervalos de confianza tienen una distribución normal. El ultimo, pudiese ser un problema cuando los parámetros se encuentra cerca de 0 o 1, resultando en varianza que so ilógicos (negativos o mayor de uno).  




Los datos necesarios para calcular la estocasticidad demográfica son los siguientes

 - La matriz de transición poblacional
 - El tamaño de muestra de cada etapa
 - La sensitividad de lambda a los parámetros de la matriz poblacional
 
 



Para el ejercicio usamos datos de *Lepanthes eltoroensis* de una población y un periodo de tiempo. los datos se encuentran en el paquete raretrans. 



```{r var1, message=FALSE, warning=FALSE}
library(raretrans) # activar el paquete
library(tidyverse) # activar el paquete
library(popbio) # activar el paquete)
```



```{r var2}


unique(L_elto$POPNUM) # Verificar cuantas poblaciones hay


onepopt1 <- L_elto %>%   

  filter(POPNUM== 209) # Usando todas las poblaciones de 209
 

# popbio::projection.matrix no funciona con el formato *tibbles*, por consecuencia se convierte en data.frame

head(onepopt1) # Ahora tenemos solamente datos de la población #209 
# Crear TF = TRUE, añadir para formatear correctamente.
TF <- popbio::projection.matrix(as.data.frame(onepopt1), 
                        stage = stage, fate = next_stage, 
                        fertility="fertility", sort=c("p","j","a"), TF = TRUE)
TF # Este es la estructura de etapas de vida para esa población.  Nota que tenemos dos matrices, una de transiciones **T** y otra de fertilidad **F**. 
```

Calcular la sensitividad de la matriz A


```{r var3}


matA=TF$T+TF$F
matA
matAsens=as.matrix(sensitivity(matA)) # matrix de sensitividad 
matAsens
```

Calcular cuanto individuos habia en el primer periodo como un estimado tipico del tamaño poblacional

```{r var4}

N_t1=L_elto %>%   

  filter(POPNUM== 209, year==1)

Nt1 <- get_state_vector(N_t1, stage = stage, sort=c("p","j","a")) 
Nt1
```

 
 Convertimos la matriz de transiciones y de sensitividad y la unimos en un solo data.frame
 
```{r var5}
DFmat=as.data.frame(matA)# Convertir matriz en un data frame
#DFmat



DFsens=as.data.frame(as.vector(matAsens)) # Método alternativo para convertir matriz en un data frame


Contribucion_var=merge(DFmat, DFsens, by=0) # Unir los dos data frames
Contribucion_var$N=c(1,1,1,5,5,5,6,6,6) # Añadir el tamaño de muestra
Contribucion =Contribucion_var |> 
  rename("Sensitividad" = "as.vector(matAsens)") |>   # Renombrar la columna e sensitividad
  rename(p =Freq) # Renombrar la columna de la matriz de transición

Contribucion
```
 

Calcular la vvarianza y la contribución de la varianza a lambda

```{r var6}
Contribucion=Contribucion |> 
  mutate(V_aij = (p*(1-p)/N)) |>  # Calcular la varianza de los parámetros sin tomar en cuenta la sensitividad
  mutate(Cont_deVar_lambda = (Sensitividad^2)*V_aij^2) # Calcular la contribución de la varianza de cada parámetro a lambda
Contribucion_var
```

La suma de la contribución de la varianza de cada parámetro a lambda es la varianza de lambda


```{r var7}
Contribucion |> 
  summarise(V_lambda = sum(Cont_deVar_lambda)) # Calcular la varianza de lambda


```

El intervalo de confianza de lambda se puede calcular con la formula de Ebert

lambda +/- 1.96*sqrt(V_lambda)

Por consecuencia el intervalo de confianza de lambda de esta población considerando la estocasticidad demogrófica rodea entre 0.89 y 1.16.   

```{r var8}
ICupper=lambda(matA)+ 1.96*sqrt(sum(Contribucion$Cont_deVar_lambda))
LClower=lambda(matA)- 1.96*sqrt(sum(Contribucion$Cont_deVar_lambda))

ICupper
LClower
```



## Aumentando el tamaño de muestra


En esta parte su usa la misma matriz pero con un tamaño de muestra mayor de 10, 50, 60.  lo que se observa es que tenemos más confianza en el rango de lambda, 0.99 a 1.06.   

 
```{r var9}
DFmat=as.data.frame(matA)# Convertir matriz en un data frame
#DFmat



DFsens=as.data.frame(as.vector(matAsens)) # Método alternativo para convertir matriz en un data frame


Contribucion_var=merge(DFmat, DFsens) # Unir los dos data frames
Contribucion_var$N=c(10,10,10,50,50,50,60,60,60) # Añadir el tamaño de muestra, se aumento el tamaño de muestra
Contribucion_var =Contribucion_var |> 
  rename("Sensitividad" = "as.vector(matAsens)") |>   # Renombrar la columna e sensitividad
  rename(p =Freq) # Renombrar la columna de la matriz de transición

Contribucion_var

Contribucion_var=Contribucion_var |> 
  mutate(V_aij = (p*(1-p)/N)) |>  # Calcular la varianza de los parámetros sin tomar en cuenta la sensitividad
  mutate(Cont_deVar_lambda = (Sensitividad^2)*V_aij^2) # Calcular la contribución de la varianza de cada parámetro a lambda
Contribucion_var

ICupper=lambda(matA)+ 1.96*sqrt(sum(Contribucion_var$Cont_deVar_lambda))
LClower=lambda(matA)- 1.96*sqrt(sum(Contribucion_var$Cont_deVar_lambda))

ICupper
LClower
```

Uno de los posible errores es aumis que la distribución de los parametros tienen una distribución normal.  En el caso de los parametros de la matriz de transición, estos son proporciones y por consecuencia tienen una distribución beta.  En el siguiente ejemplo se calcula la varianza de lambda tomando en cuenta la distribución beta de los parametros.

El promedio de distribución beta es 

$$\mu = \frac{\alpha}{\alpha+\beta}$$
y la varianza es 

$$ \sigma^2 = \frac{\alpha\beta}{(\alpha+\beta)^2(\alpha+\beta+1)}$$
Por consecuencia {\alpha} y {\beta} son los parámetros de la distribución beta. 

 $$\alpha = \left(\frac{(1-\mu)}{\sigma^2}-\frac{1}{\mu}\right)\mu^2$$
 y la beta es
 
 $$\beta = \alpha\left(\frac{1}{\mu}-1\right)$$
 
```{r var10}
#install.packages("remotes") # Instalar el paquete remotes

#remotes::install_github("pacific-hake/hake-assessment") # Instalar el paquete hake-assessment **Importante instalar este paquete ANTES de gfiscamutils**
#remotes::install_github("pbs-assess/gfiscamutils") # Instalar el paquete gfiscamutils


```
 
 
```{r var11}


library(gfiscamutils)

calc_beta_params(Contribucion_var$p, Contribucion_var$V_aij)



bp=calc_beta_params(0.5308370, sqrt(0.09))
bp[1]
bp[2]
```
 
 
 
```{r var12}
library(tidyverse)
Contribucion_var |> 
  mutate(alpha = calc_beta_params(p, (sqrt(V_aij)))[1],
         beta = calc_beta_params(p, (sqrt(V_aij)))[2]) |> 
  mutate(mu = alpha/(alpha+beta)) |> 
  mutate(var = alpha*beta/((alpha+beta)^2*(alpha+beta+1)))

```



```{r var13}

calc_beta_params(0.9, sqrt(0.009))


ss=Contribucion_var[1,]

calc_beta_params(ss$p, sqrt(ss$V_aij))

```

```{r var14, eval=FALSE}
  mutate(mu = alpha/(alpha+beta)) |> 
  mutate(var = alpha*beta/((alpha+beta)^2*(alpha+beta+1))) |> 
  mutate(V_aij = (mu*(1-mu)/N)) |> 
  mutate(Cont_deVar_lambda = (Sensitividad^2)*V_aij^2) # Calcular la contribución de la varianza de cada parámetro a lambda
```
 
 
 
 
 
 
 
 
```{r var15}
 estBetaParams <- function(mu, var) {
  alpha <- ((1 - mu) / var - 1 / mu) * mu ^ 2
  beta <- alpha * (1 / mu - 1)
  return(params = list(alpha = alpha, beta = beta))
}
```







 
Los paramétros de una beta son $\alpha$ y $\beta$, La varianza de una beta es $\alpha\beta/(\alpha+\beta)^2(\alpha+\beta+1)$.  En el siguiente ejemplo se calcula la varianza de lambda tomando en cuenta la distribución beta de los parametros. 




# install.packages("bbmle")
library("bbmle")

x <- rep(1, length(my.probs))
y <- rep(1, length(my.probs))
my.model <- mle2(minuslogl = my.probs ~ dbeta(shape1, shape2), start = list(shape1 = 2, shape2 = 30), data = data.frame(x, y))
# There were 12 warnings (use warnings() to see them)
summary(my.model)



<!--chapter:end:Varriacion_Demo_Esp_Temp.Rmd-->

