---
title: "Dinamica_Poblacional"
output:
  bookdown::gitbook:
    highlight: tango
    #code_folding: hide


    
author: ""
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]

description: |
  Este libro digital es una introdución al estudio de Biometría
link-citations: yes

editor_options: 
  markdown: 
    wrap: 72    
---

# Dinámica Poblacional

El estudio de la Dinámica Poblacional tiene como objetivo desarrollar conocimiento los patrones y processos intra-especifica y entre-especies.  Tradicionalmente muchos de los trabajos de dinamica poblacional se enfocarón en los estudios intra-especifica, fomentando una perpestiva que las especies no enteractuan con su ambiente biotico.     

## Objetivo del libro: 

Este libro digital 

<!--chapter:end:index.Rmd-->

---
output:
  word_document: default
  html_document: 
    code_folding: show
---


```{css, eval=FALSE, echo=FALSE}
body {
  counter-reset: counter-rchunks;
}

div.main-container {
  padding-left: 5em;
}

pre.r {
  counter-increment: counter-rchunks;
  position: relative;
  overflow: visible;
}

pre.r::before {
  content: 'In [' counter(counter-rchunks) ']: ';
  display: inline-block;
  position: absolute;
  left: -5em;
  color: rgb(48, 63, 159);
}
```




# ¿Qué es el analisis de dinamica poblacional?

Por: Por RLT, Nhora Ospina, Demetria y Anne .....

***

El objetivo de la conservación biológica es asegurar que las especies pueden sobrevivir, reproducirse y dejar progenie viable para de una generación a otra. Por consecuencia se necesita que las variables intrinsicas y extrinsicas, bioticas y abioticas de cada especies estén considerado con todas sus interacciones. Naturalmente aunque el concepto es sencillo, tomar en cuanta TODAS las posibles interacciones biológicas y abióticas es imposible.\
El primer paso a la conservación es considerar el ambiente adecuado para cada especie. Sin duda en los ultimos 50 años en muchos paises ha habido un cambio grande en el repesto y la conservaciones de bosque, pradera, desierto y todos los biomas en general. Por ejemplo el cambio de cobertura de bosque en Puerto Rico ha aumentado de circa de 2-5% en los años 1910 a más 40% en el 2000 [@pares2008agricultural]. En general en Latino América ha habido más reforestación de deforestación [@aide2013deforestation] en los ultimos años, aunque varia mucho entre paises y periodo de tiempo. Para la conservación el primer paso era reconocer que los habitat necesitan ser protegido.\
Muchos de estos nuevos hábitat son bosque segundarios, fragmentados y dominado por especies introducidas. Estos habitat por consecuencia son mayormente diferentes al ambiente natural antes de los cambios antropogénicos. El resultado, en muchas ocasiones, es que la especies de interes están reducida en números de individuos o fragmentados. Considerando esos remanentes de individuos en el habitat, son suficiente para mantener una población viable? ¿Como que uno decide que una población es viable?

En general, el conceptos de conservación es que si uno proteje los habitat las especies estarán conservadas. Pero lo que no es obvio es que la presencia de individuos en un sitio que este protegido o que haya muchos individuos no es suficiente para asegurar la supervivencia de una especies a largo tiempo. Un ejemplo bien conocida es la extincción del Dodo en la isla de Mauritius y la casi extinción de una especies de arbol en la familia Sapotaceae, *Calvaria major*. Para que la semillas sean viable necesitan pasar por el tracto digestivo de un pajaro para remover el encocarpo persitente de la semilla que causa latencia/"dormancy" en las semillas [@temple1977plant]. Por consecuencia nunca se puede asumir que la presencia de una especies sin tomar en cuenta las interacciones bióticas y abióticas es suficiente para sugerir que no hay riesgo de extinción.

## ¿Qué es el estudio de la dinamica poblacional?

La dinámica poblacional tiene como meta tomar en cuenta todas las etapas/edades de una especies y evaluar cual de esas etapas/edades tiene impacto sobre la supervivencia de la especies. Esas etapas de vida debería considerar las interacciones con sus ambiente biótico y abiótico. La dinámica de población es fundamental en todas las áreas de la ecología y evolución. Comprender la dinámica poblacional es la clave para entender la importancia relativa al acceso de los recursos y el efecto de competencia, herbivoría y depredaciones sobre la viablidad de especies. Tradicionalmente los estudios estaban enfocado a evaluar la tabla de vida para el manejo y conservaciones de especies particulares (ref). En años más recientes los estudios se han diversificado para evaluar la interacciones entre especies y su ambiente (ref).

## Definición

Una definición más especifica de los estudios de dinámica poblacional son definidos como los análisis de los factores que afecten el crecimiento, estabilidad y reducción en el tamaño de la población en una serie de tiempo.

Por ejemplo, la dinamica poblacional de especies invasivas incluye un periodo de crecimiento muy lento al comienzo de la colonización de un nuevo sitio y frecuentamente siguido de un crecimiento logarithmico. La figura \@ref(fig:Pop-fig). demuestra el cambio de número de individuos en el tiempo de una especie hipotética.

```{r chap1_1 ggplot2, echo=FALSE}
library(ggplot2)
        rlt_theme <- theme_bw()+
          theme(axis.title.y = element_text(colour="grey20",size=15,face="bold"),
                   axis.text.x = element_text(colour="grey20",size=15, face="bold"),
                   axis.text.y = element_text(colour="grey20",size=20,face="bold"),  
                   axis.title.x = element_text(colour="grey20",size=15,face="bold"))
                    
```

```{r chap2 Pop-fig, fig.cap='Cambio poblacional en tiempo'}
ggplot(pressure, aes(temperature, pressure))+
  geom_point()+
  rlt_theme+
  xlab("Tiempo")+
  ylab("Tamaño poblacional")

```

## El analisis de Dinámica Poblacional y su uso

Determinar el tamaño poblacional en el futuro tiene muchos usos. Se puede dividir sus usos en tres grupos grandes, entender las **1)** interacciones ecológicas, **2)** manejo y conservaciones o **3)** los procesos evolutivos. Los estudios enfocado a la conservación se engloba dentro de un acercamiento de la viablidad de poblaciones. En este libro estaremos dando una introducción a cada uno de estas vertientes, pero nuestros ejemplos son una introducción al tema y no una profundización extensa de cada uno. En la table \@ref(USO) vemos algunos de los usos especificos que se ha dado con la metodología de PPM.

```{r chap1_3, eval=FALSE, echo=FALSE}
options(width = 50)
library(tidyverse)
library(gt)
USO_PPM = tribble(~"Categoria de Uso", ~ "Uso especifico", ~"Referencias", ~"Referencias con Oquideas",
                  "Manejo", "Identificar las etapas or procesos demograficos", "Crouse et al. 1987", "?",
                  "", "Determinar cuantos individuos en una población es necesario para reducir la extinción", "Shaffer 1981, Armbruster & Lande 1993", "?",
                  "", "Determinar cuantos individuos se necesita introducir en una sitio para establacer una población viable", "Bustamante 1996", "?",
                  "", "Determinar cuantos individuos se puede extraer sin tener un impacto negativo sobre la viabilidad de una población", "Nantel et al. 1996", "?",
                  "", "En especies invasivas: determinar cuantos y cual etapas se necesita remover para controlar la especie envasivas", "?", "?",
                 "", "Determinar cuantas poblaciones se necesita para la viabilidad de una especie al nivel local o global", "Lindenmayer & Possingham 1996", "",
                 "Evaluación de riesgos", "Evaluar el riesgo de una población a ir a las extinción", "Samson 1985", "muchos",
                 "", "Comparando el riesgo relativo de dos o más poblaciones", "Allendrof et al. 1997","?",
                 
                 "Interacciones ecologicas", "Evaluar interacciones ecológicas para entender las variables importantes para la supervivencia de una población", "?", "Ospina et al., 2022",
                 "Procesos y patrones evolutivos", "Cual de los procesos y patrones evolutivos del ciclo de vbida de especies impacta su crecimeinto", "?", "?")

USO_PPM %>% gt()
```

### Tabla: El uso potencial de la diferentes acercamiento de PPM. {#USO}

NOTA IMPORTANTE: *Evaluar las referencias y añadir referencias tradicionales y recientes*

| Categoria de Uso               | Uso especifico                                                                                                   | Referencias                          | Referencias con Oquideas |
|:----------------|:-------------------|:----------------|-------------------:|
| Manejo                         | Identificar las etapas or procesos demograficos claves                                                                 | [@crouse1987stage]                   |                        ? |
|                                | Determinar cuantos individuos en una población es necesario para reducir la extinción                            | Shaffer 1981 Armbruster & Lande 1993 |                        ? |
|                                | Determinar cuantos individuos se necesita introducir en una sitio para establecer una población viable           | Bustamante 1996                      |                        ? |
|                                | Determinar cuantos individuos se puede extraer si tener un impacto negativo sobre la viabilidad de una población | Nantel et al. 1996                   |                        ? |
|                                | En especies invasivas determinar cuantos y cual etapas se necesita remover para controlar la población           | ?                                    |                        ? |
|                                | Determinar cuantas pobalciones se necesita para la viabilidad de una especie al nivel local o global             | Lindenmayer & Possingham 1996        |                          |
| Evaluación de riesgos          | Evaluar el riesgo de una población                                                                               | Samson 1985                          |                   muchos |
|                                | Comparando el riesgo relativo de dos o más poblaciones                                                           | Allendrof et al. 1997                |                        ? |
| Interacciones ecologicas       | Evaluar interacciones ecológicas para entender las variables importantes para la supervivencia de una población  | ?                                    |      Ospina et al., 2022 |
| Procesos y patrones evolutivos | Cual de los procesos y patrones evolutivos del ciclo de vida de especies impacta su crecimiento                 | ?                                    |                        ? |


### USO 1: Identificar las etapas or procesos demográficos claves

Identificar y conocer cuales son las etapas de vida más suceptibles a cambios abioticos y bióticos y su impacto sobre la persistencia de una población es necesario para el manejo.  El ejemplo clásico en la literatura usando PPM son los trabajos sobre la dinámica poblacional de la tortuga "boba" o "cabezona" *Caretta caretta* [@crouse1987stage], [@crowder1994predicting].  Crouse y Crowder demostraron que aun salvando TODOS los huevos de depredación, esa estrategia de manejo antropogenico iba a tener muy poco impacto en el crecimiento de la población.  Lo que encontrarón es que el impacto más grande sobre el crecimiento poblacional provendría de proteger los adultos era reducir la mortandad de los adultos espceificamente de las redes de pesca, modificando estas redes para que las tortugas se pueden escapar y no ahogarse en las redes.  Los trabajos de Crouse y Crowder fueron pioneros en demostrar que uno podía simular diferentes escenarios basado en la historia de vida y evaluar su impacto. 

Ejemplo de orquidea AQUI

### USO 2: Determinar cuantos individuos en una población es necesario para reducir la extinción

El efecto de tamaño poblacional sobre la biología y la probabilidad de extinción es amplia [@shaffer1985population], [@nunney1993assessing], [@harris2022abundance]. ¿Cual es la probabilidad de extinción de una población considerando la cantidad de individuos en cada etapa? En general lo que se observa es que menor el tamaño poblacional, N, mayor es el riesgo de extinción. Esa probabilidad de extinción puede variar si algunas etapas del ciclo de vida es muy reducido o su probabilidad de sobrevivir es baja o crecer a la proxima etapa varia. En orquideas es probable que uno de las etapas más vulnerable es la etapa de semilla. Consideramos por ejemplo cual es la probabilidad de que las semillas se establece, germina y crezca a ser un juvenil.  Esas transiciones es muy pequeña.  Por consecuencia una nueva población de orquídea necesita considerar la cantidad de individuos que este presente pero también la probabilidad de tener semillas y que estas pueden crecer a ser adultos reproducible. Darwin (ref) estimo por ejemplo que un fruto de *Orchis maculata* produce 6,200 semillas y una planta tipica 186,300 y en un acre la suma de las plantas produce más de 32,400,000,000 semillas!!!!  Sin duda la probabilidad de que una semilla germina y produce una planta es muy pequeña sino estaríamos cubierto de orquídea en dos generaciones.   


### USO 3: Determinar cuantos individuos se necesita introducir en una sitio para establecer una población viable 

Naturalmente, más cantidad de individuos re-introducido en un sitio mayor sera la probabilidad que la población sea viable. Pero, como todo hay un limite de tiempo y esfuerzo disponible. Por consecuencia la pregunta debería ser orientado a determinar cual es el mínimo de individuos que se debería introductir para garantizar un **x** porciento de suceso en el establecimiento de una nueva población. 

En los ultimos años, muchas organizaciones y científicos han comenzado a hacer re-introducción de especies en su habitat nativo y no. (ref). Algunos programa introduce especies en áreas urbanas.  

  - Caladenia 
  - Korea
  - one million orchids project
  - ????

### USO 4: Determinar cuantos individuos se puede extraer sin tener un impacto negativo sobre la viabilidad de una población

Hay tres razones principales para la extracción de individuos de su ambiente natural. 

 1. Obtener individuos para la conservación *Ex Situ*.
 2. Usar un grupo de individuos para su propagación.
 3. Extraccíon para la venta sin objetivo de conservación.  

El supuesto de colectores de orquidea de su habitat naturales, tanto para la conservación de *Ex situ* y el uso para la propagación es que el impacto es minimo, y no tendrá impacto a largo plazo para la supervivencia. Regresaremos sobre este punto más tarde. La historia de fanatisismo de recolección de orquideas para la venta es bien conocida ref(). Aun que uno quisiera pensar que estas extracciones son del pasado y no occuren hoy en dia, hay todavia escrupulos que extraen los plantas sin pensar al impacto que tendrá sobre la población o especie.  

Pero la pregunta se tiene que hacer. Cuantos individuos y de que etapas se puede extraer de la población sin tener impacto en el crecimoento poblacional?     

### USO 5:  En especies invasivas determinar cuantos y cual etapas se necesita remover para controlar la población.  


### USO 6: Evaluar el riesgo de una población 



### USO 7:  Determinar cuantas poblaciones se necesita para la viabilidad de una especie al nivel local o global

Dinamica de metapoblaciones.  



### USO 8: Comparando el riesgo relativo de dos o más poblaciones 



### USO 9: Evaluar interacciones ecológicas para entender las variables importantes para la supervivencia de una población 


### USO 10: Cual de los procesos y patrones evolutivos del ciclo de vida de especies impacta su crecimiento 





## Historia de dinamica poblacional en orquideas. 

## Referencias



<!--chapter:end:02-Intro.Rmd-->

# Qué es un diagrama de Ciclo de Vida

Por: Nhora Ospina

## Ejemplos de ciclos de Vida

Escribo algo

## Ejemplos de un ciclo de vida sencillo

Tengo mucho texto que ampliar

## Ejemplo de un ciclo de vida con 3 estadios

```{r chap2_1}
library(Rage)
```




```{r chap2_2}
# hidden code to produce figures
library(DiagrammeR)
matA <- rbind(
  c(0.0, 0.0, 3.2),
  c(0.5, 0.3, 0.8),
  c(0.0, 0.4, 0.9)
)


stages <- c("semillas", "plantulas", "adultos")
title <- NULL
graph <- expand.grid(to = stages, from = stages)
graph$trans <- round(c(matA), 3)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", stages, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 3
graph$col <- c(
  "PaleGreen4", "PaleGreen4", "PaleGreen4", "Goldenrod1",
  "MediumOrchid4", "PaleGreen4"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 



```


## Ejemplo de un cicle de vida con estadio de latencia

```{r chap2_3}
library(ggplot2)
plot_life_cycle(matA, stages=stages, fontsize = 0)

```










## Code for color coding figure

http://rich-iannone.github.io/DiagrammeR/

## Ejemplo de un cicle de vida con estadio de post reproducción



## Ejemplo de un cicle de vida incompleto (y biologicamente erroneos)



## Referencias

<!--chapter:end:03-Ciclos_de_Vida.Rmd-->

---
editor_options:
  markdown:
    wrap: sentence
---

# Como recopilar datos en el campo

## Consideraciones en la colecta de datos en el campo

Por: Aucencia Emeterio-Lara, Mariana Hernández-Apolinar y Raymond L. Tremblay

## Tipo de crecimiento en las orquídeas

Conocer el tipo de crecimiento y la apariencia general de la orquídea de interés es un primer paso en la toma de datos en campo, ya que a partir de esto sabremos dónde ubicarlas y cómo identificarlas con facilidad en su medio natural.
Es así que hay que identificar el sustrato en el que se establecen las orquídeas (i.e. tipo de crecimiento), mismo que puede ser terrestre, epífito o rupícola, éste último también llamado litófito [@tellez2007orquideas].
Como es evidente, en el primer caso las plantas se desarrollan en suelo, en el segundo sobre ramas y troncos los árboles, mientras que en el tercero grupo sobre rocas.
Es importante reconocer que algunas especies no son estrictamente limitado a un tipo de ambiente, por ejemplo entre mmuchos hay algunas especies de *Lepanthes* que son epífita y rupícula.

De acuerdo con sus rasgos morfológicos o apariencia se pueden identificar al menos tres grupos de orquídeas epífitas: plantas con tallos engrosados y modificados conocidos como pseudobulbos (e.g *Laelia*, *Oncidium*, *Encyclia*, *Stanhopea*, *Maxilaria*, *Rhynchostelle*, etc), plantas con tallos simples o delgados (e.g *Epidendrum*, *Dichea*) y un tercer grupo con hojas engrosadas y tallos compactos o pseudobulbos poco visibles (e. g. *Trichocentrum*).
En el caso de las orquídeas terrestres se pueden identificar seis grupos: plantas con tallos y hojas alternas o en espiral (v. g. *Cypripedium*, *Dichromanthus*, *Habenaria*, *Triphora*), plantas con hojas solitarias o en pares (v.g. *Bletia*, *Schiedeella*, *Malaxis*, *Govenia*), plantas con hojas en roseta (*Brachystele*, *Deiregyne*, *Sarcoglottis*), plantas con hojas en abanico (*Paphiopedilum*, *Phragmipedium*), plantas sin hojas (*Rhizanthella*, *Triphora*) y plantas con pseudobulbos (*Oeceoclades*, *Cymbidium*).
Por su parte, en las plantas rupícolas se identifica un dos grupos: plantas con pseudobulbos (*Cattleya*, *Hoffmannsegella*, *Laelia*, *Paphiopedillum*) o sin pseudobulbo (*Lepanthes*).
Cabe señalar que, si bien esta clasificación es de utilidad y brinda una idea de la diversidad en la morfología vegetativa de las orquídeas, hay que considerar que solo se basa en su apariencia, por lo que es muy cualitativa y poco rigurosa desde el punto de vista botánico.

## Métodos y técnicas de muestreo

El método y técnica de muestreo depende en gran medida del tipo de crecimiento (i.e. epífito, rupícola o terrestre) que presente nuestra especie de interés.
No solo eso, también de esta condición depende el grado de dificultad y el tiempo que se invertirá en la toma de datos.
Para facilitar esta colecta de información se han implementado distintas técnicas de muestreo según su tipo de crecimiento, las cuales se describen a continuación.

### *Orquídeas epífitas y rupícolas*.

Las orquídeas epífitas y rupícolas viven a distintas alturas en árboles y acantilados.
En la colecta de información de estas poblaciones se utilizan desde una simple escalera hasta equipo de alpinismo para ascenso.
El uso de escaleras es una técnica muy práctica si la especie de estudio se desarrolla en las zonas bajas de los acantilados o en forofítos como arbustos y árboles de porte bajo a medio (Hernández-Apolinar, 2023); sin embargo, se tiene la desventaja de transportar este instrumento de trabajo hasta el sitio de muestreo.

Cuando las orquídeas se distribuyen a una altura considerable del acantilado, la técnica de rapel resulta muy útil y segura e implica el descenso mediante cuerdas hasta llegar a las orquídeas a muestrear.
Por su parte, la técnica de ascenso de una sola cuerda es muy segura [@jepson2000tree] cuando se trata de orquídeas epífitas habitando hospederos de porte medio y alto con troncos y ramas gruesas.
Pero tiene algunas limitaciones como es la dificultad de acceder a ramas delgadas en los estratos muy altos.
En importante señalar que, si se carece de experiencia en el ascenso de árboles y acantilados es importante recibir apoyo de gente experta.

En el muestreo de los árboles se señala la ubicación preferente de las orquídeas de estudio, debido a que éstas presentan condiciones microclimáticas variables.
Dicha ubicación, generalmente toma en cuenta la clasificación hecha por Johansson [@johansson1974ecology; @catling1986epiphytic], quien señala que en un árbol hospedero existen cinco zonas o estratos, dividiéndolos de la siguiente manera: la parte basal del tronco (Zona I), tronco principal (Zona II), la copa interna (Zona III), la copa media (Zona IV) y la copa externa (Zona V).
Cabe señalar que, la mayor concentración de orquídeas epífitas se registra en los estratos medios II, III, IV (**Mondragón et al. 2007**).

**AQUI un dibujo del concepto sugerido por Johansson (1974) y Cattling (Quien puede hacer un dibujo que se acerca al concepto sugerido por el y Cattling? NO deberiamos usar una foto de otro papers, habria que pedir permiso.**

### *Orquídeas terrestres*.

En el muestreo de poblaciones de orquídeas terrestres se han implementado varias técnicas de muestreo, en esta sección nos referiremos a dos: El método de triangulación y el método sin área.
El primero permite estimar el área en que se establece la población, mientras que el segundo no permite establecer esta variable y se centra en el marcaje de individuos.
A continuación se detalla en qué consisten ambos.

a)  *Método de triangulación*. El método de triangulación es una técnica no invasiva y comúnmente es utilizada para monitorear las poblaciones terrestres en Australia [@tremblay2009population]. El método consiste en clavar dos estacas o clavijas permanentes en el suelo. La distancia entre estaca y estaca generalmente es de un metro. Sobre las estacas se puede: 1) sobreponer un cuadro de madera o tubos de PVC, cuyos lados están divididos en centímetros o 2) colocar cintas métricas sobre cada uno de los lados del cuadrado hecho. Estas dos variantes del método se utilizan para ubicar a los individuos dentro del cuadro al indicarse la distancia de la planta respecto a dos de los lados (un sistema xy). Esta técnica es muy buena cuando los individuos están separados uno del otro, pero hay que tener cuidado cuando están muy cercanos (menos de 1 cm de distancia). Además, es fácil de implementarse, es muy precisa y deja muy poca evidencia en el campo.

![Métodos de triangulación para muestreo: los P_x representa la posición de cada planta. Dos distancia son medidas, cada una de la estaca. Nota que este método no se añade un identificador individual a las plantas.](Figures/Triangulation_Method.pdf){width="100%" height="400"}

<br>

b)  *Método de sin área*. En campo, las orquídeas terrestres forman pequeñas colonias, algunas de menos de 20 individuos e incluso hay especies con individuos aislados (Ej. *Govenia lagenophora*, *Dichromanthus cinnabarinus* y *D. aurantiacus* [@tellez2007orquideas; **Mariana Hernández-A obs**. pers], por lo que su dinámica poblacional generalmente es descrita a partir de la información obtenida en varias colonias o subpoblaciones. El método sin área ha sido ampliamente usado en este tipo de orquídeas, no es invasivo y consiste en la selección de una colonia o subpoblación en la que se marcan todas las plantas observadas en el lugar (@martinez2024estimation). Asimismo, la ubicación del sitio y los individuos puede geo-referirse y/o hacer mapas de localización.

## Marcaje y monitoreo de los individuos en el tiempo

La dinámica o cambio en una población se evalúa marcando y siguiendo a todos los individuos que se encuentran en un sitio (i.e. censo) o de solo una parte de éstos (i.e. muestreo) a lo largo de sus distintas etapas del ciclo de vida.
Sin importar si censamos o muestreamos, tenemos que asegurar dos aspectos durante el marcaje o etiquetado de una población:

1)  que se incluyan individuos de todas las categorías de etapa/estado que conforman una población y

2)  que el número de individuos de cada estapa/estado sea suficiente para poder llevar a cabo un análisis demográfico robusto que refleje, con cierta precisión, la dinámica de la población seleccionada.

3)  además de esto, también debemos lograr que el registro de la información en campo sea fácil, consistente y sin error.

### Etapas de las orquídeas de estudio a identificar en campo

Identificar las etapas/estados de desarrollo de una especie es escencial para evaluar los cambios que ocurren en los individuos de una población a lo largo de su ciclo de vida (ver Capítulo XXX).
Para secuenciar dichos cambios se deben identificar las características biológicas y morfológicas que definen cada una de las etapas/estados de desarrollo de los individuos de la población.
Esta serie de características permitirá reconocer y diferenciar las semillas, plántulas, juveniles, adultos y etapas latentes (cuando las haya); asimismo a partir de su monitoreo o seguimiento se reconocerá su cambio de etapa/estado en el tiempo.

Existen características que son distintivas de una etapa/estado en particular, tal es el caso de estructuras reproductivas (flores, frutos y escapos frescos o secos), las cuales son distintivas de los individuos adultos y permiten diferenciar estados de desarrollo en las plantas.
No obstante, cuando se trata de especies de un mismo género que comparten un mismo hábitat, es posible confundir a los individuos de diferente estapas, plantulas, juneniles y adultos de distintas especies debido a que pueden presentar características vehetativas o florales muy similares.
A pesar de esto, y con la ayuda de un botánico experimentado, es posible resolver este dilema en la mayoría de los casos.
Por su parte, los individuos juveniles o no reproductivos serán aquellos que no presenta flores ni frutos, y son distintos a las plántulas, que son los individuos recién establecidos.
Para mayor información sobre los individuos reproductivos y no reproductivos consultar el *Capítulo X*.

Dos de las etapas de desarrollo más difíciles de seguir en campo son las semillas y plántulas, por lo que para su caracterización y muestreo en campo hay que considerar lo siguiente:

#### *Semillas*.

La fase de semillas es uno de los mayores retos en el estudio de las orquídeas, ya que sus tamaño tan pequeño (i.e. son conocidas como semillas polvo o “dust-seeds”) dificulta el seguimiento de su dispersión, germinación y establecimiento en campo [@ackerman1996seedling; @ticktin2020synthesis]; parámetros que son de gran utilidad al momento de estimar los valores de fecundidad o de transición en el primer estadio del ciclo de vida.
Actualmente en el medio natural, el método más usado para evaluar la germinación es la introducción de bolsas pequeñas de malla de plancton (mesh plankton, 50 μm) con semillas, las cuales se colocan en el suelo o en la corteza de árboles y se recogen en uno o distintos periodos del año [@rasmussen1993seed; @rasmussen2011methods; @anghelescu2023asymbiotic].

#### *Plántulas*.

Identificar las plántulas en orquídeas también tiende a ser muy complicado debido a que se desconoce su morfología en la gran mayoría de las especies.
Por ejemplo, en el caso de *Cypripedium irapeanum*, una orquídea terrestre, las plántulas presentan tallos muy delgados y su apariencia es semejante al pasto y varias de éstas se encuentran escondidas entre la vegetación (Hernández-Apolinar, comunicación personal).
En el caso de orquídeas epífitas, se trata de los individuos más pequeños en la población, algunos se pueden reconocer si no están cubiertas de musgo, liquen u otra tipo de planta.
Raymond Tremblay (com. pers.) ha encontrado a estas pequeñas plantas en alreredor de las plantas adultas, por lo que recomienda esta estrategia para marcar correctamente esta fase de desarrollo en orquídeas terrestres o epífitas; sin embargo, un problema potencial es lograr diferenciar correctamente las plántulas de distinta especie.
En *Lepanthes*, por ejemplo, las plántulas se establecen entremezclas en el mismo forofito y carecen de caracteres distintivos por lo que es imposible distinguirlas por especie (Tremblay com. pers.); esto se logra solamente cuando se marcan y siguen cuidadosamente a etapas posteriores (juvenil o adulto).
De esta manera, el autor ha logrado distinguir entre plántulas de *Lepanthes eltoroensis* y *L. woodburyana*, las cuales se diferencian únicamente en la forma de crecimiento del tallo.
Al continuar el desarrollo, *Lepanthes eltoroensis* tendrá un crecimiento postrado, mientras que éste será erecto en *L. woodburyana*.
Si bien este método es bueno, es importante considerar que puede representar un periodo de tiempo largo y que se corre el riesgo de no saber la especie cuando las plántulas no sobreviven a la siguiente etapa.

## Identificar la caracteristicas de la especie de estudio

Para cualquier estudio usando el acercamiento de dinámica poblacional es necesario conocer lo básico de la especie de interés y las etapas/edades que corresponde al ciclo de vida de esa misma.
Poder reconocer las diferentes etapas del ciclo de vida con exactitud es esencial, por ejemplo separar entre las semillas, plántulas, juveniles y adultos y si hay etapas latentes.
Cuando se define una etapa de vida se debería tener características morfológicas que se puede identificar en el campo con facilidad y para reducir los errores de asignaciones a otras etapas.
Por ejemplo en *Lepanthes* [@tremblay2003population] definió un juvenil como individuo que tiene tallos con "at least one lepanthiform sheath on the petiole and no current or previously-produced inflorescences" (**Aucencia traducir por favor**).
Nota que aquí la diferencia entre una plántula y un juvenil es que tenga una *lepanthiform sheath* y se diferencia de los adultos con la ausencia de evidencia de inflorescencias seca y activa.

Por ejemplo en la foto que sigue tenemos un individuos que tiene dos hojas, una con inflorescencia activa y la otra hoja con inflorescencia secas, por consecuencia ese individuos es un adulto ya que tiene por los menor una inflorescencia activa (produciendo flores).
Nota no es que la inflorescencia tenga flores o no es que la inflorescencia es verde.

![*Lepanthes rupestris* con inflorescencias seca y activa. Foto: Tremblay](Figures/lepanthes_rupestris.jpeg){width="90%"}

### Semillas

Algunos retos en el estudio de las orquídeas es el seguimiento de las semillas y plántulas en el campo.
La dispersión de las semillas en espacio ha sido estudiado muy poco [@ackerman1996seedling] debido a sus tamaños tan pequeños y dificultad de seguir en el espacio.
Los métodos de seguir las semillas en su ambiente natural incluye típicamente ponerlos en una malla y ponerlos en el suelo o la corteza de un árbol y recogerlos más tarde para ver si estas germinaron [@rasmussen1993seed], [@whigham2006seed].
Un patrón que parecer ser consistente en las plantas es que el crecimiento poblacional tienden a ser limitado por las semillas [@turnbull2000plant].

### Identificación y etiquetado de individuos.

Debido a la naturaleza sésil de las plantas, una vez delimitada la población resulta relativamente sencillo contar e identificar a todos los individuos seleccionados.
Sin embargo, el monitoreo y secuenciación de todos y cada uno de los procesos o eventos de desarrollo por los que transita cada uno de los individuos año con año sólo es posible si: a) contamos con material de marcaje de calidad y b) si tenemos un sistema de identificación sencillo y claro.
Estos dos sencillos pasos evitarán mezclar la información entre individuos de una misma población o confundir la información con plantas de otras poblaciones.
Es decir, la calidad de nuestros datos dependerá, en parte, de cómo marquemos y de qué calidad sea el material que usemos para el marcaje.

a)  *Qué material usar al marcar o etiquetar un individuo o sitio de muestro*.

La calidad y sobre todo la durabilidad del material de marcaje es muy importante cuando hacemos un estudio poblacional, más aún cuando se trata de uno de largo plazo (múltiples años).
Si las marcas se desintegran de un año a otro, se perderá la identidad de cada planta y si no nos damos cuenta podríamos suponer dos cosas en nuestro siguiente monitoreo: 1) que el individuo murió o 2) que hay un nuevo reclutamiento en la población (aparece un nuevo individuo sin marca pero es un error por la perdida del identificador).
Esto sesgaría nuestros resultados al suponer un aumento en la mortalidad o, en su defecto, un aumento en el reclutamiento.
Naturalmente, estos sesgos dependeran del número de individuos que marquemos (i.e. tamaño de la muestra).
Por regla general se ha considerado que a menor tamaño de muestra, mayor es el impacto de estos estas asignaciones de dinamica poblacional y por consecuencia mayor es el sesgo.

Las etiquetas de aluminio resultan ser un buen material al marcar los individuos de las orquídeas de cualquier ambiente (i.e. epífito, terrestre o rupícola).
El aluminio laminado es un material relativamente barato, muy duradero y se puede escribir sobre éste; por lo que, se garantiza la permanencia de la marca o etiqueta y la de las inscripciones que hayamos hechos sobre ésta, hay tambien marcadores previamente numerado.
Además, este tipo de etiquetas puede sujetarse a la planta o colocarse cerca de ésta con diferentes materiales; por ejemplo, hilo de pescador, cinchos de plástico, alambre galvanizado o plastificado, clavos, chinchetas (drawing pin) y grapas, entre aquellos más usados.
Un aspecto que hay que cuidar al marcar individuos es que las etiquetas se enmascaren con el ambiente; es decir, que no sean muy grandes, estén protegidas y que no sean evidentes en areas donce transitan personas no asociada a la investigación, a fin de evitar su pérdida o, incluso, el robo de plantas por gente ajena a la investigación es algo que siempre debemos tratar de minimizar.

La durabilidad del material usado es muy importante cuando existen eventos en el ciclo de vida de una especie que pueden prolongarse por varios años.
Este es el caso de algunas orquídeas terrestres que pueden no rebrotar y mantenerse en latencia vegetativa por más de un ciclo anual de forma consecutiva.
Por ejemplo, en *Liparis lilifolia* puede no emerger por tres o más años continuos [@hutchings1987population; Wells, 1991], mientras que en *Epipactis helleborine* por cinco e, incluso, siete años [@light2006appearance; @coates2006effects].
El poder tener un muestreo confiable de la secuenciación de estos eventos en un individuo en el mediano y largo plazo depende de la calidad del material usado al marcar las plantas, lo cual a su vez permitirá tener buenas estimaciones del tamaño poblacional y de la supervivencia en la población.

<br>

![*Cypripedium acaule* marcado en una población cerca de North Bay, Canada; Foto: Tremblay](Figures/Cypripedium_acaule.jpg){width="60%"}

<br>

*Marcar los sitios de muestreos*.
Al igual que los individuos, los sitios de muestreo también se marcan a fin de facilitar su ubicación en el medio natural.
Estos pueden ser marcados, usando banderines, etiquetas grandes de aluminio o plástico, cinta de señalización (flagging tape) o pintura permanente; asimismo, también se pueden georeferir y hacer mapas de localización.
Cuando se trata de marcas de colores, se deben preferir colores poco llamativos que puedan disimularse con la vegetación circundante.
Si el sitio está bien protegido se puede optar por colores fuertes y llamativos; sin embargo, hay que considerar que los animales (mamíferos, aves, herbívoros) se pueden ver atraídos por éstas e ingerirlas o destruirlas; de ahí que se sugiere utilizar etiquetas discretas que favorezcan su permanencia en el mediano y largo plazo.

*Qué Información debo plasmar en una etiqueta*.
La marca o etiqueta de cada uno de los individuos de una población debe compactar la mayor cantidad de información posible, no solo número consecutivos.
Es decir, generalmente escribimos números consecutivos (1, 2, 3, 4, etc.) en las etiquetas que colocamos a cada individuo en campo.
Sin embargo si no hay notas guía, esta información es limitada cuando se quieren analizar nuevamente; ya que es difícil determinar cuándo se reclutaron los nuevos individuos a la población o cuándo se fragmentó una planta para dar origen a un individuo de una categoría distinta a una plántula.
Asimismo, si se seleccionan distintas poblaciones o colonias y los números consecutivos son los mismos, podemos confundir la información y llegar a conclusiones erróneas.

Cuando se estudia una sola población, una forma sencilla de evitar errores y anexar más información es escribir en la etiqueta el año de estudio y el número consecutivo de la planta.
Por ejemplo, si el estudio comenzó en 2023 y la población está formada por 152 individuos, éstos se podrían codificar así: 23001, 23002, 23003, ...
23152 (i.e. captura).
En el siguiente año (2024) se revisarán o censarán los 152 individuos (i.e. recaptura) marcados y se etiquetarán los nuevos individuos que ingresan a la población (v.g. plántulas), cuya marca iniciará con 24 y el número consecutivo (153 en adelante).
De esta forma se identificará el año en que inició la toma de datos del individuo, el año de ingresaron de los nuevos individuos, lo cual evitará la redundancia en el código, ayudando a reducir los errores de asignaciones de información a individuos incorectos.
Otro aspecto que reduce los errores de codificación es mantener una secuencia lógica en las distintas zonas de muestreo.
Debido a que las orquídeas no tienen una distribución regular y varias de éstas tienen una distribución aparchonada (plantas concentrada en un área), se apremia a mantener números consecutivos (23001, 23002, 23003, etc.) por zona en un sitio de estudio y evitar la mezcla de número es áreas distintas (23001, 23012, 23043, etc.).

Siguiendo con el mismo concepto del inciso anterior, pero aplicado a múltiples poblaciones, en la numeración de la población se puede utilizar una codificación alfanumérica, donde la letra del alfabeto representa a la población y el número a los individuos marcados para su monitoreo.
De esta manera, las marcas individuales se verían de la siguiente forma: A23001, A23002, ..., 23xxx para la primera población y B23001, B23002, ..., B23xxx para la segunda población y así sucesivamente, en caso de estudiar más de dos poblaciones.

Otra forma de codificar las múltiples poblaciones o subpoblaciones es asignando un número a cada una y añadiendo el número consecutivo correspondiente.
En este caso la etiquetas de las plantas número 10 en dos sitios se verían de la siguiente manera: 1.10 y 2.10.
Si queremos añadir el año del estudio, éste también puede ser al final y sería de la siguiente forma: 1.10.23 y 2.10.23.
Para los nuevos ingresos se sigue la misma lógica del inciso anterior, por lo que la nueva planta 155 que ingresa en 2024 a la población 1 le corresponderá la etiqueta 1.155.24.

b)  *Cómo colocar la etiqueta*.
    Existen distintas formas de colocar las etiquetas o marcas en los individuos seleccionados para el estudio y, su colocación no debe afectar el desempeño de la planta marcada y si asegurar su permanencia en el mediano y largo plazo.
    Por ejemplo en las orquídeas epífitas de tamaño grande, la etiqueta de identidad se puede colocar abrazando a la planta, incluyendo la rama o tronco donde se desarrolla, o bien, colocarse abrazando a uno solo de los módulos.
    En el caso de *Laelia autumnalis* (@emeterio2021does), además de la etiqueta de identificación, se marcó **¿con qué?** el último módulo (el más joven o reciente) de cada uno de los frentes de crecimiento.
    Este tipo de marcaje permitió determinar la biomasa nueva que se agrega cada año a cada planta y, al mismo tiempo, permitió identificar la permanencia, crecimiento o retrogresión entre fases de crecimiento.
    En las orquídeas terrestres *Cypripedium irapeanum* **(ref)** y *Govenia lagenophora* **(ref)** funcionó bien usar etiquetas aluminio o cinta dymo amarradas palos de clavos o clavadas en segmentos de alambre delgado, semejando banderitas, los cuales a su vez fueron clavados en el suelo junto a los tallos.

    Las plántulas (pequeños individuos) son muy frágiles por lo que el marcaje es necesario definir un material suave que evite dañar sus estructuras.
    Tremblay (@tremblay2000plant, @tremblay2003population, @tremblay1997lepanthes) utilizo un método adecuado para plantas pequeñas, el cual consiste en colocar la etiqueta al lado de los individuos.
    En este tipo de individuos No se debe amarrar la etiqueta a la planta, ya que el peso de la etiqueta puede causarle daño además de que las hojas no son persistentes, por lo que la marca podría perderse.
    En *Lepanthes eltoroensis* se usaron al principio pequeños clavos para fijar las etiqueta de los individuos, posteriormente se usaron grapas, con lo cual se provocó menos daño al árbol y más facil el proceso de marcar.

![Los individuo de *Lepanthes eltoroensis* fueron identificados con una etiqueta de plástico clavada a la rama del árbol, posteriormente las nuevas etiquetas fueron engrapadas a la corteza del árbol. Foto: Tremblay](Figures/Lep_eltoroensis.png){width="60%"}

<br>

## Variables a registrar en campo

Captar los cambios en crecimiento, reproducción, supervivencia o muerte en los individuos es vital para describir la dinámica de una población en el tiempo.
Dichos cambios se registran en todas y cada una de las distintas etapas por las que transita un individuo promedio a lo largo de su ciclo de vida.
A través de los distintos trabajos publicados es evidente que las categorías o etapas no siempre son las mismas entre las especies, ya que depende de aspectos biológicos de la plantas (características morfológicas, fenológicas y de crecimiento), de la información disponible, del número de individuos marcado y de las preguntas de interés en la investigación [Hernández-Apolinar y Gutiérrez-Paredes, en revisión; Mondragón, 19XX].
En esta sección se presentan ejemplos en los que se utilizan distintas variables vegetativas y reproductivas para la clasificación de los individuos.

Cabe hacer notar que, sin importar las variables que usemos en la clasificación de las plantas, es necesario ser riguroso al colectar los datos, a fin de determinar las diferencias de un periodo a otro (i.e. año, temporada, etc.) asociados a los parámetros definidos, ya que estas diferencias permitirán determinar qué cambios ocurren en los individuos, en primer instancia, y en cada una de las categorías en promedio.
A fin de establecer las diferencias de un muestreo a otro, por convención se ha establecido que el registro de datos en la población al inicio del estudio sea definido como el tiempo cero o inicial ($t_{0}$), mientras que el siguiente sea denominado como $t_{+1}$.
Cuando el estudio se prolonga por más de dos periodos, los subsecuentes muestreos se nombran como $t_{+n}$.
Con base en las diferencias estimadas se podrá establecer cuál o cuáles de éstas categorías son muy dinámicas o, por el contrario, constantes en el ciclo de vida de la especie de interés.

Dos aspectos que facilitarán establecer las categorías y los cambios en los individuos en el tiempo son, por un lado, capturar información relevante que es común para todas las especies (Tabla X), y, por otro, entender cómo crecen o reiteran las plantas.
Las primeras se refieren a las características básicas más simples que permiten diferenciar un estadio de otro.

```{r, echo=FALSE, message=FALSE}
library(tidyverse)
library(gt)
Variable_Censo=tribble(
  ~"*Tiempo inicial t_0*",                       ~"Muestreo posterior t+1",
  "Etapa del individuo",                     "Etapa del individuo",
  "Presencia/ausencia de flores y/o frutos", "Presencia/ausencia del individuo",
  "Número de flores",                         "Presencia/ausencia de flores y/o frutos",
  "Número de frutos",                          "Número de flores",
  "",                                            "Número de frutos",
  "",                                           "Nuevos individuos en la población"  
)
```

```{r, echo=FALSE, message=FALSE}
gt(Variable_Censo)|>
  tab_header(
    title = md("**Variables esenciales en un censo demográfico**"),
    subtitle = ""
  ) |> 
tab_footnote(
    footnote = md("Especificar si se trata de individuos procedentes de semilla o si su origen es por clonación (v.g. keikis, pseudobulbos separados, activación de yemas de reserva en pseudobulbos y rizomas, etc.)."),
    locations = cells_body(
      columns = "Muestreo posterior t+1",
      rows = 6
    )
  )
```

<br>

### *Crecimiento o reiteración vegetativa*.

El crecimiento en las orquídeas es a partir de las yemas de reiteración, las cuales se encuentran en la base de pseudobulbos de plantas epífitas y justo por debajo del suelo en los cormos, rizomas, tubérculos y pseudobulbos de plantas terrestres.
Con la activación de estas yemas, en cada temporada de crecimiento se desarrollan estructuras que dan continuidad al crecimiento individual, las cuales en conjunto son conocidas como módulo de iteración o unidad de crecimiento básico.
El módulo es característico de todas las plantas [@harper1977population] y varía en forma según la especie que se trate.
En algunas orquídeas terrestres, por ejemplo, este módulo está representado por un cormo, yemas de regeneración, hojas , flores y frutos; éstos dos últimos cuando se trata de plantas adultas.
Las mismas estructuras se desarrollan en otras orquídeas, aunque en lugar del cormo se genera un pseudobulbo, un rizoma o un tubérculo(s), según la orquídea en cuestión.

Las yemas de regeneración se pueden clasificar por su actividad en dos tipos: renuevo y reserva [**Rasmussen, 1986**]. Las primeras son aquellas que se activan y dan continuidad al crecimiento de una planta en cada temporada, mientras que las segundas se activan eventualmente. En *Laelia autumnalis* y *L. speciosa* [i.e epífitas; @emeterio2016usos; @hernandez1992dinamica], así como en *Cypripedium irapeanum* y *Govenia lagenophora* [i.e.
terrestre; **Hernández-Apolinar et al. 2012**; **Martínez-Villegas et al. 2023**], se ha observado que las yemas de renuevo se activan (i.e. generalmente una) y dan origen al nuevo módulo al inicio de una temporada de crecimiento; que se suma a la secuencia de módulos formados en periodos previos.
En el caso de *Govenia lagenophora* el nuevo cormo que se produce, reemplaza al módulo del año previo al morir.
Asimismo, estos autores también han reconocido que las yemas de reserva pueden activarse cuando las condiciones ambientales son favorables para sostener el desarrollo de más de un módulo, dando origen a nuevas líneas o frentes de crecimiento que amplían su tamaño (**Figuras 1 y 2, cual son estas figuras?**).

Si bien las orquídeas epífitas y terrestres son perennes, lo que significa que viven por más de dos años consecutivos.
Es importante hacer notar que, el crecimiento es estacional en un gran número de estas plantas; es decir, que solo producen módulos de crecimiento en una época del año (v.g. lluvias o primavera) caracterizada por presentar las condiciones ambientales (i.e. luz, agua, etc.) adecuadas que permiten su reiteración.
Después de este periodo, las orquídeas no tienen actividad y, por lo tanto, no producen nuevas estructuras, y solo captan y/o usan los recursos necesarios para sobrevivir.
Este comportamiento es muy evidente en las orquídeas epífitas, pero lo es más aún en muchas de las orquídeas terrestres, ya que éstas emergen del suelo y son evidentes y vigorosas sólo en un periodo de año especifico (generalmente lluvias o primavera) para después marchitarse y desaparecer en la época menos favorable (v.g. época seca o fría).
Sin embargo, el hecho de que no estén visibles no implica que hayan muerto, como sería el caso de las plantas anuales (v.g. cosmos).
Por el contrario, como parte de su ciclo de vida, las orquídeas terrestres viven bajo el suelo una parte del año; fase conocida como subterránea o latencia vegetativa [@shefferson2020demography].
Esta condición es equivalente a la hibernación en los animales, ya que las plantas sobreviven reduciendo sus actividades fisiológicas y consumiendo los recursos que almacenaron en los cormos, pseudobulbos, tubérculos o rizomas, que también son órganos de almacenamiento (**referencia**).
Aunque a diferencia de los animales, la latencia vegetativa puede prolongarse por más de un año en forma consecutiva, cuando la planta no almacenó suficientes recursos o no existen las condiciones ambientales propicias para su desarrollo (Schefferson et al. 2020).
Por ejemplo, los tubérculos de *Liparis liliifolia* [@hutchings1987population; @wells1991demographic] y *Orchis simia* [Willems & Bick, 1991] pueden sobrevivir de forma subterránea por tres años, mientras que *Epipactis helleborine* por 5 a 7 años [@light2006appearance].
Cabe señalar que, en los estudios poblacionales esta situación dificulta la estimación de la mortalidad en las orquídeas terrestres y, en consecuencia, se desconoce la supervivencia real de las distintas fases de desarrollo de la especie y el tamaño real de una población de interés.
Multiples acercmiento han sido desarrollado para considerar el periodo de no avistamiento en la dinámica de orquides [@shefferson2003life, @kery2004demographic, @shefferson2005adult].
Tremblay [@tremblay2009dormancy, @tremblay2009population] desarrollo métodos bayesiano para estimar los parámetros de supervivencia condicional a si la plantas eran vista el año anterior o no y la cantidad de años sin ser vista.

<br>

### Ejemplos de categorización en especies de estudio

#### Etapas o estadios de desarrollo

<br/>

a)  *Lepanthes*.

Tremblay [@tremblay1997lepanthes] en su estudio con el género *Lepanthes*, una orquídea miniatura epífita, considero las etapas o estadios de desarrollo para definir cuatro categorías del ciclo de vida: plántulas, juveniles, adultos no reproductivos y adultos reproductivos.
Cabe señalar que, cada una de estas etapas está definida específicamente para cada especie de estudio; es decir, no son fijas por lo que pueden incluir más categorías de estado aún dentro del mismo género *Lepanthes*.
Por ejemplo, Tremblay usó en *L. caritensis* [@tremblay2003population] cuatro categorías y otras especies cinco etapas (*L. rubripetala* y *L. eltoroensis*) o seis etapas (*L. rupestris*) al incluir una segunda etapa de adulto reproductivo y un estado no reproductivo [@tremblay2001gene].
Además de definir las categorías de estado, en cada estudio es importante tener claro cuáles son las características tomadas en cuenta para su clasificación.
A continuación, se describen las categorías generales usadas en el género *Lepanthes* [@tremblay2003population]

-   **Plántula**: individuo con hojas y sin peciolo visible.

-   **Juvenil**: individuo con hojas y peciolo, pero sin evidencia de haber sido reproductivo en el pasado (la base de las inflorescencias es persistentes)

-   **Adulto no-reproductivo**: individuos con inflorescencias secas (ninguna verde)

-   **Adulto reproductivo**: individuo con inflorescencia verdes con o sin flores o frutos.

    <br/>

b)  *Govenia lagenophora*.

    Martínez-Villegas y colaboradores [@martinez2024estimation] definieron cuatro categorías de estado (i.e. Reproductivo, No reproductivo, Cormo y Ausente) para la orquídea terrestre *Govenia lagenophora*, cuya dinámica poblacional fue analizada en la Reserva del Pedregal de San Ángel, Ciudad de México, México.
    La estimación de las variables poblacionales fue estimada a partir de cuatro años de monitoreo.

-   **Reproductivo**: Individuos con hojas y con inflorescencia.

-   **No reproductivo**: Individuos con hojas y sin evidencia de ser reproductivos

-   **Cormo**: Individuos latentes, sin producción de hojas o inflorescencias.

-   **Ausente**: Individuos no detectados.

    <br/>

c)  *Caladenia*.

    Tremblay y colaboradores [@tremblay2009dormancy; @tremblay2009population], estudiaron nueve especies del género *Caladenia* en distintas localidades de Australia, cuya demografía fue analizada a partir de tres categorías de estado: individuos vegetativos, individuos en floración e individuos latentes.

-   **Individuos vegetativos**: Individuos con hojas y sin evidencia de ser reproductivos.
-   **Reproductivo**: Individuos con hojas y en flor.
-   **Latente**. Individuos sin actividad aérea.

<br/>

d)  *Laelia speciosa*.

Hernández-Apolinar [@hernandez1992dinamica] por su parte trabajó con la especie epífita *Laelia speciosa*, en la cual se identificaron cuatro fases: plántulas, juveniles y dos estadios de adultos.
Las fases de adultos y juveniles se determinaron a partir del conteo de módulos, que en este caso se trató del número de pseudobulbos por planta.
A continuación, se define cada categoría considerada.

-   **Plántula**: Individuo con un pseudobulbo pequeño (3mm de alto) o sin pseudobulbos y presentado 2 hojas pequeñas (hasta 5 mm de alto) y 1-2 raíces
-   **Juvenil**: Individuo no reproductivo, con 2 a 10 pseudobulbos y que presentan las puntas de los pseudobulbos redondeadas sin evidencia del escapo floral, que es persistente.
-   **Adulto 1**: Individuo con y sin flores, con escapos florales previos y de 11 a 20 pseudobulbos
-   **Adulto 2**: Individuo con y sin flores, con escapos florales previos y con 21 o más pseudobulbos

<br/>

e)  *Ophrys sphegodes*

Hutchings [@hutchings2010population] analizó la dinámica poblacional de *Ophrys sphegodes* por 30 años.
Esta orquídea terrestre se monitoreó durante su fase aérea, considerando la presencia o ausencia de plantas.
A las plantas que emergieron del suelo se les trató como *ramets* (i.e. plantas independientes con la misma información genética), debido a que de los tubérculos (i.e. órganos de perennación subterráneos) de *Ophrys sphegodes* se da origen a más de una planta.
Por convención los ramets (i.e. fragmentos de una planta con vida independiente y con la misma información genética) se analizan como si fueran genéticamente independientes.
En el estudio utilizaron tres categorías para su análisis:

-   **Vegetativos**: Individuos no reproductivos caracterizados por la presencia de hojas en roseta.
-   **En floración**: Individuos con hojas en roseta que presentan inflorescencia.
-   **Latentes**: Individuos que no emergen en la época de crecimiento.

<br/>

f)  *Brassavola cucullata*.

    Ackerman y colaboradores [@ackerman2020small] trabajaron con tres poblaciones de *Brassavola cucullata* en las Islas de San Eustaquio y Saba, Antillas de Barlovento del Mar Caribe, donde esta especie puede ser epífita o vivir sobre rocas.
    Usando el número de hojas se establecieron cuatro categorías de estado:

-   **Juveniles 1**: Plantas con 1 ó 2 hojas.
-   **Juveniles 2**: Plantas con 3 a 6 hojas.
-   **Adultos 1**: Plantas con 7 a 20 hojas.
-   **Adultos 2**: Plantas con más de 20 hojas.

<br/>

g)  *Brassavola cucullata*.

    Ackerman y colaboradores [@ackerman2020small] también analizaron la dinámica poblacional a partir del tamaño de hoja más grande en los individuos.
    Debido a que las poblaciones fueron analizadas con modelos de proyección integral (IPM), la descripción de las poblaciones no se basó en categorías.
    En el estudio la tendencia en la supervivencia y reproducción indicó que las plantas necesitan un tamaño mínimo de la hoja más larga para florecer.

<br/>

h)  *Aspasia principissa*.
    (AVERGIAR ESTA CODIFICACION!!!)

    Zotz y Schmidt [@zotz2006population] analizaron el comportamiento poblacional de *Aspasia principissa* en la Isla de Barro Colorado, Panamá.
    A partir del tamaño del pseudobulbo más reciente, los investigadores determinaron siete categorías de tamaño en la población.
    Además, se evaluó la presencia de flores y frutos en las plantas con un pseudobulbo reciente mayor a 7 cm de altura.
    **SC1**.

    -   Individuos con tamaño del pseudobulbo más reciente menor a 1.5 cm **SC2**.
    -   Individuos con tamaño del pseudobulbo más reciente de 1.6 a 2.5 cm **SC3**.
    -   Individuos con tamaño del pseudobulbo más reciente de 2.6–4.0 cm **SC4**.
    -   Individuos con tamaño del pseudobulbo más reciente de 4.1–6.0 cm **SC5**.
    -   Individuos con tamaño del pseudobulbo más reciente de 6.1–8.0 cm **SC6**.
    -   Individuos con tamaño del pseudobulbo más reciente de 8.1–11.0 cm **SC7**.
    -   Individuos con tamaño del pseudobulbo más reciente mayor a 11.0 cm

<br/>

i)  *Laelia autumnalis*.

Emeterio-Lara y colaboradores (en preparación) estudiaron poblaciones de la orquídea epífita *Laelia autumnalis*.
Las plantas de *Laelia autumnalis* fueron clasificadas en cinco categorías con base a su biomasa.

-   **Plántulas**: Un primer pseudobulbo pequeño
-   **Juveniles 1**: \< 9.5 gramos de biomasa, sin estructuras reproductivas
-   **Juveniles 2**: de \> 9.5 - 23.5 gramos de biomasa, ocasionalmente primeros eventos reproductivos
-   **Adulto 1**: de \> 23.5 - 49.5 gramos con restos y estructuras reproductivas en desarrollo
-   **Adulto 2**: \> 49.5 gramos de biomasa con restos de estructuras reproductivas y escasos eventos reproductivos posteriores

<br/>

![Cypripedium acaule marcado; Foto: Tremblay](Figures/Cypripedium_acaule.jpg){width="50%"}

![Cypripedium acaule identificado con bandera numerada; Foto: Tremblay](Figures/Cyp_acaule_flag.jpg){width="50%"}

Otras variables que pudiese recoger incluye

-   el tamaño de las hojas o la hoja más grande o la cantidad de hojas

    -   *Brasavola cucculata* []: las plantas necesitan un tamaño mínimo de largo de hoja antes de florecer

-   el número de pseudobulbo

    -   ....

-   la altura de la inflorescencia

    -   *Caladenia valida* []: la altura de la inflorescencia impacta la probabilidad de producir frutos (de ser polinizada)

-   la altura en el árbol de las epífitas

    -   *Brasavola cucculata* []: la localización de la planta sobre el forofito. Las plantas muy bajo, menos de 1.5m son depredadas por la cabras

-   el número de "ramet", un indice del tamaño del genotipo en plantas con crecimiento horizontal

    -   *Cypripedium calceolus var. parviflorum* [Tremblay]: Los estudios evolutivos tienen que reconocer la diferencia entre un "ramet" y un "genet".

-   indicadores de herbivoria sobre la planta

-   indicadores de la cantidad plagas sobre la planta como "rust"

<!--chapter:end:04-Recopilacion_datos_en_el_campo.Rmd-->

# Como calcular transiciones para la matriz de Lefkovitch

Por: RLT, Ernesto Mujica y Elaine Gonzalez y Aucencia

```{r, message=FALSE}
library(tidyverse)
```

## Introducción

En el siguiente capitulo estaremos viendo como calcular las transiciones para la matriz de Lefkovitch. En la primera parte veremos como calcular las transiciones de manera tradicional y a mano y en la segunda parte veremos como calcular las transiciones de manera más eficiente usando funciones en disponibles en algunos paquetes de R. Los métodos presentado aquí son una adaptación de los métodos presentados en [@caswell2000matrix] y pueden ver también una aplicación de estos métodos aplicado a las orquídeas [@tremblay2003population]. Si ha hecho análisis de matrices de transición antes, probablemente ha usado el método tradicional de calcular las transiciones y pueden obviar leer este capitulo. Este método consiste en calcular la proporciones de individuos que transitan de una clase de edad a otra. Este método es muy tedioso y propenso a errores hacer a mano. En la segunda parte veremos como calcular las transiciones de manera más eficiente usando funciones en disponibles en algunos paquetes de R.

## Métodos tradicional de calcular las transiciones

El primer paso es la tabla de datos de la orquídea y sus estados en dos periodos de tiempo, digamos un año de intervalo. Aquí adjunto un ejemplo de una tabla de datos de 20 individuos. Tenemos 3 estados en esta planta, "A", "B", "C" y "Muerto". En la tabla de datos, tenemos 19 individuos que fueron muestreados en dos periodos de tiempo. En el primer periodo de tiempo, 7 individuos estaban en el estado "A", 6 en el estado "B" y 6 en el estado "C". Para calcular las transiciones, necesitamos calcular la proporción de individuos que transitaron de un estado a otro. Por ejemplo, de los 7 individuos que estaban en el estado "A" en el primer periodo de tiempo, 1 individuos estaba en el estado "A" en el segundo periodo de tiempo, 2 individuos estaban en el estado "B", 3 individuos estaban en el estado "C", y un individuo que murió, dando las siguientes proporciones

De A a otras clases

-   1/7 = 0.1428, transitaron de "A" a "A"
-   2/7 = 0.2857, transitaron de "A" a "B"
-   3/7 = 0.4285 transitaron de "A" a "C"
-   1/7 = 0.1428 fallecieron de las "A" en el primer periodo de tiempo fallecieron en el segundo periodo de tiempo

Nota que la suma de todas estas transciones tienen que sumar a 1.000. NO pueden ser mayor que 1 o menor que 1. Si la suma de las transiciones es mayor que 1, significa que hay un error en los datos. Si la suma de las transiciones es menor que 1, significa que hay un error en los datos. Esto ocurre cuando se redondea excesivamente o incorrectamente. En este caso, Nota que la suma da un total de 0.9998, que es suficiente cerca de 1.0.

Ahora calculamos las otras transiciones De B a otras clases - 2/6 = 0.3333, transitaron de "B" a "A" - 1/6 = 0.1666, transitaron de "B" a "B" - 2/6 = 0.3333, transitaron de "B" a "C" - 1/6 = 0.1666, fallecieron de las "B" en el primer periodo de tiempo fallecieron en el segundo periodo de tiempo

De C a otras clases

-   1/6 = 0.1666, transitaron de "C" a "A"
-   2/6 = 0.3333, transitaron de "C" a "B"
-   1/6 = 0.1666, transitaron de "C" a "C"
-   2/6 = 0.3333, fallecieron de las "C" en el primer periodo de tiempo fallecieron en el segundo periodo de tiempo

```{r, echo=FALSE, eval=FALSE}
library(tidyverse)
a=2/6
b=1/6
c=1/6
d=2/6

sum=a+b+c+d
sum

sum2=0.1428+0.1428+0.2857+0.4285
sum2

```

```{r, transiciones_tabla, message=FALSE, echo=FALSE}

library(gt)
Orchis_ficticia=tribble(~Num_ind, ~anio_1, ~anio_2,
                        1,  "A", "Muerto",
                        2,  "A", "B",
                        3,  "A", "C",
                        4,  "B", "A",
                        5,  "B", "B",
                        6,  "B", "C",
                        7,  "C", "A",
                        8,  "C", "B",
                        9,  "C", "C",
                        10,  "A", "A",
                        11,  "A", "B",
                        12,  "A", "C",
                        13,  "A", "C",
                        14,  "B", "A",
                        15,  "B", "Muerto",
                        16,  "B", "C",
                        17,  "C", "Muerto",
                        18,  "C", "B",
                        19,  "C", "Muerto",
                        20,  "", "A"
                        )
gt(Orchis_ficticia)                        
```

Ahora usamos los valores calculados arriba para construir la matriz de transiciones.

Nota que en las columnas representa el estado en el tiempo 1 y las filas los estados en el periodo 2. Importante la transiciones a Muerto no se poner, automáticamente los análisis reconoce que 1 menos la suma las transiciones en la matriz, sera la proporciones de fallecimiento.

```{r}
ficticia_matrix=matrix(c(0.1428, 0.3333, 0.1666,
                         0.2857, 0.1666, 0.3333,
                         0.4285, 0.3333, 0.1666), 
                            nrow=3, byrow=TRUE)

ficticia_matrix
```

### Añadiendo los nombres de las etapas

Es buena práctica añadir el nombre de las etapas a la matriz ya que ayuda a encontrar incosistencia y posible errores. Las dos funciones necesarias son **rownames** y **colnames**.

```{r}
rownames(ficticia_matrix)<-c("A", "B", "C")
colnames(ficticia_matrix)<-c("A", "B", "C")

ficticia_matrix

```

------------------------------------------------------------------------

### Construcción de matriz con funciones en R

En la próxima sección veremos como calcular las transiciones de manera más eficiente usando funciones en disponibles en algunos paquetes de R. La función principal que usaremos es la función **projection.matrix** del paquete **popbio**. Sin duda esta función es más eficiente y menos propensa a errores que hacerlo a mano.

Los argumentos de la función **projection.matrix** son los siguientes:

```         
projection.matrix(
  transitions, # el nombre de la tabla de datos
  stage = NULL, # el nombre de la columna con los estados en el primer tiempo
  fate = NULL, # el nombre de la column con los estados en el segundo tiempo
  fertility = NULL, la información sobre la fertilidad
  sort = NULL, # si se quiere ordenar los estados de la historia de vida
  add = NULL,
  TF = FALSE # si quiere que la matriz de transiciones y de fertilidad sean separados usa = TRUE 
   )
```

Nota que el output de la función **projection.matrix** es una lista con dos elementos, en dos matrices, una con las transiciones $T$ y otra con la fertilidad $F$. La primera tiene solamente los valores de transiciones y la segunda solamente los valores que corresponde a la fertilidad, o sea la cantidad de individuos que se añaden a cada clase de edad.

```{r}
library(popbio)

Orchis_ficticia_df=as.data.frame(Orchis_ficticia) # Nota que es importante convertir la tabla de datos a un data frame si es en formato de tibble. 
stages=c("A", "B", "C")
Orchis_ficticia_df$fertility<-0
projection.matrix(Orchis_ficticia_df, anio_1, anio_2, fertility, stages, TF=TRUE)


```

Si quiere la matriz con la unión de ambas matrices, puede usar el argumento **TF=FALSE**.

```{r}
projection.matrix(Orchis_ficticia_df, anio_1, anio_2, fertility, stages, TF=FALSE)
```

### Fertilidad

Nota que no se añadió el calculo de la fertilidad en la tabla de datos, por lo que la matriz de fertilidad es una matriz de ceros. En el próximo capitulo veremos como añadir la fertilidad a la matriz.

## Problema con el uso tradicional de calcular las transiciones

El uso de estos métodos tradicionales aun que sean calculado a mano o usar la función **projection.matrix** del paquete **popbio** pudiese ser problemático. Los problemas ocurren por condiciones de muestreo, especialmente cuando trabajan con especies raras y los tamaños de muestra están pequeños o que las transiciones son raras de forma natural [@tremblay2021population; @gascoigne2023standard]. En el capitulo XX: **Impacto de datos sin sentidos** se discute como construir matrices más confiable y cuando se debería usar el método Bayesiano para los análisis.

<!--chapter:end:05-calcular_transiciones.Rmd-->

# Como calcular fecundidad

## Por: Demetria y Aucencia: equipo ECOSUR

## Métodos tradicional de calcular las transiciones



## Problema con el uso tradicional




## Referencias

<!--chapter:end:06-calcular_fecundidad.Rmd-->

# Matrices de transicion, fecundidad y clonal {#Fertilidad}

## Por: Raymond 


## Tres tipos de matrices

Para facilitar los análisis y interpretaciones es necesario tener claro la diferencias en los parámetros que provienen de transiciones, fecundidades y clonaje, cada sub-matriz se suma para tener un modelo de una matriz poblacional.  La suma de cada una de esas sub-matrices resulta en la matriz de transiciones para evaluar algunos de los parametros del crecimiento poblacional.

Definiciones de las matrices

 - MatU = Matriz de transiciones
 - MatF = Matriz de Fecundidad
 - MatC = Matriz de clonaje
 - MatA = MatU + MatF + MatC
 
 
  ![Relación entre matrices; Diseño: Samuel Gascoigne ](Figures/Matrices_A_U_F_C.jpg){width=90%}

## MatU: Matriz de transiciones

En la matriz de transiciones, **MatU** se encuentra solamente la información sobre de transiciones, estasis o retroceso entre las etapas de vida. Por consecuencia todo información sobre reproducción y clonaje es excluida.  Si el diseño del modelo asume tres etapas de vida, plantulas, juvenil y adultos, se incluye solamente las siguientes transiciones.

Nota que es este modelo los juveniles no pueden regresar a ser plantulas, pero los adultos pudiese regresar a ser juvenil.  Seria probablemente más adecuado re-nombrar la etapa juvenil (que se entiende que no es reproductivo) a algo más claro como "Individuos pequeño".

```{r chap6_1}
library(DiagrammeR)
library(Rage)
matU <- rbind(
  c(0.1, 0.0, 0.0),
  c(0.5, 0.3, 0.05),
  c(0.001, 0.4, 0.8)
)
stages <- c("Plantulas", "Juvenil", "Adulto")
plot_life_cycle(matU, stages=stages)
```


## MatF: Matriz de fecundidad

 Si uno sigue la figura anterior vemos que los individuos en la segunda etapa se reproducen sexualmente (producen plantulas). Por consequencia seria probablemente más adecuado cambiar de nombre para la segunda etapa de "juvenil" a "individuos pequeños".  Lo que se observa es el ciclo de vida de la oportaciones de plantulas es que los Individuos pequeños y Grande producen plantulas.  
 
 
```{r chap6_2}
library(DiagrammeR)
library(Rage)
matF <- rbind(
  c(0.0, 0.4, 1.8),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
)
stages <- c("Plantulas", "Ind Pequeños", "Ind Grande")
plot_life_cycle(matF, stages=stages)
```

 
## MatC = Matriz de clonación

Esa matriz representa la información para especies que se reproducen por clonaje.  Nota que hay necesitar de definir lo que es crecimiento por clonaje. Por ejemplo un individuo de *Epidendrum* que crece y que tenga más tallos, no debería ser considerado clonaje, pero crecimiento del individuo. Al contrario un individuo que crece de forma que la planta madre se separa en dos o más partes donde no comparten conexión pudiese ser considerado clonaje.  Otra alternativa es que hay muchas especies de orquídeas que producen *keiki*, el momento que estos se separan de la madre se pueden considerar como el mismo individuo (geneticamente igual) a parte (ecologicamente distincto).  

Necesitamos fotos de orquídeas con clonaje y keiki (quien puede ayudar)

Se debería enfatizar que añadir el concepto de clonaje dentro de la matriz de transiones resulta en estimados de parámetros diferentes, tal como el tamaño efectivo de población, Ne, en adición de evaluar otros conceptos evolutivos.  En estudios evolutivos no es el individuo como tal que es la unidad de interés pero el individuo como fuente de diversidad genética, por consecuencia individuos (clones) que son genéticamente igual son evolutivamente el mismo individuos aunque estén separado físicamente. Las poblaciones organizados en clones afecta la interpretación de datos tanto en los estudios ecológico y evolutivos @cook1983clonal.  Cuando se estudia especies con clonación hay que diferenciar entre los que es el "ramet" y un "genet".  Los "genets" son la suma de todas las partes "los ramets" que tiene la misma genética.   Los "ramet", son las partes individuales del individuo.  En orquídea se podría considerar cada seudobulbo como un ramet y la suma de todos los seudobulbo como el "genet".  Hay acercamiento para tomar en cuenta la adecuación de los "individuos" en la matriz y por consecuencia intergrar el concepto de clonación en los estimados. vea: @mcgraw1996estimation.    












<!--chapter:end:07-matriz_transicion_fecundidad_clonal.Rmd-->



# Método bayesiano de calcular las transciones y fecundidades

Por: Raymond L. Tremblay

El objetivo de este capítulo es demostrar algunos de los retos cuando uno trabaja con especies raras o con especies que tiene tamaño de muestra limitada. El onjetivo de este capitulo es demostrar como tomar encuenta los analisis cuando hay poca información para estimar los parametros de la matrices y como se puede resolver y estimar parametros más realista.

Considera este primer ejemplo donde se estima que la especie de interes tenga tres etapas en su ciclo de vida (semillas, plantulas y adultos) y que solamente la etapa más grande (de adultez) puede producir semillas.

Cuando se comienza un analisis de dinamica poblacional el primer paso es evaluar y tratar de ver cual son las etapas del ciclo de vida que pudiesen ser representativo de la dinámica principal de la especie y que sea realista cuando se considera el ciclo de vida de la especies y práctico en la recolección de datos.  

En esta primera figura vemos lo que se considerá que ocurre en esa especie hipotetica.  

Ahora ud recoge los datos del campo y evalua las transiciones y fecundidad y tiene información siguiente.  



 1. Todas las semilla germinan y crece a la etapa de plantula.  
  - Es realista que todas las semillas germinan? 
  - Por que no se encontró semillas que NO germinan?
  
 2. Todos las plantulas mueren
    - Es realista que todas las plantulas se muere dentro del ciclo de vida de una especies?
    
    
Aqui se ve dos de los problemas que resulta en MPM que no son realista, uno que no hay ninguna mortantad o que todo se muere.  El otro componente es el efecto del tamaño de muestra, considerá que su especie de interes usted tuvo acceso solamente a 4 plantas adultas (un especies rara), y 4 de los 4 sobrevieron, por consecuencia 100% de supervivencia.  Si los individuos llegan a esta etapa son inmortales!!!?  Claramente es un resultado del tamaño de muestra y no del ciclo de vida de la especie. 

Es importante reconocer la diferencia entre los valores recolectado y la historia de vida típica de una especies. Uno podría usar los datos que 100% de los individuos sobreviven pero eso es realista a largo plazo? 

El paquete raretrans ayuda en resolver estos asuntos illogicos y crear matrices que son más realistas al considerar el ciclo de vida típica de la especie estudiada.  

Aqui un ciclo de vida que no es biologicamente realista

 - todas las semilla sobreviven y pasan a plantulas
 - ninguna plantula sobrevive y/o pasa a ser adultos
 - los adultos 90% se quedan como adulto pero ninguno produce semillas
 
 NOTA que es posible que los datos que recolectan del campo sean estos, pero muchas veces esas observaciones son un resultado de la falta de tamaño de muestra.   
 

 
 
 
```{r chap7_1}
# hidden code to produce figures
library(DiagrammeR)
library(Rage)


matA <- rbind(
  c(0.0, 0.0, 0.0),
  c(1.0, 0.0, 0.0),
  c(0.0, 0.0, 0.9)
)
stages <- c("semillas", "plantulas", "adultos")
title <- NULL


```

```{r chap7_2}
plot_life_cycle(matA, stages=stages)

```

Considera este ejemplo:

 - Si Ud estudia los arboles Sequioa      y muestra los arboles grandes (con un dbh de > xxx), aunque muestra 1000+ individuos de esa etapa/tamaño es posible que no encontrará ninguno que muere. Por consecuencia el estimado de supervivencia de esos arboles es 100%.  Aunque uno sabe que si hubiese muestrado 10,000 o 100,000 arboles se podria haber detectado uno más que fallece.  


## El paquete "raretrans"

La información original del uso del paquete se encuentra aqui https://doi.org/10.1016/j.ecolmodel.2021.109526.

**Population projections from holey matrices: Using prior information to estimate rare transition events**

Abstracto

Las matrices de proyección de población son un medio común para predecir la persistencia de la población a corto y largo plazo para especies raras, amenazadas y en peligro de extinción. Los datos de tales especies pueden sufrir de tamaños de muestra pequeños y, en consecuencia, perder eventos demográficos raros que dan como resultado trayectorias de ciclo de vida incompletas o biológicamente poco realistas. Las matrices con valores faltantes (ceros; p. ej., sin observación de semillas que se transforman en plántulas) a menudo se subsituyen utilizando información previa de la literatura, otras poblaciones, períodos de tiempo, otras especies, estimaciones de las mejores conjeturas o, a veces, incluso se ignoran. Para paliar este problema, proponemos usar un modelo multinomial de Dirichlet para parametrizar transiciones y un Gamma para los estimados de reproducción para substituir los valores faltantes en estas matrices perforadas. Esto integra formalmente la información previa dentro de un marco bayesiano e incluye explícitamente el peso de la información previa en las distribuciones posteriores. Mostramos utilizando dos conjuntos de datos reales que el peso asignado a la información anterior influye principalmente en la dispersión de los posteriores, la inclusión de anteriores da como resultado matrices irreducibles y ergódicas, y se pueden hacer inferencias biológicamente más realistas sobre las probabilidades de transición. Debido a que las previas se establecen explícitamente, los resultados son reproducibles y se pueden volver a evaluar si hay previas alternas disponibles en el futuro.

## Instalación de los paquetes #1

```{r chap7_3}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(janitor, tidyverse, devtools)

library(tidyverse)
library(janitor)

```

## Instalación de raretrans #2

Para instalar **raretrans** remover el **#** antes de los codigos para correrlos

```{r chap7_4}
#library(devtools)

#devtools::install_github("atyre2/raretrans", build = TRUE, build_opts = c("--no-resave-data", "--no-manual"))

library(raretrans)


```

Vea el siguiente website para más información en ingles, la información que sigue es una traducción y ampliación de la información en el siuiente enlace. 

<https://atyre2.github.io/raretrans/articles/onepopperiod.html>

```{r chap7_5, message = FALSE}

library(tidyverse)
library(ggplot2)
library(popbio) # para la función projection.matrix()
library(raretrans)
# Mi tema de ggplot2 personal
rlt_theme <- theme(axis.title.y = element_text(colour="grey20",size=15,face="bold"),
        axis.text.x = element_text(colour="grey20",size=15, face="bold"),
        axis.text.y = element_text(colour="grey20",size=15,face="bold"),  
        axis.title.x = element_text(colour="grey20",size=15,face="bold"))
```

El objetivo de esta viñeta es demostrar el uso del paquete `raretrans`
para los calculos de los parametros en una población y periodo de
transición.

## Parte I: Obtención de la matriz de proyección

`raretrans` asume que la matriz de proyección es una lista de dos
matrices, una matriz de transición y una matriz de fertilidad. Este es
el formato de salida de `popbio::projection.matrix`. Si tenemos
transiciones individuales en un marco de datos

Podemos utilizar `popbio::projection.matrix` para obtener los datos
necesarios. Hacemos una demostración con los datos de transición y
fertilidad de la orquídea epifita *Lepanthes elto* **POPNUM 250** en el
**periodo 5**. *Lepanthes eltoroensis* es endemica de Puerto Rico, epifita y limitada a una pequeña región de la isla.  

## Paso 1: Cargar y fusionar los datos de población única para *L. elto*

```{r chap7_6}
data("L_elto") # carga el conjunto de datos `L_elto` en la memoria de la computadora (los datos están incluido en el paquete `raretrans`)
head(L_elto) 
```

## Organización de los datos en el "data.frame"

-   el primer paso es seleccionar los datos de una población y un periodo de tiempo.
-   el segundo paso es hacer un cambio en la terminología para el estado más pequeño de "plantula" a "seedling"... Ese cambio es para que la información presentada aqui sea la misma que en el documento en ingles.

Cada fila de este data.frame de datos tiene columnas para la fase actual (stage, periodo **t**), la fase siguiente (next_stage, periodo **t+1**) y la fertilidad por individuo.
Tenga en cuenta que "p" significa "plantula" en español. El primer conjunto de líneas de abajo cambia el nombre de la etapa del ciclo vital de "p" a "s" después de seleccionar la población y el periodo de tiempo.

```{r chap7_7_mungeData}
onepop <- L_elto %>%   
# Filtrar la población # 250, el periodo (año=year) 5
  filter(POPNUM == 250, year == 5) %>% 
  # redefine "p" por plantula a "s" para seedling
  mutate(stage = case_when(stage == "p" ~ "s",
                           TRUE ~ stage),
         next_stage = case_when(next_stage == "p"~ "s",
                                TRUE ~ next_stage))
# popbio::projection.matrix no funciona con tibbles, por consecuencia se convierte en data.frame

head(onepop) # AHora tenemos solamente datos de la población #250 del periodo 5
# Crear TF = TRUE, añadir para formatear corectamente.
TF <- popbio::projection.matrix(as.data.frame(onepop), 
                        stage = stage, fate = next_stage, 
                        fertility="fertility", sort=c("s","j","a"), TF = TRUE)
TF # Este es la estructura de etapas de vida para esa población.  Nota que tenemos dos matrices, una de transiciones **T** y otra de fertilidad **F**. 
```

## Nota:

Nuestros estadios se codifican ahora como **s** (plántula), **j** (juvenil) y **a** (adulto), y ahora tenemos dos matrices: **T** (transición de estadios) y **F** (fecundidad). La tasa de crecimiento asintótico de la población observada es $\lambda =$ `r format(lambda(TF$T + TF$F),digits = 2)`. Las transiciones raras que faltan en nuestra primera matriz de transición, `TF$T`, son la transición de plántula (*s*) a adulto (*a*) y la transición de *j* a
*s*. Pero sabemos que ocurren.

## Paso 2: Obtener el número inicial de individuos por etapa

Dado que nuestras recuentos (número de individuos, *N*) y el tamaño de *muestreo equivalente* a priori se expresa como múltiplo del número de individuos observados, necesitamos obtener el número de individuos en cada etapa ($N$) en el primer periodo de tiempo.

Utilizamos la función `raretrans::get_state_vector()` para obtener el recuento inicial de individuos, *N*.

```{r chap7_8}
N <- get_state_vector(onepop, stage = stage, sort=c("s","j","a")) 
N # Un vector # de individuos iniciales para cada etapa, nota que la cantidad por etapa, "stage", son los individuos en el primer muestreo
```

La lista de matrices y el vector de cuento de individuales no tienen por qué proceder de un data.frame como hemos hecho aquí. Mientras tengan el formato esperado, pueden crearse a mano. Usamos la población 231 en el periodo 2 como ejemplo, dividiendo la matriz en submatrices de transición **T** y fecundidad **F**. Abajo, *m* significa "muerte", es decir, plantas que están muertas.

```{r chap7_9, echo=FALSE}
Tmat <- L_elto %>% 
  mutate(stage = factor(stage, levels=c("p","j","a","m")),
         fate = factor(next_stage, levels=c("p","j","a","m"))) %>%
  filter(POPNUM == 231, year == 2) %>%
  as.data.frame() %>% 
  xtabs(~fate + stage, data = .) %>% 
  as.matrix()
Tmat <- Tmat[,-4] # remover la columna para transiciones a la muerte
N2 <- colSums(Tmat) # obtener el número total. Averiguar: debe ser antes de 86 en este caso. 
Tmat <- sweep(Tmat[-4,], 1, N2, "/") # normalizar a 1, descartando las transiciones *DESDE* la muerte
# averiguar cuánta reproducción ocurrió en el año 2 mirando el año 3
# L_elto %>% 
#   mutate(stage = factor(stage, levels=c("p","j","a","m")),
#          fate = factor(next_stage, levels=c("p","j","a","m"))) %>%
#   filter(POPNUM == 231, year == 3, stage == "p") %>%
#   count(stage) 
# 2 offspring from N[3] == 16 adults
Fmat <- matrix(0, nrow=3, ncol=3) # crear una matriz de ceros. 
Fmat[1,3] <- 2/16 # contar 16 adultos reproductivos en el tiempo t y dos plantulas en el proximo tiempo t+1, 2/16. 
TF2 <- list(Tmat = Tmat, Fmat = Fmat)
```

```{r chap7_10}
TF2
N2
```


¿Como se ve el ciclo de vida de esa población en ese periodo? 

```{r chap7_11}
stages2 <- c("plantulas", "juveniles", "adultos")
title <- NULL
plot_life_cycle(Tmat, stages=stages2)
```

En esta matriz falta la transición de plántula a juvenil, y ninguno de los 6 juveniles murió, lo que lleva a una sobreestimación de la supervivencia. La tasa de crecimiento asintótico de la población observada es $\lambda =$ `r format(lambda(TF2$T + TF2$F),digits = 2)`. La matriz no es ergódica (no se puede llegar a cualquier otro estado desde uno o más estados), y reducible, lo que significa que una o más columnas y filas se pueden descartar y tienen las mismas propiedades eigen.

## Parte 2: Uso de priors para incorporar transiciones raras

### Use priors no informativos

-   Ese paso es solamente para entender porque no se calcula y porque no
    se usa *prior* uniforme.

Tremblay (@tremblay2021population) muestran que los valores de *prior*
de una dirichlet funciona para las columnas de la matriz de transición
(**T**) y que valores *prior* gamma funciona para las columnas de la
matriz de transición (**F**). 

### Matriz de transición

Por lo tanto, vamos a añadir un dirichlet uniforme con prior con un peso
= $1$ a la matriz de transición, $T$. Aquí, tenemos 4 destinos (3 +
muerte), por lo que cada destino 0,25 a la matriz de destinos
*observados* (¡no a la matriz de transiciones!). de transición). Cuando
especificamos una matriz con un prior para las transiciones, hay una
fila más que columnas. Esta fila extra representa la muerte.

```{r chap7_12_posterior1}
Tprior <- matrix(0.25, byrow = TRUE, ncol = 3, nrow=4)
fill_transitions(TF, N, P = Tprior) # resultado de la matriz de transición básica


# Para entender las diferencias compara los resultados con *$T* del objeto *TF*
TF
```

### Como calcular a mano!

Podemos obtener el mismo resultado 'a mano' - necesitamos el vector de
observaciones porque la posterior se calcula a partir de las
observaciones de transiciones, no la matriz de transiciones.

```{r chap7_13_manualTransitionPost}
Tobs <- sweep(TF$T, 2, N, "*") # obtener las observaciones de transiciones 
Tobs <- rbind(Tobs, N - colSums(Tobs)) # añadir la fila de muerte 
Tobs <- Tobs + 0.25 # añadir los prior
sweep(Tobs, 2, colSums(Tobs), "/")[-4,] # dividir por la suma de la column y descarta la fila de muerte 
```

El *prior uniforme* rellena las transiciones que faltan, pero también
crea problemas porque proporciona valores de transición que son
biológicamente imposibles. Por ejemplo, proporciona una transición para
adulto-\>plántula, cuando esta transición sólo es posible en la matriz
de fecundidad $F$. Por esta razón, no recomendamos el uso de priores
uniformes. En otra palabra usando un prior uniforme no toma en cuenta el
ciclo de vida de una especie.

### Matriz de fecundidad

Debemos especificar los parámetros para la fertilidad *a priori* como
una matriz. Las etapas que no hay reproducción o sea que no se producen
por reproducción deben ser `NA`, usando *NA_real\_*. El concepto de
*NA_real\_* es que es un valor que no esta presente pero con puntos
decimales. Nota que el valor de *prior* de la fertilidad es 0.0001.

```{r chap7_14}
alpha <- matrix(c(NA_real_, NA_real_, 1e-5,
                  NA_real_, NA_real_, NA_real_,
                  NA_real_, NA_real_, NA_real_), nrow=3, ncol = 3, byrow = TRUE)
beta <- matrix(c(NA_real_, NA_real_, 1e-5,
                  NA_real_, NA_real_, NA_real_,
                  NA_real_, NA_real_, NA_real_), nrow=3, ncol = 3, byrow = TRUE)
fill_fertility(TF, N, alpha = alpha, beta = beta)
```

El cambio en la fertilidad es \< 0,0001 en comparación con el valor
observado.

### Calculando los Priors de fertilidad a mano

#### Calculando a mano, *alfa a priori* es el número de crías observadas

y *beta a priori* es el número de adultos observados.

```{r chap7_15}
obs_offspring <- N[3]*TF$F[1,3] 
prior_alpha <- 1e-05
prior_beta <- 1e-05
posterior_alpha <- obs_offspring + prior_alpha
posterior_beta <- N[3] + prior_beta
posterior_alpha / posterior_beta # expected value
```

Esto demuestra por qué la estimación puntual posterior de la fecundidad
no cambia mucho; los valores no informativos de $\alpha$ y $\beta$
apenas cambian los valores observados.

Ahora podemos juntarlos.

```{r chap7_16_uninformativePrior}
unif <- list(T = fill_transitions(TF, N), 
             F = fill_fertility(TF, N, 
                                alpha = alpha,
                                beta = beta))
unif
```

## El crecimiento poblacional

La tasa de crecimiento asintótico de la población es ahora $\lambda =$
`r format(lambda(unif$T + unif$F),digits = 2)`. La tasa de crecimiento
se reduce ligeramente porque la aplicación de la prioridad uniforme a
las probabilidades de transición hace que las transiciones observadas de
crecimiento y supervivencia se reduzcan ligeramente en relación con las
transiciones no observadas de crecimiento y supervivencia.

### Otras opciones para el argumento \`returnType

Por defecto, `fill_transitions()` devuelve la matriz de transición $T$,
y `fill_fertility()` devuelve la matriz de fertilidad $F$. Existen otros
tres otros valores que puede tomar el argumento `returnType`:

1.  `fill_transitions(... returnType = "TN")` puede devolver una matriz
    aumentada de destinos, que es útil para la simulación. La cuarta
    fila de este resultado (véase más adelante) es el estado de
    mortalidad.

```{r chap7_17}
fill_transitions(TF, N, returnType = "TN")
```

2.  `fill_fertility(... returnType = "ab")` devuelve los vectores alfa y
    beta de los vectores posteriores.\

```{r chap7_18}
fill_fertility(TF, N, 
               alpha = alpha,
               beta = beta,
               returnType = "ab")
```

3.  Ambas funciones también pueden devolver la matriz completa, la suma
    de $T$ y $F$.

```{r chap7_19}
fill_transitions(TF, N, returnType = "A")
```

## Añadiendo realidad a los análisis

Hasta este punto, el objetivo era de entender las funciones y su
aplicaciones. Ahora vamos a añadir realidad a los analisis. Como se ha
mencionado no deberiamos usar *priors* uniforme. Debemos usar priors que
son más relevante al ciclo de vida de la especie de interes.

### Incorporar priores informativos

Para solucionar el problema de la creación de transiciones imposibles,
especificamos una prioridad más informativa obtenida de un experto en
orquídeas epifitas (RLT). La información tiene que tener la misma forma
que la matriz de transiciones con una fila más que columnas. Esa ultima
fila representa los individuos que se mueren de la estapa
correspondiente.

```{r chap7_20}
RLT_Tprior <- matrix(c(0.25, 0.025, 0.0,
                       0.05, 0.9,   0.025,
                       0.01, 0.025, 0.95,
                       0.69, 0.05,  0.025), 
                     byrow = TRUE, nrow = 4, ncol = 3)
```

Nota la matriz tiene la 1ª fila, 3ª columna es 0,0, porque esta
transición es imposible. Esta prioridad se construye de manera que las
columnas suman 1, lo que crea la mayor flexibilidad para la ponderación
de la prioridad. Por defecto, la suma es 1, interpretado como un *tamaño
de muestra a priori* de 1.

```{r chap7_21}
fill_transitions(TF, N, P = RLT_Tprior)
```

We can specify the weight as a multiple of the sample size for each
stage.

Podemos especificar el peso de los valores apriori modificando el tamaño de muestra de cada etapa.  Nota que si uno tiene poca confianza en los valores apriori se le da un valor pequeño para que los datos dominan los resultados.  

```{r chap7_22}
fill_transitions(TF, N, P = RLT_Tprior, priorweight = 0.5)
```

En este caso, la prioridad se pondera con la mitad del número observado
de transiciones. En este caso, con sólo 2 transiciones, el tamaño
efectivo de la muestra a priori sigue siendo 1. Si el número de
transiciones observadas fuera Si el número de transiciones observadas
fuera mayor, una ponderación a priori de 0,5N sería mayor que 1, pero
permitiría que los datos dominen.

## Part 3: Obtain Credible Intervals

### Obtener los inertvalos de confianza (IC) para entradas de matriz individuales

La distribución posterior marginal de un elemento en un multinomio es una
distribución beta, y usamos esto para obtener intervalos creíbles en nuestro
tasas de transición. Podemos usar el tipo de retorno TN para obtener los parámetros de el multinomio deseado.



```{r chap7_23}
TN <- fill_transitions(TF, N, P = RLT_Tprior, priorweight = 0.5, returnType = "TN")
a <- TN[,1] # cambie 1 a 2, 3 etc para obter la distribución beta marginal de cada columna. 
b <- sum(TN[,1]) - TN[,1]# cambie 1 a 2, 3 etc para obter la distribución beta marginal de cada columna. 
p <- a / (a + b)
lcl <- qbeta(0.025, a, b)
ucl <- qbeta(0.975, a, b)
knitr::kable(sprintf("%.3f (%.3f, %.3f)", p, lcl, ucl))
```


Esas son las estimaciones puntuales (comparar con la primera columna anterior), inferior
y superior $95\%$ de los intervalos creíbles simétricos para transiciones de la
etapa de plántula. Existe un alto grado de incertidumbre debido a la
tamaño de muestra pequeño ($2$) y bajo peso en el anterior ($1$), lo que lleva a
un tamaño de muestra efectivo de 3. Si aumentamos el tamaño de muestra efectivo
a $20$ especificando: `priorweight`$= 9 (9*2 = 18 + 2 = 20)$ el
los intervalos creíbles simétricos se reducen bastante:

La importancia aqui es que el tamaño de muestra tiene un impacto sobre la confianza que se tiene sobre el estimado de punto (el promedio) de las transiciones y permanencia y mortandad. 

```{r chap7_24, echo=FALSE}
TN <- fill_transitions(TF, N, P = RLT_Tprior, priorweight = 9, returnType = "TN")
a <- TN[,1]
b <- sum(TN[,1]) - TN[,1] # El parámetro beta es la suma de todos los demás parámetros de Dirichlet.
p2 <- a / (a + b)
lcl2 <- qbeta(0.025, a, b)
ucl2 <- qbeta(0.975, a, b)
alltogethernow <- tibble(priorweight = factor(rep(c(1,9),each = 4)),
                         fate = factor(rep(c("s","j","a","dead"), times = 2), levels = c("s","j","a","dead")),
                         p = c(p, p2),
                         lcl = c(lcl, lcl2),
                         ucl = c(ucl, ucl2))
ggplot(data = alltogethernow,
       mapping = aes(x = fate, y = p, group= priorweight)) + 
  geom_point(mapping = aes(shape = priorweight), 
             position = position_dodge(width =0.5)) + 
  geom_errorbar(mapping = aes(ymin = lcl, ymax = ucl),
                position = position_dodge(width = 0.5)) + 
  rlt_theme
```


La tasa de transición de plántula a juvenil se reduce cuando el tamaño de la muestra es demasiado grande. En general, el tamaño de la muestra previa debe ser menos que el tamaño de muestra observado.



## Intervalos creíbles de $\lambda$

Obteniendo intervalos creíbles sobre la tasa de crecimiento asintótica, $\lambda$, requiere simular matrices a partir de las distribuciones posteriores. Esto es algo complicado de hacer correctamente, y hemos escrito una función `raretrans::sim_transitions()` para generar una lista de matrices simuladas dada la matriz observada y especificaciones previas.


```{r chap7_25}
sim_transitions(TF, N, P = RLT_Tprior, alpha = alpha, beta = beta,
                priorweight = 0.5)
```

Ahora simulamos 5000 veces, calculamos el valor $\lambda$ de cada
matriz y creamos un histograma de la distribución.

```{r chap7_26}
#set.seed(8390278) # make this part reproducible
alpha2 <- matrix(c(NA_real_, NA_real_, 0.025,
                  NA_real_, NA_real_, NA_real_,
                  NA_real_, NA_real_, NA_real_), nrow=3, ncol = 3, byrow = TRUE)
beta2 <- matrix(c(NA_real_, NA_real_, 1,
                  NA_real_, NA_real_, NA_real_,
                  NA_real_, NA_real_, NA_real_), nrow=3, ncol = 3, byrow = TRUE)
# generar 5000 matrices basado en las previas de transciones y de fertilidades, el tamaño de muestra, en adición de los datos
RLT_0.5 <- sim_transitions(TF, N, P = RLT_Tprior, alpha = alpha2, beta = beta2,
                priorweight = 0.5, samples = 5000)
# extract the lambdas for each matrix
RLT_0.5 <- tibble(lposterior = map_dbl(RLT_0.5, lambda)) # convertir la lista en un tibble
ggplot(data = RLT_0.5,
       mapping = aes(x = lposterior)) + 
  geom_histogram(binwidth = 0.01, colour="white") + 
  rlt_theme+ geom_vline(xintercept = 1, 
                color = "blue", size=1.5)
```

## Determinar si el $\lambda$ es significativamente diferente de 1

Esa prueba es basada en la simulación de la distribución poesterior.  Se calcula la distribución de los lambda's y se determina si el lmabda observado es significativamente más grande que 1. 

También podemos calcular algunas estadísticas de resumen. `pincrease` es el
probabilidad de que $\lambda > 1$.

```{r chap7_27}
RLT_0.5_summary <- summarize(RLT_0.5,
                             medianL = median(lposterior),
                             meanL = mean(lposterior),
                             lcl = quantile(lposterior, probs = 0.025),
                             ucl = quantile(lposterior, probs = 0.975),
                             pincrease = sum(lposterior > 1.)/n())
knitr::kable(RLT_0.5_summary, digits = 2)
```


}

<!--chapter:end:08-Metodo_bayesiano_transiones.Rmd-->

# Crecimiento Poblacional

Por: Tamara

## Introducción al crecimiento poblacional

Ahora el primer paso es explicar a que .....

  - Crecimiento intrínseco
	- Estimado de intervalos de confianza de lambda



## Métodos


<!--chapter:end:09-Crecimiento_poblacional.Rmd-->

# Elasticidad

## Por: Demetria, Ernesto Mujica y Elaine Gonzalez

## Qué es la Elasticidad

## Como se interpreta la eslaticidad


## Como se calcula la eslasticidad


## Limitaciones


## Referencias

<!--chapter:end:10-Elasticidad.Rmd-->

# Dinámica transitoria (Transient dynamics)

Autores: "Mariana Hernández Apolinar y Paola Portillo Tzompa"

## Dinámica poblacional de largo y corto plazo

Los modelos de proyección poblacional (MPP), previamente vistos en la *Sección XX*, son de carácter determinístico; es decir, éstos suponen que las muertes, la reproducción y el crecimiento individual (i.e. tasas vitales) en las distintas categorías de la población no varían en el tiempo; por lo tanto, al mantenerse constantes la población crece a una velocidad constante y la proporción de individuos por categoría de tamaño/estado no cambia en el largo plazo [@bierzychudek1999looking; **Caswell, 2001? es el libro?**]. Sin embargo, en la naturaleza estas variables distan de ser constantes, debido a que las poblaciones experimentan recursos limitados, ambientes heterogéneos tanto abioticos y bioticos y cambiantes que perturban las poblaciones, afectando su dinámica y sugiriendo que la tasa de crecimiento de largo plazo no es un buen predictor de los cambios que enfrentan dichas las poblaciones [@bierzychudek1999looking; Caswell, 2001]. De ahí que, se hayan desarrollado modelos que integran dicha variación y que permiten hacer proyecciones más realistas sobre la dinámica poblacional de la especie de estudio, tal es el caso de los modelos de de crecimiento estocástico y los análisis de dinámica transitoria.

En particular, los análisis de la dinámica transitoria surgen como una alternativa para analizar cómo cambia la dinámica de una población en el tiempo al presentarse un evento de perturbación (cambios bioticos o abioticos en el tiempo). En este análisis se evalúa la respuesta de la población en el corto plazo; es decir, antes de alcanzar la estructura estable de estadios/edades y de crecer a una tasa constante **(ref)**. Dicha respuesta se determina a través de las discrepancias o diferencias que hay entre la estructura actual (i.e. corto plazo) y la estructura estable (i.e. largo plazo) de la población analizada [@raventos2015transient].

Debido a que el análisis de la dinámica transitoria es complejo, para facilitar y asimilar su desarrollo, a continuación se listan la serie de pasos que se deben seguir. El análisis se lleva a cabo en el Programa de estadística *R* y la serie de pasos fue definida por Stott y colaboradores [@stott2011framework; @stott2012beyond; @stott2012popdemo].

<br>

*Paso 1. Matriz de transición y estructura poblacional inicial*.

En primer lugar se debe contar con una matriz de proyección poblacional y su vector correspondiente de la estructura poblacional observada al inicio del estudio. En en este caso se usarán los datos obtenidos para *Lepanthes rubripetala* por Tremblay y colaboradores [@tremblay2015stable; @schodelbauerova2010prediction].

## PROYECTO DE DINAMICA TRANSITORIA O DE CORTO PLAZO

### PART I: DINÁMICA POBLACIONAL DE LARGO PLAZO

Este es un análisis de dinámica transitoria para *Lepanthes rubripetala* (Población 1) con cuatro clases de estado en su ciclo de vida:

-   plántula,

-   juvenil,

-   adultos no reproductivos,

-   adultos reproductivos.

<br>

### PASO 1. MATRIZ DE PROYECCIÓN POBLACIONAL y ESTRUCTURA POBLACIONAL INICIAL $t_{0}$

```{r chap10_1, message=FALSE}


#Librerias de R requeridas para el análisis 
library(popdemo)
library(popbio)

#Capturar los datos de la matriz para L. rubripetala (Tremblay et al. 2015)
Lr <- matrix(c(0.4324, 0,      0,     0.15,
               0.3784, 0.8459, 0,     0,
               0,      0.0034, 0.7954,0.2300,
               0,      0.0890, 0.1841,0.7510), byrow=TRUE,ncol=4)

#Capturar las categorias de estado
categoria <- c("1","2","3","4")

#Obtener la matriz L. rubripetala 
Lr1 <- matrix(Lr[1:4, ], nrow = 4, dimnames = list(categoria, categoria))
Lr1

```

<br>

#### Capturar y obtener el vector inicial (datos de campo) de clases de estado población 1

Los datos provienen de la siguiente fuenta: [@tremblay2015stable; @schodelbauerova2010prediction] y se refieren a la estructura poblacional inicial de *Lepanthes rubripetala* en la población 1. La estructura poblacional inicial de la población 1 de *L. rubripetala* fue la siguiente:

-   plántula, n= 0

-   juvenil, n= 46

-   adultos no reproductivos, n= 38

-   adultos reproductivos, n = 82

```{r}


n0 <- c(0, 46, 38, 82) 
n0

```

<br>

*Paso 2: Condiciones que debe cumplir la matriz de estudio*.

Previo al análisis de dinámica transitoria se debe comprobar que la matriz de transición poblacional sea: a) Irreducible, que los elementos de la matriz de análisis y, por lo tanto, los nodos de la gráfica del ciclo de vida, estén fuertemente conectados, tengan una ruta, de modo que formen un ciclo. b) Ergódica, que la dinámica asintótica sea independiente de las condiciones iniciales (i.e. estructura poblacional inicial)\
c) Primitiva, que al elevar a altas potencias una matriz irreducible positiva (i.e. sin elementos negativos) su resultado sea único y tenga un sólo valor positivo (i.e. tasa de crecimiento poblacional). (Caswell, 2001)

Así que, a continuación se comprueba si la matriz de *L. rubripetala* cumple con estas condiciones o supuestos.

#### Definición de términos Ergodicidad, Irrecucible y Primitiva

-   El primer punto para cualquier análisis de dinámica poblacional es que la matriz tiene que ser cuadricular n\*n y no negativa.

-   La matriz tiene que ser **ergódica**: Irrelevante de la estructura de etapas inicial que se usa para proyectar el crecimiento poblacional siempre tendrá el mismo crecimiento asintomático.

-   La matriz tiene que ser **irreducible**: El ciclo de vida de la especie tiene las transiciones para que cualquier etapas puede llegar a todas las otras etapas.

Para una discusión sobre estas condiciones vea a [@stott2010reducibility]

Para evaluar si las matrices son ergodica y irreducible se usa las funciones **isErgodic** y **isIrreducible**. Vea que en las cajas siguiente el resultado es "TRUE" por consecuencia cumple con ambas condiciones.

#### a) Ergodicidad

```{r chap10_ergodic}


ergo <- isErgodic(Lr1, digits = 5, return.eigvec = FALSE)
ergo
```

#### b) Irreducible

```{r chap10_irreduc}
irreduc <- isIrreducible(Lr1)
irreduc


```

<br>

*Paso 3: Análisis demográfico básico*.

En el análisis de dinámica transitoria necesitamos conocer cómo se comporta una población en el largo plazo, por lo que se proyecta el crecimiento poblacional de tipo asintótico para la matriz de la población seleccionada. Entonces, a partir de la matriz de proyección poblacional y el correspondiente vector de la estructura poblacional observada al inicio del estudio de *L. rubripetala*, calcularemos la tasa de crecimiento poblacional (i.e.*lambda*, de ahora en adelante *lambda-max*), la estructura poblacional estable (*w*, de ahora en adelante *w-max*) y el valor reproductivo (*v*), así como las matrices de sensibilidad y elasticidad. Con este fin, usaremos el procedimiento de la *Sección X*, desarrollado en el *Programa "popbio" de R*.

Además de esta información, se estimarán dos nuevos términos: el tiempo de convergencia (*convergence-time*) y la relación de amortiguamiento (*damping-ratio*). El primero indica el tiempo esperado en que una población alcanza la estructura estable, mientras que el segundo es una medida de que tan rápido converge una población a la estructura estable (Caswell, 2001).

### Crecimiento asintótico

La definición del crecimiento asintótico de la población *lambda* se basa en la tasa de crecimiento poblacional cuando la población este a su nivel estable de estructura de edades/estados. Por consecuencia se asume que la población llegue o este a un nivel estructura de edades/estados estable.

Para la población de *Lepanthes rubripetala* se obtiene una tasa de crecimiento poblacional de 1.007, lo que indica que la población crece a una tasa constante de 1.007 entre $t_{0}$ y $t_{1}$. Entonces si la población tuviese 1000 individuos hubiese 7 individuos más en $t_{1}$.

```{r chap10_asimptotico}

#Análisis asintótico (i.e. largo plazo) del crecimiento poblacional de L. rubripetala
#La orquídea florece todo el año, por lo que el seguimiento de la población fue mensual. 

#PARÁMETROS POBLACIONALES
##lambda: Tasa de crecimiento poblacional


lambda <-lambda(Lr1)
lambda
```

## Estructura estable

La estructura estable de edades/etapas es un indice de la distribución proporcional de la poblacional que se espera que esta población alcance en el largo plazo. En el caso de *Lepanthes rubripetala* se espera que la población alcance una estructura estable de 0.088, 0.206, 0.369 y 0.337 para las categorías de plántulas, juveniles, adultos no reproductivos y adultos reproductivos, respectivamente. Esta estructura asume que el crecimiento poblacional *lambda* $\lambda$ sigue igual y constante en el tiempo.

```{r stable.stage}
#Estructura estable de estados
Wmax <- stable.stage(Lr1)
Wmax
```

Uno puede visualizar la estructura la estructura de la población usando el codigo siguiente.

```{r estructuraestable_viz}
Wdf=data.frame(Wmax)
Wdf$Categorias=c("Plántulas","Juveniles","Adultos no reproductivos","Adultos reproductivos")
Wdf$Categorias=factor(Wdf$Categorias, levels=c("Plántulas","Juveniles","Adultos no reproductivos","Adultos reproductivos"))
library(ggplot2)

ggplot(Wdf, aes(y=Wmax, x=Categorias)) + 
  geom_bar(stat="identity", fill="blue") +
  labs(title="Estructura estable de estados", x="Categoría", y="Proporción") +
  theme_minimal()

```

## Valores reproductivos

El valor reproductivo *v* es un indice de la contribución de cada categoría de edad/estado a la tasa de crecimiento poblacional. En el caso de *Lepanthes rubripetala* se espera que la categoría de adultos reproductivos contribuya más a la tasa de crecimiento poblacional, seguido por la categoría de adultos no reproductivos, juveniles y plántulas. Los valores en la lista de *v* se compara con la primera edad/estado. Por consecuencia un individuo de la 4ta etapa (adulto reproductivo) tiene un potencial de dejar 2.7 individuos al comparar que una plantula tiene solamente tiene un valor de 1.0. La diferencia es que los individuos pequeños tienen que sobrevivir y llegar a las etapas mayores para contribuir a la tasa de crecimiento poblacional.

```{r valorreproductivo}

valor_repro=reproductive.value(Lr1)
valor_repro
```

## Análisis de elasticidad

La elasticidad es un indice de la sensibilidad de la tasa de crecimiento poblacional a los cambios en las tasas de supervivencia, crecimiento y reproducción de cada categoría de edad/estado. La suma de todas las proporciones es 1.0, por consecuencia uno puede comparar el efecto de cambios proporcional en cada parámetro y evaluar su impacto. En el caso de *Lepanthes rubripetala* se espera que la tasa de crecimiento poblacional sea más sensible a los cambios en la supervivencia de los etapas 3 y 4 ya que tienen una elasticidad de 0.313 y 0.311 respectivamente. Si sumamos el componente de supervivencia (la diagonal) de la matriz de transición poblacional, la suma es (0.018 + 0.122 + 0.313 + 0.311) = 0.764. Por consecuencia, las etapas de supervivencia de los individuos contribuyen a 76.4% y son las etapas más sensitivas a los cambios demográficos. Al comparar si uno fuese a hacer un cambio proporcional en la reproducción (los adultos que dejan plántulas) tendría un impacto mucho más pequeño, solamente de 2.3%.

Los análisis de elasticidad pueden ser usado para evaluar que etapas que pudiese ayudar en enfocar las alternativas de manejo para cambiar la tasa de crecimiento poblacional. Por ejemplo si es una especie en peligro de extinción, uno puede enfocar los trabajos de manejo de la especie en mejorar la supervivencia de los individuos de las etapas más sensitivas. Al contrario si es una especie invasora, uno puede enfocar los trabajos de manejo en reducir la supervivencia de las etapas más sensitivas. En este caso seria reducir la supervivencia de los adultos reproductivos y no reproductivos. Enfocando en las etapas más sensitivas es una forma de maximizar el impacto de los trabajos de manejo con menos recursos. Naturalmente se asume que el manejo de estas etapas es posible, por ejemplo si la elasticidad es alta en una de las tranciciones, por ejemplo juvenil a adultos, pero no se conoce cual son la variables ambientales que impacta esa transiciones no se puede hacer un manejo efectivo. 


```{r elasticidad}
#Matriz de elasticidad
elasticidad <- round(elas(Lr1),digit=3)
elasticidad
```

## Análisis de Amortiguamiento/Damping Ratio

El análisis de amortiguamiento es un indice de la rapidez con la que una población converge a su estructura estable después de un disturbio [@jiang2020life]. El indice de amortiguamiento $d > 0$, y más grande el indice de amortiguamiento más rápido la población converge a la estructura estable. Se ha demostrado que hay una relación entre el indice de amortiguamiento y tiempo de generación de una especie [@jiang2020life].  El tiempo de amortiguamiento se calcula $\tau=1/d$. Usando la función *dr* del paquete **popbio**, en el caso de *Lepanthes rubripetala* se espera estima que el indice de amortigamiento es 1.2 y que la población converga a su estructura estable en 12 meses, ya que los datos fueron recolectado y analizado mensualmente. Si los datos son recolectado fueron recolectado una vez al año entonces la población converga a su estructura estable en 12 años. Un supuesto importante es que la tasa de crecimiento intrínseca es igual para todos los periodos subsiguientes.  

```{r damping}

#Relación de amortiguamiento
dampingratio <- dr(Lr1, return.time=TRUE, x=10)
dampingratio
```

## Análisis de Convergencia

El tiempo de convergencia puede ser calculado a base de la cantidad de individuos en las diferentes etapas o edades. El tiempo de convergencia es el tiempo esperado en que una población alcanza la estructura estable. En el caso de *Lepanthes rubripetala* se espera que la población alcance la estructura estable en 25 meses si se comienza con una población sesgada de solamente plántulas (n=1000) y ninguno en las etapas subsiguientes. 



```{r converngence}
# Tiempo de convergencia
n = c(1000, 0, 0, 0)
tconvergencia <- convt(Lr1, accuracy = 1e-3, vector = n)
tconvergencia

```

Si comenzamos con una población mucho más cerca a la estructura estable, podemos calcular el tiempo de convergencia. Digamos que se comienza con una población de 8, 20, 27 34 individuos en las etapas 1, 2, 3 y 4 respectivamente. En este caso se espera que la población alcance la estructura estable en 6 meses. En este caso vemos que el tiempo de convergencia es mucho más corto que si se comienza con una población sesgada de solamente plántulas.


```{r converngence2}

n2 = c(8, 20, 27, 34)
tconvergencia <- convt(Lr1, accuracy = 1e-3, vector = n2)
tconvergencia
```


## Dinámica transitoria

En la dinámica transitoria o de corto plazo, Stott y colaboradores (2010, 2012) incorporaron la estocasticidad demográfica para analizar el cambio de la estructura poblacional debido a una perturbación de origen biótico, abiótico o antropogénico (i.e. cambios en la estructura incicial observada). Este tipo de estocasticidad se refiere a la sobrevivencia y reproducción en número entero y finito; es decir, un individuo sobrevive o no, lo cual se representa con 1 ó 0, al igual que puede reproducirse (1) o no (0). La incorporación de esta característica en los individuos genera una variación no cíclica ni predecible en la respuesta de los individuos de una población.

En el análisis transitorio, el modelo sesgado por etapas (i.e. categorías) es el procedimiento que se usa para evaluar la perturbación de la estructura inicial. La perturbación o sesgo en la estructura inicial se evalúa modificando la proporción de individuos presentes en alguna categoría de la estructura poblacional. Cabe señalar que estas modificaciones representan distintos escenarios o simulaciones que ocurren o pueden ocurrir en nuestra población de estudio.

Por ejemplo, la estructura inicial en la población 1 de *Lepanthes rubripetala* fue la siguiente: (0,46,38,82). En este caso, al modificar la proporción de individuos presente en una, dos o en todas las categorías de la población se simuló el cambio en la dinámica en el corto plazo; es decir, en un momento previo a que se alcance el crecimiento estable o de largo plazo. En *Lepanthes rubripetala* se hicieron cinco simulaciones o escenarios al suponer las siguientes proporciones de individuos por categoría (Tremblay et al, 2015):

1.  Límite inferior: (1,0,0,0), los individuos de la población se contran en la categoría de plántulas (Lower bound).
2.  Inicio I: (0.15, 0.35, 0,30, 0.20), mayor proporción de individuos en las categorías juvenil y adulto no reproductivo.
3.  Estructura estable de la población: los individuos de la población tienen una abundancia de acuerdo con *w-max*.
4.  Inicio II: (0.4, 0.2,0.2, 0.2), mayor proporción de plántulas y una proporción similar en las categorías juvenil, adulto no reproductivo y adulto reproductivo.
5.  Límite superior: (0,0,0,1), los individuos de la población se contran en la categoría de adulto reproductivo.

*Dinámica poblacional absoluta*. Como consecuencia de las perturbaciones o escenarios existen cambios en el crecimiento poblacional, los cuales son evidentes si se grafican. Un aspecto a considerar es que, la gráfica que se genera incluye la influencia de la dinámica trasitoria y asintótica, por lo que se le denomina dinámica poblacional absoluta (Fig. 2A de Tremblay y colaboradores, 2015).

```{r chap10_4}
##PASO 4. DINÁMICA POBLACIONAL ABSOLUTA.    
#Se proyecta el crecimiento poblacional ante cambios en la estructura 
#inicial debidos a la perturbación (5 escenarios). Esta gráfica incluye la 
#influencia de la dinámica trasitoria y asintótica, por lo que se le denomina 
#dinámica poblacional absoluta. Proyección a 50 meses.

#Definir los margenes
par(mfrow = c(1, 1))
par(mar = c(3, 3, 3, 3))

#Librerias de R requeridas para el análisis 
library(popdemo)
library(popbio)
library(ggplot2)
library(dplyr)
library(scales)

#Vector original
nLr0 <- c(0, 46, 38, 82)
#Escenario 1. Límite inferior
nLr1 <- c(166, 0, 0, 0)
#Proporción de individuos por categoría
nLr1 <- nLr1/sum(nLr1)
nLr1
#Gráfica de barras del escenario 1 
barplot(nLr1, names.arg = 1:4)
title(main = "Escenario 1", xlab = "Categoría", ylab = "Proporción")
#Proyección de la dinámica escenario 1
pr1 <- project(Lr1, vector = nLr1, time = 50)
plot(pr1, log = "y", ylim = c(0.1, 1.6), ann = FALSE)
title(main = "Proyección de la dinámica (Escenario 1)", xlab = "Time intervals", ylab = "Population size/density")


#Escenario 2. Inicio I
nLr2 <- c(25, 58, 50, 33)
#Proporción de individuos por categoría
nLr2 <- nLr2/sum(nLr2)
nLr2
#Gráfica de barras del escenario 1 
barplot(nLr2, names.arg = 1:4)
title( main = "Escenario 2", xlab = "Categoría", ylab = "Proporción")
#Proyección de la dinámica escenario 2 
pr2 <- project(Lr1, vector = nLr2, time = 50)
plot(pr2, log = "y", ylim = c(0.1, 1.6), ann = FALSE)
title(main = "Proyección de la dinámica (Escenario 2)", xlab = "Time intervals", ylab = "Population size/density")

#Escenario 3. Estructura estable
nLr3 <- Wmax
#Gráfica de barras del escenario 3
barplot(nLr3, names.arg = 1:4)
title( main = "Escenario 3", xlab = "Categoría", ylab = "Proporción")
#Proyección de la dinámica escenario 3 
Lr1st <- (Lr1/lambda)
Lr1st
eigen(Lr1st)
pr3 <- project(Lr1st, vector = Wmax, time = 50)
plot(pr3, log = "y", ylim = c(0.1, 1.6), ann = FALSE)
title(main = "Proyección de la dinámica (Escenario 3)", xlab = "Time intervals", ylab = "Population size/density")

#Escenario 4. Inicio II
nLr4 <- c(66, 33, 33, 33)
#Proporción de individuos por categoría
nLr4 <- nLr4/sum(nLr4)
nLr4
#Gráfica de barras del escenario 4 
barplot(nLr4, names.arg = 1:4)
title( main = "Escenario 4", xlab = "Categoría", ylab = "Proporción")
#Proyección de la dinámica escenario 4 
pr4 <- project(Lr1, vector = nLr4, time = 50)
plot(pr4, log = "y", ylim = c(0.1, 1.6), ann = FALSE)
title(main = "Proyección de la dinámica (Escenario 4)", xlab = "Time intervals", ylab = "Population size/density")

#Escenario 5. Límite superior
nLr5 <- c(0, 0, 0, 166)
#Proporción de individuos por categoría
nLr5 <- nLr5/sum(nLr5)
nLr5
#Gráfica de barras del escenario 5 
barplot(nLr5, names.arg = 1:4)
title( main = "Escenario 5", xlab = "Categoría", ylab = "Proporción")
#Proyección de la dinámica escenario 5 
pr5 <- project(Lr1, vector = nLr5, time = 50)
plot(pr5, log = "y", ylim = c(0.1, 1.6), ann = FALSE)
title(main = "Proyección de la dinámica (Escenario 5)", xlab = "Time intervals", ylab = "Population size/density")

#Gráfica de la dinámica absoluta 
Population_density <- stack(c(as.data.frame(pr1), as.data.frame(pr2), as.data.frame(pr3), as.data.frame(pr4), as.data.frame(pr5)))
Population_density[, "time"] <- rep(seq(1, nrow(pr1), 1), 5)
names(Population_density) <- c("Values", "Projection", "Time")
#Population_density[, "Projection"] <- c(rep("Projection 1", len), rep("Projection 2", len), rep("Projection 3", len), rep("Projection 4", len), rep("Projection 5", len))
abs.plot <- ggplot(data = Population_density) +
theme_classic() +
theme(panel.border = element_blank()) +
theme(legend.position = "none") +
geom_line(aes(x = Time, y = Values, group = Projection, colour = Projection), linewidth = 0.8) +
geom_hline(yintercept = 1, linewidth = 0.8) +
scale_colour_manual(values = c("#C6E2FF", "#B9D3EE", "black", "#9FB6CD", "#6C7B8B")) +
theme(axis.title.x = element_text(vjust = -1, size = 12)) +
theme(axis.title.y = element_text(vjust = 1, size = 12)) + 
theme(axis.text = element_text(size = 12)) +
labs(title = "Absolut population dynamics", x = "Projection intervals", y = "Population density relative to lambda max")+ 
theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 12))
abs.plot 

```

##Dinámica transitoria estandarizada: límites

Con el fin de evaluar en el corto plazo los cambios cuantitativos en la población en respuesta a una perturbación determinada se calculan los límites de la dinámica transitoria a través Índices de transferencia y se proyecta el crecimiento de la población en el corto plazo.

#Dinámica transitoria específica de la población.\
a proyección se hace sin la influencia de la dinámica asintótica. hecho que facilita y hace equitativa la comparación entre los modelos de los distintos escenarios. Se elimina el efecto de la dinámica asintótica al estandarizar la matriz y el vector de la estructura. En el primer caso se usa el comando 'standard.A=T', lo cual supone que en el largo plazo la tasa de crecimiento poblacional tendrá un valor de 1 (unidad) -por lo que la población no crecerá ni declinará, en el segundo caso se usa el comando 'standard.vec=T', que implica que éste suma 1 (Stoot et al., 2010, 2012). DINÁMICA POBLACIONAL TRANSITORIA ESTANDARIZADA

*Índices de transferencia*. Con el fin de evaluar en el corto plazo qué cambios cuantitativos habría en la población como respuesta ante una perturbación determinada, se calculan los límites de la dinámica transitoria a través de los *Índices de transferencia*, que incluyen los siguiente tres parámetros (Stoot et al. 2012):

a)  *Reactividad alta y Reactividad baja* (Upper reactivity y Lower reactivity) que representan el crecimiento o el decremento inmediato (i.e. primer intervalo de tiempo) de la población antes de alcanzar la tasa constante de crecimiento poblacional.

b)  *Máxima amplificación/Máxima atenuación* (Maximum amplification/Maximum attenuation) que indican,respectivamente, el incremento o decremento máximo futuro del crecimiento poblacional previo a alcanzar la tasa constante de crecimiento poblacional.

c)  *Inercia alta e Inercia baja* (Upper inertia y Lower inertia) que evalúan el límite más alto o el más bajo en el crecimiento de la población antes de alcanzar la tasa constante de crecimiento poblacional, respectivamente.

```{r chap10_5}
### PARTE II: DINÁMICA POBLACIONAL TRANSITORIA ESTANDARIZADA.
#Modelo de Dinámica transitoria específica de la población  
## La dinámica de corto plazo se projecta a partir de la matriz de transición y el vector inicial previamente definidos

#Definir los margenes
library(popdemo)
library(ggplot2)

#Vector de estructura inicial: abundancia por categoría de acuerdo con  el estado 
n0 <- c(0, 46, 38, 82) 

## 1) PROYECCIÓN DE LA DINÁMICA DE CORTO PLAZO. Con la función PROJECT se proyectar la  a 50 meses, tomando en 
#cuenta la matriz de transición poblacional y el vector de la estructura.
#En esta función se elimina el efecto de la dinámica asintótica al estandarizar: 
#a) la matriz usando el comando 'standard.A=T', lo cual significa que 
#en el largo plazo la tasa de crecimiento poblacional tendrá 
#un valor de 1 (unidad), por lo que la población no crecerá ni declinará. 
#b) el vector de la estructura usando 'standard.vec=T', lo cual supone que éste suma 1, 
# Ambas estandarizaciones facilitan y hacen equitativa la comparación entre modelos 
#con distintos tamaños poblacionales y distintas tasas de crecimiento de largo plazo. 

#Gráfica de la dinámica de corto plazo por escenario. En la graficación se usa la misma matriz pero se cambia el vector de acuerdo con el escenario
#Escenario 1: Límite inferior
pr2.1 <- project(Lr1, vector = nLr1, time = 50, 
                 standard.A = T, standard.vec = T)
#Plot the amplification projection and label it
# Se atenua (decrece)
plot(pr2.1, log = "y", main = "Dinámica a corto plazo (Escenario 1)", cex.axis = 0.8)

#Escenario 2. Inicio I
pr2.2 <- project(Lr1, vector = nLr2, time = 50, 
                 standard.A = T, standard.vec = T)
#Plot the amplification projection and label it
plot(pr2.2, log = "y", main = "Dinámica a corto plazo (Escenario 2)", cex.axis = 0.8) # Se atenua (decrece)

#Escenario 3. Estructura estable
pr2.3 <- project(Lr1, vector = nLr3, time = 50, 
                 standard.A = T, standard.vec = T)
#Plot the amplification projection and label it
plot(pr2.3, main = "Dinámica a corto plazo (Escenario 3)", cex.axis = 0.8)# Se amplifica (crece)

#Escenario 4. Inicio II
pr2.4 <- project(Lr1, vector = nLr4, time = 50, 
                 standard.A = T, standard.vec = T)
#Plot the amplification projection and label it
plot(pr2.4, log = "y", main = "Dinámica a corto plazo (Escenario 4)", cex.axis = 0.8)# Se atenua (decrece)

#Escenario 5. Límite superior
pr2.5 <- project(Lr1, vector = nLr5, time = 50, 
                 standard.A = T, standard.vec = T)
#Plot the amplification projection and label it
plot(pr2.5, log = "y", main = "Dinámica a corto plazo (Escenario 5)", cex.axis = 0.8)# Se amplifica (crece)

#2) LIMITES TRANSITORIOS POR ESCENARIO.
#Escenario 1: Límite inferior

#Cálculo de los limites transitorios
library(popdemo)

lim.trans <- as.data.frame(matrix(NA, 5, 3))
names(lim.trans) <- c("reac", "maxatt", "inertia")
reac1<-reac(Lr1, vector = nLr1)
lim.trans[1, 1] <- reac1
reac1
maxatt1<-maxatt(Lr1, vector = nLr1, return.t=T)
maxatt1
lim.trans[1, 2] <- maxatt1[1]
inertia1<-inertia(Lr1, vector = nLr1)
inertia1
lim.trans[1, 3] <- inertia1
#Escenario 2. Inicio I
reac2<-reac(Lr1, vector = nLr2)
reac2
lim.trans[2, 1] <- reac2
maxatt2<-maxatt(Lr1, vector = nLr2, return.t=T)
maxatt2
lim.trans[2, 2] <- maxatt2[1]
inertia2<-inertia(Lr1, vector = nLr2)
inertia2
lim.trans[2, 3] <- inertia2

#Escenario 3. Estructura estable
reac3<-reac(Lr1, vector = nLr3)
lim.trans[3, 1] <- reac1
reac3
maxamp3<-maxamp(Lr1, vector = nLr3, return.t=T)
maxamp3
lim.trans[3, 2] <- maxamp3[1]
inertia3<-inertia(Lr1, vector = nLr3)
inertia3
lim.trans[3, 3] <- inertia3

#Escenario 4. Inicio II
reac4<-reac(Lr1, vector = nLr4)
lim.trans[4, 1] <- reac1
reac4
maxatt4<-maxatt(Lr1, vector = nLr4, return.t=T)
maxatt4
lim.trans[4, 2] <- maxatt4[1]
inertia4<-inertia(Lr1, vector = nLr4)
inertia4
lim.trans[4, 3] <- inertia4

#Escenario 5. Límite superior
reac5<-reac(Lr1, vector = nLr5)
lim.trans[5, 1] <- reac5
reac5
maxamp5<-maxamp(Lr1, vector = nLr5, return.t=T)
maxamp5
lim.trans[5, 2] <- maxamp5[1]
inertia5<-inertia(Lr1, vector = nLr3)
inertia5
lim.trans[5, 3] <- inertia5

# Dinamica transitoria plot
len <- nrow(pr2.1)
Population_density <- stack(c(as.data.frame(pr2.1), as.data.frame(pr2.2), as.data.frame(pr2.3), as.data.frame(pr2.4), as.data.frame(pr2.5)))
Population_density[, "time"] <- rep(seq(1, len, 1), 5)
names(Population_density) <- c("Values", "Projection", "Time")
Population_density[, "Projection"] <- c(rep("Projection 1", len), rep("Projection 2", len), rep("Projection 3", len), rep("Projection 4", len), rep("Projection 5", len))

trans.plot <- ggplot(data = Population_density) +
theme_classic() +
theme(panel.border = element_blank()) +
theme(legend.position = "none") +
geom_line(aes(x = Time, y = Values, group = Projection, colour = Projection), linewidth = 0.8) +
scale_colour_manual(values = c("#C6E2FF", "#B9D3EE", "black", "#9FB6CD", "#6C7B8B")) +
theme(axis.title.x = element_text(vjust = -1, size = 12)) +
theme(axis.title.y = element_text(vjust = 1, size = 12)) + 
theme(axis.text = element_text(size = 15)) +
labs(title = "Transient population dynamics" ,x = "Projection intervals", y = "Population density relative to lambda max") + 
theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 12)) +
ylim(0.2, 1.5)
trans.plot + 
geom_text(x = 45, y = 1.09, label = expression(paste(bar(rho) == 0.46)), hjust = 1.0, vjust = -1) +
geom_text(x = 45, y = 0.74, label = expression(paste(bar(rho) == 0.89)), hjust = 1.0, vjust = -1) +
geom_text(x = 45, y = 0.64, label =  expression(paste(bar(rho) == 0.70)), hjust = 1.0, vjust = -1) +
geom_text(x = 45, y = 0.33, label =  expression(paste(bar(rho) == 1)), hjust = 1.0, vjust = -1)

```

##Funciones de transferencia Finalmente, el cálculo de las funciones de transferencia representa el último paso en análisis de dinámica transitoria establecido por Stott y colaboradores (2012). A través de estas ecuaciones se evalúa la elasticidad o efecto de la perturbación sobre la dinámica poblacional. A diferencia de las matrices de elasticidad de los modelos de proyección poblacional, estas elasticidades no son lineales y evidencian la importancia relativa de la de la perturbación en la categoría de tamaño/estado sobre el crecimiento de la población en el corto plazo. Estas ecuaciones también están disponibles en el programa *Popdemo* de *R* y sus resultados se representan a través de gráficas.

La perturbación de la estructura está determinada ppor dos vectores *d* y *e*

```{r chap10_6}
##PASO 6: ANALISIS DE LAS FUNCIONES DE TRANSFERENCIA 
#Establecer márgenes:
#Vector original
library(popdemo)

nLr0 <- c(0, 46, 38, 82)

#PERTURBACIÓN DEL VECTOR ORIGINAL

#1) Entrada de la matriz a(1,1): plántulas a plántulas
tf1 <- tfa_lambda(Lr1, d = c(1, 0, 0, 0),
                  e = c(1, 0, 0, 0),
                  prange = seq(0, 4, 0.01))

#Gráfica de la dinámica poblacional
plot(tf1, ann = FALSE)
title(main = "Dinámica poblacional (Plántulas - Plántulas)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda1 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad 
sens1 <- tfs_lambda(Lr1, d = c(1, 0, 0, 0), e = c(1, 0, 0, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda1, sens1, lty = 2, col = "red")

#2) Entrada de la matriz a(2,1): plántulas y juveniles
tf2 <- tfa_lambda(Lr1, d = c(0, 1, 0, 0),
                  e = c(1, 0, 0, 0),
                  prange = seq(-0.4, 0.6, 0.01))

#Gráfica de la dinámica poblacional
plot(tf2, ann = FALSE)
title(main = "Dinámica poblacional (Plántulas - Juveniles)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda2 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad 
sens2 <- tfs_lambda(Lr1, d = c(0, 1, 0, 0), e = c(1, 0, 0, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda2, sens2, lty = 2, col = "red")

#3) Entrada de la matriz a(2,2): juveniles y juveniles
tf3 <- tfa_lambda(Lr1, d = c(0, 1, 0, 0),
                  e = c(0, 1, 0, 0),
                  prange = seq(-0.8, 0.1, 0.001))

#Gráfica de la dinámica poblacional
plot(tf3, ann = FALSE)
title(main = "Dinámica poblacional (Juveniles - Juveniles)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda3 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad 
sens3 <- tfs_lambda(Lr1, d = c(0, 1, 0, 0), e = c(0, 1, 0, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda3, sens3, lty = 2, col = "red")

#4) Entrada de la matriz a(3,2): juveniles y no reproductivos
tf4 <- tfa_lambda(Lr1, d = c(0, 0, 1, 0),
                  e = c(0, 1, 0, 0),
                  prange = seq(-0.001, 0.03, 0.01))

#Gráfica de la dinámica poblacional
plot(tf4, ann = FALSE)
title(main = "Dinámica poblacional (Juveniles - No reproductivos)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda4 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens4 <- tfs_lambda(Lr1, d = c(0,0,1,0), e = c(0, 1, 0, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda4, sens4, lty = 2, col = "red")

#5) Entrada de la matriz a(4,2): juveniles a adultos
tf5 <- tfa_lambda(Lr1, d = c(0,0,0,1),
                  e = c(0,1,0,0),
                  prange = seq(0,0.8,0.01))

#Gráfica de la dinámica poblacional
plot(tf5, ann = FALSE)
title(main = "Dinámica poblacional (Juveniles - Adultos)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda5 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens5 <- tfs_lambda(Lr1, d = c(0, 0, 0, 1), e = c(0, 1, 0, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda5, sens5, lty = 2, col = "red")

#6) Entrada de la matriz a(3,3): adultos no reproductivos a adultos no reproductivos
tf6 <- tfa_lambda(Lr1, d = c(0, 0, 1, 0),
                  e = c(0, 0, 1, 0),
                  prange = seq(-0.8, 0.2, 0.01))

#Gráfica de la dinámica poblacional
plot(tf6, ann = FALSE)
title(main = "Dinámica poblacional (Adultos No rep - Adultos  No reproductivos)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda6 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens6 <- tfs_lambda(Lr1, d = c(0,0,0,1), e = c(0,1,0,0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda6, sens6, lty = 2, col = "red")

#7) Entrada de la matriz a(4,3): adultos no reproductivos a adultos reproductivos

tf7 <- tfa_lambda(Lr1, d = c(0,0,0,1),
                  e = c(0,0,1,0),
                  prange = seq(-0.2,0.8,0.001))

#Gráfica de la dinámica poblacional
plot(tf7, ann = FALSE)
title(main = "Dinámica poblacional (Adultos No rep - Adultos No rep)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda7 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens7 <- tfs_lambda(Lr1, d = c(0,0,0,1), e = c(0,0,1,0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda7, sens7, lty = 2, col = "red")

#8) Entrada de la matriz a(1,4): adultos reproductivos a plántulas

tf8 <- tfa_lambda(Lr1, d = c(1,0,0,0),
                  e = c(0,0,0,1),
                  prange = seq(-0.2,0.8,0.001))

#Gráfica de la dinámica poblacional
plot(tf8, ann = FALSE)
title(main = "Dinámica poblacional (Adultos reproductivos - Plántulas)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda8 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens8 <- tfs_lambda(Lr1, d = c(1,0,0,0), e = c(0,0,0,1))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda8, sens8, lty = 2, col = "red")

#9) Entrada de la matriz a(3,4): adultos reproductivos a plántulas

tf9 <- tfa_lambda(Lr1, d = c(0, 0,1, 0),
                  e = c(0, 0, 0,1),
                  prange = seq(-0.2, 0.8, 0.001))

#Gráfica de la dinámica poblacional
plot(tf9, ann = FALSE)
title(main = "Dinámica poblacional (Adultos reproductivos - Plántulas)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda9 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens9 <- tfs_lambda(Lr1, d = c(0, 0, 0,1), e = c(0, 0, 1, 0))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda9, sens9, lty = 2, col = "red")

#10) Entrada de la matriz a(4,4): adultos reproductivos a adultos reproductivos

tf10 <- tfa_lambda(Lr1, d = c(0, 0, 0, 1),
                  e = c(0, 0, 0, 1),
                  prange = seq(-0.6, 0.2, 0.001))

#Gráfica de la dinámica poblacional
plot(tf10, ann = FALSE)
title(main = "Dinámica poblacional (Adultos rep - Adultos rep)", ylab = "Lambda", xlab = "p")

#Cálculo de lambda-max:
lambda10 <- Re(eigen(Lr1)$values[1]) 

#Cálculo de la sensibilidad
sens10 <- tfs_lambda(Lr1, d = c(0,0,0,1), e = c(0,0,0,1))

#Agregar la línea, especificando el intercepto y la pendiente
abline(lambda10, sens10, lty = 2, col = "red")

#Definir márgenes
par(mfrow = c(4,4))
par(mfg = c(1,1))

#Gráficas de la función de transferencia de la inercia en el ciclo de vida de L. rubripetala (población 1)
tfmatriz <- tfam_inertia(Lr1,vector = nLr0)
plot(tfmatriz)
 
```

Raventós y colaboradores (2015) estimaron el crecimiento poblacional de corto plazo de dos orquídeas epífitas después del paso de un huracán. Dado que a su paso se pierden individuos, se simuló si la reintroducción de plántulas y adultos mitigaban los efectos de este fenómeno en Cuba. Los resultados sugieren que la reintroducción de adultos tiene un efecto positivo sobre

<!--chapter:end:11-Dinamica_de_Transiciones.Rmd-->

# Elasticidad no lineal


## Por : ???

## Transfer function

## Valor biológico

## Métodos de calculo


## Paquete de R para calcular le eslaticidad no lineal


## Referencias

<!--chapter:end:12-Elasticidad_no_lineal.Rmd-->

# LTRE

por : Adriana Ramírez-Martínez

## Introducción a LTRE

La variación de las diferencias en las poblaciones se puede evaluar a diferentes niveles: genético, demográfico, espacial o temporal. Esta variación en ecología es la norma. La variación se encuentra en todos aspectos desde la parte genética de los individuos que compone una población, la variación ambiental y las interacciones bióticas y abióticas; además  de la plasticidad fenotípica que es la interacción entre la genética y el ambiente. ¿Cuál es esa variación? ¿en otra palabra qué es lo que varía? y ¿cómo los individuos responden a las variables bióticas y abióticas? son aspectos importantes para determinar la ecología, evolución y conservación de las especies. La causa de la variación en una población se puede resumir a tres componentes principales, la genética, el efecto del ambiente y la interacción entre ambiente y genética (plasticidad fenotípica) (@hastings2021effects; @sun2019multivariate). Dentro de un contexto de dinámica poblacional las condiciones que los individuos en las poblaciones experimentan varían, ya sea durante tratamientos manipulados, localidades o periodos de tiempo, y por consecuencia los datos que colectamos con diferencias en espacio/tiempo también varían y pudieran tener efecto sobre la matriz de proyección poblacional A. Por tanto, las entradas de esa matriz A variarán en tiempo/espacio o experimento y esto tendría un impacto sobre la tasa de crecimiento poblacional (λ) y su dispersión en los estimados (Intervalo de confianza; @caswell2000matrix, @caswell2010life).

Tomando en cuenta lo anterior un Experimento de Respuesta de Tabla de Vida (ERTV) conocido también como Life Table Response Experiment (LTRE por sus siglas en inglés) descompone la diferencia o varianza en λ entre múltiples poblaciones o tiempo dentro de las contribuciones de los elementos de la matriz y sus interacciones (@caswell1989analysis). Entonces al realizar este análisis podemos tener una apreciación de cómo los cambios en la matriz de datos recolectados en diferentes tiempos y espacio impactan las tasas vitales y a su vez que causan cambios en el crecimiento intrínseco (λ) y otros parámetros poblacionales (@caswell1989analysis, @caswell2010life). 

Desde la aplicación del primer ERTV por Birch (1953) en su estudio sobre el efecto de la temperatura, humedad y el alimento sobre tres especies de escarabajos de harina, las aplicaciones de estos análisis han sido variadas con diversos fines en las últimas dos décadas (@caswell1989analysis, @caswell2010life). Tanto en diseños fijos en los que se manipulan uno o más factores, como en diseños aleatorios en los que se analizan parámetros demográficos en condiciones naturales no manipuladas a lo largo del tiempo o del espacio (@horvitz1997relative; @teitel2016assessing). Los diseños fijos se han utilizado en poblaciones de animales para investigar las consecuencias demográficas de la exposición a contaminantes, la manipulación del alimento o la manipulación de la densidad poblacional (@hansen1999multiannual, 1999; @levin1996demographic;@oli2001effect). En plantas, los análisis ERTV se han utilizado para evaluar las consecuencias demográficas de la disponibilidad de polinizadores o de la herbívora, competencia, efectos en intensidades de cosecha y de fenómenos naturales e inducidos por el humano (@davison2010demographic; @gaoue2010effects; @garcia2002reproductive; @hart2021simulated; @jacquemyn2012stochastic; @miriti2001effects; @mondragon2009population; @nordbakken2004demography;@schmidt2011matrix).

Los métodos para calcular los ERTV están constantemente actualizándose y de acuerdo con @hernandez2023exact (2023) existen 186 análisis de ERTV para 75 especies de animales y 1487 para 200 especies de plantas. Aunque en este trabajo no utilizamos la metodología expuesta por dichos autores mostramos una forma práctica de la aplicación de este análisis.

### ¿Cómo se diferencia la elasticidad de ERTV?

A diferencia de la elasticidad, el cual es un tipo de análisis de perturbación que examina cuánto cambiaría el crecimiento de la población si se cambiaran una de las entradas de la matriz, el análisis ERTV examina cuánto cambió λ en función de la variación observada en las entradas de la matriz (@caswell2000matrix, @caswell2010life; @horvitz1997relative); y por consecuencia es un análisis que toma en cuenta el cambio de las variaciones individualmente registradas en matrices en diferentes poblaciones/ tiempo / experimentos, etc. (@caswell2010life).  

***

## Métodos

### Ejemplo práctico de ERTV

Para ejemplificar el cálculo de los ERTV utilizaremos los datos recabados por Ramírez-Martínez colectados de a 2017-2018 para la orquídea epífita *Oncidium brachyandrum* Lindl. en un bosque de encino estacional en Oaxaca, México (@ramirez2021host). La pregunta principal del estudio era saber qué tasas vitales estaban ligadas a las variaciones en los valores de λ de poblaciones de *O. brachyandrum* creciendo sobre los hospederos *Quercus martinezii* C.H.Mull. y *Q. rugosa* Née. Usando el método ERTV se pudo evaluar el efecto que tiene la variación observada en los parámetros de las matrices en función de las especies de hospedero en los que se encontraban creciendo.  

Como el ERTV es una forma de análisis retrospectivo y es análogo al ANOVA (porque cuantifica los efectos observados de los elementos individuales de matriz sobre la variación observada en λ, en contraposición a los efectos esperados) se requiere de un valor de referencia para realizar las comparaciones, por lo que se toma la matriz con el valor más alto de λ como valor de referencia (@caswell2010life; @timsina2021six).

A continuación, se muestran dos matrices de tipo Lefkovitch (matrices contruidas a base de estadíos) para las poblaciones de *O. brachyandrum* y sus valores respectivos de λ en los dos hospederos, *Q. martinezii* (λ=1.3; I.C: 1.11-1.45) y *Q. rugosa* (λ=0.98; I.C: 0.87-0.99) (Cuadro 1). Notamos claramente que el valor de λ era mayor en *Q. martinezii* por lo que la matriz de esta especie fue la matriz de referencia para calcular los ERTV.


***

### Matrices de proyecciones y ciclo de vida por especie de hospedero

Cuadro 1. Matrices de proyección poblaciones de dos poblaciones de *Oncidiun brachyandrum* creciendo sobre *Quercus martinezii* y *Q. rugosa*. Los valores de λ (intervalos de confianza ± 95%) son mostrados en la parte superior izquierda de cada matriz. *qx*, mortalidad por estadío; *w*, categorías estables de tamaño por estadío; valor reproductivo por estadío, n = el tamaño de muestra en el tiempo cero (el primer muestreo). p: plántula, i: infantil, j: juvenil, A; adulto (@ramirez2021host).  Los valores en negritas son los valores que representan la proporción de individuos que se queda en ese estadio. 


![](Figures/imagen1.jpg)

***

###	Diagrama del ciclo de vida

### Diagrama para Quercus martinezii

Primeramente se creó el ciclo de vida por especie de hospedero utilizando el siguiente código:

```{r chap12_1_Q_martinezii, echo=TRUE}
library(Rage)
library(DiagrammeR)




library(DiagrammeR)

matmart <- rbind(
  c(0.68, 0.02, 3.88, 16.53),
  c(0.22, 0.76, 0.23, 0.0),
  c(0.0, 0.13, 0.53, 0.58),
  c(0.0, 0.0, 0.17, 0.38))
stages <- c("plántula", "infantil", "juvenil", "adulto")
title <- NULL
graph <- expand.grid(to = stages, from = stages)
graph$trans <- round(c(matmart), 4)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", stages, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 4
graph$col <- c(
  "steelblue4", "PaleGreen4", "MediumOrchid4", "steelblue4", "PaleGreen4", "Goldenrod1",
  "MediumOrchid4", "steelblue4", "PaleGreen4", "Goldenrod1", "MediumOrchid4", "steelblue4"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
                "[minlen=", graph$min_len,
                ",fontsize=", 10,
                ",color=", graph$col,
                ",xlabel=", paste("\"", graph$trans),
                "\"]\n",
                collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
)




```

### Diagrama para Quercus rugosa

```{r chap12_2_Quercus_rugosa, echo=TRUE}


library(Rage)
library(DiagrammeR)

matrug <- rbind(
  c(0.64, 0.06, 0, 0.0045),
  c(0.27, 0.75, 0.27, 0.0),
  c(0.0, 0.08, 0.47, 0.28),
  c(0.0, 0.0, 0.27, 0.68))
stages <- c("plántula", "infantil", "juvenil", "adulto")
title <- NULL
graph <- expand.grid(to = stages, from = stages)
graph$trans <- round(c(matrug), 4)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", stages, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 4
graph$col <- c(
"steelblue4", "PaleGreen4", "MediumOrchid4", "steelblue4", "PaleGreen4", "MediumOrchid4","steelblue4", "PaleGreen4",  "Goldenrod1", "MediumOrchid4", "steelblue4"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
                "[minlen=", graph$min_len,
                ",fontsize=", 10,
                ",color=", graph$col,
                ",xlabel=", paste("\"", graph$trans),
                "\"]\n",
                collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
)
```

***

##	Procedimiento para ERTV en Excel

Para facilitar el entendimiento de cómo se calcula ERTV se creó la matriz con los términos de referencia (Cuadro 2).

Cuadro 2. Matriz de términos para el entendimiento de los ERTV. Donde: f= fecundidad, g= crecimiento o retrogesión, p= permanencia y s=supervivencia. Los subíndices se refieren a las transiciones entre estadíos.   

![](Figures/imagen2.jpg)


Una vez colocadas las matrices en la hoja de trabajo el primer paso será sumar las columnas para cada estadio, esto significará la supervivencia (s) por estadío (s1, s2, s3, s4); para el caso de *Q. martinezii* en plántulas sería s1= 0.68+0.22= 0.90 (Figura 3). Después se tienen que calcular las transiciones con respecto a la supervivencia; por lo que para el caso de la transición g12 para la matriz de *Q. martinezii* tenemos g12= 0.22/0.90=0.25; este cálculo se realiza para todas las transiciones. Los valores de fecundidad (f) se tomarán tal cual de la matriz de fecundidad ($F). Una vez obtenido esto se procederá a realizar los cálculos con las ecuaciones que se muestran del lado derecho para cada una de las celdas y, además, esto nos sirve para verificar que hayamos calculado bien cada una de las tasas vitales. Por ejemplo, observamos que una proporción de plántulas en *Q. martinezii* se mantuvo (0.67) este valor se obtiene de multiplicar la supervivencia de plántulas (s1) por la sustracción de 1 menos el crecimiento de plántulas a infantiles 0.89 (1-0.25) = 0.68 (ecuación s1* (1-g12)).

![](Figures/imagen3.jpg)
 
Figura 3. Forma de calcular las ecuaciones para la base de ERTV.

En un archivo nuevo de Excel se arma la base, con la columna de vital rate al principio, seguido por las especies de hospederos (tratamientos) poniendo primeramente el control y después la columna de matrix (Figura 4). Esta base contendrá las ecuaciones de la matriz de referencia. Como la matriz de *Q. martinezii* tuvo los valores más altos de lambda está ultima de colocará en nuestra base que utilizaremos para correr el análisis ERTV.

![](Figures/imagen4.jpg)
 
Figura 4. Ejemplo de base para poder calcular los ERTV.

Es importante colocar en la segunda fila la palabra lambda en la primera columna y después los valores según corresponda a cada tratamiento. Debido a que en *Q. rugosa* no hubo producción de plántulas (f31) pero en *Q. martinezii* si hubo se coloca una cantidad muy pequeña pero mayor a cero (e.g. 0.00001) para que se pueda correr el análisis, para las otras transiciones en valor puede ser 0. Una vez culminada la base se guarda el archivo en formato de texto, para continuar en R. Es importante comenzar a colocar las ecuaciones a partir de la segunda fila en la columna matrix.

***

##	Procedimiento en R


```{r chap12_3, echo=TRUE}
# Asegurarse de tener instalado y cargado el paquete 'popbio' package 



library (popbio)

oncidium<-read.table("data/vitalratesoncidium.txt", sep="\t", header=TRUE, stringsAsFactors=FALSE, fill=TRUE)
oncidium 

```



Debido a que la columna de matrix contiene más filas con datos nos aparecerá la leyenda NA en las otras columnas esto se refiere a que no hay valores disponibles para esas filas

 Para extraer los nombres de las tasas vitales (de la fila 2 a la 13), sin incluir a lambda el cual está en la primera

```{r chap12_4}
vitalrates<-oncidium$names[2:13] 

# mostrar los nombres del objeto vitalrates

vitalrates

```

### Extraer tasas vitales de Martinezzi y dejar a lambda a un lado
```{r chap12_5}
 

Martinezzi<-oncidium$ Martinezzi [2:13] # [2:13] se refiere a la fila 2 hasta la 13. 
names(Martinezzi)<-vitalrates
Martinezzi
```

### Extraer tasas vitales de martinezii y dejar a lambda a un lado

```{r chap12_6}
Rugosa<-oncidium$ Rugosa [2:13]
names(Rugosa)<-vitalrates
Rugosa
```




### Extraer los elementos de matriz utilizando los nombres de las tasas vitales

```{r chap12_7}
matrix.el<-as.expression(parse(text=oncidium$matrix)) 
matrix.el
expression(s1*(1-g12), s1*g12, 0, 0, s2*g21, s2*(1-g23-g21), 
    s2*g23, 0, f31, s3*g32, s3*(1-g34-g32), s3*g34, f41, 0, s4*g43, 
    s4*(1-g43))
```


### Calcular las sensibilidades y elasticidades de ambas matrices

#### *Quercus matinezzi*

```{r chap12_8}
Martinezzi.se<-vitalsens(matrix.el, Martinezzi)
Martinezzi.se
```

#### *Quercus rugosa*

```{r chap12_9}
Rugosa.se<-vitalsens(matrix.el, Rugosa)
Rugosa.se
```       

### Calcular las diferencias en tasas vitales entre las especies

```{r chap12_10}
vr.dif.Martinezzi.Rugosa<-Rugosa-Martinezzi 
vr.dif.Martinezzi.Rugosa
```
        
### Calcular las tasas vitales para la matriz media

```{r chap12_11}
vr.midway.Martinezzi.Rugosa<-((Rugosa+Martinezzi)/2) #calculate vital rates for midway matrix

# Nota: si se tuvieran 3 matrices se sumarían las tasas vitales de las tres dividido por 3. 

vr.midway.Martinezzi.Rugosa
```
        
### Calcular las tasas sensibilidades y elasticidades para la matriz media

```{r chap12_12}
midway.sens.Martinezzi.Rugosa<-vitalsens(matrix.el, vr.midway.Martinezzi.Rugosa) 
midway.sens.Martinezzi.Rugosa
```


### Calcular las contribuciones de ERTV y ver los resultados

```{r chap12_13}
LTRE.contrib.Martinezzi.Rugosa<-vr.dif.Martinezzi.Rugosa*midway.sens.Martinezzi.Rugosa$sensitivity  
LTRE.contrib.Martinezzi.Rugosa
```

```{r chap12_14}
LTRE.results.Martinezzi.Rugosa<- data.frame(rug.vr=Rugosa, mart.vr=Martinezzi, vr.difference=vr.dif.Martinezzi.Rugosa, mid.sens=midway.sens.Martinezzi.Rugosa$sensitivity, contribution=LTRE.contrib.Martinezzi.Rugosa)

library(gt)
gt(LTRE.results.Martinezzi.Rugosa)
```        


***

En Excel puedes utilizar la columna de “contribución” para hacer una representación gráfica de los resultados (Figura 5).
 
Figure 5. Resultados de un Experimento de Respuesta de la Tabla de Vida (ERTV) llevado a cabo para evaluar las contribuciones de las entradas de la matriz a la variación observada en λ.

De acuerdo con el análisis de elasticidad para cada una de las poblaciones de *O. brachyandrum*, tanto en *Q. martinezii* como en *Q. rugosa* la permanencia de individuos infantiles es la tiene un mayor impacto sobre los valores de la tasa de crecimiento poblacional (Figura 6). De acuerdo al ERTV, el cual toma en cuenta las diferencias en las tasas vitales y la sensibilidad de lambda que es una función no linear de esas tasas vitales, podemos observar que la fecundidad (fsa) y el crecimiento de plantulas a juveniles (gsj), de juveniles a adultos (gja) y el retroceso de adultos a juveniles (gaj) tiene las mayores contribuciones a las diferencias en lambda entre Q. martinezii y Q. rugosa que la permanencia de plántulas.
 
Figure 6. Resultados de los análisis de elasticidad, para dos poblaciones de *Oncidium brachyandrum* creciendo sobre *Quercus martinezii* y *Q. rugosa*. Por proceso demográfico (a) y por estadío (b).


***



<!--chapter:end:13-LTRE.Rmd-->

# Metodos de Simulaciones y estimaciones de intervalo de confianza


Por: ???

## Introducciones a métodos de simulaciones

### Estocasticidad demografica

### Estocasticidad espacial

### Estocasticidad temporal





## Ventaja de usar simulaciones

## Ejemplo Simple de simulaciones


<!--chapter:end:14-Metodos_de_simulaciones.Rmd-->

# El uso de matrices para estudios evolutivos 


Por: Roberto Salguero-Gómez

## 




<!--chapter:end:15-Estudio_evolutivo.Rmd-->

# PPM_Orquidea sinopsis historico

## Por: Raymond y todos

Por: Un overview de la historia de estudios PPm con orquideas  




<!--chapter:end:16-PPM_Orquidea_sinopsis.Rmd-->

# Compadre_Orchid PPM y su uso

Raymond y Roberto

Activar los siguiente paquetes

```{r chap16_1, message=FALSE}
library(Rcompadre) # Paquete para trabajar con la base de datos de COMPADRE y COMADRE
library(tidyverse)
library(gt)
library(kableExtra)
```

```{r chap16_2, echo=FALSE}
library(tidyverse)

rlt_theme <- theme(axis.title.y = element_text(colour="grey20",size=15,face="bold"),
        axis.text.x = element_text(colour="grey20",size=10, face="bold"),
        axis.text.y = element_text(colour="grey20",size=15,face="bold"),  
        axis.title.x = element_text(colour="grey20",size=15,face="bold"))+
  theme(
  # Remove panel border
  panel.border = element_blank(),  
  # Remove panel grid lines
  panel.grid.major = element_blank(),
  panel.grid.minor = element_blank(),
  # Remove panel background
  panel.background = element_blank(),
  # add thicker border lines
    axis.line.x = element_line(colour = "black", linewidth  = 1),
    axis.line.y = element_line(colour = "black", linewidth  = 1)
  )

# The palette with grey:
cbPalette1 <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

# The palette with black:
cbPalette2 <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

# To use for fills, add
#  scale_fill_manual(values=cbPalette)

# To use for line and point colors, add
  #scale_colour_manual(values=cbPalette)

```


***

### COMPADRE 

Este capítulo es una introducción a COMPADRE y algunas de la funciones en los paquetes de **Rcompadre** y **Rage**. La información aqui no sustituye la información proviste \<<https://compadre-db.org/>\> y los tutoriales que se encuentran en la siguiente pagina \<<https://compadre-db.org/Education>\>

***

### Acceso a los datos de COMPADRE.

Hay dos métodos de tener acceso a los datos de COMPADRE (datos de dinamica poblacional de plantas) y COMADRE (datos de dinamica poblacional de animales). Los datos se pueden acesar directamente en la pagina de web o bajar el archivo de datos al siguiente enlace \<<https://compadre-db.org/Data/Compadre>\> seleccionando la pestaña de **Download COMPADRE**.

## Para tener acceso a los datos cuando no esta conectado al internet es necesario bajar el archivo y instalar en su proyecto de RStudio.

```{r chap16_3}
compadre <- cdb_fetch("compadre") # Usar este código para bajar los datos del repositorio de COMPADRE. 

# USAR el código siguiente si tiene los datos bajado a su computadora. 
# load(dirección al archivo a su proyecto de RStudio) si tiene el repositorio en su computadora
```



```{r, echo=FALSE}
#load("~/Library/CloudStorage/Dropbox/GitHub_Dropbox_Drive/GitHub/Diagnostico_Poblacional/Diagnostico_Poblacional/COMPADRE_v.6.23.5.0.RData")

#load("~/Dropbox/GitHub_Dropbox_Drive/GitHub/Diagnostico_Poblacional/Diagnostico_Poblacional/COMPADRE_v.6.23.5.0.RData") # work computer
```

***

#### Renombrar la base datos algo más sencillo

```{r chap16_4}
#ALLSp=as_cdb(compadre)  # Un paso critico: Convertir la base de datos anterior COM(P)ADRE (de clase 'list') en la base en un objeto CompadreDB (COMPADRE Database)

ALLSp=compadre
names(ALLSp) # La lista de los nombres de las variables en el archivo COMPADRE

```

***

#### Evaluate if a genus/species are present in the data base

```{r chap16_5}
Ex = ALLSp %>% 
  filter(Genus %in% c("Epipactis"))
Ex # This shows that the species added Epidendrum xanthinum is not yet included in the data base
```

***

#### Extraer (filter) solamente las especies de la familia **Orchidaceae**

```{r chap16_6}
index_O=ALLSp %>% 
 filter(Family %in% c("Orchidaceae")) # Extraer la orquídeas de la base de datos. 


head(index_O, n=3)

Genera=(as.data.frame(sort(unique(index_O$Genus))))

gt(Genera)
```


***

### Lista de especies unicas de orquídeas en la base de datos de COMPADRE.

Note que al momento hay 46 especies con nombres únicos en la base de datos

```{r chap16_7}

gt(as.data.frame(sort(unique(index_O$SpeciesAccepted))))


```

***

## Contabilizar cuantas matrices y variables estan incluidas en el archivo

La base de datos de orquídea tiene un total de 647 filas con 59 variables, por consecuencia tiene 647 matrices. Esas matrices de la misma especie son de diferentes poblaciones, tiempo o un análisis teóricos. 

```{r chap16_8}
dim(index_O)

```

Para saber de cuantos manuscritos distintos provienen esos datos uno puede evaluar la cantidad de DOI_ISBN distinctos. En este caso los de esas 647 matrices provienen de 34 fuentes de información publicada, revisada por pares, tesis o informes tecnicos.

```{r chap16_9}
unique(index_O$DOI_ISBN)
```

Igualmente podemos evaluar cuantos distintos autores son responsable de esas publicaciones. Un total de 37 autores únicos o en grupo son la fuente de esos artículos.

## ROBERTO:

HAY una manera de contabilizar los nombres específicos, no por grupo?

```{r chap16_10}
unique(index_O$Authors)
```

## Cuantos estudios unicos?

Para evaluar el largo de tiempo por estudio se necesita seleccionar una combinación de variables única

Subset

```{r chap16_11}
#names(index_O) Los nombres de las variables
SPECIES_O=index_O %>% select(StudyStart, StudyEnd, SpeciesAccepted, YearPublication, Authors, DOI_ISBN, OrganismType, MatrixPopulation, mat) %>% 
  group_by(SpeciesAccepted, YearPublication, OrganismType, StudyStart, StudyEnd) %>% 
  summarize(n_populations = length(unique(MatrixPopulation))) %>% 
  arrange(desc(n_populations)) %>% 
  mutate(StudyStart=as.numeric(StudyStart)) %>% 
  mutate(StudyEnd=as.numeric(StudyEnd)) %>% 
  drop_na(StudyStart, StudyEnd)

SPECIES_O %>% gt()


#write_csv(SPECIES_O, "Species_O.csv")
```


****

## Cantidad de poblaciones por especies

```{r chap16_12}
as.data.frame(table(SPECIES_O$n_populations))


```

```{r chap16_13}

SPECIES_O$SpeciesAccepted <- fct_reorder(SPECIES_O$SpeciesAccepted, SPECIES_O$StudyStart, .desc = FALSE)

ggplot(SPECIES_O, aes(SpeciesAccepted, color=OrganismType))+
  geom_linerange(aes(x= SpeciesAccepted  , ymin=StudyStart, ymax=StudyEnd))+
  coord_flip()+
  theme(legend.position = c(0.2, 0.8))+
  ylab("")+
  xlab("")+
  rlt_theme+
  theme(axis.text.x = element_text(color = "grey20", size = 9, angle = 90, hjust = .5, vjust = .5, face = "plain"),
        axis.text.y = element_text(color = "grey20", size = 7, angle = 0, hjust = 1, vjust = 0, face = "plain"),  
        axis.title.x = element_text(color = "grey20", size = 12, angle = 0, hjust = .5, vjust = 0, face = "plain"),
        axis.title.y = element_text(color = "grey20", size = 12, angle = 90, hjust = .5, vjust = .5, face = "plain"))


ggsave("Lenght_survey.png")

```

***


```{r chap16_14}

index_O=index_O %>% 
  mutate(StudyDuration=as.numeric(StudyDuration))

table(index_O$StudyDuration)
table(index_O$OrganismType)

ggplot(index_O, aes(StudyDuration, fill=OrganismType))+
         geom_histogram(colour="white")+
  facet_wrap(~OrganismType)+
  theme(legend.position = "none")+
  xlab("Study duration")+
  ylab("Frequency")+
  rlt_theme

#ggsave("Duración_Epi_Ter.pdf")

ggsave("Duración_Epi_Ter.png")
```

```{r chap16_15}
plot(index_O$Lon,index_O$Lat,main = "Location")
```



### Amalgamando todas las matrices y su información

```{r chap16_16}

index <- which(compadre$metadata$Family=="Orchidaceae") 
names(Compadre)

subset(index_O, Family =="Orchidaceae"  &
             MatrixDimension >2)


subset(index_O,DicotMonoc == "Eudicot" & 
              Country %in% c("USA", "CAN") & 
              MatrixDimension > 2)

#cdb_compare(index_O,x)


x <- subset(index_O,Family == "Orchidaceae")

x_OT=x %>% 
  group_by(OrganismType)
```




```{r chap16_17}
#Orchids_New=as_cdb(index)
#compadre$mat[index]

Compadre_flagged <- cdb_flag(index_O)

x <- subset(Compadre_flagged, check_NA_A == FALSE & check_ergodic == TRUE)
x
y <- subset(Compadre_flagged, check_NA_A == FALSE & check_irreducible == TRUE)

y
xy <- subset(Compadre_flagged, check_NA_A == FALSE & check_irreducible == TRUE & check_ergodic == TRUE)
xy

lambdaVals <- sapply(matA(xy), popdemo::eigs, what="lambda")
summary(lambdaVals)
hist(lambdaVals, main = "Lambda values")
```

```{r chap16_18}

library(purrr)
lambdaVals1 <- map_dbl(matA(xy), ~popdemo::eigs(.x, what="lambda"))
 
 
#Or with popbio, which avoids some warning messages…
lambdaVals2 <- map_dbl(matA(xy), ~popbio::lambda(.x))
```

```{r chap16_19}
x2=xy %>% 
  mutate(OrganismType = case_when(
    Genus ==  "Caladenia" & OrganismType == "Epiphyte" ~ "Herbaceous perennial",
    TRUE ~ OrganismType
  ))

epi=x2 %>% 
  filter(OrganismType=="Epiphyte")

terr=x2 %>% 
  filter(OrganismType=="Herbaceous perennial")



```

Compadre_flagged \<- cdb_flag(index_O)

x \<- subset(Compadre_flagged, check_NA_A == FALSE & check_ergodic == TRUE)

lambdaVals \<- sapply(matA(x), popdemo::eigs, what="lambda") summary(lambdaVals) hist(lambdaVals, main = "Lambda values")

```{r chap16_20}

Compadre_flagged_epi <- cdb_flag(epi)

x_epi <- subset(Compadre_flagged_epi, check_NA_A == FALSE & check_ergodic == TRUE)

#sapply(matA(x_epi), popdemo::eigs, what="lambda")

library(purrr)
lambda_epi <- map_dbl(matA(x_epi), ~popdemo::eigs(.x, what="lambda"))

#Or with popbio, which avoids some warning messages…
lambda_terr <- map_dbl(matA(terr), ~popbio::lambda(.x))
```

```{r chap16_21}
summary(lambda_epi)
hist(lambda_epi, main = "Lambda values")

summary(lambda_terr)
hist(lambda_terr, main = "Lambda values")
```

```{r chap16_22}
df_Lamb_epi=as.data.frame(lambda_epi)
df_Lamb_epi=df_Lamb_epi %>% 
  add_column(Habit_Type = "Epiphyte") %>% 
  rename(lambda=lambda_epi)


df_Lamb_terr=as.data.frame(lambda_terr)
df_Lamb_terr=df_Lamb_terr %>% 
  add_column(Habit_Type = "Terrestrial")%>% 
  rename(lambda=lambda_terr)


ALL_Lambdas=rbind(df_Lamb_epi, df_Lamb_terr)
```

```{r chap16_23}
ggplot(ALL_Lambdas, aes(lambda, fill=Habit_Type ))+
  geom_histogram(colour="white") + 
  facet_wrap( ~Habit_Type)+
  rlt_theme

ggsave("Terr_Epi_lambda.png")
```

### The number of populations

```{r chap16_24}
x2 %>% 
  group_by(SpeciesAccepted) %>% 
  summarize(n_populations = length(unique(MatrixPopulation))) %>% 
  arrange(desc(n_populations))
```

```{r chap16_25}

compadre_replicated_pops <- x2 %>% 
  group_by(SpeciesAccepted) %>% 
  mutate(n_pops = length(unique(MatrixPopulation))) %>% 
  ungroup() %>%
  subset(n_pops >= 10)

compadre_replicated_pops
```

```{r chap16_26}
ggplot2::ggplot(x2, aes(Lon, Lat)) +
  borders(database = "world", fill = "grey80", col = NA) +
  geom_point(col = "steelblue", size = 1.8, alpha = 0.8)

ggsave("orchid_map.jpg")
```

## Important to include only matrices that are annual.

Unless we data wrangle the life span so it represent a year worth instead of life span.

```{r chap16_27}
# function to calculate life expectancy
lifeExpectancy <- function(matU, startLife) {
  N <- solve(diag(nrow(matU)) - matU)
  return(colSums(N)[startLife])
}

compadre_life_expect <- x2 %>% 
  filter(ProjectionInterval >0.7) |> 
  filter(MatrixComposite == "Mean", # filter is the dplyr version of subset
         MatrixTreatment == "Unmanipulated",
         MatrixCaptivity == "W",
         #ProjectionInterval == "1"
         ) %>% 
  mutate(StageID = cdb_id_stages(.)) %>%
  cdb_collapse(columns = "StageID") %>%
  cdb_flag() %>% 
  filter(check_NA_U == FALSE,
         check_zero_U == FALSE,
         check_singular_U == FALSE) %>% 
  mutate(matU = matU(.), start_life = mpm_first_active(.)) %>% 
  mutate(life_expectancy = mapply(lifeExpectancy, matU, start_life)) %>% 
 # filter(life_expectancy >= 1) %>% 
  mutate(OrganismType = reorder(OrganismType, life_expectancy, median))



compadre_life_expect |> 
  group_by(OrganismType) |> 
  summarize(mean_LS= mean(life_expectancy, na.rm=TRUE),
            sd_LS = sd(life_expectancy, na.rm=TRUE))


ggplot2::ggplot(compadre_life_expect, aes(OrganismType, life_expectancy, colour=OrganismType)) +
  geom_boxplot() +geom_point()+
  scale_y_log10() +
  coord_flip() +
  labs(x = NULL, y = "Life expectancy (log(years))")+
  rlt_theme+
  theme(legend.position = "none")

ggsave("Life_Span.png")
```

```{r chap16_28}

#SPECIES_O$SpeciesAccepted <- fct_reorder(SPECIES_O$SpeciesAccepted, SPECIES_O$StudyStart, .desc = FALSE)

compadre_life_expect |> select(mat, Genus, SpeciesAccepted, life_expectancy) |> 
  group_by(SpeciesAccepted) |> 
  summarize(mean_LS= mean(life_expectancy, na.rm=TRUE),
            sd_LS = sd(life_expectancy, na.rm=TRUE))


ggplot(compadre_life_expect, aes(x=reorder(SpeciesAccepted, life_expectancy), life_expectancy, colour=OrganismType)) +
  geom_boxplot() +
  geom_point()+
  scale_y_log10() +
  coord_flip() +
  labs(x = NULL, y = "Life expectancy (log(years))")+
  rlt_theme+
  theme(legend.position = "none")

ggsave("Genus_Life_Span.png")
```

```{r chap16_29}

#SPECIES_O$SpeciesAccepted <- fct_reorder(SPECIES_O$SpeciesAccepted, SPECIES_O$StudyStart, .desc = FALSE)

compadre_life_expect |> 
  group_by(Genus) |> 
  summarize(mean_LS= mean(life_expectancy, na.rm=TRUE),
            sd_LS = sd(life_expectancy, na.rm=TRUE)) |> 
  filter(Genus %in% c("Caladenia"))

compadre_life_expect |> 
  filter(Genus %in% c("Caladenia")) |> 
ggplot( aes(x=reorder(SpeciesAccepted, life_expectancy), life_expectancy, colour=OrganismType)) +
  geom_boxplot() +
  geom_point()+
  #scale_y_log10() +
  coord_flip() +
  labs(x = NULL, y = "Life expectancy (years)")+
  rlt_theme+
  theme(legend.position = "none")

ggsave("Caladenia_Life_Span.png")
```

Test difference in life span.

```{r chap16_30}
unique(compadre_life_expect$OrganismType)

t.test(life_expectancy~OrganismType, data=compadre_life_expect)


shapiro.test(compadre_life_expect$life_expectancy) # Not normaly distributed


library(car)

leveneTest(life_expectancy~OrganismType, data=compadre_life_expect) # equal variance but not notmaly distributed

```

Use robust Approach

Para el siguiente análisis se necesita instalar el paquete **WRS2**.

Y se necesita cargar el archivo de funciones de **Rallfun-v38.txt** que se encuentra en el siguiente enlace \<<https://github.com/rrwilcox/Rallfun>\> y guardarlo en su directorio de trabajo. Pudiese ser que haya versiones más recientes de este archivo. Nota que el codigo abajo funciona para mi computadora, uds tienen que ajustar la dirección del archivo a su directorio de trabajo.

```{r chap16_31}
library(WRS2)
source("/Users/rlt/Library/CloudStorage/Dropbox/GitHub_Dropbox_Drive/GitHub/Diagnostico_Poblacional/Diagnostico_Poblacional/Rallfun-v38.txt", chdir = T) # Home computer
#source("/Users/rlt/Dropbox/METAS+COHORT_D/Rallfun-v38.txt", chdir = T)
#source("/Users/rlt/Dropbox/Ackermanstuff/Pollinator_Interaction/Specificity_Index_pollinators/Rallfun-v38.txt", chdir = T) ## Work laptop Computer
#source("/Users/raymondtremblay/Dropbox/METAS+COHORT_D/Rallfun-v38.txt", chdir = T) #When used on Monique
```

```{r chap16_32}
unique(compadre_life_expect$OrganismType)

Cf=cdb_flatten(compadre_life_expect)


YSEC_T=Cf %>% 
  dplyr::select("life_expectancy", "OrganismType") %>% 
  filter(OrganismType== "Herbaceous perennial")

YSEC_T
YSEC_E=Cf %>% 
  dplyr::select("life_expectancy", "OrganismType") %>% 
  filter(OrganismType== "Epiphyte")

yuenbt(YSEC_T$life_expectancy, YSEC_E$life_expectancy, alpha=.05, nboot=10000, side=T)

```

```{r chap16_33}
library(Rcompadre)
library(popdemo)
data(Compadre)


Compadre$matA <- matA(Compadre)

# create empty vector to store output
Compadre$dim <- numeric(nrow(Compadre))

index$dim <- numeric(nrow(index_O))

# loop through all rows of Compadre
for (i in seq_len(nrow(Compadre))) {
  Compadre$dim[i] <- nrow(Compadre$matA[[i]])
}

# function to determine whether matrix 'mat' has any stages with no transitions
NullStages <- function(mat) any(colSums(mat) == 0)

# apply function to every element of A
Compadre$null_stages <- sapply(Compadre$matA, NullStages)

NullStages(Compadre$matA[[1]]) # apply function to single element
Compadre$null_stages <- sapply(matA(Compadre), NullStages)
```

<!--chapter:end:17-COMPADRE_ORCHIDS.Rmd-->

---
editor_options: 
  markdown: 
    wrap: 72
---

# Un protocolo para informar sobre modelos discreto de estructura de población

### "A standard protocol to report discrete stage-structured demographic information" {.unnumbered}

##### Samuel J. L. Gascoigne<sup>1</sup> \| Simon Rolph<sup>2</sup> \| Daisy Sankey<sup>1</sup> \| Nagalakshmi Nidadavolu<sup>1</sup> \| Adrian S. Stell Pičman<sup>1,3</sup> \| Christina M. Hernández<sup>4</sup> \| Matthew E. R. Philpott<sup>1</sup> \| Aiyla Salam<sup>1</sup> \| Connor Bernard<sup>1</sup> \| Erola Fenollosa<sup>1</sup> \| Young Jun Lee<sup>1</sup> \| Jessica McLean<sup>1</sup> \| Shathuki Hetti Achchige Perera<sup>1</sup> \| Oliver G. Spacey<sup>1</sup> \| Maja Kajin<sup>1,3</sup> \| Anna C. Vinton<sup>1</sup> \| C. Ruth Archer<sup>5</sup> \| Jean H. Burns<sup>6</sup> \| Danielle L. Buss<sup>7,8</sup> \| Hal Caswell<sup>9</sup> \| Judy P. Che-Castaldo<sup>10</sup> \| Dylan Z. Childs<sup>2</sup> \| Pol Capdevila<sup>11</sup> \| Aldo Compagnoni<sup>1,12,13</sup> \| Elizabeth Crone<sup>14</sup> \| Thomas H. G. Ezard<sup>15</sup> \| Dave Hodgson<sup>8</sup> \| Tiffany M. Knight<sup>12,13,16</sup> \| Owen R. Jones<sup>17</sup> \| Eelke Jongejans<sup>18,19</sup> \| Jenni McDonald<sup>20,21</sup> \| Brigitte Tenhumberg<sup>22</sup> \| Chelsea C. Thomas<sup>23</sup> \| Andrew J. Tyre<sup>2,4,25</sup> \| Satu Ramula<sup>26</sup> \| Iain Stott<sup>27</sup> \| Raymond L. Tremblay<sup>28,29,30</sup> \| Phil Wilson<sup>8</sup> \| James W. Vaupel<sup>31,‡</sup> \| Roberto Salguero-Gómez<sup>1,32,33</sup> {.unnumbered}

<sup>1</sup>Department of Biology, University of Oxford, Oxford, UK;
<sup>2</sup>Department of Animal & Plant Sciences, University of
Sheffield, Sheffield, UK; <sup>3</sup>Department of Biology, University
of Ljubljana, Ljubljana, Slovenia; <sup>4</sup>Department of Ecology and
Evolutionary Biology, Cornell University, Ithaca, New York, USA;
<sup>5</sup>Institute of Evolutionary Ecology and Conservation Genomics,
University of Ulm, Ulm, Germany; <sup>6</sup>Department of Biology, Case
Western Reserve University, Cleveland, Ohio, USA; <sup>7</sup>Department
of Archaeology, University of Cambridge, Cambridge, UK;
<sup>8</sup>College of Life and Environmental Sciences, University of
Exeter, Penryn, UK; <sup>9</sup>Institute for Biodiversity and Ecosystem
Dynamics, University of Amsterdam, Amsterdam, The Netherlands;
<sup>10</sup>Branch of Species Status Assessment Science Support, U.S.
Fish and Wildlife Service, Washington, DC, USA; <sup>11</sup>School of
Biological Sciences, University of Bristol, Bristol, UK;
<sup>12</sup>Institute of Biology, Martin Luther University
Halle-Wittenburg, Halle (Saale), Germany; <sup>13</sup>German Centre for
Integrative Biodiversity Research (iDiv) Halle-Jena-Leipzig, Leipzig,
Germany; <sup>14</sup>Department of Biology, Tufts University, Medford,
Massachusetts, USA; <sup>15</sup>School of Ocean and Earth Science,
University of Southampton, Southampton, UK; <sup>16</sup>Department of
Community Ecology, Helmholtz Centre for Environmental Research-UFZ,
Halle (Saale), Germany; <sup>17</sup>Department of Biology, University
of Southern Denmark, Odense, Denmark; <sup>18</sup>Animal Ecology and
Physiology, Radboud University, Nijmegen, The Netherlands;
<sup>19</sup>NIOO-KNAW, Animal Ecology, Wageningen, The Netherlands;
<sup>20</sup>Veterinary Department, Cats Protection, National Cat
Centre, Haywards Heath, UK; <sup>21</sup>Bristol Veterinary School,
University of Bristol, Bristol, UK; <sup>22</sup>School of Biological
Sciences and Department of Mathematics, University of Nebraska, Lincoln,
Nebraska, USA; <sup>23</sup>Alexander Center for Applied Population
Biology, Conservation & Science Department, Chicago, Illinois, USA;
<sup>24</sup>School of Natural Resources, University of
Nebraska-Lincoln, Lincoln, Nebraska, USA; <sup>25</sup>Global Resistance
Management Team, Bayer U.S. –Crop Science, Chesterfield, Missouri, USA;
<sup>26</sup>Department of Biology, University of Turku, Turku, Finland;
<sup>27</sup>School of Life Sciences, University of Lincoln, Lincoln,
UK; <sup>28</sup>Department of Biology, University of Puerto Rico, San
Juan, Puerto Rico, USA; <sup>29</sup>Center for Applied Tropical Ecology
and Conservation, University of Puerto Rico, San Juan, Puerto Rico, USA;
<sup>30</sup>Department of Biology, University of Puerto Rico-Humacao,
Puerto Rico, USA; <sup>31</sup>Interdisciplinary Centre on Population
Dynamics, University of Southern Denmark, Odense, Denmark;
<sup>32</sup>Centre for Biodiversity and Conservation Science,
University of Queensland, St Lucia, Queensland, Australia y
<sup>33</sup>Evolutionary Demography Laboratory, Max Planck Institute
for Demographic Research, Rostock, Germany

------------------------------------------------------------------------

### Persona de contacto {.unnumbered}

Samuel J. L. Gascoigne Email:
[samuel.gascoigne\@pmb.ox.ac.uk](mailto:samuel.gascoigne@pmb.ox.ac.uk){.email}

Roberto Salguero-Gómez Email:
[rob.salguero\@biology.ox.ac.uk](mailto:rob.salguero@biology.ox.ac.uk){.email}

Por: Traducido por Anne Damon, RLT y Roberto... y .......

------------------------------------------------------------------------

Nota: Cualquier conflicto entre el texto en ingles y español, siempre se
debería usar el texto en ingles como guia.

------------------------------------------------------------------------

#### Cuando cita el articulo use la siguiente información, [@gascoigne2023standard] {.unnumbered}

### Abstract {.unnumbered}

1.  Los métodos demográficos que se basan en etapas, como los Modelos
    Matriciales Poblacionales (MPM, por sus siglas en inglés), son
    herramientas poderosas que se utilizan para abordar una amplia gama
    de preguntas fundamentales en ecología, biología evolutiva y
    ciencias de la conservación. Por ello, ahora existen MPM para más de
    3,000 especies en todo el mundo. Estos datos se están digitalizando
    como un proceso continuo y se publican periódicamente en dos grandes
    repositorios en línea de acceso abierto: la base de datos de
    matrices vegetales de COMPADRE y la base de datos de matrices
    animales de COMADRE. Sin embargo, durante la última década, el
    análisis y la curación de los datos de COMPADRE y COMADRE, y la
    investigación comparativa posterior, han revelado una variación
    pronunciada en la forma en que se parametrizan y reportan los MPM.
2.  Aquí resumimos los problemas actuales relacionados con la
    parametrización y difusión de los MPM, los que surgen con más
    frecuencia, y describimos cómo afectan la construcción, el análisis
    y la interpretación de los MPM. Para cuantificar la variación en
    cómo se difundan los MPM, presentamos los resultados de una encuesta
    que buscaba identificar aspectos clave de los MPM que con frecuencia
    no se presentan en los manuscritos. Luego evaluamos las bases de
    datos de COMPADRE y COMADRE para cuantificar con qué frecuencia se
    omiten piezas clave de información en los manuscritos donde manejan
    los MPM.
3.  Más del 80 % de los y las investigadores entrevistados (n = 60)
    comentaron de las ventajas de adoptar metodologías más
    estandarizadas para difundir y compartir los MPM. Además, más del
    85% de los 300 MPM evaluados por COMPADRE y COMADRE omitieron uno o
    más de los elementos clave para su correcta interpretación. Basado
    en estos resultados, identificamos los principales problemas que
    pueden surgir a partir de la construcción y difusión de los MPM y
    brindamos sugerencias para mejorar la claridad y la reproducibilidad
    y así contribuir a la investigación futura utilizando MPM y los
    metadatos requeridos. Para fortalecer la reproducibilidad y
    capacitar a los investigadores para aprovechar al máximo sus datos
    demográficos, presentamos un protocolo estandarizado para presentar
    los MPM en las publicaciones. Este estándar está vinculado con el
    contenido de www.compa dre-db.org, para que los autores que deseen
    archivar sus MPM puedan hacerlo antes de someter sus publicaciones,
    siguiendo ejemplos de otros repositorios de acceso abierto como
    DRYAD, Figshare y Zenodo.
4.  La combinación y estandarización de MPM parametrizados provenientes
    de poblaciones de todo el mundo, y de todo el árbol de la vida de
    los organismos, abre poderosas oportunidades de investigación en
    biología evolutiva, ecología y conservación. Sin embargo,
    enfatizamos que este potencial solo se logrará mediante la adopción
    de métodos estandarizados para garantizar la reproducibilidad.
    PALABRAS CLAVE demografía comparativa, modelos matriciales de
    población, acceso abierto, reproducibilidad

### 1 \| INTRODUCCION {.unnumbered}

La ecología de poblaciones ha llegado a la mayoría de edad. El
desarrollo de teorías, enfoques experimentales y metodologías
estadísticas han dado como resultado la publicación de información
demográfica para una muestra cada vez más representativa de la
biodiversidad mundial (De Magalhᾶes & Costa, 2009; Levin et al., 2022;
Salguero-Gómez et al., 2015, 2016). Estos datos abarcan el árbol
taxonómico desde los microbios (Jouvet et al., 2018) hasta
macrovertebrados (Fujiwara & Caswell, 2001), y cubren prácticamente
todos los continentes y biomas, aunque con importantes sesgos
taxonómicos (Conde et al., 2019; Römer et al., 2021). El potencial de
esta cantidad de información impresionante y en rápido aumento está
comenzando a realizarse. De hecho, mediante la combinación de estos
modelos demográficos, los investigadores han identificado
características funcionales que explican la variación en las estrategias
de la historia de vida de las plantas (Adler et al., 2014; ver también
Bernard et al., 2023), características a corto plazo (transitorias) que
impulsan la evolución demográfica, la dinámica de las poblaciones de
plantas en ambientes variables (McDonald et al., 2016), y las formas en
que las estrategias de historia de vida permiten que las especies
persistan en un entorno de clima cambiante (Jelbert et al., 2019; Paniw
et al., 2019).

Una de las herramientas más utilizadas para describir y analizar las
complejas historias de vida de las especies es la de los modelos de
población matricial (MPM). Brevemente, en un MPM, los individuos de una
población se clasifican por etapas discretas y/o edades (st/edad en
adelante) de acuerdo con algunos criterios biológicos (Caswell, 2001, p.
31) o estadísticos/de muestreo (Salguero-Gómez & Plotkin, 2010). Estos
individuos son seguidos en pasos de tiempo discretos, típicamente
ajustados por el tiempo de generación de cada especie. De hecho, los
pasos de tiempo pueden variar de 12 a 24 h, como en los gusanos
nematodos Caenorhabditis elegans y pulgones Myzus periscae (Bruijning et
al., 2019; Li et al., 2014), a períodos mensuales/anuales en mamíferos y
plantas (Coulson et al., 2001; Ferreira et al., 2016), y hasta los 50
años en los “red woods” de crecimiento lento (Namkoong & Roberds, 1974).
A partir de estos datos, los investigadores estiman pérdidas por
mortalidad, probabilidades de transición entre estadios/edades y su per
cápita contribuciones a/sexuales a través de la reproducción (Nordstrom
et al., 2021; Omeyer et al., 2021).

A partir de un solo MPM se puede calcular un amplio repertorio de
resultados biológicamente significativos. Estos resultados incluyen
indicadores estimados del desempeño y la viabilidad de las poblaciones,
como tasas de crecimiento demográfico deterministas (γ) o estocásticas
(γs) (Doak et al., 2005), riesgo de cuasi-extinción (Davis, 2022),
respuesta de la población a perturbaciones de las tasas vitales
subyacentes, como la supervivencia o la reproducción (Caswell, 2001, p.
206), dinámica transitoria (Capdevila et al., 2020, Ezard et al., 2010;
Stott et al., 2011) y rasgos de historia de vida, como tasas de
senescencia (Baudisch et al., 2013), grado de iteroparidad
(Salguero-Gómez et al., 2017) y edad de madurez (Caswell, 2001, p. 124).
Esta gran cantidad de inferencias demográficas destaca el por qué han
sido tan importantes los MPM para el desarrollo de la demografía y la
teoría de la historia de vida (Franco & Silvertown, 1996; Pfister, 1998;
Sæther et al., 2013; Tuljapurkar, 1989).

Los MPM para plantas y animales han sido archivados, corregidos,
complementados con información adicional (p. ej., coordenadas GPS,
estado de conservación de la UICN) y publicados en medios de acceso
abierto en la Base de Datos de Matrices Vegetales de COMPADRE
(Salguero-Gómez et al., 2015) y el Base de Datos de Matrices Animales
COMADRE (Salguero-Gómez et al., 2016). En la publicación más reciente,
COMPADRE v. 6.22.5 [COMADRE v. 4.21.8] se presentan datos de 8851 [3317]
MPM de 760 [415] especies distintas, trabajadas en 643 [395] estudios.
Al momento de redactar este informe, otras 1307 especies están
pendientes de digitalización en la red COMPADRE, con una tasa aproximado
de 4.5 nuevos trabajos que contienen MPM siendo analizados,
digitalizados y pasados por un proceso de control de calidad cada semana
(S. Gascoigne, obs. pers.). Sin embargo, uno de los desafíos del proceso
de digitalización es la enorme variación en la forma en que se
recopilan, presentan y utilizan los datos para parametrizar los MPM. La
estandarización de datos mejora la capacidad de replicación y facilita
el intercambio de datos entre disciplinas de investigación (Reichman et
al., 2011). Por lo tanto, la estandarización de los datos, y los
metadatos detallados asociados, es clave para que la investigación se
replique, valide y discuta abiertamente para que la ciencia avance
(Powers & Hampton, 2019; Reichman et al., 2011; Salguero-Gómez et al.,
2021). Ejemplos de estos estándares incluyen, informar del tamaño de la
muestra y de la varianza de las estimaciones, además de detallar la
lista completa de fuentes originales de datos (Gerstner et al., 2017).
En este contexto, los estándares se pueden utilizar como elementos de
una lista de requisitos para mejorar la calidad y la reproducibilidad de
las publicaciones y el proceso de arbitraje por pares (Reichman et al.,
2011). Este proceso de estandarización hará posible ampliar el alcance
del análisis, mediante la inclusión de los meta-análisis (Gurevitch et
al., 2018) y los análisis comparativos filogenéticos (Healy et al.,
2019; Salguero-Gómez et al., 2017), que ofrecen oportunidades valiosas
para examinar patrones generales e identificar lagunas en el
conocimiento, y en ambos casos también dependen de datos que conforman a
determinadas normas.

Los MPM se están adaptando, ampliando y aplicando más allá de su
contexto original especie-específica en la demografía comparativa. Sin
embargo, no todos los MPM se construyen y se reporten de la misma
manera. La presentación actual de las MPM en COMPADRE y COMADRE nos
podría dar la falsa impresión de que todos los MPM se conformen a un
formato homogéneo predeterminado, y esto a pesar de las diferencias en
cómo y por qué fueron concebidos los MPM (Caswell, 2001). Esta impresión
pudo haber surgido por el extenso proceso de verificación que realiza el
equipo de digitalización de COMADRE y COMPADRE atrás de las escenas (p.
ej., validación de los resultados del modelo, correspondencia con el
autor para obtener información adicional). Si bien la verificación es un
aspecto inevitable de la curación de bases de datos, la mayor parte de
nuestros esfuerzos se dedica a comunicarnos con los autores en lugar de
la digitalización de datos. Nuestro objetivo aquí es (i) presentar el
estándar actual de comunicación de los MPM en la literatura, (ii)
identificar problemas comunes en la comunicación de los MPM y sus
impactos, (iii) sugerir formas de apoyar la comunicación clara de datos
y metadatos de los MPM, (iv) destacar las ventajas para los autores y la
comunidad científica en general y (v) introducir un método estándar para
compartir datos y metadatos de los MPM.

### 2 \| COMUNICACIÓN MPM: ESTADO DEL ARTE {.unnumbered}

Para presentar las prácticas actuales en la comunicación de datos y
metadatos de los MPM, con el objetivo final de evaluar la necesidad de
estandarizar informes de datos y metadatos, realizamos una encuesta de
investigadores y examinamos un subconjunto de publicaciones que se han
utilizado para generar MPMs y que han sido almacenados en COMPADRE y
COMADRE.

### 2.1 \| Una encuesta sobre comunicación matricial {.unnumbered}

Entrevistamos especialistas de ecología de poblaciones, a quienes
identificamos por haber publicado artículos revisados por pares que
incluyen MPM, con respecto a nuestra capacidad actual para comunicar
datos y metadatos de los MPM con fines de reproducibilidad.
Específicamente, preguntamos qué tan bien las publicaciones revisadas
por pares transmiten los atributos de los MPM necesarios para asegurar
la reproducibilidad. Además, preguntamos si los investigadores pensaban
que un método estandarizado de comunicación matricial es "necesario para
la comunicación coherente de los MPM en la literatura" (la lista
completa de 11 preguntas se puede encontrar en Información de apoyo). La
encuesta se distribuyó mediante Google Forms. Identificamos 1390
participantes potenciales bajo el criterio de ser el autor principal y/o
de correspondencia de una publicación que contiene al menos un MPM. Más
del 50% de las direcciones de correo electrónico correspondientes
estaban desactualizadas y no hubo seguimiento. De los aproximadamente
650 investigadores restantes que fueron contactados, 60 participantes
completaron la encuesta. Como era de esperar, los investigadores
comentaron de una gran heterogeneidad en los componentes incluidos en la
comunicación de los MPM (Figura 1). Los atributos mejor comunicados
según estos participantes de la encuesta son los nombres de los rasgos
(es decir, el fenotipo mediante el cual se estructuró el MPM:
etapa/edad/tamaño clases), la duración del censo e intervalo de
proyección, mientras que los atributos peor comunicados son los gráficos
del ciclo de vida, fórmulas que definen las tasas vitales y los vectores
de población (es decir, número/frecuencia de individuos en cada
etapa/edad). Es importante destacar que el 83% de los participantes de
la encuesta acordaron que la disciplina si necesita un método
estandarizado para la comunicación de los MPM.

### 2.2 \| Una muestra de publicaciones en COMPADRE y COMADRE {.unnumbered}

Para cuantificar qué tan bien se comunican los datos y metadatos de los
MPM en publicaciones revisadas por pares, seleccionamos al azar 300
artículos entre los que contenían MPM ya digitalizados en COMPADRE y
COMADRE, quedando con 150 artículos en cada caso. Entre los diferentes
atributos clave de los MPM que examinamos, hubo una variación
considerable en la confiabilidad con la que los autores proporcionaron
los datos y metadatos necesarios para digitalizar, archivar y realizar
análisis comparativos (Figura 2). Por ejemplo, la ubicación genérica de
la población examinada (i.e. provincia/ciudad/monumento; COMPADRE:
95.1%, COMADRE: 86.2% de los trabajos lo reportaron), el MPM totalmente
parametrizado (93.3%, 88.9%) y la fecha del censo (89.6 %, 77.7 %) se
indicaron explícitamente con frecuencia en los artículos, mientras que
la latitud y longitud de la población examinada (52.4 %, 39.9 %), su
diagrama de ciclo de vida (44.5 %, 40.1 %) y el vector de población (es
decir, si la distribución por edades de los individuos en el momento t)
(33.2 %, 32.6 %) se indicaron con menor frecuencia. Curiosamente, los
estudios de plantas que utilizan MPM (COMPADRE) contienen en general
datos y metadatos más completos y claros que los estudios de animales
(COMADRE; Figura 2). Utilizamos esta información para categorizar la
calidad de cada uno de los 300 artículos examinados en términos de su
reproducibilidad, definida como la inclusión de los componentes
necesarios para la comunicación de los MPM (Figura 3). La distribución
de estos componentes de comunicación entre los reinos es similar.
Fundamentalmente, solo el 13.9 % de los artículos en COMADRE y el 15.8 %
de los artículos en COMPADRE contienen toda la información necesaria
para realizar análisis comparativos y proyecciones precisas (Figura 3).
Por lo tanto, en aproximadamente el 85 % de los artículos se requiere
enviar un correo electrónico a los autores para solicitar la información
faltante.

### 3 \| PROBLEMAS COMUNES CON LA CONSTRUCCIÓN DE MATRICES {.unnumbered}

Aquí, identificamos problemas clave en la parametrización de los MPM
para ilustrar el impacto de la metodología en el potencial de
extrapolación demográfica. Para hacerlo, nos basamos en los hallazgos de
la sección anterior y nuestra experiencia con la curación de COMPADRE y
COMADRE. Señalamos las siguientes cuestiones por dos razones: (i) para
guiar los demógrafos en cómo identificar estas cuestiones en la
literatura y (ii) para evitar que persistan estos problemas en futuras
publicaciones. Señalamos que un lista completa fue difundido
recientemente por Kendall et al. (2019, véase también Che-Castaldo et
al., 2020). Aquí, ampliamos estos documentos anteriores indicando los
pasos necesarios para que los investigadores puedan evitar/mitigar estos
problemas en su propia investigación. Un resumen de estos problemas,
desde la ocurrencia hasta impacto, se detalla en la Figura S1. 3.1 \|
Tipo de censo, temporalidad y frecuencia Los MPM son modelos
demográficos de tiempos medidos, parametrizados mediante el seguimiento
de individuos tras los muestreos o censos. Por lo tanto, el tipo (p.
ej., longitudinal, transversal), el momento y la frecuencia de los
muestreos o censos deben planificarse cuidadosamente. Estos criterios
son particularmente importantes ya que el tipo de censo afecta
directamente a la construcción de la matriz, y el momento y la
frecuencia del censo pueden influir involuntariamente en los resultados
demográficos (Emery & Gross, 2005).

Por lo general, los MPM se manejan de dos formas con respecto a la
medición de la reproducción entre censos: nacimiento-flujo o
nacimiento-pulso (ver Caswell, 2001, p. 22). La distinción se basa en si
la reproducción se produce de forma continua (es decir,
nacimiento-flujo) o en una estrecha ventana temporal (nacimiento-pulso).
Los MPM de nacimiento-pulso a su vez se subclasifican en censo previo
versus pos-reproductivo. Aunque tanto los censos pre-reproductivos como
los pos-reproductivos a menudo conducen a un escenario demográfico
similar (ver Cooch et al., 2003), su diferencia radica en la relación
entre el tiempo del censo de la población y la posición de la estrecha
ventana reproductiva. En el primero, las poblaciones son censadas
inmediatamente antes de una ventana reproductiva, mientras que los
censos post-reproductivos continúan después de una ventana reproductiva.
Un censo pre-reproductivo requiere la inclusión de la supervivencia de
la descendencia en los elementos de la matriz reproductiva, mientras que
un censo post-reproductivo requiere la inclusión de la supervivencia de
los padres en los elementos de la matriz reproductiva. A menudo
encontramos errores en el acomodo de la descendencia o la supervivencia
de los padres en los elementos de la matriz reproductiva (ver también
Kendall et al., 2019). Un paso clave en la construcción de la matriz que
puede evitar el acomodo incorrecta de la supervivencia sería dibujar el
gráfico del ciclo de vida (según Ebert, 1999, p. 61) con respecto al
momento del censo (demostrado en Ellner et al., 2016, p. 13), así como
también detallar explícitamente el tipo de censo utilizado para
parametrizar el MPM. Sin embargo, a veces dibujar el gráfico del ciclo
de vida puede que sea inviable o poco informativo. Por ejemplo, el
gráfico de un modelo clasificado por edad si tuviera 100 clases de edad
sería demasiado grande para dibujarlo y no muy útil; sin embargo, se
podría simplificar con una línea discontinua si varias clases adyacentes
tienen las mismas tasas demográficas (por ejemplo, Ebert, 1999, p. 2).
Los modelos con muchas etapas y transiciones altamente conectadas no son
viables para dibujar el gráfico del ciclo de vida (por ejemplo, el
gráfico de *Calathea ovandensis* en Neubert y Caswell (2000)). Pero
incluso, en situaciones complejas (por ejemplo, la serie de gráficos
estacionales para el pingüino emperador en Jenouvrier et al. (2010)), el
gráfico puede ser útil para organizar la estructura del modelo. El
tiempo y la frecuencia del censo afectan la construcción del modelo, lo
que hace que un MPM construido no sea práctico para la inferencia
demográfica si no se considera la historia de vida del organismo
examinado. Considere a un investigador que compara los procesos
demográficos de las moscas de la fruta y los árboles frutales. El
investigador primero nota que hay cuatro etapas discretas en la historia
de vida de las moscas de la fruta: tres etapas juveniles que abarcan el
desarrollo desde el huevo hasta el estadio y la pupa, y una etapa adulta
donde los individuos se dispersan y reproducen. Dado que el desarrollo
de huevo a adulto tarda \~10 días en esta especie, el investigador
decide realizar el censo cada 10 días tanto para la mosca de la fruta
como para los árboles frutales durante un período de 3 meses. Sin
embargo, debido a que ni la mortalidad ni la reproducción ocurren en un
censo tan corto en la población de árboles frutales, el MPM de árboles
frutales resultante, cuando se proyecta hacia adelante, persistirá para
siempre, sin aumentar ni disminuir. Este mismo problema ocurriría al
revés. Si los intervalos de 5 años se consideraran suficientes para los
árboles frutales, las moscas de la fruta medidas individualmente nunca
sobrevivirían a lo largo de los períodos de tiempo. Existe una solución
a este problema, utilizando modelos de matrices periódicas para incluir
períodos mucho más cortos o más largo que otros períodos. Por ejemplo,
Hunter y Caswell (2005) analizaron la pardela negra Puffinus griseus
incluyendo dos períodos de cosecha de varias semanas de duración y luego
un intervalo anual para la especie, con una vida útil de décadas. Smith
et al. (2005) y Shyu et al. (2013) utilizaron modelos estacionales
periódicos para adaptarse a los ciclos de vida en los que algunas etapas
solo están presentes durante una parte del ciclo anual. El enfoque
(Caswell, 2001, sección 13.1) es poderoso y general.

### 3.2 \| Supervivencia etapa-específica poco realista {.unnumbered}

Los problemas en la parametrización de la supervivencia
etapa-específica, si bien son fáciles de diagnosticar, son difíciles de
controlar y pueden dar lugar a una variedad de historias de vida no
naturales. Las probabilidades de transición y supervivencia están
limitadas entre 0 (el evento nunca sucede) y 1 (el evento siempre
ocurre). Es evidente que, considerando la etapa-específica supervivencia
de un MPM, los elementos no reproductivos sumados en una columna dada
del MPM A no deben exceder 1. Cuando lo hace, los individuos en esa
etapa tienen una probabilidad poco realista de sobrevivir \>100%, lo que
resulta en una representación incorrecta de la historia de vida del
organismo. Los valores de \>1 de supervivencia etapa-específica
generalmente surgen debido a errores de redondeo, errores tipográficos,
e inclusión de eventos reproductivos a/sexuales no declarados y
generalmente se recomienda omitir estos MPM en un análisis comparativo
(Jones et al., 2014). Los eventos reproductivos a/sexuales no declarados
ocurren cuando un elemento $a_{i,j}$ en el MPM $A$ combina procesos
dependientes de la supervivencia, como el crecimiento/encogimiento, pero
también la fertilidad, y que estos no se han informado por separado. De
preferencia, los autores identificarían cuidadosamente si varias tasas
vitales se confunden con procesos demográficos dependientes de la
supervivencia en cada elemento del MPM. Para el demógrafo comparativo
que utiliza COMPADRE y COMADRE, recomendamos evitar los modelos MPM
donde supervivencia etapa-específica llega a ser \>1, y también evitar
alterar el modelo para hacer que la supervivencia etapa-específica se
fije a un máximo de 1 (p. ej., Buckley et al., 2010). En muchos MPM
publicados, algunas de las etapas de la vida tienen un tiempo estimado
probabilidad de supervivencia de 1 o un ciclo de vida incompleto,
probablemente el resultado de un tamaño de muestra pequeño o algún
evento raro a lo largo de la historia de vida del especies. La
supervivencia perfecta (es decir, mortalidad = 0) es poco probable y es
posible que el valor deba estimarse o imputarse (Johnson et al., 2018).
Un método para estimar valores realistas de supervivencia y transición
fue propuesto recientemente por Tremblay et al. (2021), utilizando un
enfoque bayesiano para estimar los valores de los parámetros utilizando
datos previos, además de los datos observados, para obtener los MPM. Una
ventaja de este enfoque es que los intervalos de confianza de los
parámetros que representan probabilidades (estásis, transición,
supervivencia) se obtienen a partir de una distribución beta. La ventaja
de usar una distribución de Dirichlet multinomial bayesiana inferida
para estimar los valores medios es que los investigadores pueden inferir
la varianza y el sesgo de las distribuciones posteriores para informar
mejor la construcción de MPM y la interpretación demográfica (p. ej.,
Tremblay et al., 2009a, 2009b). Por último, dado que el tamaño de la
muestra puede ser un factor causante de la supervivencia
etapa-específica poco realista, el tamaño de la muestra y la
incertidumbre (p. ej., intervalo de confianza, desviación estándar)
deben informarse para (1) transmitir la precisión de la supervivencia
estimada valor para su audiencia y (2) para la inclusión precisa de los
valores de supervivencia en metaanálisis y métodos comparativos.

### 3.3 \| Parametrización incorrecta de la fertilidad {.unnumbered}

La fertilidad a menudo presenta un desafío para la construcción de MPM
precisos. Este desafío se debe en parte a la ambigüedad del término
"fertilidad". El problema surge cuando las contribuciones individuales
(per-cápita) de los adultos reproductivos a los nuevos reclutas (por
ejemplo, huevos, neonatos, semillas, etc.) no representan los enlaces
que contempla el intervalo de proyección completo del estudio. Recuerda
que la entrada $a_{i,j}$ en un MPM es el número (esperado) de individuos
en etapa $i$ en $t + 1$ por estadio $j$ individuo en el tiempo $t$. Si
la etapa $i$ es efectivamente un tipo de individuo 'recién nacido',
entonces $a_{i,j}$ debe incluir todos los procesos entre tiempo $t$ y
tiempo $t + 1$ (Caswell, 2001, p. 61). Rendimiento reproductiva, a su
vez, es un proceso demográfico compuesto del número de descendientes
producidos en un evento reproductivo y la supervivencia pertinente que
penalizará en cuanto al número de descendientes nuevos que alcanzarán a
la siguiente observación. El no tener en cuenta esta descomposición de
la tasa vital puede resultar en la introducción de un retraso por un
unidad de tiempo (en los términos del caso particular) en el ciclo de
vida del organismo, ya que la descendencia recién creada pasaría un
intervalo de proyección 'en limbo 'antes de su transiciones hacia
delante. El ejemplo más conocido está en el modelo clásico del cardo
*Dipsacus sylvestris*, de Werner y Caswell (1977), en el que las plantas
con flores en el momento $t$, pasaron a tener semillas en el tiempo
$t + 1$, y que éstas solo germinaron para formar plántulas en el tiempo
$t + 2$. Este tema fue discutido y corregido en Caswell (2001). Además,
este problema se ha reportado, por ejemplo, en estructuras
reproductivas, tales como semillas, que no forman parte de un banco de
semillas. Si se presenta este tipo de problema en un MPM, generalmente
(Kendall et al., 2019), pero no siempre (Nguyen et al., 2019), se
subestima la tasa de crecimiento γ de la población asintótica, y de allí
se enfrenta el desafío de estimar la importancia relativa del banco de
semillas y la vida útil de estas semillas aun no germinadas. El efecto
de parametrizar incorrectamente la fertilidad dentro de la tasa de
crecimiento γ es mayor en casos de crecimiento extremo, por ejemplo, en
especies invasoras, o, al contrario, disminución extrema, como la que
observamos en especies en peligro de extinción crítico (Rueda-Cediel et
al., 2018). Este fenómeno también puede causar una sobre-estimación de
la envoltura transitoria (ver Ezard et al., 2010). Por ello,
recomendamos especificar las fórmulas de la tasa vital de fecundidad en
conjunto con los MPM asociados e identificar claramente los valores de
estas tasas vitales subyacentes (como en el Recuadro 1).

### 3.4 \| Cálculo indirecto de tasas vitales {.unnumbered}

La estimación de las tasas vitales a menudo implica una combinación de
medidas directas e indirectas. La medición directa deriva empíricamente
las tasas vitales a partir de datos basados en individuos, donde se
censan los mismos individuos etiquetados varias veces, como en los
estudios de tablas de vida de cohortes, métodos de
captura-marcado-recaptura y muchos estudios de cuadrantes de plantas
marcadas. Sin embargo, las tasas vitales pueden ser difíciles de
observar en especies con altas tasas de reproducción, fenología compleja
y/o poblaciones pequeñas (Beissinger & Westphal, 1998). En consecuencia,
las estimaciones de reclutamiento a menudo se usan para complementar los
MPM desarrollados en condiciones controladas, por ejemplo, en el
laboratorio (Jouvet et al., 2018), en un invernadero (Gontijo &
Carvalho, 2020), en un zoológico (Clubb et al., 2009) o en un jardín
botánico (Jiménez-Valdés et al., 2010). Dado que algunos métodos para el
desarrollo de los MPM requieren de un ciclo de vida completo para
obtener las métricas clave (por ejemplo, métricas transitorias: Stott et
al., 2011), se tiende a utilizar sitios de estudio externos o fuentes de
la literatura para parametrizar los componentes que hacen falta para
'cerrar el ciclo' (Omeyer et al., 2021). Sin embargo, hay que tomar en
cuenta que las poblaciones cautivas o de alguna forma domesticadas
pueden no presentar la misma dinámica poblacional que la población
natural (Clubb & Mason, 2003), particularmente en relación a
supervivencia (Che-Castaldo et al., 2021) o reproducción (Clubb et al.,
2009).

Otro método para estimar indirectamente las tasas vitales consiste en
utilizar métodos ex situ para obtener los límites superior e inferior
del reclutamiento (u otras tasas vitales) y explorar los espacios
ocupados por los parámetros dentro de esos límites. Este enfoque fue
introducido por Caswell et al. (1998) en un estudio sobre los efectos de
la mortalidad por captura incidental en la marsopa común. Los
cronogramas de supervivencia y fertilidad específicos por edad se
seleccionaron de otras especies con ciclos de vida similares, se
reajustaron para que coincidieran con la longevidad de la marsopa común
y se usaron para producir distribuciones de incertidumbre para el
crecimiento de la población y los efectos de la captura incidental
medida. La información así generada de la distribución y los parámetros
asociados proporciona una medida de incertidumbre a partir de la cual
informar la construcción de un MPM (Tenhumberg et al., 2008). Además, el
uso de la jerarquía en los modelos para estimar los valores faltantes y
la fuerza de préstamo de otras poblaciones o especies pueden mejorar la
estimación de los parámetros (James et al., 2021; Tremblay & McCarthy,
2014).

Por último, los modelos poblacionales integrados representan un marco
valioso para estimar indirectamente las tasas demográficas y la dinámica
de la población (tamaño y estructura) mediante la combinación de fuentes
de datos, en particular la combinación de datos individuales
longitudinales con datos de censos poblacionales (Plard et al., 2019;
Schaub & Kéry, 2021). Los modelos de población integrados permiten la
construcción de modelos de población (incluyendo los MPM) mediante, (1)
la combinación de diversas fuentes de datos, (2) la definición de una
historia de vida a priori (a menudo se trata de algún tipo de modelo de
población estructurado por etapas) y (3) la cuantificación de la máxima
probabilidad de las tasas demográficas codificadas en la historia de
vida, y citando las fuentes de los datos. Los modelos de población
integrados son particularmente útiles cuando se conoce la incertidumbre
en torno a la adquisición de datos (por ejemplo, en estudios de
captura-marcado-recaptura) (Riecke et al., 2019).

### 3.5 \| Vector de población {.unnumbered}

Una estimación de la estructura de la población, clasificada por edad o
etapa, es una pieza útil de información cuando está disponible, pero no
siempre se cuenta con esta información. Tiene lógica utilizar la
estructura actual de la población como punto de partida para las
proyecciones de la viabilidad de la población a corto y largo plazo
(Werner & Peacock, 2019). Además, el utilizar la población vector (es
decir, abundancia y distribución de etapas) para las proyecciones ayuda
para tener en cuenta los efectos de la dinámica transitoria, que mide el
efecto de la estructura de población no estacionaria en tasas de
crecimiento de “near term” de las poblaciones (Capdevila et al., 2020).
Los vectores reportados de etapa o edad de la población reflejan dos
componentes clave: la estructura de población real en el censo en el
tiempo t y las opciones metodológicas. Este segundo componente es
fundamental para representar con precisión la población estudiada.

A través del desarrollo y curación de COMPADRE y COMADRE, hemos notado
dos fuentes de error que afectan la estimación de los vectores de
población. El primer error es un sesgo de detección, donde los
investigadores identifican ciertas etapas/edades con una mayor tasa de
detección que las etapas más crípticas (por ejemplo, plantas adultas
versus bancos de semillas). El segundo error es la apropiación indebida
de los métodos utilizados para cuantificar las tasas demográficas como
base para estimar la abundancia de etapa. Este segundo error proviene de
un malentendido de la diferencia entre estimar tasas y estimar números.
Para medir las tasas demográficas, durante un censo, los investigadores
a veces aumentan el esfuerzo de muestreo de ciertas clases de etapa/edad
en relación a otras. Este diferencia en el esfuerzo en relación a
etapa/edad es particularmente común cuando las clases de etapas/edades
tienen probabilidades de supervivencia cercanas a sus límites (es decir,
0 y 1). Por ejemplo, en la demografía de los árboles, normalmente solo
hay unos pocos individuos muy grandes por área examinada. Por lo tanto,
a menudo los investigadores complementan el tamaño de la muestra de esta
categoría al muestrear fuera del área predefinida (Jones y Hubbell,
2006). Sin embargo, muchos métodos para la estimación de tasas
demográficas no proporcionan ninguna información sobre números y
estructura de la población. Las tablas de vida de cohortes, que siguen a
una cohorte de individuos a medida que envejecen, son ciegos a la
estructura de la población en la que se desarrolla la cohorte. De hecho,
puede que no haya tal población (por ejemplo, toda la historia de
demografía basado en el estudio de cohortes realizada en laboratorio,
que se remonta a Pearl en la década de 1920 (Pearl et al., 1927). La
estimación de tasas mediante la técnica de captura-marcar-recaptura a
partir de datos longitudinales extrae toda su inferencia de los
individuos marcados y en ningún momento hace referencia al número y la
estructura de los no marcados. La literatura sobre métodos de
captura-marcar-recaptura para la estimación de tasas reconoce que
estimar el tamaño de la población es mucho más difícil que estimar las
tasas (Lebreton et al., 1992) y requiere diferentes modelos de
captura-marcar-recaptura (por ejemplo, la inclusión de la evaluación de
la respuesta hacía las trampas (dispuesto / renuente) en la estimación
de tasas vitales.

### 3.6 \| Omitir etapas de vida crípticas {.unnumbered}

La identificación y estimación de tasas vitales en etapas crípticas
representa un reto en ecología de poblaciones. Se determinan las etapas
crípticas como puntos a lo largo del ciclo de vida de un organismo que
están, de una forma u otra, ocultos o se pasan por alto por ecologistas
de poblaciones al construir modelos de población (Doak et al., 2002).
Una etapa de la vida puede ser críptica porque es logísticamente difícil
de observar, o, aunque si es observable, a su vez es indistinguible de
otra etapa (Nguyen et al., 2019). En las plantas, etapas crípticas
pueden surgir de los bancos de semillas, como en el caso de las
orquídeas, donde las semillas son demasiado pequeñas para ser observadas
e identificadas en el campo (Paniw et al., 2017) o algunas perennes
herbáceas (por ejemplo, *Astragulus scaphoides*) donde períodos de
latencia vegetativa permiten que los individuos permanezcan escondidos
bajo tierra durante una o más temporadas de crecimiento (Gremer & Sala,
2013). Además, los animales pueden exhibir etapas crípticas al pasar por
diapausa o retrasos en el desarrollo debido a condiciones ambientales
adversas (p. ej. *Aedes albopictus*: Jia et al., 2016). Aves marinas
pelágicas (albatros, petreles, pingüinos) a menudo pasan etapas
pre-reproductivas en el mar, a veces de duraciones de muchos años, y al
ser así, se mantienen completamente crípticas hasta volver a la colonia
reproductora como adultos. Métodos sofisticados de marcado-recaptura
multi-estado pueden proporcionar estimaciones de parámetros para estas
partes del ciclo de vida (p. ej., Jenouvrier et al. (2018), usando el
algoritmo de eventos múltiples de Choquet et al. (2009)). Omitir una
etapa críptica de la vida puede reducir la realismo biológico de un MPM
y alterar el número de etapas en el MPM, que, en su conjunto puede
impactar aún más los resultados demográficos (Salguero-Gómez y Plotkin,
2010; Tenhumberg et al., 2009). En algunos casos, las etapas de la vida
crípticas solo se identificarán a través de un enfoque
multidisciplinario. incluyendo métodos de campo y de laboratorio, junto
con marcos bayesianos para integrar datos y conocimientos previos (por
ejemplo, Paniw et al., 2017).

### 3.7 \| Modelos de uno versus dos sexos {.unnumbered}

Gran parte de la demografía se centra en las hembras, bajo los supuestos
que la fertilidad está determinada por las hembras sin limitación por
los machos (ver Caswell, 2001, p. 568). Dichos modelos pueden incluir
machos (por ejemplo, Hunter et al., 2010), pero si la reproducción está
determinada por las tasas femeninas (es decir, dominado por la etapa de
hembras). Los machos representan un conjunto de etapas que no
contribuyen al crecimiento de la población. La mayoría de los MPM de
animales existentes están a base de hembras y femenino dominante
(Salguero-Gómez et al., 2016) dados sesgos de muestreo hacia mamíferos y
aves (Conde et al., 2019), a menudo no es factible, o necesario para la
pregunta de investigación, rastrear interacciones reproductivas
masculinas (Archer et al., 2022). Estos estudios, por lo general, asumen
una proporción de sexos 1:1, y las tasas vitales son congruente por sexo
y la reproducción no es limitada por los machos de la especie
(Compagnoni et al., 2017; Miller & Compagnoni, 2022). Mientras que un
sexo los modelos son comunes en animales MPM'S (actualmente 77% en
Comadre v. 4.21.8), se debe tener cuidado no hacer suposiciones sobre la
relación sexual dinámica dependiente dentro estos sistemas (Archer et
al., 2022). De hecho, estos supuestos no pueden ser cumplido cuando
cualquiera de los siguientes es cierto: que haya un sesgo en la
proporción de sexos (Archer et al., 2022), hay reproducción sesgadas
(Sky et al., 2022), o un alta sensibilidad de la dinámica de la
población en respuesta a la elección de apareamiento (Veran y
Beissinger, 2009). Además, la detectabilidad de los diferentes sexos en
el muestreo dependiente del sexo puede confundir más las estimaciones de
la relación sexual y sus inpactos asociados sobre las tarifas vitales si
no se tiene en cuenta. Los modelos de dos sexos que no asumen la
dominancia por un sexo no son lineales y requiere especificaciones de
una función de apareamiento que describe la fertilidad en función del
macho y la abundancia hembras (Caswell, 2001). La definición de tales
funciones de apareamiento es generalmente difícil o imposible, excepto
en casos específicos como la estricta monogamia (Jenouvrier et al.,
2010).

Informar sobre las proporciones de sexos puede expandir enormemente el
alcance de un estudio (Shyu & Caswell, 2016a, 2016b); Por ejemplo,
evaluar el impacto de la razón de sexo cuando hay efecto Allee (Boukal y
Berec, 2002). Desafortunadamente, este tipo de análisis es raro y pocos
ejemplos son notado en la bases de datos de COMPADRE y COMADRE. Además,
si hay diferencias en los valores de la tasa vital entre sexos, como
supervivencia, crecimiento y/o producción reproductiva en los modelos
basado en un sexo solamente los MPM puede omitir procesos importantes
(Archer et al., 2022; Caswell, 2001, p. 568). En plantas, ejemplos de
investigaciones que incluye la dinámica de dos sexos raro (0.2% en
COMPADRE v. 6.22.5). Este bajo porcentaje probablemente refleja en parte
la rareza de la plantas dioecía u otros sistemas de apareamiento con dos
o más sexos (Käfer et al., 2017) y los sistemas de apareamiento
polígamos que hace que la reproducción y la dinamica poblacional
limitado a los macho es raro (ver Compagnoni et al., 2017; Miller y
Compagnoni, 2022).

### 3.8 \| Irreductibilidad y ergodicidad {.unnumbered}

Las propiedades de la irreductibilidad tiene implicaciones sobre la
diversidad de eigenvalue de una matriz y, por lo tanto, interpretaciones
biológicamente relevantes (e.g. tasas de crecimiento de la población,
estructuras de etapa estable). Estas implicaciones son bien conocidos en
la literatura sobre MPM (Caswell, 2001). Matriz que son irreducible son
aquellas en la que el gráfico del ciclo de vida está completamente
conectado; es decir, existe una ruta directa o indirecta desde cualquier
etapa a cualquier otra etapa. A veces se afirma que los MPM reducibles
son de alguna manera inválido; ellos no son inválido. Hay (al menos)
cuatro situaciones en que matrices reducibles ocurren naturalmente.

1.  Ciclos de vida con etapas post-reproductiva. Las etapas
    post-reproductiva no pueden contribuir a la potencialmente
    reproductiva (por ejemplo, MPM's para humanos, *Orcas*).
2.  Modelos de dos sexos dominado por un sexo (generalmente mujeres,
    pero podría ser hombre). En un modelo dominado por hembras, toda la
    reproducción es acreditado a las mujeres. Los machos son producidos
    por las hembras, pero los machos no hacen contribución a la parte
    femenina del ciclo de vida (por ejemplo, Hunter et al. (2010) para
    osos polares).
3.  Modelos espaciales en los que la dispersión es un direccional, como
    en los sistemas fluviales (ríos) o corrientes oceánicas.
4.  En los modelos de Edad × Etapas (Caswell, 2009; Caswell y
    Salguero-Gómez, 2013). En estos modelos, la reproducción produce
    (por definición) individuos en la clase de edad 1, pero el modelo
    incluye todo combinaciones de edad y etapa, incluidas combinaciones
    imposibles de edad de clase 1 y etapas que no existen a los 1 años.

La reductibilidad puede o no ser fácil de detectar desde el gráfico del
ciclo de vida, pero se puede evaluar numéricamente. La matriz **A** es
irreducible si y solo si la matriz $\left(I+A\right)^{s-1}$ es positiva
(Caswell, 2001). La irreductibilidad, junto con la primitividad, es una
condición suficiente para Ergodicidad, garantizando que la población
convergerá a la misma estructura estable independientemente de la
condición inicial. Una matriz reducible puede no tener esta propiedad;
claramente, por ejemplo, si una población comenzó con un solo individuo
post-reproductivo no convergerán a la misma estructura que uno comenzó
con algunos pre-reproductivos individuos. Con respecto a la ergodicidad,
también se sabe que un MPM es ergódico si y solo si todas las entradas
de su vector propio dominante izquierdo (v) son positivos (Stott et al.,
2010). En resumen, a pesar del modelo apropiado estructura y
parametrización correcta, los datos demográficos pueden conducir a
matrices reducibles y/o no ergódico.

### 4 \| Representación completa de un MPM en publicaciones {.unnumbered}

En esta sección, justificamos la necesidad de una presentación clara de
MPM's en la literatura científica, sugerencias dónde archivar los MPM's
en base da datos de acceso abierto, y discutir cómo estas dos acciones
benefician a los autores, revista editorial, lectores, demógrafos
comparativos, meta-analistas y la disciplina en general. Una tabla que
contiene la lista de los datos a incluir al publicar MPM's junto con una
justificación para la inclusión. Se pueden encontrar ejemplos de buenas
prácticas en Tabla S1.

### 4.1 \| Partición de los procesos demográficos {.unnumbered}

Es importante definir a que se refiere cada elemento de una matriz de un
MPM's. Varios procesos demográficos pueden superponerse al mismo
elemento matriz en un MPM, particularmente en especies con un rápido y/o
variable ciclo de vida relativo a los intervalos de proyección del MPM.
Por ejemplo, el parámetro en un MPM que representa el enlace entre
individuos grandes en el tiempo $t$ y individuos más pequeños en el
tiempo $t+1$ podría corresponder a la reproducción sexual, reproducción
clonal, fisión, retroceso o un conjunto de los procesos anteriores. Las
derivaciones matemáticas de parámetros clave de la historia de vida (por
ejemplo, generación el tiempo, la esperanza de vida, la tasa de
senescencia, el grado de iteroparidad) requieren que estos procesos
están claramente separados (Jones et al., 2022). Esto separaciones es
crítica para la familia de análisis basados en las cadenas de Markov; la
matriz U define las transiciones de estado transitorio en un análisis de
Chain de Markov absorbente (Caswell, 2011, 2013). Claramente
describiendo la estructura subyacente de las tasas demográficas en un
diagrama del ciclo de vida y su consecuente modelo de población de la
matriz completa **A**, se puede separar matrices en los procesos de
supervivencia (por ejemplo, progresión/crecimiento, retroceso/
contracción, fisión, fusión, estasis) en la submatriz **U**, una matriz
de reproducción sexual en el submatriz **F** y la reproducción clonal en
la submatriz **C** (Figura 4). Es importante destacar que tanto que las
matrices de **F** y **C** incluye elementos que deben incorporar la
supervivencia de acuerdo con el tipo de censo (es decir,
pre-/post-reproductivo censo).

Informando claramente la matriz **A** y las submatrices **U**, **F** y
**C** se lleva dos beneficios clave: (1) indica explícitamente cómo se
generan los valores de la matriz **A** de tasas vitales subyacentes; y
(2) los submatrices pueden ser utiliza para calcular una gran gran
cantidad de medidas demográficas que no pueden calcularse a partir de
solamente la matriz **A**, como la longevidad (promedio y varianza),
tiempos de ocupación (promedio y variaciones), la distribución de la
reproductiva de por vida de los individuos (promedio y variaciones),
taza de reproducción neta, tiempo de generación y entropía (KeyFitz
Entropy (KeyFitz, 1968) y la entropía de Demetrius (Demetrius, 1992)
entre otros.

### 4.2 \| Atribución de fuentes de datos secundarias {.unnumbered}

Las fuentes de datos secundarias son críticas para la reproducibilidad.
Las fuentes de datos proporcionan información y soporte para las
metodologías utilizadas en la construcción MPM. En algunos casos, los
MPM simplemente usan datos secundarios para estimar algunos parámetros
del ciclo de vida, mientras que otros se construyen puramente de fuentes
secundarias (ver Tabla S1). Las fuentes secundarias incluyen estudios
previos, datos de bases de datos, simulaciones, observaciones indirectas
y estimaciones teóricas. El uso de fuentes de datos secundarias puede
significar que el MPM final no representa con precisión las tasas de
razón vitales, y así debe reconocerse en la sección de métodos de la
publicación o su información de apoyo. La comunicación de fuentes
secundarias debería ser suficiente para determinar su proveniencia e
incluye la fuente de los datos, si se estimó un punto, el intervalo de
confianza o la distribución y como se integró con la fuente de datos
primaria, así como la justificación de su inclusión. Por ejemplo, Omeyer
et al. (2021) presenta una tabla de fuentes de datos utilizadas en la
construcción de MPM. Si estas fuentes secundarias no se reconocen en
conjunto con el MPM, los inferidos procesos demográficos, por realista
que sean, pueden no pasar revisión por pares ni aceptada de la comunidad
científica. A su vez, la comunicación clara de estas fuentes secundarias
es muy recomendable.

### 4.3 \| Archivando los datos en COMPADRE y COMADRE {.unnumbered}

Proponemos que las bases de datos de la matriz de COMPADRE y COMADRE
proporcione la forma más adecuada de archivar y acceder a MPM's.
Mientras reconocemos que hay otros repositorios de bases de datos
ecológicas (por ejemplo, Dryad: \<<https://datadryad.org/>\>; figshare:
\<<https://figshare.com>\>; Zenodo: \<<https://zenodo.org>\>), la base
de datos de COMPADRE COMADRE de acceso abierto
(\<<https://compadre-db.org/Contribute>\>) proporciona una plataforma de
archivo de datos dedicada, específicamente para MPM's, que permite
contribuciones directas de los investigadores y la digitalización de MPM
publicados por nuestros equipos de validación de datos. La integración
de un portal usando una pagina web para la entrada de datos proporciona
un proceso de curación de datos estructurado (es decir, desde la
detección, la estandarización, hasta la validación) que pueden acomodar
MPM de diferentes dimensiones y diversas historias de vida. Al ingresar,
los MPM se complementan con variables biogeográfico relevante y detalles
sobre la metodología del censo en COMPADRE y COMADRE. Detalles de la
publicación original, incluyendo **doi** y citas funcional (ver
\<<https://compadre-db.org/Education/article/obtaining-references>\>
donde se almacenan junto con cada MPM para garantizar que su
contribución a cualquier publicación futura es reconocida. Todos los
datos están archivados a largo plazo a través de Oxford Open Access y
con apoyo de la Biblioteca Bodleian.

Otras mejoras recientes integradado a COMPADRE y COMADRE ayudará aún más
a la comunidad de cientfica. Anteriormente, las bases de datos solo eran
accesibles a través de la descarga de un archivo **R-Object** que
contenía todas las matrices en esa versión de la base de datos. La base
de datos es ahora accesible a través de un sitio web
(\<<https://compadre-db.org/QueryDatabase>\>) que permite a los usuarios
encontrar y descargar matrices individuales. También nos esforzamos por
empoderar a los investigadores y educadores con materiales de enseñanza
(\<<https://compadre-db.org/Education>\>) y la producción de nuevos
paquetes R (Jones et al., 2022) para facilitar escalabilidad de MPM
investigación. Junto con estos materiales, todos los detalles de la
estructura de la base de datos y el flujo de trabajo son de acceso libre
(\<<https://jonesor.github.io/CompadreGuides/user-guide.html>\>). Estas
mejoras en las bases de datos y su estructura de interfaz ha sido
directamente dirigido a equipar a los demógrafos con más herramientas
para realizar investigaciones y capacitar a los estudiantes en MPM's
junto con el mejoras en transparencia de la base de datos para
garantizar buenas prácticas en la investigación.

### 5 \| Un protocolo estandarizado para reportar MPM's {.unnumbered}

Aquí presentamos una lista de verificación propuesta sobre cómo reportar
un MPM en publicaciones (Recuadro 1). Recomendamos utilizar la lista de
verificación cuando diseñar la recopilación de datos, así como al
redactar el MPM para publicación. Recomendamos utilizar esta plantilla
como apoyo de la información necesaria para los MPM ya que permite una
comunicación clara de la construcción de los modelos además de la
facilidad para integrar publicaciones MPM a las bases de datos COMPADRE
y COMADRE.

### 6 \| La teoría non es estática: la no linealidad, dependencia del medio ambiente y los modelos de múltiple estados.

Los MPM se han convertido en un enfoque predominante en la lista de
herramientas en el estudio de ecología de población en parte debido a su
simplicidad de construcción y análisis. Pero la teoría subyacente basada
en matrices para estudiar demografía no se detiene y en los últimos 20
años ha aumentado espectacularmente. Estos nuevos métodos producen
modelos cuya estructura no se ajusta en los marcos para la presentación
de informes que parecían tan completos en el pasado. Estos avances
recientes en la teoría y los métodos de MPM permiten investigadores
vincular la dinámica demográfica y el efecto del medio ambiente sobre la
demografía y múltiples rasgos individuales (por ejemplo, sexo y edad)
(Childs et al., 2016); edad y parentesco (Caswell, 2019b, 2020)) en
lugar de un solo rasgo de la especie. Estos avances también ofrecen
beneficios para el estudio de respuestas de la población al clima
extremo (Jenouvrier et al., 2022), en adición de investigaciones
demográfica más matizadas de aspectos comparativos y evolutivos (Childs
et al., 2016). En esta sección repasamos algunas áreas interesantes de
demografía estructurada que pueden abrir nuevas preguntas de
investigación para el demógrafo y enumerar algunas de las desafíos que
plantean para la comunicación y la presentación de informes.

### 6.1 \| Modelos no lineal

Los MPM no lineales son aquellos en los que las entradas de la matriz de
proyección dependen del estado de la población (números y estructura) y
pueden ser influenciado por la frecuencia o la densidad
denso-dependiente. Los modelos que son influenciado por la densidad de
frecuencia no lineal dependen sólo de la relativa abundancia de etapas;
ellos ocurren en los modelos de dos sexos en los que el apareamiento
depende de la relación abundancia de machos y hembras, y en modelos
genéticos de poblaciones donde la dinámica depende de la abundancia
relativa de genotipos (de Vries y Caswell, 2019). Los modelos
denso-dependiente dependen de la abundancia y estructura de la
población; ejemplos recientes incluyen a Pardini et al. (2009) y Shyu et
al. (2013) para análisis de estrategias de control de la mostaza con ajo
*Alliaria petiolata* y de Vries. et al. (2020) para estudios de
laboratorio de resistencia a pesticidas en *Tribolium*.

Los análisis de MPM no lineales se centra en los resultados demográficos
diferentes a los de los modelos lineales; equilibrios, atractores,
bifurcaciones, oscilaciones y estabilidad (ver Caswell, 2001, Capítulos
16 y 17, y Cushing et al., 2003 para el análisis más detallado). Sin
embargo, ¿qué hace que estos modelos sean problemáticos para la
situación actual? El estatus de COMPADRE y COMADRE es que la unidad del
modelo no es una matriz, sino más bien una función matricial, en la que
las entradas de la matriz de proyección son funciones del estado de la
población. Los análisis de sensibilidad están disponibles para estudiar
prácticamente cualquier grupo demográfico resultado en respuesta a
cualquier parámetro (Caswell, 2019a), pero informar las funciones que
definen el MPM no lo es en absoluto estandarizado.

### 6.1 \| Dependencia del Ambiente

Un problema similar surge en entornos dependientes del medio ambiente.
En algunos modelos, algunas o todas las tasas demográficas son funciones
de algunos aspectos del medio ambiente; por ejemplo, los osos polares
como funciones de los parámetros estadísticas del hielo marino del
Ártico (Regehr et al., 2010), los sifaka de Madagascar como funciones de
lluvia (Lawler et al., 2009), el pingüino emperador en función de los
patrones estacionales del hielo marino en la Antártida (Jenouvrier et
al., 2012) y la ballena franca del Atlántico norte en función del tiempo
y de las tendencias en el tiempo (Fujiwara y Caswell, 2001). Al igual
que con los MPM no lineales, el modelo no es una matriz, sino una
función que se mapea desde las variable(s) ambientales a las entradas de
la matriz. Los protocolos para informar dichas funciones aún no están
disponibles pero es importante desarrollarlas.

### 6.3 \| Modelos de múltiples estados

Un área emergente en la investigación demográfica es la construcción y
análisis de MPM multiestatales, en los que se clasifican los individuos
por más de una variable de estado. Esto incluye edad y etapa. (Caswell y
Salguero-Gómez, 2013), escenario y localización espacial (Hunter &
Caswell, 2005), estadio y genotipo (de Vries & Caswell, 2019), estadio y
estado de infección (Klepac & Caswell, 2011), edad y heterogeneidad no
medida (Hartemink et al., 2017) y etapas específicas de incidencia de
enfermedades (Caswell y Van Daalen, 2021). Una presentación detallada de
los métodos se se encuentra en (Caswell et al., 2018) y la extensión a
más de dos ejes estatales (los llamados matrices de hiperestado) se
proporciona en (Roth & Caswell, 2016). La incorporación de estados
adicionales permite a los investigadores separar varias fuentes de
información individual de heterogeneidad, la varianza en la historia de
vida de los individuos del mismo modelo poblacional y sus resultados, en
adición de plantear comparaciones más profundas y preguntas evolutivas.
Por ejemplo, la edad materna tiene un fuerte impacto en las tasas
vitales en rotíferos monogonones (Bock et al., 2019). Aplicando métodos
de permutación-vec (Caswell, 2012) para construir MPM multi-estatales
han permitido a los investigadores cuantificar el nivel de población
impactos del efecto observado de la edad materna e investigar los
procesos evolutivos que pueden conducir a este tipo de senescencia en
rotíferos (Hernández et al., 2020). MPM multidimensionales y los métodos
de la cadena de Markov han sido particularmente importantes en el
estudio de la "suerte" en las historias de vida, que explora por qué
algunos individuos viven mucho tiempo y prosperan, mientras que otros no
(Snyder & Ellner, 2018). En estudios de "suerte", la variación entre
individuos en la historia de vida se divide en contribuciones de la
variación entre grupos y dentro del grupo (por ejemplo, Snyder & Ellner,
2018; van Daalen & Caswell, 2017). Ejemplos de fuentes de heterogeneidad
individual incluyen edad materna (van Daalen et al., 2022), año de
nacimiento ambiente (Snyder & Ellner, 2022) y variación genética
(Steiner et al., 2021). El efecto de la variación dentro se llama
estocasticidad individual o "suerte" y surge del hecho de que las tasas
vitales son procesos probabilísticos.

Estos modelos plantean un desafío para la presentación de informes
porque el MPM no consta de una única matriz, sino de cuatro conjuntos de
matrices. Considerar un modelo clasificado como edad × etapa. Esos
modelos son compuesto por un conjunto de matrices dando transiciones
entre etapas para cada clase de edad, un conjunto de matrices D
asignando transiciones de edad para cada etapa y un conjunto de matrices
F que asignan transiciones de edad específicas para cada etapa de
fecundidad, y un conjunto de matrices H que asignan crías recién nacidas
a las edades apropiadas. Estos están ensamblados en matrices de
transición y fertilidad estructuradas en bloques a partir de las cuales
todos los resultados demográficos habituales se pueden calcular y
relacionar con tanto la edad como la etapa (por ejemplo, ver Caswell y
Salguero-Gómez (2013) para un análisis de gradientes de selección tanto
para edad como para tamaño).

### 7 \| Discusión

La investigación demográfica ha avanzado mucho desde la introducción de
los estudios demográficos a base de edad (Leslie, 1945) y modelos
matriciales basado en etapas (Lefkovitch, 1965). Los avances en este
campo se han visto impulsados en parte mediante una comunicación clara
de los métodos y el código asociado. Deseamos continuar expandir el uso
de esas herramientas con la comunicación de MPM.

A medida que la profundidad y amplitud de la literatura continúa
expandiéndose, estamos empezando a construir una imagen integral de la
demografía y explorar el espectro de la vida biologica (Adler et al.,
2014; Healy et al., 2019; Salguero-Gómez et al., 2017). A través de la
base de datos de COMPADRE y COMADRE, hemos llegado a apreciar la
utilidad y oportunidades de una forma estandarizada de compilar MPM. De
hecho, una parte importante del tiempo (\>50%) que dedicamos a curar
estas bases de datos en realidad no se trata de digitalización,
verificación de errores, y complementar datos, sino en contactar a los
autores para obtener aclaraciones y solicitud de datos y metadatos
faltantes. A través de este arduo proceso, hemos identificado valiosas
información en MPM que no estaba en las publicaciones originales. Si
bien los datos faltantes se destacan aquí como particularmente
importante y refleja principalmente los intereses y perspectivas de
demógrafos comparativos, incluidos los datos descritos en el métodos
estandarizado qué beneficiaría a la demografía en su conjunto.

Este artículo pretende actuar como una referencia útil para autores,
editores, revisores, gestores/conservacionistas y demógrafos
comparativos. Además, esperamos que este manuscrito promueva una
discusión constructiva sobre el propósito, la construcción y la
presentación de información demográfica a base de etapas. El cuadro 1
contiene un ejemplo completo de la información clave que creemos que
debería incorporarse a la publicación de cualquier MPM. Al adoptarse los
métodos que se sugiere aquí, habrá claros beneficios para el crecimiento
de las bases de datos demográficas COMPADRE y COMADRE; sin embargo,
creemos que estos beneficios se extienden más allá de COMPADRE y
usuarios de COMADRE hacia todo el campo de la ecología de poblaciones y
campos que utilizan MPM para su propia beneficio (por ejemplo,
conservación biología y monitoreo de la biodiversidad). Un mayor nivel
de detalle y transparencia al describir cómo y por qué se produce un MPM
dará como resultado una mayor precisión, accesibilidad, reproducibilidad
y citabilidad; eso tiene claros beneficios para el campo en su conjunto
y para los investigadores. Además, una mayor coherencia y transparencia
facilita la revisión por pares y, de hecho, estas directrices pueden
ofrecer una herramienta que puede ser citada por editores asociados y
revisores por pares y puede ser recomendado como guia para los pasos
sugeridos aquí. Además, la adopción de los pasos sugeridos aquí puede
aumentar confianza en los resultados presentados y facilitar el
aprendizaje/adopción de MPM por investigadores que inician su carrera.

Finalmente, cerramos con una precaución. Hemos utilizado el término
"preciso" en puntos a lo largo de este documento, aplicados a los MPM,
pero debemos reconocer que no existe un modelo exacto, ya sea un MPM o
cualquier otro tipo. Un modelo es una serie de selección de parámetros,
selección de aspectos o variables que se incluyen y otros que no se
incluye. La selección de modelos como técnicas de selección como AIC
(Akaike Information Criterion; Anderson & Burnham, 2002) hacen estas
opciones explícitas y miden su apoyo en términos de probabilidad. Pero
incluso sin utilizar el método estadístico explícito, el mensaje es
claro. La opciones de "i"-estado/variables, de intervalos de proyección,
de tipos de variación temporal, de dependencia funcional de un conjunto
elegido de factores ambientales, etc., todos ellos son inexactos. La
cuestión no es buscar la precisión: es ser claro al comunicar las
decisiones que tomó al construir el modelo, los análisis usted eligió
aplicar y la interpretación de los resultados. Una modelo 'precisa' de
un sistema ecológico, experimental u observacional sería tan complicado
como un sistema real. Eso no termina bien (Borges, 1999).

<!--chapter:end:18-Traduccion_protocolo_informacion.Rmd-->

# Dinámica espacial y temporal de Encyclia bocourtii después de 15 años en la Península de Guanahacabibes, Cuba


Por: Ernesto y Elaine




<!--chapter:end:19-Encyclia_bocourtii.Rmd-->

# Nhora


Por: Nhora




<!--chapter:end:20-Nhora_Dracula.Rmd-->

# Impactos de datos sin sentido sobre los análisis de dinámica poblacional

Por: Raymond L. Tremblay


```{r}
if (!require("pacman")) install.packages("pacman")
pacman::p_load("DiagrammeR", "Rage", "popdemo", "popbio", "interpretCI", 
               "MCMCpack", "ggplot2", "plyr", "reshape")

```


El valor principal de los estudios científicos proviene en que los datos representa una visión suficiente cerca a la realidad y sirve para inferir información sobre la ecología de la especie de interés. En ningún estudio ecológico se podrá obtener **TODOS** los datos para evaluar la relación biótica y abiótica sobre un organismos y todas sus interacciones.   Ese modelo es primero demasiado complejo y irreal dentro del concepto de los trabajos científicos. El objetivo es tener una apreciación de los parámetros más importante para definir un cierto patrón o interacciones. Por consecuencia la base de todo estudios esta fundado en las unidades de los muestreos y de la recolección de datos. Si los datos no representa la realidad del estudio la interpretaciones de los análisis pudiese ser errónea. La matemática y sus ecuaciones y modelos no harán que la biología sea más cerca a la realidad si desde el principio los datos y el método de recolección de datos es erróneo.  

En esta sección evaluamos diferentes aspectos de los análisis matriciales poblacional de projección y diferentes aspectos de la recolección de datos que pudiese ser problemáticos cuando uno considera la biología de una especie. La lista de "Impactos" no pretende incluir todos las posibles efecto de datos sin sentido, sino unos ejemplos si uno no considera estos problemas y cómo pueden distorsionar las interpretaciones. Por lo tanto, una advertencia a todos los biólogos de población para que estén consciente de estos temas.

***

## Tamaño de muestra pequeño o eventos raros

Sin duda, el tema principal para el uso de PPM ha sido evaluar la proyección de población de especies raras o en peligro de extinción (otras cuestiones son ecológicas o evolutivas) (ref). En consecuencia, las especies raras o en peligro de extinción son naturalmente pequeñas y reduce el tamaño de la muestra del estudio o de algunas de las etapas/edades de la vida. Estos tamaños de muestra reducidos provocan estimaciones de parámetros y, a menudo, resultados sin sentido biológicos.


***

### Sin Mortalidad/Supervivencia Perfecta

Considere una especie donde se recopilan datos de una especies **Sp1** y la matriz de transición **Sp1matU** es la siguiente y la matriz de fertilidad es **Sp1matF**. Tenga en cuenta que ninguno de los individuos murió en la etapa adulta (supervivencia perfecta). En consecuencia, el tamaño de la población nunca disminuye o aumenta después de un período de tiempo. Bajo TODOS los modelos biológicamente realistas, esperaríamos que el tamaño de la población comenzaría a disminuir si una población no tiene reproducción.  Pero en este caso como todos los individuos de la etapa sobreviven la población es *eterna* (algo irreal).  


```{r}
library(DiagrammeR)

Sp1matU <- rbind(
  c(0.0, 0.0, 0.0),
  c(0.5, 0.3, 0.0),
  c(0.0, 0.4, 1.0)
) # transition matrix

Sp1matF <- rbind(
  c(0.0, 0.0, 1.0),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA = Sp1matU+Sp1matF # TF matrix
library(Rage)
stages <- c("plantula", "juvenil", "adulto")

plot_life_cycle(Sp1matU, stages=stages, fontsize = 0)
```

Así si analizamos esta matriz asumimos que ninguno de los individuos en etapa adulta muere, en ningún momento!!!. Claramente esto no es realista. Para cualquier especie, la probabilidad de muerte en cualquier etapa nunca es cero (aunque podría ser muy pequeña) y, por lo tanto, nuestra matriz no tiene sentido. Considere una especie de árbol, como *Sequoia*, es probable que para los árboles grandes de esta especie la supervivencia sea muy alta entre un año y otro, pero nunca del 100%.  Hay que deferenciar entre lo que se observa en periodo y las probabilidades a largo plazo. Es possible que en el sitio de muestreo NO se observo mortalidad de los arboles grandes entre dos periodos de muestreo, que resultaria en una mortalidad de zero pero no es un valor real a largo plazo. 

En el siguiente *script* mostramos que la población no cambia después de 5-6 periodos y se mantiene cercana a uno y no cambia nada (usamos la matriz de transición sin fecundidad). Si no hay reclutas (matriz de fertilidad), el tamaño de la población debería reducirse con el tiempo. Todo modelos de transiciones que no incluye la matriz de fertilidad debería resultar en reducción de tamaño poblacional. 



```{r}
n=c(5,5,5)

library(popdemo)
library(popbio)
truelambda(Sp1matU)
pop.projection(Sp1matU, n=n)$pop.changes
```


####  Suponga un pequeño cambio en la mortalidad.


Tenga en cuenta que en este nuevo modelo, aunque la tasa de supervivencia es muy cercana a cero (0,995) y, por consecuencia, es posible una disminución de la población en cada período de tiempo (aunque solo sea en una pequeña fracción). Siempre hay que considerar si esta taza de mortalidad es biologicamente real o es un resultado del tamaño de la muestra.  Este valor sugiere que se muestreo 1000 individuos y que 995 sobrevivieron.   Si el tamaño fue de 1000, uno pudiese tener confianza en el parámetro.  

```{r}
Sp1matU_2 <- rbind(
  c(0.0, 0.0, 0.0),
  c(0.5, 0.3, 0.0),
  c(0.0, 0.4, 0.995)
) # transition matrix

Sp1matF <- rbind(
  c(0.0, 0.0, 1.0),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA_2=Sp1matU_2+Sp1matF

pop.projection(Sp1matU_2, n=n)$pop.changes

```

***

### Irreductibilidad: No hay transiciones entre etapas

En el escenario actual, los juveniles no crecen para convertirse en adultos, todos los juveniles siguen siendo juveniles o mueren. Tenga en cuenta la figura del ciclo de vida donde no hay flechas que conecten a los juveniles con los adultos.

```{r}
library(DiagrammeR)

Sp1matU_NT <- rbind(
  c(0.0, 0.0, 0.0),
  c(0.5, 0.7, 0.0),
  c(0.0, 0.0, 0.995)
) # transition matrix

Sp1matF <- rbind(
  c(0.0, 0.0, 1.0),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA_NT = Sp1matU_NT+Sp1matF # TF matrix
library(Rage)
stages <- c("plantula", "juvenil", "adulto")

plot_life_cycle(Sp1matU_NT, stages=stages, fontsize = 0)
```


Como lo muestra @caswell2000matrix y explorado más recientemente por @stott2010, las matrices deben de ser *irreducibles*. El concepto de *irreductibilidad* está asociado con el ciclo de vida de la especie y la matriz incluye las transiciones de todas las etapas a todas las demás etapas. A la figura del ciclo de vida anterior le faltan dos componentes importantes en la historia de vida de la especie, ningún juvenil crece para convertirse en adulto y ninguno de los adultos produce plántulas (semillas que crecen hasta convertirse en plántulas).

Una manera fácil de determinar si la matriz es irreducible es correr el siguiente script *isIrreducible* en el paquete (popdemo). Tenga en cuenta que, en este caso, el resultado es *Falso* para la matriz anterior.


```{r}
isIrreducible(Sp1matU_NT) # para la matriz de transición, faltando una etapa de transición y fertilidad
isIrreducible(Sp1matA_NT) # para la matriz TF, falta una etapa de transición

# Ahora considerando Sp1matA_2

isIrreducible(Sp1matA_2) # incluye todas las transiciones y la fertilidad
```


***

### Ninguna supervivencia

La mortalidad es uno de los estadios del ciclo de vida de una especies, pero raramente se añade al ciclo de vida porque es implícito en los cálculos. A menudo se observa que la supervivencia de los individuos más pequeños o la primera etapa del ciclo de vida de una especie es muy arriesgada, donde la probabilidad de supervivencia es muy baja. Por ejemplo, la mayoría de las semillas no sobreviven para germinar. Esta es probablemente la norma en las orquídeas donde la producción de semillas es muy alta (a veces millones de semillas en una cápsula de semillas, es decir, *Catasetum*; ref), pero pocas germinan (ref). Sin embargo, esto no se limita a las orquídeas, en los árboles se puede observar el mismo patrón, por ejemplo, en *Nothofagus pumilio* el reclutamiento de plántulas fue inferior al 1,5 % @torres2015seed.  NEED Other EXAMPLES OF NO SEED OR SEEDLING RECRUITMENTS.   


Como es bien sconocido, la germinación de semillas en las orquídeas no es sencilla y muchas variables pueden influir en la germinación de semillas @rasmussen2015germination .......  más detalle sobre lo que se conoce y lo que no se conoce...

En el gráfico del ciclo de vida actual, ninguna de las plántulas sobrevive o crece a la siguiente etapa. Tenga en cuenta que en la primera columna de la matriz de transición todos los valores son cero. La población puede haber comenzado con muchas (incluso miles) de plántulas, pero ninguna creció hasta convertirse en un juvenil o permaneció como plántula antes del siguiente muestreo. Esto da como resultado una matriz que es reducible *isIrreducible* = *FALSO* y en consecuencia no cumple con los requisitos necesarios.


```{r}
library(DiagrammeR)

Sp1matU_NS <- rbind(
  c(0.0, 0.0, 0.0),
  c(0.0, 0.7, 0.0),
  c(0.0, 0.25, 0.995)
) # transition matrix

Sp1matF <- rbind(
  c(0.0, 0.0, 1.0),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA_NS = Sp1matU_NS+Sp1matF # TF matrix
library(Rage)
stages <- c("plantula", "juvenil", "adulto")

plot_life_cycle(Sp1matU_NS, stages=stages, fontsize = 0)

isIrreducible(Sp1matU_NS)
```


## Redondeo excesivo de valores

Uno de los errores más simples en la construcción de los elementos de la matriz es el error de redondeo excesivo u otras estimaciones que dan como resultado valores de supervivencia superiores a 1,00, lo que a veces da como resultado una supervivencia incluso superior al 100%.  Una estimación de supervivencia de mayor de 1 es que de la nada aumenta la cantidad de individuos sin reproducción o clonaje.  

Por ejemplo en un análisis de *Serapia cordigera* @pellegrino2014effects. Aquí los autores evaluaron las transiciones entre latencia, plántulas, roseta vegetativa y floración. Aquí mostramos una de estas matrices que esta incluida en el material suplementario del articulo. Período de tiempo 2001-2002, A1.


```{r}
library(DiagrammeR)

SerapiaU <- rbind(
  c(0.668, 0.122, 0.294, 0.401),
  c(0.128, 0.0, 0.0, 0.0),
  c(0.0, 0.302, 0.453, 0.366),
  c(0.214, 0.364, 0.185, 0.207)
) # transition matrix

SerapiaF <- rbind(
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0, 0.0)
) # fertility matrix

SerapiaA = SerapiaU+SerapiaF # TF matrix
library(Rage)
stages <- c("latente", "plantulas", "vegetativa", "adulto")

plot_life_cycle(SerapiaA, stages=stages)

# Tenga en cuenta que la suma de supervivencia para la etapa inactiva es mayor que 1, igual a 1.01

```



***

## Estimaciones de fertilidad y ciclo de vida

La importancia de considerar cómo se incluye la fertilidad en el ciclo de vida es extremadamente influyente en los resultados de los modelos, y si se considera erróneamente puede dar lugar a interpretaciones sin sentido. Mostramos algunos ejemplos de cómo estos pueden incluirse en el ciclo de vida y la matriz y dar como resultado problemas de causa. Vea el capitulo \@ref(Fertilidad) para más detalle. 


### Ciclo de vida y etapa de fertilidad incorrectos

Suponga que tiene una especie en la que modela el ciclo de vida como plántula, juvenil y adulto. La fertilidad se mide como el número de semillas producidas por un adulto (número medio de semillas por adulto). Después de recopilar los cálculos de datos, se determina que el número medio de semillas por adulto es 11000. Si agregamos la matriz de transición y fertilidad a continuación y evaluamos el lambda y graficamos el crecimiento de la población con la función *proyecto*, tenemos un lambda de 4.93 y después de solo 5 períodos de tiempo, el número de adultos supera los 250,000. Por consecuencia, la estimación de la tasa de crecimiento de la población sería incorrecta y engañosa, donde 30% de 11,000 semillas crecen a ser plántulas, un total de 3,300 plantulas!!! 

El error es que el valor en la matriz de fertilidad debería corresponder a la primera etapa de la matriz, en este caso la etapa de plántula. Por lo tanto, la esquina superior derecha de la matriz de fertilidad no debe ser la **cantidad media de semillas** por planta, sino la **cantidad media de plántulas** producidas por una planta adulta.

```{r}
library(DiagrammeR)

Sp1matU_Fert <- rbind(
  c(0.0, 0.0, 0.0),
  c(0.3, 0.7, 0.0),
  c(0.0, 0.25, 0.995)
) # transition matrix

Sp1matF <- rbind(
  c(0.0, 0.0, 1100.0),
  c(0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA_Fert = Sp1matU_Fert+Sp1matF # TF matrix
library(Rage)
stages <- c("plantula", "juvenil", "adulto")

lambda(Sp1matA_Fert)

# show change in population size
n
pr <- project(Sp1matA_Fert, vector="n", time=5)
plot(pr) # Note that even after just 5 time periods, the number of adults is larger than 250,000 individuals
```

Si deseamos agregar una etapa de semilla, debemos incluir la etapa en nuestro modelo y matriz con una nueva etapa *la etapa de semilla*, y tener una estimación del número de semillas que germinan y se convierten en plántulas. En el caso de las orquídeas, es probable que sea una estimación difícil de lograr porque las semillas de las orquídeas son difíciles de seguir en la naturaleza a menos que se haya usado el método del paquete de semillas (ref) o se utilizó algún método de huella genética para determinar la procedencia de las semillas.

```{r}
library(DiagrammeR)

Sp1matU_Fert2 <- rbind(
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0001, 0.0, 0.0, 0.0),
  c(0.0, 0.3, 0.7, 0.0),
  c(0.0, 0.0, 0.25, 0.995)
) # transition matrix

Sp1matF2 <- rbind(
  c(0.0, 0.0, 0.0, 1100.0),
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0, 0.0),
  c(0.0, 0.0, 0.0, 0.0)
) # fertility matrix

Sp1matA_Fert2 = Sp1matU_Fert2+Sp1matF2 # TF matrix
library(Rage)
stages <- c("semillas", "plantula", "juvenil", "adulto")

plot_life_cycle(Sp1matA_Fert2, stages=stages)

lambda(Sp1matA_Fert2)

# show change in population size
pr <- project(Sp1matA_Fert2, vector="n", time=5)
plot(pr) # Note that now the number of adults did not increase to the level of the previous model
```

En el ejemplo anterior no hemos incluido una etapa de latencia de semillas. En muchas especies de plantas, las semillas pueden permanecer latentes durante uno o más años. No se sabe si las semillas de las orquídeas están inactivas durante mucho tiempo @gale2010restricciones, excepto para algunas especies que han demostrado que las semillas aún están vivas después de varios años en el suelo usando la prueba de tinción de tetrazolio @rasmussen1993seed y @whigham2006seed. MAS REFERENCIAS!!

***


## Problemas de análisis de datos

### Estimaciones de intervalos de confianza incorrectas

Las estimaciones de dispersión en los parámetros de la matriz de supervivencia, transición, muerte y fertilidad son útiles de múltiples maneras. El enfoque más básico es comprender la incertidumbre en el parámetro como una función del tamaño de la muestra, los parámetros con gran dispersión deben verse con precaución. Los parámetros de dispersión pueden ser útiles para simulaciones y comprender la incertidumbre en los parámetros de población como lambda y la probabilidad de persistencia y extinción.

Los parámetros de supervivencia, muerte, estasis y transiciones NO se distribuyen normalmente ya que los valores van de cero a 1. Ningún valor puede ser menor que cero o mayor que uno, incluidos los intervalos de confianza del 95 % (limitados por 0 y 1). Si se usa la distribución gaussiana (normal) es probable que el IC del 95 % esté fuera de los límites. Supongamos que deseamos calcular la probabilidad de supervivencia de una etapa y sus intervalos de confianza del 95%.

Se deterimna que de 20 individuos 2 fallecen y 19 sobrevivieron entre el primer muestreo y el segundo. 

 - Construya un intervalo de confianza del 95% de la proporción de individuos que murieron
 
Donde la proporción que murió es $\hat{p}$ y el número que murió es $n_d$ y $n$ es el tamaño de la muestra
 
 
$$\hat{p}=\frac{n_d}{n}$$ con una probabilidad de muerte del 20%. 
 
 

```{r}
p=1/20
p
```


El IC del 95% de una proporción se calcula

$$ \hat{p}\pm Z_{0.05}*\sqrt{}(\frac{\hat{p}(1-\hat{p})}{n})$$
- Z_{0.05} es el valor crítico de Z para un IC del 95% = 1.955.  Nota que ese calculo, uno de los intervalos de confianza es negativo.

```{r}
n=20
HCI=p+(1.96*sqrt((p*(1-p))/n)) # IC alto
HCI

LCI=p-(1.96*sqrt((p*(1-p))/n)) # IC bajo
LCI # Nota que el valor es sin sentido, ya que es negativo
```

Un método más fácil es usar la función R *propCI* de la **biblioteca(interceptCI)**


```{r}
library(interpretCI)

resultado=propCI(n=20, p=0.05, alpha=0.05)

resultado
```

## Distribución Dirichlet de intervalo de confianza

Sin embargo, ¿cómo se calcula el IC del 95% cuando hay más de 2 proporciones? Debido a que la proporción de todas las etapas depende de la proporción de las otras etapas, el análisis debe considerar la proporción y el IC del 95% debe incluir todas las etapas simultáneamente. La función requerida es la función de Dirichlet multinomial (multigrupo).


En el análisis estimamos los intervalos de confianza del 95% de la transición y estasis de plántulas a plántulas (50%), juveniles (20%), adultos (0%) y muerte (30%). Tenga en cuenta el gráfico del ciclo de vida que, como de costumbre, excluye la probabilidad de que mueran las plántulas.

```{r}

Dirichlet <- rbind(
  c(0.5, 0.0, 0.0),
  c(0.2, 0.0, 0.0),
  c(0.0, 0.3, 0.7)
) # transition matrix

library(Rage)
stages <- c("plantula", "juvenil", "adulto")

plot_life_cycle(Dirichlet, stages=stages)
```



Para evaluar el intervalo IC del 95% simultáneamente de las cuatro transiciones, usamos la **library(MCMCpack)**, que es un paquete dedicado a realizar simulaciones de *Markov Chain Monte Carlo*. Usaremos la función *MCmultinomdirichlet*. Tenga en cuenta que la primera lista son las proporciones que se muestran en la matriz para la etapa de plántula c(.50*n,.02*n,.0*n,.3*n) multiplicadas por el tamaño de la muestra n= 25. La segunda lista son los priores bayesianos c(.5,.2,0.0001,.3), en este caso asumí que la suma de los previos es igual a 1. Esto da como resultado una confianza muy baja en la percepción previa de lo que es la transiciones. Otro tipo de previa para la transición es que sean iguales, sin embargo, podríamos haber usado c(1,1,0,.000001, 1), donde este previo sugiere una transición igual para todos menos las plántulas que hay muy poca probabilidad que crezcan hasta convertirse en adultos.   

El concepto de lo anterior no se puede explicar completamente aquí, consulte las siguientes referencias para obtener información más detallada.  ANADIR referencias sobre previas.....

Los resultados en la figura muestran que hay mucha dispersión alrededor de la proporción media de las estadísticas y la transición como se esperaba debido al pequeño tamaño de la muestra. 


```{r, message=FALSE}

library(MCMCpack)
```


```{r}
n=25
L=posteriorPRIORL <- MCmultinomdirichlet(c(.50*n,.2*n,.0*n,.3*n), c(.5,.2,0.0001,.3), mc=10000)
dfL=as.data.frame(L)
t(summary(dfL))

#head(dfL)
stack_dfL=stack(dfL)
comb_dfbL= cbind(stack_dfL, T="25")

All_Data3=comb_dfbL
levels(All_Data3$ind)[levels(All_Data3$ind)=="pi.1"]="Plantulas"
levels(All_Data3$ind)[levels(All_Data3$ind)=="pi.2"]="Juvenil"
levels(All_Data3$ind)[levels(All_Data3$ind)=="pi.3"]="Adulto"
levels(All_Data3$ind)[levels(All_Data3$ind)=="pi.4"]="Muerto"

library(ggplot2)
ggplot(data=All_Data3, aes(x=values, fill=ind, colour=ind))+
  geom_density(aes(alpha=.5)) +
  scale_y_continuous(limit=c(0, 5.5))+
  scale_colour_hue(l=60)+
  facet_grid(~ind)



```


Ahora calculemos el IC del 95% de las transiciones

  - Intervalos de confianza de transiciones, estasis y supervivencia basados en simulación y distribución de Dirichlet.
  
Aspectos importantes a tener en cuenta.

 - los IC del 95% están acotados entre 0 y 1. Los valores por debajo de cero o por encima de uno en los parámetros no tendrían sentido.
 - la suma de la media es igual a 1.
 - la suma de la mediana es igual a 1.
 - la forma de la distribución NO se distribuye normalmente, ver figura anterior. La forma de la distribución se llama distribución beta.



```{r}

library(plyr)
library(reshape2)

Transitions=ddply(All_Data3, c("ind"), summarise,
            mean = round(mean(values),3), sd = round(sd(values),4),
            median= median(values),
            #sem = round(sd(values)/sqrt(length(values)),6),
            CI5 = quantile(values, probs = c(0.05)),
            CI95 = round(quantile(values, probs = c(0.95)), 4),
            min=min(values),
            max=max(values)
            )

Transitions

```


Para comparar con el ejemplo anterior asumimos que en lado de tener solamente 25 plantas teníamos 250 plantas para los estimados.

Nota que la mediana sigue en el mismo lugar (casi) pero los IC cambian mucho y es más reducido, ya que con más datos en el muestreo resulta en más confianza y reducción en el IC. Este analisis es primordial para enterder la confianza que uno debería tener sobre los estimados de los parámetros de la matriz.   Un ejemplo si se observa un IC muy grande eso pudiese ser utilizado para modificar la recolección de datos en el campo para aumentar el tamaño de muestra de esa etapa de vida. 


  
```{r}
b=250
L=posteriorPRIORL <- MCmultinomdirichlet(c(.50*b,.2*b,.0*b,.3*b), c(.5,.2,0.0001,.3), mc=10000)
dfL=as.data.frame(L)
t(summary(dfL))

#head(dfL)
stack_dfL=stack(dfL)
comb_dfbL= cbind(stack_dfL, T="25")

All_Data4=comb_dfbL
levels(All_Data4$ind)[levels(All_Data3$ind)=="pi.1"]="Plantulas"
levels(All_Data4$ind)[levels(All_Data3$ind)=="pi.2"]="Juvenil"
levels(All_Data4$ind)[levels(All_Data3$ind)=="pi.3"]="Adulto"
levels(All_Data4$ind)[levels(All_Data3$ind)=="pi.4"]="Muerto"

library(ggplot2)
ggplot(data=All_Data4, aes(x=values, fill=ind, colour=ind))+
  geom_density(aes(alpha=.5)) +
  scale_y_continuous(limit=c(0, 18))+
  scale_colour_hue(l=60)+
  facet_grid(~ind)



```
  
```{r}

library(plyr)
library(reshape2)

Transitions=ddply(All_Data4, c("ind"), summarise,
            mean = round(mean(values),3), sd = round(sd(values),4),
            median= median(values),
            #sem = round(sd(values)/sqrt(length(values)),6),
            CI5 = quantile(values, probs = c(0.05)),
            CI95 = round(quantile(values, probs = c(0.95)), 4),
            min=min(values),
            max=max(values)
            )

Transitions

```



<!--chapter:end:21-Impacto_de_Datos_sin_Sentido.Rmd-->

# Diferentes_componentes_de_Ciclo_de_vida 

## Por: Anne, Fabiola, Aucencia: ECOSUR


## El capitulo sera movido a otra posicion en el libro

titulo: "diferentes_componentes_de_Ciclo_de_vida"

<!--chapter:end:24-Componentes_ciclo_Vida.Rmd-->

# Hojas de datos en el campo

Por: RLT, Nhora, Demetria, Anne....

La hoja de recoleccion de datos deberia estar preparada antes de ir al campo y estar sobre papel que es impermeable y escribir con lapiz.   Ese ultimo punto es bien importante ya que la gran mayoria de los boligrafos son soluble en agua y si el papel se moja ud puede perder sus daos.  RECUERDA que no se puede regresar en el tiempo y recoger los datos. Si Ud tiene su hoja de datos en el laboratorio y se le cae la taza cafe y fue escrito con boligrafo se puede perder los datos.  No se arriega.

es importante tener la lista completa de todos los individuos en la hoja de datos, ya que esto le ayuda asegurarse durante el muestreo que no se le olvida ningun individuo.  Datos olvidado no se puede recuperar


Hoja en blanco para llevarse


```{r}
library(tidyverse)
library(gt)
Hoja_de_campo = tribble(
  ~Número_de_Ind, ~Etapa, ~Cantidad_flores_abierta, ~Cantidad_capullo, ~ Cantidad_Frutos, ~Numero_Hojas, ~Ancho_hoja_mm, ~etc,
  23001,"...","...","...","...","...","...","...",
  23002,"...","...","...","...","...","...","...",
  23003,"...","...","...","...","...","...","...",
  23004,"...","...","...","...","...","...","...",
  23005,"...","...","...","...","...","...","...",
  24006,"...","...","...","...","...","...","...",
  24007,"...","...","...","...","...","...","...",
  24008,"...","...","...","...","...","...","...",
  
)

Hoja_de_campo %>% gt()
```


Usando ejemplo de Tremblay [] y su codificación 

 - p == **plantula**.
 - j == **juvenil**
 - A0 == **adulto non-reproductivo**
 - A1 == **adulto reproductivo**
 - M = **muerto** 

Hoja llena al final del muestreo

```{r}
library(tidyverse)
library(gt)
Hoja_llena = tribble(
  ~Número_de_Ind, ~Etapa, ~Cantidad_flores_abierta, ~Cantidad_capullo, ~ Cantidad_Frutos, ~Numero_Hojas, ~Ancho_hoja_mm, ~etc,
  23001,"p",NA, NA,NA,NA,NA,NA,
  23002,"j",NA, NA,NA,2,10,NA,
  23003,"A1",5, 10,1, 5,32,NA,
  23004,"Ao",0, 0,0,2,14,NA,
  23005,"m",NA, NA,NA,NA,NA,NA,
  24006,"p",NA, NA,NA,NA,NA,NA,
  24007,"j",NA, NA,NA,1,7,NA,
  24008,"p",NA, NA,NA,NA,NA,NA,
  
)

Hoja_llena %>% gt()
```


Nota que solamente los individuos 23003 y 23004 son adultos, uno tiene flores, capullos y frutos y el otro nada.   A todos los adultos hay que llenar la informacion, no dejarlo en blanco.  Para las otras etapas, no es necesario llenar la mayoria de las columnas ya que para las plantulas y muertos no PUEDEN tener esas, pero los juveniles, se puede llenar la cantidad de hojas y sus tamaño.  Nota que el individuo 23005 se murio. 


Esa misma estructura de recoger los dados puede ser utilizado para ponerlo en una hoja de MSExcel, Google Sheet o MacOS Numbers.  


<!--chapter:end:25-Hoja_de_datos.Rmd-->

# 26-Calcular_Transiciones


```{r}
library(readr)
Especie_desconocida <- read_csv("Especie_desconocida.csv")

Especie_desconocida
```



```{r Simple_matrix}
Especie_desconocida
head(Especie_desconocida)
library(popbio)

# Crear TF = TRUE, añadir para formatear correctamente.
TF <- popbio::projection.matrix(as.data.frame(Especie_desconocida), 
                                stage = stage, fate = next_stage, 
                                fertility="fertility", sort=c("p","j","a"), TF = TRUE)

TF # Este es la estructura de etapas de vida para esa población.  Nota que tenemos dos matrices, una de transiciones **T** y otra de fertilidad **F**. 
```



```{r}
library(Rage)
```


```{r}



TF$T
stages <- c("plantula", "juvenil", "adulto")



plot_life_cycle(TF$T, stages=stages)

plot_life_cycle(TF$F, stages=stages)

```

Uniendo ambas matriz en una

```{r}
matA=TF$T+TF$F

matA


stages <- c("plantula", "juevnil", "adulto")
plot_life_cycle(matA, stages=stages)

lambda(matA)
```

 

```{r}

library(readr)
ejercicio_de_orquideas_Hoja_1 <- read_csv("ejercicio_de_orquideas_Hoja_1.csv")

ejercicio_de_orquideas_Hoja_1

unique(ejercicio_de_orquideas_Hoja_1$Etapa_2023)
```


```{r}
# Crear TF = TRUE, añadir para formatear correctamente.
TF2 <- popbio::projection.matrix(as.data.frame(ejercicio_de_orquideas_Hoja_1), 
                                stage = Etapa_2023, 
                                fate = Etapa_2024, 
                                fertility=Fertility_2023, 
                                sort=c("Plantula","Juvenil","Adulta"), TF = TRUE)

TF2
```


```{r}
matA=TF2$T+TF2$F

matA


stages <- c("plantula", "juvenil", "adulto")
plot_life_cycle(matA, stages=stages)

lambda(matA)
```



```{r}

library(popdemo)



```



<!--chapter:end:26-Calcular_Transiciones.Rmd-->

# Nombre del capitulo. {#intro}

All chapters start with a first-level heading followed by your chapter title, like the line above. There should be only one first-level heading (`#`) per .Rmd file.



## A section

## Otra seccion

All chapter sections start with a second-level (`##`) or higher heading followed by your section title, like the sections above and below here. You can have as many as you want within a chapter.

### A subsection {.unnumbered}

The subtopic

#### 

More subdivision

##### 

Even more subdivision

### An unnumbered section {.unnumbered}

Chapters and sections are numbered by default. To un-number a heading, add a `{.unnumbered}` or the shorter `{-}` at the end of the heading, like in this section.

Remember not to use only 1 *\#* as this indicates a new chapter

## NOTE the size of font changes with the number *\#*

### NOTE the size of font changes with the number *\#*

#### NOTE the size of font changes with the number *\#*

##### NOTE the size of font changes with the number *\#*

Don't miss Table \@ref(tab:nice-table).

<!--chapter:end:91-intro.Rmd-->

# Cross-references {#cross}

Cross-references make it easier for your readers to find and link to elements in your book.

## Chapters and sub-chapters

There are two steps to cross-reference any heading:

1. Label the heading: `# Hello world {#nice-label}`. 

    - Leave the label off if you like the automated heading generated based on your heading title: for example, `# Hello world` = `# Hello world {#hello-world}`.
    
    - To label an un-numbered heading, use: `# Hello world {-#nice-label}` or `{# Hello world .unnumbered}`.
    
 

1. Next, reference the labeled heading anywhere in the text using `\@ref(nice-label)`; for example, please see Chapter \@ref(intro). 

    - If you prefer text as the link instead of a numbered reference use: [any text you want can go here](#cross).
    
******


## Captioned figures and tables

Figures and tables *with captions* can also be cross-referenced from elsewhere in your book using `\@ref(fig:chunk-label)` and `\@ref(tab:chunk-label)`, respectively.

See Figure \@ref(fig:nice-fig).

```{r nombre_1}

```


```{r nice-fig, fig.cap='Here is a nice figure!', out.width='80%', fig.asp=.75, fig.align='center'}
par(mar = c(4, 4, .1, .1))
plot(pressure, type = 'b', pch = 19)
```

Don't miss Table \@ref(tab:nice-table).

```{r nice-table, tidy=FALSE}
knitr::kable(
  head(pressure, 10), caption = 'Here is a nice table!',
  booktabs = TRUE
)
```

<!--chapter:end:92-cross-refs.Rmd-->

# (Appendix) List of epiphyitc species {-}

You can add parts to organize one or more book chapters together. Parts can be inserted at the top of an .Rmd file, before the first-level chapter heading in that same file. 

Add a numbered part: `# (PART) Act one {-}` (followed by `# A chapter`)

Add an unnumbered part: `# (PART\*) Act two {-}` (followed by `# A chapter`)

Add an appendix as a special kind of un-numbered part: `# (APPENDIX) Other stuff {-}` (followed by `# A chapter`). Chapters in an appendix are prepended with letters instead of numbers.



# (Appendix) List of terrestrial species {-} 




<!--chapter:end:93-parts.Rmd-->

# Footnotes and citations 

## Footnotes

Footnotes are put inside the square brackets after a caret `^[]`. Like this one ^[This is a footnote.]. 


Let's add a second footnote. In this case we add information on the origin of matrix algebra ^[The term matrix was introduced by the 19th-century English mathematician James Sylvester, but it was his friend the mathematician Arthur Cayley who developed the algebraic aspect of matrices in two papers in the 1850s. ]

Mi tercer footnote es filosofico ^[kgjljgljhggjlhgjhgljgjhl]


## Citations

Reference items in your bibliography file(s) using `@key`.

For example, we are using the **bookdown** package [@R-bookdown] (check out the last code chunk in index.Rmd to see how this citation key was added) in this sample book, which was built on top of R Markdown and **knitr** [@xie2015] (this citation was added manually in an external file book.bib). 
Note that the `.bib` files need to be listed in the index.Rmd with the YAML `bibliography` key.


#### Here is second citation. 

Evolutionary processes in orchids are likely to be a interaction between natural selection and genetic drift [@tremblay2005variation]. 

#### Here is a third citation

un articulo de Damon excepcional [@damon2000review]

## Links to websites


The RStudio Visual Markdown Editor can also make it easier to insert citations: <https://rstudio.github.io/visual-markdown-editing/#/citations>

<https://www.researchgate.net/profile/Raymond-Tremblay>





<!--chapter:end:94-citations.Rmd-->

# Blocks

## Equations

Here is an equation.

\begin{equation} 
  f\left(k\right) = \binom{n}{k} p^k\left(1-p\right)^{n-k}
  (\#eq:binom) 
\end{equation} 

You may refer to using `\@ref(eq:binom)`, like see Equation \@ref(eq:binom). 

  -- this is the script to make the equation connectable in the text

** that the `....` are to make the text visual


## Theorems and proofs

Labeled theorems can be referenced in text using `\@ref(thm:tri)`, for example, check out this smart theorem \@ref(thm:tri).

::: {.theorem #tri}
For a right triangle, if $c$ denotes the *length* of the hypotenuse
and $a$ and $b$ denote the lengths of the **other** two sides, we have
$$a^2 + b^2 = c^2$$

A site to help create your equations $$\bar{x}=\frac{\sum x_{i}}{n}$$




<https://latex.codecogs.com/eqneditor/editor.php>


Ahora se enseña la formula del promedio \@ref(thm:promedio)

::: {.theorem #promedio}
$$\bar{x}= \frac{\sum x_{i}}{n}$$

Si quiere la ecuación en la linea usa solamente un "$" antes y despues de la formula. 
El promedio tiene la siguiente formula $\bar{x}= \frac{\sum x_{i}}{n}$ y la varianza se estima tomando la diferencia entre los valores y el promedio.    




:::

Read more here <https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html>.

***

## Callout blocks


The R Markdown Cookbook provides more help on how to use custom blocks to design your own callouts: https://bookdown.org/yihui/rmarkdown-cookbook/custom-blocks.html

<!--chapter:end:95-blocks.Rmd-->

# Sharing your book

## Publishing

HTML books can be published online, see: https://bookdown.org/yihui/bookdown/publishing.html

## 404 pages

By default, users will be directed to a 404 page if they try to access a webpage that cannot be found. If you'd like to customize your 404 page instead of using the default, you may add either a `_404.Rmd` or `_404.md` file to your project root and use code and/or Markdown syntax.

## Metadata for sharing

Bookdown HTML books will provide HTML metadata for social sharing on platforms like Twitter, Facebook, and LinkedIn, using information you provide in the `index.Rmd` YAML. To setup, set the `url` for your book and the path to your `cover-image` file. Your book's `title` and `description` are also used.



This `gitbook` uses the same social sharing data across all chapters in your book- all links shared will look the same.

Specify your book's source repository on GitHub using the `edit` key under the configuration options in the `_output.yml` file, which allows users to suggest an edit by linking to a chapter's source file. 

Read more about the features of this output format here:

https://pkgs.rstudio.com/bookdown/reference/gitbook.html

Or use:

```{r eval=FALSE}
?bookdown::gitbook
```



<!--chapter:end:96-share.Rmd-->

`r if (knitr::is_html_output()) '
# References {-}
'`

<!--chapter:end:97-references.Rmd-->

# Taller de Dinamica Poblacional

## Esta sección tiene objetivo de presentar una sinopsis de un taller de 3 dias sobre el uso de matrices para el estudio de Dinámica poblacional. 

Lugar: Universidad Nacional de San Antonio Abad del Cusco, Perú Fecha
del taller: 24-26 Noviembre 2023

## *Impartido por*:

**Dr. Raymond L. Tremblay**:

Universidad de Puerto Rico Presidente de Analítica Fundación, Inc

e-mail:

-   [raymond.tremblay\@upr.edu](mailto:raymond.tremblay@upr.edu){.email}

-   [tremblayanaliticafun\@gmail.com](mailto:tremblayanaliticafun@gmail.com){.email}

**Dra. Nhora Helena Ospina-Calderón**:

Pontificia Universidad Javeriana Seccional Cali Profesora-investigadora

e-mail:

-   [nhospina\@javerianacali.edu.co](mailto:nhospina@javerianacali.edu.co){.email}

## Duración del taller:

Tres días con 26 horas totales de Taller-teórico practico con una
experiencia de recolección de datos en el campo (8 horas) y dos días de
taller--teórico practico y análisis de datos (14 horas). Instrucción en
español.

## Certificación A nombre de la

-   Universidad Nacional San Antonio Abad del Cusco (UNSAAC)

-   ANALITICA Fundación Inc. (Puerto Rico)

## Costo del taller Estudiantes:

S/. xxx.00 nuevos soles (\$ 100.00 dol.) locales.

Profesionales: S/. xxx.00 nuevos soles (\$200.00 dol.) Estudiantes
internacional y profesionales

## Cupo: 25 personas

## Introducción

Este taller teórico-práctico se ofrece a los estudiantes interesados en
orquídeas y a las personas interesadas en la conservación de plantas.
Los métodos se enfocarán en el uso de las matrices de Lefkovitch para
construir modelos de historia de vida que sirven a su vez para evaluar
si una población de una especie es estable, está creciendo o se está
reduciendo. Para evaluar el crecimiento de las poblaciones se utiliza el
método de marcar y recapturar (monitorear) individuos en el campo, dicho
método se aplicará para hacer Matrices de Proyección de Poblaciones
(MPP). Se dará énfasis en el manejo para el almacenamiento y
sistematización de datos. Los datos recolectados en el campo serán
utilizados para construir una base de datos que almacene las evidencias
recogidas en el campo y funcione como insumo para calcular las matrices
de transiciones. Posterior a la construcción de matrices de transición
se analizará las tasas de crecimiento (crecimiento poblacional
intrínseco), estimando los errores y los intervalos de confianza con
distribución beta para cada una de las transiciones. También se llevará
a cabo análisis de elasticidad y la proyección del tamaño de la
población. Todos los análisis serán preparados y llevados a cabo en R,
Rstudio y RMarkdown (todos programas de distribución libre).

## Objetivo general:

Introducir las bases teóricas y prácticas para la recolección de datos
de campo que permiten determinar la probabilidad de extinción de una
población.

## Objetivos específicos:

• Conocer las bases teóricas y los métodos modernos de recolección de
datos en el campo para determinar la probabilidad de extinción de una
población.

\
• Conocer los datos básicos y su correcta manipulación para determinar
la viabilidad de una población.

• Manipular correctamente los archivos electrónicos de datos de campo
para proponer la estructura de la población y su posterior depuración
para análisis sobre diferentes formatos.

• Aprender nociones básicas de Excel, R y RStudio para editar y analizar
conjuntos de datos para el uso con análisis de MPP.

• Construir un gráfico de ciclo de vida para la especie estudiada.

• Construir modelos demográficos que permitan predecir la dinámica
poblacional en el tiempo y generar insumos importantes para el manejo y
la conservación

• Estimar los intervalos de confianza de los parámetros del ciclo de
vida de la población.

• Utilizar la información y análisis demográfico para el diagnóstico y
predicciones de la viabilidad de las poblaciones.

• Modelar el tamaño poblacional de la población de estudio para
determinar su posible riesgo de extinción



## Introducción

**23 noviembre- Llegada a Cusco**

-   8:00 pm- 9:15pm

    -   Introducción al taller y Presentación de conceptos básicos
        (Capítulo 2; Tremblay)
    -   Diagrama del ciclo de vida (Capítulo 3; Ospina)
    -   Preparación del viaje de campo

**24 noviembre: Viaje de campo**

-   Salida 6:00 am - Llegada 8:15 am.

    -   Llegada al sitio de muestreo campo

-   8:30am- 5:00pm.

    -   Determinación de la especie a estudiar (Ospina y Tremblay)

    -   Métodos de recolección de datos (Capítulo 4 y 22; Ospina y Tremblay)
    -   Recolección de datos
        

**25 noviembre:**

8:30 pm-10:30 pm

-    Teoria:
    -   Proponer un ciclo de vida (Capítulo 3)
    -   Quien se reproduce y como calcular la fecundidad (Capitulo 6)
    -   Como se ama la matriz (3 x 3) y ejercicio (Capítulo 5)
        -   Subir la matriz a mano
            -   Multiplicación del vector (N en el tiempo t) con la
                matriz = Nt+1

10:30am -- 12:00pm

-    Introducción a la teoria de MPP
    -   crecimiento asimtotico (Capítulo 9)
    -   elasticidad (Capitulo 10)
    -   estructura estable (Capitulo Nuevo)
    -   valor reproductivo (Capitulo Nuevo)

Almuerzo 12:00- 1:00pm

1:00pm - 2:30 pm

-    Organización de los datos en Excel/Numbers/Sheet, estructura de
    la población (Capítulo 4 y 22; Ospina y Tremblay)

2:30pm -- 5:30pm

-   Introducción a R, RStudio y RMarkdown y paquetes de análisis.
    (Tremblay)

-   Subir los datos a RStudio, análisis preliminar de los datos usando
    **popdemo** y **raretrans** (Ospina y Tremblay)

    -   Métodos para calcular contruir la matriz (Capítulo 8, Tremblay)
    -   Incluir la fecundidad (Capítulo 6)
    -   Matriz bayesiana a priori (Capítulo 8, Tremblay)
    -   Calcular los indices de **Oquídea cuscanensis**
        -   crecimiento asintótico (Capítulo 9)
        -   elasticidad (Capítulo 10)
        -   estructura estable (Capítulo Nuevo)
        -   valor reproductivo (Capítulo Nuevo)

**26 noviembre:**

8:30 pm-10:30 pm

-   \- Descripción histórica del uso y aplicaciones de MPP (Capítulo 2,
    16: Tremblay)

10:30am -- 12:00pm

-   Dinamica transitoria *transfer function* (Capítulo 12; Ospina)

-   Dinámica, análisis de viabilidad poblacional: el futuro de la
    especie (Capítulo 9: Tremblay)

Almuerzo 12:00- 1:00pm

1:00pm -- 4:30pm

-   Estudio de casos, asignaciones de tarea. 
    -   *Caladenia xxx*, Terrestre con latencia
    -   *Dracula chimaera*, Epífita y Terrestre
    -   *Dendrophylax lindenii*, Epífita áfila
    -   

4:30pm -- 5:30pm

-   Presentaciones de trabajo (20 minutos por grupo, 10 minutos de preguntas)

## Materiales necesarios:

1.  Computadora portátil (Mac o PC) con Excel, R y Rstudio

-   Los participantes pueden trabajar en parejas en caso de que sea
    difícil conseguir una computadora portatil.\
-   Es necesario acudir a las sesiones teórica/práctica con los programas y
    paquetes previamente instalados, se enviará instrucciones y brindará
    oportuna asesoría.
-   **La instalación de los programados se harán una semana antes del taller, en una conferencia por ZOOM**. 

## Bibliografía

Gascoigne Samuel J. L., Simon Rolph, Daisy Sankey, Nagalakshmi
Nidadavolu, Adrian S. Stell Pičman, Christina M. Hernández, Matthew
Philpott, Aiyla Salam, Connor Bernard, Erola Fenollosa, Jessie McLean,
Shathuki Hetti Achchige Perera, Oliver G. Spacey, Maja Kajin, Anna C.
Vinton, C. Ruth Archer, Jean H. Burns, Danielle L. Buss, Hal Caswell,
Judy P. Che-Castaldo, Dylan Z. Childs, Pol Capdevila, Aldo Compagnoni,
Elizabeth Crone, Thomas H. G. Ezard, Dave Hodgson, Owen Jones, Eelke
Jongejans Jenni McDonald, Brigitte Tenhumberg, Chelsea C. Thomas, Andrew
J. Tyre, Satu Ramula, Iain Stott, Raymond L. Tremblay, Phil Wilson,
James W. Vaupel, and Roberto Salguero-Gómez.. 2023. **A standard
protocol to report discrete stage-structured demographic information.**
Submitted to Methods in Ecology and Evolution. In press.

Stott, I., Hodgson, D. J., & Townley, S. (2012). **Beyond sensitivity:
nonlinear perturbation analysis of transient dynamics. Methods in
Ecology and Evolution**. 3(4), 673-684. doi:
10.1111/j.2041-210X.2012.00199.x

Stott, I., Hodgson, D. J., & Townley, S. (2012b). **Popdemo: An R
package for population demography using projection matrix analysis.
Methods in Ecology and Evolution**, 3(5), 797-802.
<https://doi.org/10.1111/j.2041-210X.2012.00222.x>

Stott, I., Townley, S., & Hodgson, D. J. (2011). **A framework for
studying transient dynamics of population projection matrix models**.
Ecology Letters, 14(9), 959-970. doi: 10.1111/j.1461-0248.2011.01659.x

Tremblay, R. L., & Hutchings, M. J. (2002). **Population dynamics in
orchid conservation: a review of analytical methods based on the rare
species Lepanthes eltoroensis**. Orchid conservation. Kota Kinabalu:
Natural History Publications (Borneo), 183-204.

Tremblay, R. L., Raventos, J., & Ackerman, J. D. (2015). **When
stable-stage equilibrium is unlikely: integrating transient population
dynamics improves asymptotic methods**. Annals of Botany, 116(3),
381-390. <doi:10.1093/aob/mcv031>

Tremblay, R. L., Tyre, A. J., Pérez, M. E., & Ackerman, J. D. (2021).
**Population projections from holey matrices: Using prior information to
estimate rare transition events**. Ecological Modelling, 447, 109526.
<https://doi.org/10.1016/j.ecolmodel.2021.109526>.


**Que conocemos de estas especies?**

Especies reportadas de en el sitio de muestreo (día uno)

-   *Cyrtochilum cimiciferum* (Rchb.f.) Dalström (Tiene una gran población)

-   *Cyrtochilum myanthum* (Lindl.) Kraenzl.1917

-   *Epidendrum chalmersii* Hágsater & Ric. Fernández 2013 (endémico de
    la región Cusco)

-   *Epidendrum syringothyrsus* Rchb.f. ex Hook.f. 1875

-   *Pleurothallis casapensis* Lindl. 1842

-   *Habenaria* sp.

-   *Cyclopogon* sp.

<!--chapter:end:99-Taller_Dinamica_Poblacional.Rmd-->

