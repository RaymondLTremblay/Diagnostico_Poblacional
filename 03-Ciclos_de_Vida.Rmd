# Qué es un diagrama de Ciclo de Vida

Por: 


```{r chap2_1}
library(Rage)
library(DiagrammeR)
```

## Introducción

Todas las especies biológicas tienen una historia de vida, del comienzo de la vida hasta su fallecimiento. La supervivencia de la mayoría de las especie de plantas en su hábitat natural requiere que todas las etapas de vida, desde la semilla, las plántulas, los juveniles, los adultos y el esfuerzo reproductivo, sean continuas dentro de la vida natural del organismo de interés. Aunque esos son las etapas más común incluidos en análisis algunas especies pudiese que ya no tenga por ejemplo semillas y se reproduce por clonaje (e.i. guineo **Otros ejemplos**). Nuestra perspectiva para análisis de conservación y ecológica es evaluar toda la información del ciclo de vida de una especies comprender las características del ciclo de vida que limitan la supervivencia y la reproducción de una especie en su hábitat natural y identificar cual son las etapas más relevante para impactar el crecimiento poblacional. 

La supervivencia de las especies depende de los procesos viables del ciclo de vida que resultan en una población estable o en un aumento en el tamaño de la población.  El proceso más apropiado para determinar la persistencia de una población es evaluar todas las etapas críticas de la historia de vida de una especie y utilizar matrices de proyección de población para determinar el potencial del cambio poblacional, si aumenta, disminuya o es estable.  

Siempre uno debería comenzar por crear modelos de diagramas de ciclo de vida antes de cualquier estudio.  Esto se debería hacer antes de la recolección de datos para visualizar el ciclo de vida hipotético de la especie de interés. La visualización del ciclo de vida es una herramienta muy útil para identificar las etapas críticas de la historia de vida de una especie y para determinar qué factores pudiese influir en el crecimiento y la supervivencia de la población y determinar cual son los datos a recolectar en el campo.  Estos diagramas son muy útiles para entender la biología de un organismo y para identificar los posibles factores que influyen en su desarrollo. 

En esta primera parte presentamos diferentes ejemplos de diagramas de ciclo de vida y cómo se pueden crear en R. Enfatizando lo hipotético versus lo que se puede recolectar en el campo. 
Un diagrama de ciclo de vida es una representación gráfica de los diferentes estadios que atraviesa un organismo a lo largo de su vida. En este capítulo, veremos cómo se pueden crear diagramas de ciclo de vida en R utilizando la librería `Rage`.

## Ejemplo de ciclos de vida sencillo

El primer ejemplo comenzamos con un ejemplo de un ciclo de vida sencillo con tres estadios: semillas, plántulas y adultos. Vamos a sumir que es una planta que se reproduce sexualmente, y que las semillas no tienen banco de semilla (latencia de germinación entre periodos).  En este caso, las semillas germinan y se convierten en plántulas o se mueren. Las plántulas crecen y se convierten en adultos o se mueren. Los adultos se reproducen y mueren. Por consecuencia el ciclo de vida dura 3 años. El primer año es el año de la semilla, el segundo año es el año de la plántula y el tercer año es el año del adulto y reproducción.  Nota que este es un ciclo de vida hipotético y que no todos los organismos tienen un ciclo de vida de 3 años y raramente tan sencillo. 

El la matriz de transición de este ciclo de vida es la siguiente: 50% de la semillas germinan y se convierten en plántulas, 40% de las plántulas se convierten en adultos y cada adultos en promedio deja 3.2 semillas. Las lineas verde representan crecimiento y la linea amarilla representan reproducción. 





```{r chap2_2}
# hidden code to produce figures
matA <- rbind(
  c(0.0, 0.0, 3.2),
  c(0.5, 0.0, 0.0),
  c(0.0, 0.4, 0.0)
)


stages <- c("semillas", "plantulas", "adultos")
title <- NULL
graph <- expand.grid(to = stages, from = stages)
graph$trans <- round(c(matA), 3)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", stages, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 3
graph$col <- c(
  "PaleGreen4", "PaleGreen4", "Goldenrod1"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 

```

## Ejemplo de una orquídea hipotética

En el siguiente gráfico se muestra un ciclo de vida hipotética de una orquídea epifita. La orquídea comienza como una semilla que germina en un árbol. La plántula crece y se convierte en un juvenil y subsiguientemente en un adulto que florece y produce semillas. En cada uno de las etapas menos de la semilla se puiede quedar en la misma etapa de un año a otro.  En este caso, la orquídea tiene un ciclo de vida de múltiples años. El primer año es el año de la semilla, el segundo año es el año de la plántula pero esta etapa los individuos pueden quedarse en esta etapa de un año al otro, igual como las etapas de juveniles y adulto. Cuando los individuos se pueden quedar en la misma etapa hay valores mayor de cero en la diagonal. Solamente los adultos pueden reproducir semillas. 

Las lineas en verde representa crecimiento, las lineas en rojo representan quedarse en la misma etapa y las lineas en amarillo representan reproducción.

Nota aquí es que si este diagrama representa la recolección de datos en el campo uno debería de recolectar datos de la etapa de semilla, plántula, juvenil y adulto. En nuestra búsqueda de literatura no encontramos ni una publicación que recolectara datos de todas las etapas de vida de una orquídea. En parte por la dificultad de encontrar semillas y plántulas en el campo. Especialmente por la dificultad de encontrar semillas y seguir su desarrollo de un año a otro.


```{r chap2_3}
# hidden code to produce figures
library(DiagrammeR)
matA <- rbind(
  c(0.0, 0.0, 0.0, 3.2),
  c(0.5, 0.3, 0.0, 0.0),
  c(0.0, 0.4, 0.20, 0.0),
  c(0.0, 0.0, 0.40, 0.80)
)


stages <- c("semillas", "plantulas", "juvenil", "adultos")
title <- NULL
graph <- expand.grid(to = stages, from = stages)
graph$trans <- round(c(matA), 3)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", stages, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 3
graph$col <- c(
  "PaleGreen4", 
  "red", "PaleGreen4", 
  "red", "PaleGreen4", 
  "Goldenrod1", "red"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 



```



## Ciclo de vida de orquídea en publicaciones

En la siguiente veremos diferentes ciclos de vida utilizados en varias publicaciones. Demostramos que no hay un ciclo de vida estándar y que cada ciclo de vida es único. Los ejemplos representan tanto especies terrestre como epifitas, y la complejidad entre los ciclos de vida hipotéticas y lo que se puede recolectar el el campo.   


### Especie Epífitas

#### *Laelia speciosa*

La siguiente información proviene de la tesina de Mariana Hernández-Apolinar [@hernandez1992dinamica].

La historia de vida es representada por 5 etapas. Los datos provienen de la figura 25a de la tesina.

- Semillas
- Plántulas
- 3 etapas de tamaño de planta donde 2 de las etapas son adultos y pueden producir semillas

Nota aquí que se hizo un estimado de la cantidad de semillas producidas y la proporciones de semillas que germinan y se convierten en plántulas el siguiente año. 


```{r chap2_5}
# hidden code to produce figures
library(DiagrammeR)
matA <- rbind(
  c(0.0,     0.0,  0.00, 52686, 127324),
  c(0.00022, 0.0,  0.00, 0.0,   0.0),
  c(0.0,     0.71, 0.93, 0.0,   0.0),
  c(0.0,     0.0,  0.07, 0.76,   0.0),
  c(0.0,     0.0,  0.00, 0.24,   0.75)
)


stages <- c("semillas", "plántulas", "tamaño 1", "tamaño 2", "tamaño 3")
title <- NULL
graph <- expand.grid(to = stages, from = stages)
graph$trans <- round(c(matA), 5)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", stages, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 3
graph$col <- c(
  "PaleGreen4", 
  "PaleGreen4", 
  "red", "PaleGreen4", 
  "Goldenrod1", "red", "PaleGreen4",
  "Goldenrod1", "red"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 



```



#### *Telipogon helleri*

En el trabajo de [@raventos2018comparison] se recolectaron datos de la etapa de inmaduros, reproductivo pequeños y reproductivo grandes.  La historia de vida es representada por 3 etapas. Los datos provienen de la figura 1 de la publicación de [@rraventos2018comparison]. En este caso, los autores le interesa el efecto de perturbaciones sobre el crecimiento poblacional evaluando el efecto de perturbaciones con análisis de dinámica transitoria.  

Los observaron tres tipos de transiciones en la historia de vida de la orquídea *Telipogon helleri*.  Las etapas que pasen una tamaño/etapa pequeña a más grande el próximo año son de color verde, los que se quedan en la misma etapa son de color roja, los individuos que se ponen más pequeños son de color violeta y amarillo es la reproducción de las etapas adultas.



```{r Telipogon_helleri}


matA_Th=matrix(c(                  
 0.1548, 0.1573, 0.5309,
 0.2738, 0.4425, 0.1606,
 0.0238, 0.4060, 0.7368), byrow=TRUE,ncol=3)

matA_Th

stages <- c("inmaduros", "reproductivo_pequeños", "reproductivo_grandes")
title <- NULL
graph <- expand.grid(to = stages, from = stages)
graph$trans <- round(c(matA_Th), 3)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", stages, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 3
graph$col <- c(
  "red", "PaleGreen4", "PaleGreen4", 
  "Goldenrod1", "red", "PaleGreen4", 
  "Goldenrod1", "MediumOrchid4", "red" 
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 

```




### Especie Terrestres

#### *Prasophyllum correctum*

Es este trajabo se recolectaron datos de la etapa de plántula, juvenil, adulto y latencia.  La historia de vida es representada por 4 etapas. Los datos provienen de la figura 4 de la publicación de [@coates2006effects], donde hay un periodo de 3 o más años entre los periodos de régimen de fuegos. Una de la etapas distintivas de esta especie es la latencia, en otra palabra plantas que no emergen de un año a otro. Muchas especies de orquídeas tienen latencia. en estas especies la única etapa que podemos estimar la mortandad es después de la latencia.  Esto típicamente es un problema de muestreo y no la biológia de la especie, ya que frecuentemente las especies muestreada son en peligro de extinción y no se pueden recolectar datos de todas las etapas de vida para determinar si cuando no se ven la planta es viva (debajo el suelo) o muerta. Como son en peligro de extinción no permite o no es ético modificar el hábitat para determinar si la planta esta viva o muerta.  En este caso, se hace unos análisis para determinar cual es la probabilidad que un individuo con latencia de múltiples años este vivo.

Las etapas que pasen a latente el proximo año son de color azul, los que se quedan en la misma etapa son de color roja (incluyende de latente a latente), verde es crecimiento y amarillo es reproducción. 




```{r Prasophyllum_correctum}
# hidden code to produce figures
library(DiagrammeR)
matA <- rbind(
  c(0.0, 0.0,     0.0125, 0.0),
  c(0.0, 0.2874,  0.375,  0.1364),
  c(0.0, 0.0230,  0.15,   0.0303),
  c(1.000, 0.6897,  0.475,  0.7475)
)


stages <- c("plántulas", "adultos vegetativos", "adultos reproductivos", "latencia")
title <- NULL
graph <- expand.grid(to = stages, from = stages)
graph$trans <- round(c(matA), 4)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", stages, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 2
graph$col <- c(
  "blue", 
  "red", "PaleGreen4", "blue",
  "Goldenrod1", "PaleGreen4", "red", "blue",
  "PaleGreen4", "PaleGreen4", "red"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 



```



#### *Ophrys sphegodes*  

En el trabajo de Waite y Hutchings 1991, se recolectaron datos de la etapa de plantas vegetativa, plantas con flores y latencia de un año y dos años, por consecuencia la historia de vida es representada por 4 etapas. Los datos provienen de la figura 1 y la tabla 3b (periodo de herbivoría por oveja) de la publicación de [@waite1991effects]. En este caso, se hace unos análisis para determinar cual es la probabilidad que un individuo con latencia de múltiples años este vivo comparando periodos de herbivoría por ganados versus ovejas.

Nota que este caso el objetivo de la publicación era determinar la probabilidad de que un individuo con latencia de múltiples años (uno o dos) este vivo.  Por consecuencia no incluye reproducción (nota que no hay linea amarilla). Las etapas que pasen a latente el próximo año son de color azul, los que se quedan en la misma etapa son de color roja, verde es de una etapa no latente.

            
            
```{r Ophrys}
# hidden code to produce figures
library(DiagrammeR)
G1=matrix(c(0.0080, 0.0184,   0.0149, 0.0148,
            0.0180,  0.4249,  0.1214, 0.1214,
            0.1853,  0.2770,  0,      0,
            0,       0,       0.3050, 0), byrow=TRUE,ncol=4)


stages <- c("Vegetativa", "Ind. con Flores", "Latencia año 1", "Latencia año 2")
title <- NULL
graph <- expand.grid(to = stages, from = stages)
graph$trans <- round(c(G1), 4)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", stages, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 2
graph$col <- c(
  "red", "PaleGreen4", "blue",
  "PaleGreen4", "red", "blue",
  "PaleGreen4", "PaleGreen4",  "blue",
  "PaleGreen4", "PaleGreen4"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 



```


#### *Cypripedium parviflorum*, *Epipactus atrorubens* y *Orchis purpurea*

La dimensiones de la matriz y la cantidad de etapas/años incluido en un análisis depende de múltiples factores.  Sin duda si son datos del campo el acceso de las etapas de vida es un factor importante.  Revisión de las publicaciones de orquídea se observa análisis con dimensiones de matrices que van de 29 a 3, con un promedio de 5.6 etapas (desv. estandard de 3.2).  El trabajo que incluyo el máximo de etapas fue el trabajo de [@shefferson2014life] con 29 etapas en *Cypripedium parviflorum* var. *parviflorum*.  En la especies *Epipactus atrorubens* se evaluó el costo de estar latente después de diferentes etapas. En este análisis usaron 11 etapas, donde hubiese una probabilidad de latencia después de todas las etapas emergente [@jakalaniemi2011orchids].  En *Orchis purpurea* los autores modelaron la especie usando 6 etapas de vida, protocormos, turberculos, plantulas, juveniles (más de un año y menos de 3 hojas), plantas sin flores (más de 3 hojas) y plantas con flores [@jacquemyn2010seed].  

La transiciones a una etapa más mayor son en verde, las transiciones a una etapa más pequeña son violeta y la reproducción en amarillo.   




```{r}
matA_Os=matrix(c(
0.000, 0.000, 0, 0.00, 0.000, 84.88725,
0.012, 0.000, 0, 0.00, 0.000,  0.00000,
0.000, 0.041, 0, 0.00, 0.000,  0.00000,
0.000, 0.000, 1, 0.75, 0.000,  0.00000,
0.000, 0.000, 0, 0.25, 0.615,  0.62500,
0.000, 0.000, 0, 0.00, 0.385,  0.37500), byrow=TRUE,ncol=6)

matA_Os  



stages <- c("Protocormos", "tuberculos", "Plantulas", "Juveniles", "Sin Flores", "Con Flores")
title <- NULL
graph <- expand.grid(to = stages, from = stages)
graph$trans <- round(c(matA_Os), 6)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", stages, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 2
graph$col <- c(
   "PaleGreen4",
  "PaleGreen4",
  "PaleGreen4",
  "red", "PaleGreen4",  
  "red", "PaleGreen4", 
  "Goldenrod1","MediumOrchid4", "red"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 
```




```{r Basic, echo=FALSE}
# hidden code to produce figures
library(DiagrammeR)
matA <- rbind(
  c(0.0, 0.0, 3.2),
  c(0.5, 0.3, 0.8),
  c(0.0, 0.4, 0.9)
)


stages <- c("semillas", "plantulas", "adultos")
title <- NULL
graph <- expand.grid(to = stages, from = stages)
graph$trans <- round(c(matA), 3)
graph <- graph[graph$trans > 0, ]
nodes <- paste(paste0("'", stages, "'"), collapse = "; ")
graph$min_len <- (as.numeric(graph$to) - as.numeric(graph$from)) * 3
graph$col <- c(
  "PaleGreen4", "PaleGreen4", "PaleGreen4", "Goldenrod1",
  "MediumOrchid4", "PaleGreen4"
)
edges <- paste0("'", graph$from, "'", " -> ", "'", graph$to, "'",
  "[minlen=", graph$min_len,
  ",fontsize=", 10,
  ",color=", graph$col,
  ",xlabel=", paste("\"", graph$trans),
  "\"]\n",
  collapse = ""
)
grViz(
  paste(
    "
digraph {
  {
    graph[overlap=false];
    rank=same;
    node [shape=", "egg", ", fontsize=", 12, "];",
    nodes, "
  }",
    "ordering=out
  x [style=invis]
  x -> {", nodes, "} [style=invis]", edges,
    "labelloc=\"t\";
  label=\"", title, "\"
}"
  )
) 



```


## Ejemplo de un diagrama de un ciclo de vida usando el paquete ggplot

Nota aquí podemos usar otro paquete de R. La diferencia es que no se puede cambiar los colores de las lineas y los nodos.  Es una opción más sencilla para crear diagramas de ciclo de vida. 
 

```{r chap2_4}
library(Rage)
plot_life_cycle(matA, stages=stages, fontsize = 0)

```










## Code for color coding figure

http://rich-iannone.github.io/DiagrammeR/

## Ejemplo de un cicle de vida con estadio de post reproducción



## Ejemplo de un cicle de vida incompleto (y biologicamente erroneos)



## Referencias
